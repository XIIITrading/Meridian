import{f as x,a9 as E,a8 as P,V as B,S as D,aD as L,fU as M,a4 as O,a5 as T,gn as A,L as j,il as h,gW as b,gU as C,gV as k}from"./DOFFjK0_.js";import{u as Y}from"./SJHyi9T4.js";import{d as u}from"./boyBAVNN.js";import{e as p}from"./D2QgEzTv.js";const[X,F]=Y(a=>{const{$api:R}=x(),{t:g}=E(),{base:_}=P(B()),{metas:S}=D(),o=e=>(e.rowMeta||(e.rowMeta={}),e.rowMeta.ltarState||(e.rowMeta.ltarState={}),e.rowMeta.ltarState),H=async(e,t,s)=>{if(h(s)||b(s)){if(o(e)[s.title]||(o(e)[s.title]=[]),o(e)[s.title].find(r=>u(r,t)))return O.info(g("msg.info.valueAlreadyInList"));Array.isArray(t)?o(e)[s.title].push(...t):o(e)[s.title].push(t)}else(C(s)||k(s))&&(o(e)[s.title]=t)},N=async(e,t,s)=>{var r,i;h(s)||b(s)?(i=o(e)[s.title])==null||i.splice((r=o(e)[s.title])==null?void 0:r.indexOf(t),1):(C(s)||k(s))&&(o(e)[s.title]=null)},I=async(e,t,s,r,{metaValue:i=a.value}={})=>{try{await R.dbTableRow.nestedAdd(A,(i==null?void 0:i.base_id)??_.value.id,i==null?void 0:i.id,encodeURIComponent(e),r,s.id,encodeURIComponent(t))}catch(l){O.error(await T(l))}};return{addLTARRef:H,removeLTARRef:N,syncLTARRefs:async(e,t,{metaValue:s=a.value}={})=>{var i,l,d,y;const r=p(t,s==null?void 0:s.columns);for(const n of(s==null?void 0:s.columns)??[]){if(!L(n))continue;const c=n.colOptions,w=(i=S.value)==null?void 0:i[c==null?void 0:c.fk_related_model_id];if(h(n)||b(n)){const v=((l=o(e))==null?void 0:l[n.title])??[];for(const f of v)await I(r,p(f,w.columns),n,c.type,{metaValue:s})}else(C(n)||k(n))&&((d=o(e))!=null&&d[n.title])&&await I(r,p((y=o(e))==null?void 0:y[n.title],w.columns),n,c.type,{metaValue:s});o(e)[n.title]=null}},loadRow:async e=>{var s,r,i,l;const t=await R.dbTableRow.read(A,((s=a.value)==null?void 0:s.base_id)??((r=_.value)==null?void 0:r.id),(i=a.value)==null?void 0:i.title,encodeURIComponent(p(e.row,(l=a.value)==null?void 0:l.columns)));Object.assign(j(e),{row:t,oldRow:{...t},rowMeta:{...e.rowMeta,new:!1}})},clearLTARCell:async(e,t)=>{var s,r,i,l,d,y,n,c,w,v;try{if(!t||!L(t))return;const f=(r=S.value)==null?void 0:r[(s=t==null?void 0:t.colOptions)==null?void 0:s.fk_related_model_id];if(e.rowMeta.new)o(e)[t.title]=null;else if([M.BELONGS_TO,M.ONE_TO_ONE].includes((i=t.colOptions)==null?void 0:i.type)){if(!e.row[t.title])return;await R.dbTableRow.nestedRemove(A,((l=a.value)==null?void 0:l.base_id)??_.value.id,(d=a.value)==null?void 0:d.id,p(e.row,(y=a.value)==null?void 0:y.columns),(n=t.colOptions)==null?void 0:n.type,t.id,p(e.row[t.title],f==null?void 0:f.columns)),e.row[t.title]=null}else{for(const U of e.row[t.title]||[])await R.dbTableRow.nestedRemove(A,((c=a.value)==null?void 0:c.base_id)??_.value.id,(w=a.value)==null?void 0:w.id,encodeURIComponent(p(e.row,(v=a.value)==null?void 0:v.columns)),(t==null?void 0:t.colOptions).type,t.id,encodeURIComponent(p(U,f==null?void 0:f.columns)));e.row[t.title]=[]}}catch(f){O.error(await T(f))}},cleaMMCell:async(e,t)=>{var s,r,i,l;try{if(!t||!L(t))return;if(e.rowMeta.new)o(e)[t.title]=null;else if(((s=t.colOptions)==null?void 0:s.type)===M.MANY_TO_MANY){if(!e.row[t.title])return;const d=await R.dbDataTableRow.nestedListCopyPasteOrDeleteAll((r=a.value)==null?void 0:r.id,t.id,[{operation:"deleteAll",rowId:p(e.row,(i=a.value)==null?void 0:i.columns),columnId:t.id,fk_related_model_id:(l=t.colOptions)==null?void 0:l.fk_related_model_id}]);return e.row[t.title]=null,Array.isArray(d.unlink)?d.unlink:[]}}catch(d){O.error(await T(d))}}}},"smartsheet-ltar-helpers");function Z(){const a=F();if(a==null)throw new Error("Please call `useSmartsheetLtarHelpers` on the appropriate parent component");return a}export{Z as a,X as u};
