import{e as Z,aX as J,r as d,gy as ee,G as g,aZ as ae,aY as te,cd as se,aM as ne,n as y,gi as oe,W as le,aQ as ie,b0 as D,aj as ce,ac as de,I as u,K as _,L as t,o as l,w as o,b as p,ap as re,ad as ue,O as _e,a as n,c as S,M as pe,t as i,ag as me,d as C,N as F,ez as fe,P as V,an as ge,aq as ve,eO as we,aT as be,j as ke,ae as ye,aG as xe,f$ as he,g0 as Ie,f_ as Se}from"./DOFFjK0_.js";import{_ as Ce}from"./0vrXc9P0.js";import{u as Ve}from"./B3Wp9c04.js";import{a as Be}from"./C1uRXLg7.js";import{u as Me}from"./BfzMHcOa.js";import"./MNXVOE4I.js";import"./SJHyi9T4.js";import"./DG2ZEhLK.js";import"./D2QgEzTv.js";import"./boyBAVNN.js";const je={class:"flex items-center gap-2"},Oe={key:0,class:"flex items-center gap-0.5"},Ne={class:"text-capitalize !text-[13px] font-medium flex items-center gap-1"},Te={class:"!text-[13px] font-medium truncate !leading-5"},$e={class:"flex flex-col gap-2"},De={class:"nc-fields-list"},Fe={class:"grouping-field"},Le=["title"],Ee={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Ge={class:"flex items-center gap-1"},Ke={class:"text-sm text-gray-800"},Ue=Z({__name:"StackedBy",setup(ze){J(ee,d(!0));const L=g(ae,d()),m=g(te,d()),E=g(se,d(!1)),f=g(ne,d(!1)),B=g(oe,y(()=>!1)),{fields:G,loadViewColumns:K,metaColumnById:M}=Ve(),{kanbanMetaData:v,loadKanbanMeta:j,loadKanbanData:U,updateKanbanMeta:O,groupingField:z}=Be(),{addUndo:N,defineViewScope:T}=le(),c=d(!1);Me(c),ie(()=>{var e;return(e=m.value)==null?void 0:e.id},async(e,a)=>{e!==a&&L.value&&await K()},{immediate:!0});const x=async e=>{var a;await O({fk_grp_col_id:e}),await j(),await U(),((a=m.value)==null?void 0:a.view).fk_grp_col_id=e},w=y({get:()=>v.value.fk_grp_col_id,set:async e=>{e&&(N({undo:{fn:await x,args:[v.value.fk_grp_col_id]},redo:{fn:await x,args:[e]},scope:T({view:m.value})}),await x(e))}}),h=async e=>{var r,k;const a={...D((r=v.value)==null?void 0:r.meta),hide_empty_stack:e};await O({meta:a}),await j(),((k=m.value)==null?void 0:k.view).meta=a},I=d(null),b=y({get:()=>{var e;return D((e=v.value)==null?void 0:e.meta).hide_empty_stack||!1},set:async e=>{I.value="hideEmptyStack",N({undo:{fn:h,args:[b.value]},redo:{fn:h,args:[e]},scope:T({view:m.value})}),await h(e),I.value=null}}),P=y(()=>{var e;return(e=G.value)==null?void 0:e.filter(a=>a.fk_column_id&&M.value[a.fk_column_id].uidt===ce.SingleSelect).map(a=>({value:a.fk_column_id,label:a.title}))}),R=()=>{c.value=!1},q=e=>ke(Se(e)?he:Ie,{columnMeta:e});return(e,a)=>{const r=pe,k=_e,$=re,A=we,H=fe,Q=ye,W=Ce,X=xe,Y=de("e");return t(E)?_("",!0):(l(),u(X,{key:0,visible:t(c),"onUpdate:visible":a[5]||(a[5]=s=>V(c)?c.value=s:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu overflow-hidden",class:"!xs:hidden"},{overlay:o(()=>[t(c)?(l(),S("div",{key:0,class:"p-4 w-90 bg-white nc-table-toolbar-menu rounded-lg flex flex-col gap-5",onClick:a[4]||(a[4]=F(()=>{},["stop"]))},[n("div",$e,[n("div",null,i(e.$t("general.groupingField")),1),n("div",De,[n("div",Fe,[p(H,{value:t(w),"onUpdate:value":a[0]||(a[0]=s=>V(w)?w.value=s:null),class:"nc-select-shadow w-full nc-kanban-grouping-field-select !rounded-lg","dropdown-class-name":"!rounded-lg",placeholder:"Select a Grouping Field",disabled:t(f),onChange:R,onClick:a[1]||(a[1]=F(()=>{},["stop"]))},{suffixIcon:o(()=>[p(r,{icon:"arrowDown",class:"text-gray-700"})]),default:o(()=>[(l(!0),S(ge,null,ve(t(P),s=>(l(),u(A,{key:s.value,value:s.value},{default:o(()=>[n("div",{class:"w-full flex gap-2 items-center justify-between",title:s.label},[n("div",Ee,[s.value?(l(),u(be(q(t(M)[s.value])),{key:0,class:"!w-3.5 !h-3.5 !text-current opacity-80 !ml-0"})):_("",!0),p($,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:o(()=>[C(i(s.label),1)]),default:o(()=>[C(i(s.label),1)]),_:2},1024)]),t(w)===s.value?(l(),u(r,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):_("",!0)],8,Le)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])])])]),n("div",Ge,[p(Q,{checked:t(b),"onUpdate:checked":a[2]||(a[2]=s=>V(b)?b.value=s:null),size:"small",class:"nc-switch",loading:t(I)==="hideEmptyStack",disabled:t(f)},{default:o(()=>[n("div",Ke,i(e.$t("general.hide"))+" "+i(e.$t("general.empty").toLowerCase())+" "+i(e.$t("general.stack").toLowerCase()),1)]),_:1},8,["checked","loading","disabled"])]),t(f)?(l(),u(W,{key:0,class:"-mb-4 -mx-4",onOnOpen:a[3]||(a[3]=s=>c.value=!1)})):_("",!0)])):_("",!0)]),default:o(()=>[p($,{disabled:!t(B),class:"nc-kanban-btn"},{title:o(()=>[C(i(e.$t("activity.kanban.stackedBy")),1)]),default:o(()=>[ue((l(),u(k,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn !border-0 !h-7 group",size:"small",type:"secondary","show-as-disabled":t(f)},{default:o(()=>[n("div",je,[p(r,{icon:"settings",class:"h-4 w-4"}),t(B)?_("",!0):(l(),S("div",Oe,[n("span",Ne,i(e.$t("activity.kanban.stackedBy")),1),n("div",{class:me(["flex items-center rounded-md transition-colors duration-0.3s bg-gray-100 px-1 min-h-5 max-w-[108px]",{"group-hover:bg-gray-200":!t(f)}])},[n("span",Te,i(t(z)),1)],2)]))])]),_:1},8,["show-as-disabled"])),[[Y,["c:kanban:change-grouping-field"]]])]),_:1},8,["disabled"])]),_:1},8,["visible"]))}}}),Je=Object.assign(Ue,{__name:"SmartsheetToolbarStackedBy"});export{Je as default};
