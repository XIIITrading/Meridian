import{b3 as ee,c as f,o as c,a as s,e as se,a9 as te,f as ae,bm as oe,a7 as le,r as U,eQ as _,X as M,n as I,oK as ne,I as p,w as l,b as o,d as g,t as i,at as ie,au as re,L as n,aT as T,b9 as C,ad as ce,a0 as de,a1 as me,ar as ue,N as _e,bB as pe,an as ve,aq as fe,eO as xe,K as he,ap as ye,M as ge,af as we,ah as be,ag as ke,cb as $e,a4 as v,a5 as Ue,l0 as Me,_ as Ie}from"./DOFFjK0_.js";import{u as Te}from"./CNJqPN7Y.js";import{T as Ce}from"./CUrqgAoI.js";import{_ as Ee}from"./BrfakvRE.js";const Re={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Be(E,d){return c(),f("svg",Re,d[0]||(d[0]=[s("path",{fill:"currentColor",d:"M3 20V4l19 8zm2-3l11.85-5L5 7v3.5l6 1.5l-6 1.5zm0 0V7z"},null,-1)]))}const Ve=ee({name:"material-symbols-send-outline",render:Be}),je={class:"flex flex-col"},Ne={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 w-full"},Se={class:"px-2 mt-1.5"},De={key:0,class:"flex flex-col mt-1 pb-5"},Oe={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},ze={class:"text-xs ml-0.5 mt-0.5","data-rec":"true"},Fe={class:"flex flex-row justify-between items-center py-1"},Le={class:"flex pl-2 text-green-700 text-xs","data-rec":"true"},qe={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2","data-rec":"true"},Ae={class:"flex flex-row justify-end mt-4 ml-2"},Pe={class:"flex flex-row justify-center items-center space-x-0.5"},We={class:"text-xs text-gray-600","data-rec":"true"},Ke={key:1,class:"flex flex-col pb-4"},Ge={class:"border-1 py-3 px-4 rounded-md mt-1"},Qe={class:"flex flex-row space-x-4"},Xe={class:"flex flex-col w-3/4"},He={class:"ml-1 mb-1 text-xs text-gray-500","data-rec":"true"},Je={class:"flex flex-col w-2/4"},Ye={class:"ml-1 mb-1 text-xs text-gray-500"},Ze={class:"w-full flex items-start gap-1"},es={class:"flex-1 max-w-[calc(100%_-_16px)]"},ss={class:"nc-select-hide-item text-gray-500 text-xs whitespace-normal","data-rec":"true"},ts={class:"flex flex-row justify-end"},as={class:"flex flex-row justify-center items-center space-x-1.5"},os={"data-rec":"true"},ls=se({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(E,{emit:d}){const x=d,{t:w}=te(),{$api:R,$e:h}=ae(),{copy:B}=oe(),{dashboardUrl:V}=Te(),{clearBasesUser:j}=le(),t=U({emails:"",role:_.VIEWER,invitationToken:void 0}),b=U(),N=M.useForm,S=I(()=>({emails:[ne]})),{validateInfos:D}=N(t.value,S),O=async()=>{var e;h("a:org-user:invite",{role:t.value.role}),await((e=b.value)==null?void 0:e.validateFields());try{const a=await R.orgUsers.add({roles:t.value.role,email:t.value.emails});t.value.invitationToken=a.invite_token,x("reload"),v.success(w("msg.success.userAdded")),j()}catch(a){console.error(a),v.error(await Ue(a))}},y=I(()=>t.value.invitationToken?`${V.value}#/signup/${t.value.invitationToken}`:null),z=async()=>{if(y.value){try{await B(y.value),v.success(w("msg.toast.inviteUrlCopy"))}catch(e){v.error(e.message)}h("c:shared-base:copy-url")}},F=()=>{h("c:user:invite-more"),t.value.invitationToken=void 0,t.value.role=_.VIEWER,t.value.emails=""},L=e=>e==null?void 0:e.focus(),q=e=>{var m;const a=((m=e.clipboardData)==null?void 0:m.getData("text"))??"";t.value.emails=Me(a)||a},A=[{title:"objects.roleType.orgLevelCreator",subtitle:"msg.info.roles.orgCreator",value:_.CREATOR},{title:"objects.roleType.orgLevelViewer",subtitle:"msg.info.roles.orgViewer",value:_.VIEWER}];return(e,a)=>{const m=Ce,P=re,u=ie,W=Ee,k=Ve,K=ue,$=de,G=ye,Q=ge,X=xe,H=pe,J=M,Y=$e;return c(),p(Y,{class:ke({active:e.show}),footer:null,centered:"",visible:e.show,closable:!1,width:"max(50vw, 44rem)","wrap-class-name":"nc-modal-invite-user",onCancel:a[3]||(a[3]=r=>x("closed"))},{default:l(()=>[s("div",je,[s("div",Ne,[o(m,{class:"select-none",level:4,"data-rec":"true"},{default:l(()=>[g(i(e.$t("activity.inviteUser")),1)]),_:1}),o(u,{type:"text",class:"!rounded-md mr-1 -mt-1.5",onClick:a[0]||(a[0]=r=>x("closed"))},{icon:l(()=>[o(P,{"data-testid":"nc-root-user-invite-modal-close",class:"flex mx-auto"})]),_:1})]),s("div",Se,[n(t).invitationToken?(c(),f("div",De,[s("div",Oe,[(c(),p(T(("iconMap"in e?e.iconMap:n(C)).account))),s("div",ze,i(e.$t("activity.copyInviteURL")),1)]),o(W,{class:"!mt-2",type:"success","show-icon":""},{message:l(()=>[s("div",Fe,[s("div",Le,i(n(y)),1),o(u,{type:"text",class:"!rounded-md -mt-0.5",onClick:z},{icon:l(()=>[(c(),p(T(("iconMap"in e?e.iconMap:n(C)).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),s("div",qe,i(e.$t("msg.info.userInviteNoSMTP"))+" "+i(n(t).invitationToken&&n(t).emails),1),s("div",Ae,[o(u,{size:"middle",outlined:"",onClick:F},{default:l(()=>[s("div",Pe,[o(k,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),s("div",We,i(e.$t("activity.inviteMore")),1)])]),_:1})])])):(c(),f("div",Ke,[s("div",Ge,[o(J,{ref_key:"formRef",ref:b,"validate-on-rule-change":!1,model:n(t),"validate-trigger":"onBlur",onFinish:O},{default:l(()=>[s("div",Qe,[s("div",Xe,[o($,me(n(D).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:e.$t("msg.plsInputEmail")}]}),{default:l(()=>[s("div",He,i(e.$t("datatype.Email"))+":",1),o(K,{ref:L,value:n(t).emails,"onUpdate:value":a[1]||(a[1]=r=>n(t).emails=r),size:"middle",class:"nc-input-sm","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),onPaste:_e(q,["prevent"])},null,8,["value","placeholder"])]),_:1},16,["rules"])]),ce(s("div",Je,[o($,{name:"role",rules:[{required:!0,message:e.$t("msg.roleRequired")}]},{default:l(()=>[s("div",Ye,i(e.$t("labels.selectUserRole")),1),o(H,{value:n(t).role,"onUpdate:value":a[2]||(a[2]=r=>n(t).role=r),class:"w-55 nc-user-roles","dropdown-match-select-width":!1,"dropdown-class-name":"nc-dropdown-user-role max-w-64"},{default:l(()=>[(c(),f(ve,null,fe(A,(r,Z)=>o(X,{key:Z,class:"nc-role-option",value:r.value},{default:l(()=>[s("div",Ze,[s("div",es,[o(G,{"show-on-truncate-only":"",class:"truncate","data-rec":"true"},{title:l(()=>[g(i(e.$t(r.title)),1)]),default:l(()=>[g(" "+i(e.$t(r.title)),1)]),_:2},1024),s("div",ss,i(e.$t(r.subtitle)),1)]),n(t).role===r.value?(c(),p(Q,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):he("",!0)])]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["rules"])],512),[[we,!("isEeUI"in e?e.isEeUI:n(be))]])]),s("div",ts,[o(u,{type:"primary",class:"!rounded-md","html-type":"submit"},{default:l(()=>[s("div",as,[o(k,{class:"flex h-[0.8rem]"}),s("div",os,i(e.$t("activity.invite")),1)])]),_:1})])]),_:1},8,["model"])])]))])])]),_:1},8,["class","visible"])}}}),ds=Object.assign(Ie(ls,[["__scopeId","data-v-3e85fefd"]]),{__name:"AccountUsersModal"});export{ds as default};
