const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DRQrXP7Q.js","./DOFFjK0_.js","./entry.DDfSYhWa.css","./D2QgEzTv.js","./PlainCell.CJha1QXQ.css","./BmeEgVC9.js","./DBe8bXbT.js","./RecordCard.pwDI-3DF.css","./0c4tmWST.js","./DG2ZEhLK.js","./SJHyi9T4.js","./4PLl4EP6.js","./DcFNOSET.js","./boyBAVNN.js","./D1gZ4Fpg.js","./Bo7kLdUR.js","./BYGCxle3.js","./B3Wp9c04.js","./C1uRXLg7.js","./DGuB8RA-.js","./D_wq2ltS.js","./Item.C85DUSg3.css","./9aYOtC5C.js","./index.CotXCNy2.css","./DunK-51v.js","./DivDataCell.D_9SDUsb.css","./ps5He39s.js","./CHgOe2F-.js","./MSgi_m6o.js","./JKos0pQW.js","./CQugZrqw.js","./index._6B72PDH.css","./BdLxRlCP.js","./YaKnxhzO.js","./Markdown.CUPXKfeQ.css","./CNJqPN7Y.js","./AxsiR11P.js","./C9H3ht2d.js","./Comments.BKDN6dt-.css","./CkXo2doe.js","./CV-2bRRD.js","./TimeSelector.DAR2lbHN.css","./Czlq_f4Y.js","./Cgx2iu1G.js","./C6nWwNvX.js","./Cell.Dgtcn0F2.css","./DiUleKVo.js","./JUJEmhCv.js","./Modal.CB1oWLel.css","./BrfakvRE.js","./CJtI8BMq.js","./Bgc5K1P7.js","./D4c215jk.js","./lL-0_K96.js","./BClTqpVB.js","./CYkscC4Z.js","./DEAKw9Pl.js","./Cl-qOJW6.js","./BNo10Mdm.js","./index.C8L8AhJa.css","./CtJu2gHc.js","./MNXVOE4I.js","./LockView.BWC8JyQk.css","./CMyFGii6.js","./qgYlKlk5.js","./Cb5B9eG-.js","./C_qz9woQ.js","./DA4KItu_.js","./D8wgK-Ih.js","./HdsRe6lq.js","./index.N-A1gxk9.css","./DzBSAsxR.js","./FilterInput.7KjqjE1F.css","./4fFkR2QG.js","./Pagination.XVPzwtel.css","./CAfhvBOi.js","./BcKPINb2.js","./VirtualCell.6f0pX0MN.css","./D0vnHTOx.js","./BRTCxTHu.js","./DDEVLD8O.js","./-rIuSlCu.js","./SpSJ8E4d.js","./Dh5zKH8k.js","./ColumnMenu.DQG9Y5_N.css","./CiBV2ZED.js","./ZNRZafJ9.js","./BhfICdUA.js","./NRjd0XWG.js","./RfUK_fd6.js","./SelectOptions.DqNkMQ-A.css","./hehmy6V1.js","./BvG7Iv4q.js","./CyXz1Zkk.js","./CPChVVVr.js","./CFXGfO_A.js","./VKUQM8lk.js","./BqWeTF94.js","./sgaWLnOz.js","./BpgQOThx.js","./DmoodaOn.js","./B3tDgntu.js","./Db9kSA7A.js","./EditOrAddProvider.C2farLzy.css","./B4YnCsMc.js","./6zXueAcs.js","./Byuk3M83.js","./D-8_fbld.js","./DminWhpq.js","./index.Bp-YHGEB.css"])))=>i.map(i=>d[i]);
import{e as ze,n as T,r as R,f as Ve,fv as Pe,as as Be,G as de,aZ as Oe,gl as Ie,cm as o,o6 as $e,c as M,o as b,a as Y,an as P,aq as N,ag as ce,L as v,t as Ae,K as ve,N as fe,cn as Fe,b as me,w as pe,aS as Z,I as Te,aV as Ne,aW as Q,_ as Xe}from"./DOFFjK0_.js";import{i as je,e as $}from"./D2QgEzTv.js";import{a as qe}from"./6Zptevrc.js";import{u as We}from"./DG2ZEhLK.js";import{u as Ue}from"./B3Wp9c04.js";import"./SJHyi9T4.js";import"./C1uRXLg7.js";import"./boyBAVNN.js";const Ge=Z(()=>Q(()=>import("./DRQrXP7Q.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(D=>D.default||D)),He=Z(()=>Q(()=>import("./BmeEgVC9.js"),__vite__mapDeps([5,1,2,6,7]),import.meta.url).then(D=>D.default||D)),Je=Z(()=>Q(()=>import("./0c4tmWST.js").then(D=>D.R),__vite__mapDeps([8,1,2,9,10,11,3,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109]),import.meta.url).then(D=>D.default||D)),Ke={class:"flex h-6"},Ye=["onClick","onDblclick"],Ze=["onClick","onDblclick"],Qe={class:"absolute nc-scrollbar-md overflow-y-auto z-2 mt-6 pointer-events-none inset-0","data-testid":"nc-calendar-week-record-container"},et=["data-testid","data-unique-id","onMouseover","onMousedown"],tt=ze({__name:"DateField",emits:["expandRecord","newRecord"],setup(D,{emit:we}){const X=we,{selectedDateRange:g,formattedData:k,formattedSideBarData:ee,calendarRange:A,selectedDate:j,displayField:ye,updateRowProperty:q,viewMetaProperties:ge,updateFormat:B,isSyncedFromColumn:_e}=qe(),{isSyncedTable:he}=We(),x=T(()=>{var e;return(e=ge.value)!=null&&e.hide_weekend?5:7}),L=R(null),{$e:Re}=Ve(),{width:De}=Pe(L),{isUIAllowed:S}=Be(),O=de(Oe,R()),be=de(Ie,R()),{fields:te}=Ue(),xe=T(()=>te.value?new Map(te.value.map(e=>[e.fk_column_id,{underline:e.underline,bold:e.bold,italic:e.italic}])):new Map),W=e=>xe.value.get(e.id),ae=T(()=>{let e=o(g.value.start),n=o(g.value.end);x.value===5&&(n=n.subtract(2,"day"));const a=[];for(;e.isBefore(n)||e.isSame(n,"day");)a.push(o(e)),e=e.add(1,"day");return a}),Ee=(e,n,a)=>{let i=0;for(;;){let r=!0;for(let t=0;t<a;t++){const l=n+t;if(e[l]||(e[l]={}),e[l][i]){r=!1;break}}if(r)return i;i++}},ne=e=>{const n=x.value===5?o(g.value.end).subtract(2,"day"):o(g.value.end);return e&&e.isBetween(o(g.value.start).startOf("day"),o(n).endOf("day"),"day","[]")},Me=T(()=>{if(!k.value||!A.value)return[];const e=Array.from({length:7},()=>({})),n=[],a=De.value/x.value;return A.value.forEach(({fk_from_col:i,fk_to_col:r})=>{if(!i)return;const t=l=>{const u=l.rowMeta.id??$e();let s=o(l.row[i.title]);const p=s.clone(),c=r?o(l.row[r.title]):s;s.isBefore(g.value.start)&&(s=o(g.value.start));const w=s.diff(g.value.start,"day"),h=r?Math.min(Math.max(c.diff(s,"day")+1,1),x.value-w):1,f=Ee(e,w,h);for(let y=0;y<h;y++){const E=w+y;e[E]||(e[E]={}),e[E][f]=!0}const d=ne(p),C=ne(c);let V="none";d&&C?V="rounded":d?V="leftRounded":C&&(V="rightRounded"),n.push({...l,rowMeta:{...l.rowMeta,range:{fk_from_col:i,fk_to_col:r},position:V,id:u,spanningDays:Math.abs(p.diff(c,"day"))-Math.abs(s.diff(c,"day")),style:{width:`calc(max(${h*a+.5}px, ${a+.5}px))`,left:`${w*a-1}px`,top:`${f*28+Math.max(f+1,1)*8}px`}}})};r?k.value.filter(l=>{const u=o(l.row[i.title]),s=o(l.row[r.title]);return u.isValid()&&s.isValid()&&!s.isBefore(u)&&!s.isBefore(g.value.start,"day")}).forEach(t):k.value.forEach(t)}),n}),z=R(null),U=R(!1),G=R(),I=R(!1),m=R(),F=R(),_=R(null),H=R(),ke=Ne((e,n,a)=>{q(e,n,a)},500),oe=e=>{var h,f;if(!S("dataEdit")||!L.value||!_.value)return;const{width:n,left:a}=L.value.getBoundingClientRect(),i=(e.clientX-a-window.scrollX)/n,r=(h=_.value.rowMeta.range)==null?void 0:h.fk_from_col,t=(f=_.value.rowMeta.range)==null?void 0:f.fk_to_col;if(!r||!t)return;const l=o(_.value.row[t.title]),u=o(_.value.row[r.title]),s=Math.floor(i*x.value);let p=[],c;if(F.value==="right"){let d=o(g.value.start).add(s,"day");if(p=[t.title],o(d).isBefore(u,"day")&&(d=u.clone()),!d.isValid())return;c={..._.value,row:{..._.value.row,[t.title]:d.format(B.value)}}}else if(F.value==="left"){let d=o(g.value.start).add(s,"day");if(p=[r.title],o(d).isAfter(l)&&(d=o(o(l)).clone()),!d)return;c={..._.value,row:{..._.value.row,[r.title]:o(d).format(B.value)}}}const w=$(c.row,O.value.columns);k.value=k.value.map(d=>$(d.row,O.value.columns)===w?c:d),ke(c,p,!1)},le=()=>{U.value=!1,F.value=null,_.value=null,document.removeEventListener("mousemove",oe),document.removeEventListener("mouseup",le)},Se=(e,n,a)=>{S("dataEdit")&&(U.value=!0,F.value=e,_.value=a,document.addEventListener("mousemove",oe),document.addEventListener("mouseup",le))},J=R({x:null,y:null}),K=(e,n)=>{var d,C,V;const{width:a,left:i}=(d=L.value)==null?void 0:d.getBoundingClientRect(),r=e.clientX-i,t=r/a,l=(C=m.value.rowMeta.range)==null?void 0:C.fk_from_col,u=(V=m.value.rowMeta.range)==null?void 0:V.fk_to_col;if(!l)return{updatedProperty:[],newRow:null};const s=Math.floor(t*x.value-m.value.rowMeta.spanningDays-Math.max(0,Math.min(1,r/a))),p=o(g.value.start).add(s,"day");if(!p)return{updatedProperty:[],newRow:null};let c;const w={...m.value,row:{...m.value.row,[l.title]:o(p).format(B.value)}},h=[l.title];if(u){const y=m.value.row[l.title]?o(m.value.row[l.title]):null,E=m.value.row[u.title]?o(m.value.row[u.title]):null;y&&E?c=o(p).add(E.diff(y,"day"),"day"):y&&!E?c=o(p).endOf("day"):!y&&E?c=o(p).endOf("day"):c=p.clone(),w.row[u.title]=o(c).format(B.value),h.push(u.title)}const f=$(w.row,O.value.columns);return n?(k.value=[...k.value,w],ee.value=ee.value.filter(y=>$(y.row,O.value.columns)!==f)):k.value=k.value.map(y=>$(y.row,O.value.columns)===f?w:y),{updateProperty:h,newRow:w}},re=e=>{S("dataEdit")&&(!L.value||!m.value||(e.preventDefault(),K(e,!1)))},se=e=>{if(e.preventDefault(),clearTimeout(G.value),!S("dataEdit")||!I.value||!L.value||!m.value)return;const{updateProperty:n,newRow:a}=K(e);if(!a)return;document.querySelectorAll(".draggable-record").forEach(r=>{r.style.visibility="",r.style.opacity="100%"}),z.value&&(z.value.style.boxShadow="none",z.value=null),m.value=void 0,q(a,n,!1),J.value={x:null,y:null},document.removeEventListener("mousemove",re),document.removeEventListener("mouseup",se)},Ce=(e,n)=>{if(U.value||_e.value)return;let a=e.target;I.value=!1,J.value={x:e.clientX-a.getBoundingClientRect().left,y:e.clientY-a.getBoundingClientRect().top},G.value=setTimeout(()=>{if(!S("dataEdit"))return;for(I.value=!0;!a.classList.contains("draggable-record");)a=a.parentElement;document.querySelectorAll(".draggable-record").forEach(t=>{t.getAttribute("data-unique-id").includes(n.rowMeta.id)||(t.style.opacity="30%")}),I.value=!0,z.value=a,m.value=n,document.addEventListener("mousemove",re),document.addEventListener("mouseup",se)},200);const i=()=>{clearTimeout(G.value),J.value={x:null,y:null},document.removeEventListener("mouseup",i),I.value||X("expandRecord",n)};document.addEventListener("mouseup",i)},Le=e=>{var a;if(!S("dataEdit"))return;e.preventDefault();const n=(a=e.dataTransfer)==null?void 0:a.getData("text/plain");if(n){const{record:i}=JSON.parse(n);m.value=i;const{updateProperty:r,newRow:t}=K(e,!0);z.value&&(z.value.style.boxShadow="none",z.value=null),q(t,r,!1),Re("c:calendar:day:drag-record")}},ie=e=>{j.value=e,m.value=void 0},ue=e=>{if(!S("dataEdit")||!A.value||!he.value)return;const n=A.value[0].fk_from_col;if(!n)return;const a={row:{[n.title]:e.format(B.value)}};X("newRecord",a)};return(e,n)=>{const a=Ge,i=He,r=Je;return b(),M("div",{class:"flex relative flex-col prevent-select","data-testid":"nc-calendar-week-view",onDrop:Le},[Y("div",Ke,[(b(!0),M(P,null,N(v(ae),(t,l)=>(b(),M("div",{key:l,class:ce([{"selected-date-header":v(o)(t).isSame(v(j),"day"),"w-1/5":v(x)===5,"w-1/7":v(x)===7},"cursor-pointer text-center text-[10px] font-semibold leading-4 flex items-center justify-center uppercase text-gray-500 w-full py-1 border-gray-200 border-l-gray-50 border-t-gray-50 last:border-r-0 border-1 bg-gray-50"]),onClick:u=>ie(t),onDblclick:u=>ue(t)},Ae(v(o)(t).format("DD ddd")),43,Ye))),128))]),Y("div",{ref_key:"container",ref:L,class:"flex h-[calc(100vh-7.3rem)] w-full"},[(b(!0),M(P,null,N(v(ae),(t,l)=>(b(),M("div",{key:l,class:ce([{"selected-date":v(o)(t).isSame(v(j),"day"),"!bg-gray-50":t.get("day")===0||t.get("day")===6,"w-1/5":v(x)===5,"w-1/7":v(x)===7},"flex cursor-pointer flex-col border-r-1 min-h-[100vh] last:border-r-0 items-center"]),"data-testid":"nc-calendar-week-day",onClick:u=>ie(t),onDblclick:u=>ue(t)},null,42,Ze))),128))],512),Y("div",Qe,[(b(!0),M(P,null,N(v(Me),(t,l)=>{var u;return b(),M(P,{key:l},[((u=t.rowMeta.style)==null?void 0:u.display)!=="none"?(b(),M("div",{key:0,"data-testid":`nc-calendar-week-record-${t.row[v(ye).title]}`,"data-unique-id":t.rowMeta.id,style:Fe({...t.rowMeta.style,lineHeight:"18px"}),class:"absolute group draggable-record pointer-events-auto nc-calendar-week-record-card",onMouseleave:n[0]||(n[0]=s=>H.value=null),onMouseover:s=>H.value=t.rowMeta.id,onMousedown:fe(s=>Ce(s,t),["stop"])},[me(r,{row:t},{default:pe(()=>{var s,p,c,w,h;return[me(i,{hover:v(H)===t.rowMeta.id,dragging:t.rowMeta.id===((p=(s=v(m))==null?void 0:s.rowMeta)==null?void 0:p.id)||t.rowMeta.id===((w=(c=v(_))==null?void 0:c.rowMeta)==null?void 0:w.id),position:t.rowMeta.position,record:t,resize:!!((h=t.rowMeta.range)!=null&&h.fk_to_col)&&v(S)("dataEdit"),onDblclick:fe(f=>X("expandRecord",t),["stop"]),onResizeStart:Se},{default:pe(()=>[(b(!0),M(P,null,N(v(be),(f,d)=>(b(),M(P,{key:d},[("isRowEmpty"in e?e.isRowEmpty:v(je))(t,f)?ve("",!0):(b(),Te(a,{key:0,modelValue:t.row[f.title],"onUpdate:modelValue":C=>t.row[f.title]=C,class:"text-xs",bold:W(f).bold,column:f,italic:W(f).italic,underline:W(f).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},1032,["hover","dragging","position","record","resize","onDblclick"])]}),_:2},1032,["row"])],44,et)):ve("",!0)],64)}),128))])],32)}}}),dt=Object.assign(Xe(tt,[["__scopeId","data-v-a5caf81e"]]),{__name:"SmartsheetCalendarWeekViewDateField"});export{dt as default};
