const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CxSafZTa.js","./DOFFjK0_.js","./entry.DDfSYhWa.css","./BYGCxle3.js","./Cell.DrFrP4_9.css","./B2f1fstS.js","./VirtualCell.krPvGNjk.css"])))=>i.map(i=>d[i]);
import{e as ee,n as E,mS as se,f as le,aD as G,aQ as B,I as R,o as w,L as e,w as T,a as P,c as S,K as W,ag as O,b as x,t as K,an as U,aq as X,aS as oe,f_ as ae,aW as ne,aX as ie,aZ as re,_ as ue,r as de,es as ce,S as me,fU as k,bh as fe,aj as Z,ak as _e,dC as pe,ao as he,M as ye,by as ge,d as ve,a1 as ke,P as be,$ as we}from"./DOFFjK0_.js";import{_ as xe}from"./sgaWLnOz.js";import{_ as Ae,l as $e,d as q,a as Ce}from"./Dju0KrVl.js";import{u as te,P as V,a as H,i as D,b as J,M as Ne,W as Me,R as Q,G as Oe,O as Te,c as Le}from"./BlIUVhTI.js";const ze=oe(()=>ne(()=>import("./CxSafZTa.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(b=>b.default||b)),Ee=oe(()=>ne(()=>import("./B2f1fstS.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(b=>b.default||b)),Ye={class:"capitalize"},Se={key:0},Pe={key:1,class:"py-1 pr-0.5"},Ie=ee({__name:"TableNode",props:{data:{},showSkeleton:{type:Boolean},dragging:{type:Boolean}},setup(b){const{viewport:I}=te(),i=E(()=>b.data.table),L=se(!1,200);ie(re,i);const{$e:F}=le(),v=t=>t.type==="mm"?t.fk_parent_column_id:t.fk_child_column_id,p=E(()=>b.data.pkAndFkColumns.length||b.data.nonPkColumns.length),C=E(()=>b.data.nonPkColumns.filter(t=>!(t.system&&G(t)&&/.*_nc_m2m_.*/.test(t.title))));return B(()=>I.value.zoom,()=>{L.value=!0}),(t,N)=>{const $=xe,Y=ze,M=Ee,A=Ae;return w(),R(A,{class:"h-full flex flex-1 justify-center items-center","modifier-key":t.showSkeleton||e(I).zoom>.35?"Alt":void 0,disabled:t.dragging||e(L)},{title:T(()=>[P("div",Ye,K(e(i).table_name),1)]),default:T(()=>[P("div",{class:O(["relative h-full max-w-76 flex flex-col justify-center bg-white min-w-16 min-h-8 rounded-lg nc-erd-table-node",[`nc-erd-table-node-${e(i).table_name}`,t.showSkeleton?"cursor-pointer items-center min-h-200px min-w-300px":""]]),onClick:N[0]||(N[0]=r=>e(F)("c:erd:node-click"))},[P("div",{class:O([[(t.showSkeleton,""),(e(p),"")],"text-gray-800 text-sm py-4 border-b-1 border-gray-200 rounded-t-lg w-full h-full px-3 font-medium flex items-center"])},[x($,{class:O(["text-primary",{"!text-6xl !w-auto mr-2 !h-18":t.showSkeleton}]),meta:e(i)},null,8,["class","meta"]),P("div",{class:O([t.showSkeleton?"text-6xl":"","flex pr-2 pl-1"])},K(e(i).title),3)],2),t.showSkeleton?(w(),S("div",Se,[x(e(H),{style:{left:"-20px"},class:"opacity-0",position:e(V).Left,type:"target",connectable:!1},null,8,["position"]),x(e(H),{style:{right:"-15px"},class:"opacity-0",position:e(V).Right,type:"source",connectable:!1},null,8,["position"])])):e(p)?(w(),S("div",Pe,[(w(!0),S(U,null,X(t.data.pkAndFkColumns,r=>(w(),S("div",{key:r.title,class:O(["w-full h-full min-w-32 py-2 px-1",`nc-erd-table-node-${e(i).table_name}-column-${r.column_name}`])},[r?(w(),R(Y,{key:0,class:"nc-erd-table-node-column",column:r,"hide-menu":!0},null,8,["column"])):W("",!0)],2))),128)),(w(!0),S(U,null,X(e(C),(r,z)=>{var g;return w(),S("div",{key:r.title},[P("div",{class:O(["relative w-full h-full flex items-center min-w-32 py-2 px-1",z+1===e(C).length?"rounded-b-lg":""])},[e(G)(r)?(w(),S("div",{key:0,class:O(["flex w-full",`nc-erd-table-node-${e(i).table_name}-column-${(g=r.title)==null?void 0:g.toLowerCase().replace(" ","_")}`])},[x(e(H),{id:`s-${v(r.colOptions)}-${e(i).id}`,class:"opacity-0 !right-[-1px]",type:"source",position:e(V).Right,connectable:!1},null,8,["id","position"]),x(e(H),{id:`d-${v(r.colOptions)}-${e(i).id}`,class:"opacity-0 !left-[-1px]",type:"target",position:e(V).Left,connectable:!1},null,8,["id","position"]),x(M,{class:"nc-erd-table-node-column",column:r,"hide-menu":!0},null,8,["column"])],2)):e(ae)(r)?(w(),R(M,{key:1,column:r,"hide-menu":!0,class:O(`nc-erd-table-node-column nc-erd-table-node-${e(i).table_name}-column-${r.column_name}`)},null,8,["column","class"])):(w(),R(Y,{key:2,column:r,"hide-menu":!0,class:O(`nc-erd-table-node-column nc-erd-table-node-${e(i).table_name}-column-${r.column_name}`)},null,8,["column","class"]))],2)])}),128))])):W("",!0)],2)]),_:1},8,["modifier-key","disabled"])}}}),Re=Object.assign(ue(Ie,[["__scopeId","data-v-12643fac"]]),{__name:"ErdTableNode"});function Ve(b,I){const i=de([]),{theme:L}=ce(),F=$e().domain([0,2]).range([L.value.primaryColor,L.value.accentColor]),v=new q.graphlib.Graph;v.setDefaultEdgeLabel(()=>({})),v.setGraph({rankdir:"LR",align:"UL",nodesep:50,ranksep:100});const{metasWithIdAsKey:p}=me(),C=E(()=>e(b)),t=E(()=>e(I)),N=300,$=E(()=>t.value.showViews&&t.value.showAllColumns?50:40),Y=E(()=>C.value.reduce((n,a)=>{var l,u;const y=((l=p.value[a.id].columns)==null?void 0:l.filter(s=>G(s)&&s.system!==1))||[];for(const s of y){const c=s.colOptions,o=s.fk_model_id,m=c.fk_related_model_id,f=C.value.find(_=>_.id===o),h=C.value.find(_=>_.id===m);if(o&&m&&f&&h){const _={source:o,target:m,childColId:c.fk_child_column_id,parentColId:c.fk_parent_column_id,modelId:c.fk_mm_model_id,type:k.HAS_MANY};if(c.type===k.HAS_MANY){_.type=k.HAS_MANY,n.push(_);continue}if(c.type===k.ONE_TO_ONE){if(_.type=k.ONE_TO_ONE,(u=s.meta)!=null&&u.bt)continue;n.push(_);continue}if(c.type===k.MANY_TO_MANY&&!n.find(j=>j.type===k.MANY_TO_MANY&&j.parentColId===c.fk_child_column_id&&j.childColId===c.fk_parent_column_id)){_.type=k.MANY_TO_MANY,n.push(_);continue}}}return n},[]));function M({type:n,source:a,target:d,modelId:y,childColId:l,parentColId:u}){var m,f;let s;n===k.HAS_MANY?s="has many":n===k.MANY_TO_MANY?s="many to many":n==="oo"&&(s="one to one");const c=(m=p.value[a].columns)==null?void 0:m.find(h=>{const _=h.colOptions;return _?_.fk_child_column_id===l&&_.fk_parent_column_id===u&&_.fk_mm_model_id===y:!1}),o=(f=p.value[d].columns)==null?void 0:f.find(h=>{const _=h.colOptions;return _?_.fk_parent_column_id===(n===k.MANY_TO_MANY?l:u):!1});if(!c||!o)return"";if(n===k.MANY_TO_MANY&&t.value.showJunctionTableNames){if(!y)return"";const h=p.value[y];return h?h.title!==h.table_name?[`${h.title} (${h.table_name})`]:[h.title]:""}return[`[${p.value[a].title}] ${c.title} - ${s} - ${o.title} [${p.value[d].title}]`,`${p.value[a].title} - ${s} - ${p.value[d].title}`]}function A(){return C.value.reduce((n,a)=>{var u;if(!a.id)return n;const d=((u=p.value[a.id].columns)==null?void 0:u.filter(s=>[Z.CreatedBy,Z.LastModifiedBy].includes(s.uidt)&&s.system?!1:t.value.showAllColumns||!t.value.showAllColumns&&G(s)))||[],y=d.filter(()=>t.value.showPkAndFk).filter(s=>s.pk||s.uidt===Z.ForeignKey),l=d.filter(s=>!s.pk&&s.uidt!==Z.ForeignKey);return n.push({id:a.id,data:{table:p.value[a.id],pkAndFkColumns:y,nonPkColumns:l,showPkAndFk:t.value.showPkAndFk,showAllColumns:t.value.showAllColumns,columnLength:d.length,color:""},type:"custom",position:{x:0,y:0}}),n},[])}function r(){return Y.value.reduce((n,{source:a,target:d,childColId:y,parentColId:l,type:u,modelId:s})=>{let c,o;(u===k.HAS_MANY||u==="oo")&&(c=y,o=y),u===k.MANY_TO_MANY&&(c=l,o=y);const[m,f]=M({source:a,target:d,type:u,childColId:y,parentColId:l,modelId:s});return n.push({id:`e-${c}-${a}-${o}-${d}-#${m}`,source:`${a}`,target:`${d}`,sourceHandle:`s-${c}-${a}`,targetHandle:`d-${o}-${d}`,type:"custom",markerEnd:{id:"arrow-colored",type:Ne.ArrowClosed},data:{isManyToMany:u===k.MANY_TO_MANY,isOneToOne:u==="oo",isSelfRelation:a===d&&c===o,label:m,simpleLabel:f,color:""}}),n},[])}const z=(n,a)=>({});return{elements:i,layout:async(n=!1)=>new Promise(a=>{i.value=[...A(),...r()];for(const o of i.value)if(D(o)){const f=o.data.columnLength,h=n?N*3:N,_=$.value+(n?250:f>0?$.value*f:$.value);v.setNode(o.id,{width:h,height:_})}else J(o)&&v.setEdge(o.source,o.target);q.layout(v);let d=1/0,y=1/0,l=-1/0,u=-1/0;for(const o of i.value)if(D(o)){const m=v.node(o.id),f=n?N*3:N,h=$.value+(n?250:o.data.columnLength>0?$.value*o.data.columnLength:$.value);d=Math.min(d,m.x-f/2),y=Math.min(y,m.y-h/2),l=Math.max(l,m.x+f/2),u=Math.max(u,m.y+h/2)}const s=-(d+l)/2,c=-(y+u)/2;for(const o of i.value)if(D(o)){const m=F(v.predecessors(o.id).length),f=v.node(o.id);o.targetPosition=V.Left,o.sourcePosition=V.Right,o.position={x:f.x+s,y:f.y+c},o.class=["rounded-lg border-1 border-gray-200 shadow-lg"].join(" "),o.data.color=m,o.style=h=>(h.selected,z())}else if(J(o)){const m=i.value.find(f=>f.id===o.source);if(m){const f=m.data.color;o.data.color=f,o.markerEnd.color=`#${fe(f).toHex()}`}}a()})}}const Fe=ee({__name:"Flow",props:{tables:{},config:{}},setup(b){const I=b,{tables:i,config:L}=_e(I),{$destroy:F,fitView:v,viewport:p,setMaxZoom:C,onNodeDoubleClick:t,zoomIn:N,zoomOut:$}=te({minZoom:.05,maxZoom:2}),{layout:Y,elements:M}=Ve(i,L),A=E(()=>p.value.zoom<.15);async function r(){await Y(A.value),await we(),setTimeout(()=>{v({duration:200,padding:.1,minZoom:p.value.zoom||1,maxZoom:p.value.zoom||1})},100)}function z(g){v({nodes:g?[g]:void 0,duration:200,minZoom:.2})}return t(({node:g})=>{A.value&&z(),setTimeout(()=>{z(g.id)},250)}),B(i,r,{flush:"post",immediate:!0}),B(A,async g=>{Y(g).then(()=>{g&&v({duration:300,padding:.1,minZoom:p.value.zoom,maxZoom:p.value.zoom})})}),B(M,g=>{g.length>3?C(2):C(1.25)}),pe(F),(g,n)=>{const a=ye,d=Re,y=Ce;return w(),R(e(Le),{modelValue:e(M),"onUpdate:modelValue":n[2]||(n[2]=l=>be(M)?M.value=l:null),class:"nc-erd-flow"},{"node-custom":T(({data:l,dragging:u})=>[x(d,{data:l,dragging:u,"show-skeleton":e(A)},null,8,["data","dragging","show-skeleton"])]),"edge-custom":T(l=>[x(y,ke(l,{"show-skeleton":e(A)}),null,16,["show-skeleton"])]),default:T(()=>[x(e(Me),{class:"bg-transparent rounded-lg shadow-md border-1 border-gray-200",position:e(Q).BottomLeft,"show-fit-view":!1,"show-interactive":!1},{"control-zoom-in":T(()=>[P("div",{class:"nc-erd-zoom-btn rounded-t-md",onClick:n[0]||(n[0]=(...l)=>e(N)&&e(N)(...l))},[x(a,{icon:"plus"})])]),"control-zoom-out":T(()=>[P("div",{class:"nc-erd-zoom-btn border-t-1 border-gray-200 rounded-b-lg",onClick:n[1]||(n[1]=(...l)=>e($)&&e($)(...l))},[x(a,{icon:"minus"})])]),_:1},8,["position"]),x(e(Oe),{size:e(A)?2:void 0,gap:e(A)?50:void 0},null,8,["size","gap"]),x(ge,{name:"layout"},{default:T(()=>[e(A)&&e(L).showAllColumns?(w(),R(e(Te),{key:0,position:e(Q).BottomCenter,class:"color-transition z-5 cursor-pointer rounded shadow-sm text-slate-400 font-semibold px-4 py-2 bg-slate-100/50 hover:text-slate-900 hover:ring hover:ring-accent hover:ring-opacity-100 hover:bg-slate-100/90",onClick:z},{default:T(()=>[ve(K(g.$t("labels.zoomInToViewColumns")),1)]),_:1},8,["position"])):W("",!0)]),_:1}),he(g.$slots,"default")]),_:3},8,["modelValue"])}}}),De=Object.assign(Fe,{__name:"ErdFlow"});export{De as default};
