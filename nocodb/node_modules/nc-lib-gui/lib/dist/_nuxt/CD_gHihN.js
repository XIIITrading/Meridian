import{e as S,r as _,n as f,aH as V,g as j,I as B,o as N,w as b,a as U,b as d,bB as h,L as a,O as C,d as D}from"./DOFFjK0_.js";import{_ as E}from"./CPTCytSI.js";import{b as O}from"./CfRhHfQ4.js";import"./Bx9ACB-J.js";import"./C9H3ht2d.js";import"./SpSJ8E4d.js";import"./DmoodaOn.js";import"./D0s_72GC.js";import"./AxsiR11P.js";import"./ps5He39s.js";import"./CHgOe2F-.js";import"./BrVaQsoo.js";import"./DG2ZEhLK.js";import"./SJHyi9T4.js";import"./B3Wp9c04.js";import"./0c4tmWST.js";import"./4PLl4EP6.js";import"./D2QgEzTv.js";import"./DcFNOSET.js";import"./boyBAVNN.js";import"./D1gZ4Fpg.js";import"./Bo7kLdUR.js";import"./BYGCxle3.js";import"./C1uRXLg7.js";import"./DGuB8RA-.js";import"./D_wq2ltS.js";import"./9aYOtC5C.js";import"./DunK-51v.js";import"./MSgi_m6o.js";import"./JKos0pQW.js";import"./CQugZrqw.js";import"./BdLxRlCP.js";import"./YaKnxhzO.js";import"./CNJqPN7Y.js";import"./CkXo2doe.js";import"./CV-2bRRD.js";import"./Czlq_f4Y.js";import"./Cgx2iu1G.js";import"./C6nWwNvX.js";import"./DiUleKVo.js";import"./JUJEmhCv.js";import"./BrfakvRE.js";import"./CJtI8BMq.js";import"./Bgc5K1P7.js";import"./D4c215jk.js";import"./lL-0_K96.js";import"./BClTqpVB.js";import"./CYkscC4Z.js";import"./DEAKw9Pl.js";import"./Cl-qOJW6.js";import"./BNo10Mdm.js";import"./CtJu2gHc.js";import"./MNXVOE4I.js";import"./CMyFGii6.js";import"./qgYlKlk5.js";import"./Cb5B9eG-.js";import"./C_qz9woQ.js";import"./DA4KItu_.js";import"./D8wgK-Ih.js";import"./HdsRe6lq.js";import"./DzBSAsxR.js";import"./4fFkR2QG.js";import"./CAfhvBOi.js";import"./BcKPINb2.js";import"./D0vnHTOx.js";import"./BRTCxTHu.js";import"./DDEVLD8O.js";import"./-rIuSlCu.js";import"./Dh5zKH8k.js";import"./CiBV2ZED.js";import"./ZNRZafJ9.js";import"./BhfICdUA.js";import"./NRjd0XWG.js";import"./RfUK_fd6.js";import"./hehmy6V1.js";import"./BvG7Iv4q.js";import"./CyXz1Zkk.js";import"./CPChVVVr.js";import"./CFXGfO_A.js";import"./VKUQM8lk.js";import"./BqWeTF94.js";import"./sgaWLnOz.js";import"./BpgQOThx.js";import"./B3tDgntu.js";import"./Db9kSA7A.js";import"./B4YnCsMc.js";import"./6zXueAcs.js";import"./Byuk3M83.js";import"./D-8_fbld.js";import"./DminWhpq.js";import"./_ul3kWJ5.js";import"./DBe8bXbT.js";import"./Ku4eS5hZ.js";import"./BUvWXnXR.js";import"./DJYXGfCo.js";import"./Ck91Ssdf.js";import"./BjYZnuzO.js";import"./CuTsqUFw.js";import"./D1f5NZz7.js";import"./DvuaVsvk.js";import"./6Zptevrc.js";import"./CFDwQBzt.js";import"./CgBhsNh5.js";import"./DwhHO_3u.js";const P={class:"flex flex-col gap-2 p-3"},Oo=S({__name:"index",setup(R){const{extension:n,tables:c,getViewsForTable:w,getData:x}=O(),m=_([]),t=_({}),I=f(()=>c.value.map(o=>({label:o.title,value:o.id}))),y=f(()=>t.value.tableId?m.value.filter(o=>o.type===V.GRID).map(o=>({label:o.is_default?"Default":o.title,value:o.id}))||[]:[]),v=async()=>{t.value.tableId&&(m.value=await w(t.value.tableId))},g=async o=>{var e;t.value.tableId=o,await v(),t.value.viewId=(e=m.value.find(i=>i.is_default))==null?void 0:e.id,await n.value.kvStore.set("exportPayload",t.value)},k=async o=>{t.value.viewId=o,await n.value.kvStore.set("exportPayload",t.value)},L=async()=>{if(!t.value.tableId||!t.value.viewId)return;const o=[];x({tableId:t.value.tableId,viewId:t.value.viewId,eachPage:(e,i)=>{o.push(...e),i()},done:()=>{const e=JSON.stringify(o,null,2),i=new Blob([e],{type:"application/json"}),l=URL.createObjectURL(i),r=document.createElement("a"),p=c.value.find(u=>u.id===t.value.tableId),s=m.value.find(u=>u.id===t.value.viewId);p&&s?r.download=`${p.title} - ${s.is_default?"Default":s.title}.json`:r.download="data.json",r.href=l,r.click(),URL.revokeObjectURL(l)}})};return j(()=>{t.value=n.value.kvStore.get("exportPayload")||{},v()}),(o,e)=>{const i=h,l=C,r=E;return N(),B(r,null,{default:b(()=>[U("div",P,[d(i,{value:a(t).tableId,"onUpdate:value":e[0]||(e[0]=p=>a(t).tableId=p),options:a(I),placeholder:"-select table-",onChange:g},null,8,["value","options"]),d(i,{value:a(t).viewId,"onUpdate:value":e[1]||(e[1]=p=>a(t).viewId=p),options:a(y),placeholder:"-select view-",onChange:k},null,8,["value","options"]),d(l,{onClick:L},{default:b(()=>e[2]||(e[2]=[D("Export")])),_:1,__:[2]})])]),_:1})}}});export{Oo as default};
