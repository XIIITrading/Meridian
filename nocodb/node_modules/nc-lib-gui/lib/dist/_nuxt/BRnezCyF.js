const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DRQrXP7Q.js","./DOFFjK0_.js","./entry.DDfSYhWa.css","./D2QgEzTv.js","./PlainCell.CJha1QXQ.css","./BmeEgVC9.js","./DBe8bXbT.js","./RecordCard.pwDI-3DF.css","./0c4tmWST.js","./DG2ZEhLK.js","./SJHyi9T4.js","./4PLl4EP6.js","./DcFNOSET.js","./boyBAVNN.js","./D1gZ4Fpg.js","./Bo7kLdUR.js","./BYGCxle3.js","./B3Wp9c04.js","./C1uRXLg7.js","./DGuB8RA-.js","./D_wq2ltS.js","./Item.C85DUSg3.css","./9aYOtC5C.js","./index.CotXCNy2.css","./DunK-51v.js","./DivDataCell.D_9SDUsb.css","./ps5He39s.js","./CHgOe2F-.js","./MSgi_m6o.js","./JKos0pQW.js","./CQugZrqw.js","./index._6B72PDH.css","./BdLxRlCP.js","./YaKnxhzO.js","./Markdown.CUPXKfeQ.css","./CNJqPN7Y.js","./AxsiR11P.js","./C9H3ht2d.js","./Comments.BKDN6dt-.css","./CkXo2doe.js","./CV-2bRRD.js","./TimeSelector.DAR2lbHN.css","./Czlq_f4Y.js","./Cgx2iu1G.js","./C6nWwNvX.js","./Cell.Dgtcn0F2.css","./DiUleKVo.js","./JUJEmhCv.js","./Modal.CB1oWLel.css","./BrfakvRE.js","./CJtI8BMq.js","./Bgc5K1P7.js","./D4c215jk.js","./lL-0_K96.js","./BClTqpVB.js","./CYkscC4Z.js","./DEAKw9Pl.js","./Cl-qOJW6.js","./BNo10Mdm.js","./index.C8L8AhJa.css","./CtJu2gHc.js","./MNXVOE4I.js","./LockView.BWC8JyQk.css","./CMyFGii6.js","./qgYlKlk5.js","./Cb5B9eG-.js","./C_qz9woQ.js","./DA4KItu_.js","./D8wgK-Ih.js","./HdsRe6lq.js","./index.N-A1gxk9.css","./DzBSAsxR.js","./FilterInput.7KjqjE1F.css","./4fFkR2QG.js","./Pagination.XVPzwtel.css","./CAfhvBOi.js","./BcKPINb2.js","./VirtualCell.6f0pX0MN.css","./D0vnHTOx.js","./BRTCxTHu.js","./DDEVLD8O.js","./-rIuSlCu.js","./SpSJ8E4d.js","./Dh5zKH8k.js","./ColumnMenu.DQG9Y5_N.css","./CiBV2ZED.js","./ZNRZafJ9.js","./BhfICdUA.js","./NRjd0XWG.js","./RfUK_fd6.js","./SelectOptions.DqNkMQ-A.css","./hehmy6V1.js","./BvG7Iv4q.js","./CyXz1Zkk.js","./CPChVVVr.js","./CFXGfO_A.js","./VKUQM8lk.js","./BqWeTF94.js","./sgaWLnOz.js","./BpgQOThx.js","./DmoodaOn.js","./B3tDgntu.js","./Db9kSA7A.js","./EditOrAddProvider.C2farLzy.css","./B4YnCsMc.js","./6zXueAcs.js","./Byuk3M83.js","./D-8_fbld.js","./DminWhpq.js","./index.Bp-YHGEB.css"])))=>i.map(i=>d[i]);
import{e as Ce,r as h,fv as je,G as pe,aZ as Le,as as Ie,av as Pe,gl as Ve,n as A,o6 as Oe,c as S,o as E,a as Z,d as $e,b as H,O as Ae,L as n,w as J,I as Q,K as B,M as Be,ag as we,cn as N,an as F,aq as fe,N as ye,aS as Y,aV as Ne,aW as ee,_ as Fe}from"./DOFFjK0_.js";import{i as qe,e as V}from"./D2QgEzTv.js";import{u as Xe}from"./B3Wp9c04.js";import{a as Ue}from"./6Zptevrc.js";const We=Y(()=>ee(()=>import("./DRQrXP7Q.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(y=>y.default||y)),Ge=Y(()=>ee(()=>import("./BmeEgVC9.js"),__vite__mapDeps([5,1,2,6,7]),import.meta.url).then(y=>y.default||y)),Ke=Y(()=>ee(()=>import("./0c4tmWST.js").then(y=>y.R),__vite__mapDeps([8,1,2,9,10,11,3,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109]),import.meta.url).then(y=>y.default||y)),Ze={style:{"z-index":"100"},class:"sticky flex top-0 bg-white border-b-1 border-gray-200 shadow-sm prevent-select"},He={class:"pointer-events-none h-full inset-y-0 relative"},Je=["data-testid","data-unique-id","onMouseover","onMousedown"],Qe=Ce({__name:"DateTimeSpanningContainer",props:{records:{}},emits:["expandRecord","newRecord"],setup(y,{expose:_e,emit:ge}){const he=y,q=ge,k=h(null),{width:te}=je(k),L=pe(Le,h()),{isUIAllowed:I}=Ie(),ae=Pe(he,"records"),xe=pe(Ve,h()),{fields:ze}=Xe(),X=A(()=>(ze.value??[]).reduce((e,t)=>(e[t.fk_column_id]={bold:!!t.bold,italic:!!t.italic,underline:!!t.underline},e),{})),{selectedDate:ne,formattedData:T,formattedSideBarData:oe,calendarRange:le,updateRowProperty:re,selectedDateRange:b,viewMetaProperties:Re,displayField:Ee,activeCalendarView:_,updateFormat:C,timezoneDayjs:s}=Ue(),j=A(()=>{var e;return _.value==="week"?(e=Re.value)!=null&&e.hide_weekend?5:7:1}),De=(e,t,o)=>{let p=0;for(;;){let i=!0;for(let u=0;u<o;u++){const d=t+u;if(e[d]||(e[d]={}),e[d][p]){i=!1;break}}if(i)return p;p++}},se=A(()=>_.value==="week"?b.value.start:ne.value),ie=e=>{if(_.value==="day")return e.isSame(ne.value,"day");{const t=j.value===5?s.dayjsTz(b.value.end).subtract(2,"day"):s.dayjsTz(b.value.end);return e&&e.isBetween(s.dayjsTz(b.value.start).startOf("day"),s.dayjsTz(t).endOf("day"),"day","[]")}},ke=A(()=>{var p;if(!((p=ae.value)!=null&&p.length)||!le.value)return[];const e=Array.from({length:7},()=>({})),t=te.value/j.value,o=[];return le.value.forEach(({fk_from_col:i,fk_to_col:u})=>{if(!(!i||!u))for(const d of ae.value){const a=d.rowMeta.id??Oe(),D=s.timezonize(d.row[i.title]),c=s.timezonize(d.row[u.title]),l=Math.max(D.diff(se.value,"day"),0),v=Math.min(c.diff(se.value,"day"),j.value-1)-l+1,z=De(e,l,v);for(let K=0;K<v;K++){const Te=l+K;e[Te][z]=!0}const r=ie(D),w=ie(c);let m="none";r&&w?m="rounded":r?m="leftRounded":w&&(m="rightRounded");const R={top:`${z*28+z*8+8}px`,left:`${l*t}px`,width:`${v*t}px`};o.push({...d,rowMeta:{...d.rowMeta,style:R,position:m,range:{fk_from_col:i,fk_to_col:u},id:a}})}}),o}),O=h(null),U=h(!1),W=h(),P=h(!1),f=h(),$=h(),g=h(null),G=h(),M=h(!1),ue=(e,t)=>{var r,w;if(!k.value||!f.value)return{updatedProperty:[],newRow:null};const{width:o,left:p}=k.value.getBoundingClientRect(),i=e.clientX-p,u=Math.max(0,Math.min(1,i/o)),d=(r=f.value.rowMeta.range)==null?void 0:r.fk_from_col,a=(w=f.value.rowMeta.range)==null?void 0:w.fk_to_col;if(!d)return{updatedProperty:[],newRow:null};const D=Math.floor(u*j.value),c=s.dayjsTz(b.value.start).add(D,"day");if(!c)return{updatedProperty:[],newRow:null};let l;const x={...f.value,row:{...f.value.row,[d.title]:s.dayjsTz(c).format(C.value)}},v=[d.title];if(a){const m=f.value.row[d.title]?s.timezonize(f.value.row[d.title]):null,R=f.value.row[a.title]?s.timezonize(f.value.row[a.title]):null;m&&R?l=s.dayjsTz(c).add(R.diff(m,"day"),"day"):m&&!R||!m&&R?l=s.dayjsTz(c).endOf("day"):l=c.clone(),x.row[a.title]=s.dayjsTz(l).format(C.value),v.push(a.title)}const z=V(x.row,L.value.columns);return t?(T.value=[...T.value,x],oe.value=oe.value.filter(m=>V(m.row,L.value.columns)!==z)):T.value=T.value.map(m=>V(m.row,L.value.columns)===z?x:m),{updateProperty:v,newRow:x}},be=Ne((e,t,o)=>{re(e,t,o)},500),de=e=>{var v,z;if(!I("dataEdit")||!k.value||!g.value)return;const{width:t,left:o}=k.value.getBoundingClientRect(),p=(e.clientX-o-window.scrollX)/t,i=(v=g.value.rowMeta.range)==null?void 0:v.fk_from_col,u=(z=g.value.rowMeta.range)==null?void 0:z.fk_to_col;if(!i||!u)return;const d=s.timezonize(g.value.row[u.title]),a=s.timezonize(g.value.row[i.title]),D=Math.floor(p*j.value);let c=[],l;if($.value==="right"){let r=s.dayjsTz(b.value.start).add(D,"day"),w=a.clone();if(c=[u.title],r.isSameOrBefore(a,"day")&&(r=a.clone().add(1,"hour"),w=a.clone().subtract(1,"hour"),c.push(i.title)),!r.isValid())return;l={...g.value,row:{...g.value.row,[u.title]:r.format(C.value),[i.title]:w.format(C.value)}}}else if($.value==="left"){let r=s.dayjsTz(b.value.start).add(D,"day"),w=d.clone();if(c=[i.title],r.isSameOrAfter(d)&&(r=s.dayjsTz(d).clone(),w=r.clone().add(1,"hour"),c.push(u.title)),!r)return;l={...g.value,row:{...g.value.row,[i.title]:s.dayjsTz(r).format(C.value),[u.title]:s.dayjsTz(w).format(C.value)}}}const x=V(l.row,L.value.columns);T.value=T.value.map(r=>V(r.row,L.value.columns)===x?l:r),be(l,c,!1)},ce=()=>{U.value=!1,$.value=null,g.value=null,document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",ce)},Me=(e,t,o)=>{I("dataEdit")&&(U.value=!0,$.value=e,g.value=o,document.addEventListener("mousemove",de),document.addEventListener("mouseup",ce))},ve=e=>{I("dataEdit")&&(!k.value||!f.value||ue(e,!1))},me=e=>{if(e.preventDefault(),clearTimeout(W.value),!I("dataEdit")||!P.value||!k.value||!f.value)return;const{updateProperty:t,newRow:o}=ue(e);if(!o)return;document.querySelectorAll(".draggable-record").forEach(i=>{i.style.visibility="",i.style.opacity="100%"}),O.value&&(O.value.style.boxShadow="none",O.value=null),f.value=void 0,re(o,t,!1),document.removeEventListener("mousemove",ve),document.removeEventListener("mouseup",me)},Se=(e,t)=>{if(U.value)return;let o=e.target;if(_.value==="day"){q("expandRecord",t);return}P.value=!1,W.value=setTimeout(()=>{if(!I("dataEdit"))return;for(P.value=!0;!o.classList.contains("draggable-record");)o=o.parentElement;document.querySelectorAll(".draggable-record").forEach(u=>{u.getAttribute("data-unique-id").includes(t.rowMeta.id)||(u.style.opacity="30%")}),P.value=!0,O.value=o,f.value=t,document.addEventListener("mousemove",ve),document.addEventListener("mouseup",me)},200);const p=()=>{clearTimeout(W.value),document.removeEventListener("mouseup",p),P.value||q("expandRecord",t)};document.addEventListener("mouseup",p)};return _e({isSpanningRecordExpanded:()=>M.value}),(e,t)=>{const o=Be,p=Ae,i=We,u=Ge,d=Ke;return E(),S("div",Ze,[Z("div",{style:N({maxWidth:`${n(_)==="week"?"64px":"66px"}`,minWidth:`${n(_)==="week"?"64px":"66px"}`}),class:we([{"p-2":n(_)==="day","py-2 pr-1":n(_)==="week"},"text-xs top-0 text-right z-50 !sticky h-full left-0 text-[#6A7184]"])},[t[2]||(t[2]=$e(" All day ")),H(p,{size:"xsmall",class:"mt-2",type:"text",onClick:t[0]||(t[0]=a=>M.value=!n(M))},{default:J(()=>[n(M)?n(M)?(E(),Q(o,{key:1,class:"w-4 h-4 text-gray-800",icon:"minimize"})):B("",!0):(E(),Q(o,{key:0,class:"w-4 h-4 text-gray-800",icon:"maximize"}))]),_:1})],6),Z("div",{ref_key:"container",ref:k,style:N({width:`calc(100% - ${n(_)==="week"?"64":"66"}px)`}),class:we([{"border-gray-100":n(_)==="day","border-gray-200":n(_)==="week","min-h-32 max-h-32 ":n(M),"h-20":!n(M)},"relative border-l-1 transition-all overflow-y-scroll z-30"])},[Z("div",He,[n(j)===7?(E(),S("div",{key:0,class:"absolute !right-0 h-full bg-gray-100 inset-y-0",style:N({width:`${n(te)/7*2}px`})},null,4)):B("",!0),(E(!0),S(F,null,fe(n(ke),(a,D)=>{var c;return E(),S(F,{key:D},[((c=a.rowMeta.style)==null?void 0:c.display)!=="none"?(E(),S("div",{key:0,"data-testid":`nc-calendar-week-record-${a.row[n(Ee).title]}`,"data-unique-id":a.rowMeta.id,style:N({...a.rowMeta.style}),class:"absolute group draggable-record pointer-events-auto nc-calendar-week-record-card",onMouseleave:t[1]||(t[1]=l=>G.value=null),onMouseover:l=>G.value=a.rowMeta.id,onMousedown:ye(l=>Se(l,a),["stop"])},[H(d,{row:a},{default:J(()=>{var l,x;return[H(u,{hover:n(G)===a.rowMeta.id,dragging:((l=n(g))==null?void 0:l.rowMeta.id)===a.rowMeta.id||((x=n(f))==null?void 0:x.rowMeta.id)===a.rowMeta.id,position:a.rowMeta.position,record:a,resize:n(_)==="week",onDblclick:ye(v=>q("expandRecord",a),["stop"]),onResizeStart:Me},{default:J(()=>[(E(!0),S(F,null,fe(n(xe),(v,z)=>{var r,w,m;return E(),S(F,{key:z},[("isRowEmpty"in e?e.isRowEmpty:n(qe))(a,v)?B("",!0):(E(),Q(i,{key:0,modelValue:a.row[v.title],"onUpdate:modelValue":R=>a.row[v.title]=R,class:"text-xs",column:v,bold:!!((r=n(X)[v.id])!=null&&r.bold),italic:!!((w=n(X)[v.id])!=null&&w.italic),underline:!!((m=n(X)[v.id])!=null&&m.underline)},null,8,["modelValue","onUpdate:modelValue","column","bold","italic","underline"]))],64)}),128))]),_:2},1032,["hover","dragging","position","record","resize","onDblclick"])]}),_:2},1032,["row"])],44,Je)):B("",!0)],64)}),128))])],6)])}}}),ot=Object.assign(Fe(Qe,[["__scopeId","data-v-1d06e182"]]),{__name:"SmartsheetCalendarDateTimeSpanningContainer"});export{ot as _};
