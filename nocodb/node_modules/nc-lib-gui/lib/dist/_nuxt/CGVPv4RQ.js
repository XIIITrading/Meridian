import{e as Ce,av as Oe,n as v,r as V,aX as $,dI as Se,kX as De,cr as Te,lg as Ve,jw as ce,iu as pe,iv as me,iw as fe,ju as ve,aj as de,kr as Ie,em as Pe,I as p,c as w,L as t,ip as Me,o as r,ez as je,P as ye,N as Y,ag as ue,aT as W,a1 as F,mn as Le,iK as Be,js as Re,l9 as Ue,mo as Ae,ir as Ne,iq as He,is as $e,jv as Ee,it as qe,jt as ze,l8 as Ge,fT as Ye,gb as We,_ as Fe,T as Ke,G as Xe,aZ as Qe,a9 as Ze,dB as Je,aQ as el,b0 as E,ac as ll,ad as q,ao as al,K as _,t as z,w as h,an as L,aq as oe,b as G,eO as nl,a as f,b9 as le,bB as tl,ap as il,d as we,O as sl,M as ol,aG as rl,aV as dl}from"./DOFFjK0_.js";import ul from"./D4XRfH0I.js";import{S as cl}from"./Cb5B9eG-.js";import{M as be}from"./C_qz9woQ.js";import{I as ge,F as pl,D as he,C as ml,P as fl,a as vl,R as yl,T as wl,Y as bl,b as gl,c as hl}from"./DA4KItu_.js";import{U as ke}from"./DzBSAsxR.js";import{a as kl,c as _e,i as _l,b as re,d as xl,e as xe,f as Cl,h as Fl}from"./D-8_fbld.js";const Ol=Ce({__name:"InputLite",props:{column:{},filter:{},disabled:{type:Boolean},dbClientType:{}},emits:["updateFilterValue"],setup(ae,{emit:ne}){const a=ae,b=ne,l=Oe(a,"column"),B=v(()=>!a.disabled),K=V(a.filter.readOnly||a.disabled);$(Ye,l),$(De,Se(B)),$(We,K);const te={isSingleSelect:Ge,isMultiSelect:ze,isDate:pe,isYear:ve,isDateTime:me,isTime:fe,isRating:qe,isDuration:Ee,isPercent:$e,isCurrency:He,isDecimal:Ne,isReadonlyDateTime:Ae,isInt:ce,isFloat:Ue,isTextArea:Re,isLinks:o=>o.uidt===de.Links,isUser:Be,isReadonlyUser:Le},M=v(()=>a.dbClientType??Te.PG),X=v(()=>M.value&&Ve.create({client:M.value})),k=v(()=>{var o;return l.value&&((o=X.value)==null?void 0:o.getAbstractType(l.value))}),I=o=>{const u=te[o];return!l.value||!u?!1:u(l.value,k.value)},O=v({get:()=>a.filter.value,set:o=>{b("updateFilterValue",o)}}),S=[{value:!0,label:"true"},{value:!1,label:"false"},{value:null,label:"unset"}],y=o=>["anyof","nanyof"].includes(o)?be:cl,R=o=>["daysAgo","daysFromNow","pastNumberOfDays","nextNumberOfDays"].includes(o)?he:hl,j=v(()=>({isSingleSelect:y(a.filter.comparison_op),isMultiSelect:be,isDate:R(a.filter.comparison_sub_op),isYear:bl,isDateTime:R(a.filter.comparison_sub_op),isReadonlyDateTime:R(a.filter.comparison_sub_op),isTime:wl,isRating:yl,isDuration:vl,isPercent:fl,isCurrency:ml,isDecimal:he,isInt:ge,isFloat:pl,isLinks:ge,isUser:ke,isReadonlyUser:ke})),C=v(()=>Object.keys(j.value).find(o=>I(o))),D=v(()=>{var o,u,P,x,Q,Z,J,ee,e,n;switch(C.value){case"isSingleSelect":case"isMultiSelect":return{disableOptionCreation:!0,showReadonlyField:((o=a.filter)==null?void 0:o.readOnly)||(a==null?void 0:a.disabled)};case"isPercent":case"isDecimal":case"isFloat":case"isLinks":case"isInt":return{class:"h-32px",showReadonlyField:((u=a.filter)==null?void 0:u.readOnly)||(a==null?void 0:a.disabled)};case"isDuration":return{showValidationError:!1,showReadonlyField:((P=a.filter)==null?void 0:P.readOnly)||(a==null?void 0:a.disabled)};case"isUser":return{forceMulti:!0,showReadonlyField:((x=a.filter)==null?void 0:x.readOnly)||(a==null?void 0:a.disabled)};case"isReadonlyUser":return["anyof","nanyof"].includes(a.filter.comparison_op)?{forceMulti:!0,showReadonlyField:((Q=a.filter)==null?void 0:Q.readOnly)||(a==null?void 0:a.disabled)}:{};case"isCurrency":return{hidePrefix:!0,showReadonlyField:((Z=a.filter)==null?void 0:Z.readOnly)||(a==null?void 0:a.disabled)};case"isRating":return{style:{minWidth:`${(((ee=(J=l.value)==null?void 0:J.meta)==null?void 0:ee.max)||5)*19}px`},showReadonlyField:((e=a.filter)==null?void 0:e.readOnly)||(a==null?void 0:a.disabled)};default:return{showReadonlyField:((n=a.filter)==null?void 0:n.readOnly)||(a==null?void 0:a.disabled)}}}),ie=v(()=>{var o;return l.value&&(((o=l.value)==null?void 0:o.uidt)===de.Links||ce(l.value,k)||pe(l.value,k)||me(l.value,k)||fe(l.value,k)||ve(l.value,k))}),U=V(!1);$(Ie,V(!0)),$(Pe,V(!0));const se=v(()=>C.value==="isSingleSelect"||C.value==="isMultiSelect");return(o,u)=>{const P=je;return t(l)&&("isBoolean"in o?o.isBoolean:t(Me))(t(l),t(k))?(r(),p(P,{key:0,value:t(O),"onUpdate:value":u[0]||(u[0]=x=>ye(O)?O.value=x:null),disabled:o.filter.readOnly||o.disabled,options:S},null,8,["value","disabled"])):(r(),w("div",{key:1,class:ue(["bg-white border-1 flex flex-grow min-h-4 h-full px-1 items-center nc-filter-input-wrapper !rounded-lg",{"px-2":t(ie),"border-brand-500":t(U),"!max-w-100":t(se)}]),onMouseup:u[4]||(u[4]=Y(()=>{},["stop"]))},[(r(),p(W(t(C)?t(j)[t(C)]:gl),F({modelValue:t(O),"onUpdate:modelValue":u[1]||(u[1]=x=>ye(O)?O.value=x:null),disabled:o.filter.readOnly||o.disabled,placeholder:"Enter a value",column:t(l),class:["flex !rounded-lg",{"text-nc-content-gray-muted pointer-events-none":o.disabled}]},t(D),{location:"filter",onFocus:u[2]||(u[2]=x=>U.value=!0),onBlur:u[3]||(u[3]=x=>U.value=!1)}),null,16,["modelValue","disabled","column","class"]))],34))}}}),Sl=Object.assign(Fe(Ol,[["__scopeId","data-v-a4f62e29"]]),{__name:"SmartsheetToolbarFilterInputLite"}),Dl={class:"flex items-center w-full justify-between w-full gap-2"},Tl={class:"truncate flex-1 capitalize"},Vl={class:"flex items-center w-full justify-between w-full gap-2"},Il={class:"truncate flex-1"},Pl={key:1,class:"flex flex-grow"},Ml={class:"flex items-center w-full justify-between w-full gap-2 max-w-40"},jl={class:"flex items-center flex-grow"},Ll={key:0,class:"flex-grow"},Bl={class:"relative overflow-visible min-h-17 w-10"},Rl={class:"absolute -top-21 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},Ul={class:"flex flex-row items-center justify-between w-full"},Al={class:"flex flex-row items-center justify-between w-full"},Nl={key:1,class:"flex-grow"},Hl=Ce({__name:"FilterRow",props:{modelValue:{},index:{},columns:{},handler:{},dbClientType:{},showNullAndEmptyInFilter:{type:Boolean},webHook:{type:Boolean},link:{type:Boolean},widget:{type:Boolean},disabled:{type:Boolean},isLockedView:{type:Boolean},isLogicalOpChangeAllowed:{type:Boolean},containerProps:{},logicalOpsProps:{},columnSelectProps:{},comparisonOpsProps:{},comparisonSubOpsProps:{},inputValueProps:{},deleteButtonProps:{},isColourFilter:{type:Boolean},isLoadingFilter:{type:Boolean}},emits:["update:modelValue","change","delete"],setup(ae,{emit:ne}){const a=ae,b=ne,l=Ke(a,"modelValue",b),B=Xe(Qe,V()),{t:K}=Ze(),te=[{value:"and",text:K("general.and")},{value:"or",text:K("general.or")}],M=Je(),X=V(""),k=V(!1),I=V("");el(()=>l.value.value,()=>{I.value&&l.value.value!==I.value&&(l.value.value=I.value)},{deep:!0});const O=e=>{var n,i;return(((i=(n=M[e??"default"])==null?void 0:n.call(M))==null?void 0:i.length)??0)>0},S=v(()=>l.value.readOnly||a.disabled||a.isLockedView),y=v(()=>{const e=l.value.fk_column_id;if(l.value.fk_column_id)return a.columns.find(n=>n.id===e)}),R=v(()=>{var e,n;return(e=l.value)!=null&&e.dynamic?kl((n=B.value)==null?void 0:n.columns,y.value,a.dbClientType):[]}),j=v(()=>{var d;const e=y.value;if(!e)return[];const n=(e==null?void 0:e.filterUidt)??(e==null?void 0:e.uidt);return _e(n,(d=E(e==null?void 0:e.meta))==null?void 0:d.date_format).filter(m=>_l(l.value,m,n,a.showNullAndEmptyInFilter))}),C=v(()=>{var i;const e=y.value,n=(e==null?void 0:e.filterUidt)??(e==null?void 0:e.uidt);return re(l.value.comparison_op,(i=E(e==null?void 0:e.meta))==null?void 0:i.date_format).filter(d=>xl(l.value,d,n))}),D=v(()=>{var n,i,d,m,c,g,T,A;const e=l.value;return e.comparison_op?e.comparison_sub_op?!((d=re(e.comparison_op,(i=E((n=y.value)==null?void 0:n.meta))==null?void 0:i.date_format).find(N=>N.value===e.comparison_sub_op))!=null&&d.ignoreVal):!((A=_e(((m=y.value)==null?void 0:m.filterUidt)??((c=y.value)==null?void 0:c.uidt),(T=E((g=y.value)==null?void 0:g.meta))==null?void 0:T.date_format).find(N=>N.value===e.comparison_op))!=null&&A.ignoreVal):!1}),ie=e=>{var i,d;const n=l.value.fk_column_id;if((i=a.handler)!=null&&i.rowChange)(d=a.handler)==null||d.rowChange({filter:l.value,type:"fk_column_id",prevValue:n,value:e,index:a.index});else{l.value.fk_column_id=e;const m=a.columns.find(c=>c.id===e);m&&Cl({column:m,filter:l.value,showNullAndEmptyInFilter:a.showNullAndEmptyInFilter}),b("change",{filter:{...l.value},type:"fk_column_id",prevValue:n,value:e,index:a.index})}},U=e=>{var i,d;const n=l.value.logical_op;(i=a.handler)!=null&&i.rowChange?(d=a.handler)==null||d.rowChange({filter:l.value,type:"logical_op",prevValue:n,value:e,index:a.index}):(l.value.logical_op=e,b("change",{filter:{...l.value},type:"logical_op",prevValue:n,value:e,index:a.index}))},se=e=>{var i,d,m;const n=l.value.comparison_op;if((i=a.handler)!=null&&i.rowChange)(d=a.handler)==null||d.rowChange({filter:l.value,type:"comparison_op",prevValue:n,value:e,index:a.index});else{l.value.comparison_op=e;const c=l.value,g=y.value;g&&(g.uidt===de.SingleSelect&&["anyof","nanyof"].includes(X.value)&&["eq","neq"].includes(c.comparison_op)?c.value=null:["blank","notblank","empty","notempty","null","notnull"].includes(c.comparison_op)?(c.value=null,c.comparison_sub_op=null):Fl(g.filterUidt??g.uidt)&&(c.value=null,re(c.comparison_op,(m=E(g==null?void 0:g.meta))==null?void 0:m.date_format).map(T=>T.value).includes(c.comparison_sub_op)||(c.comparison_op==="isWithin"?c.comparison_sub_op="pastNumberOfDays":c.comparison_sub_op="exactDate"))),X.value=l.value.comparison_op,b("change",{filter:{...l.value},type:"comparison_op",prevValue:n,value:e,index:a.index})}},o=e=>{var i,d;const n=l.value.comparison_sub_op;(i=a.handler)!=null&&i.rowChange?(d=a.handler)==null||d.rowChange({filter:l.value,type:"comparison_sub_op",prevValue:n,value:e,index:a.index}):(l.value.comparison_sub_op=e,b("change",{filter:{...l.value},type:"comparison_sub_op",prevValue:n,value:e,index:a.index}))},u=e=>{var i,d;const n=l.value.fk_value_col_id;(i=a.handler)!=null&&i.rowChange?(d=a.handler)==null||d.rowChange({filter:l.value,type:"fk_value_col_id",prevValue:n,value:e,index:a.index}):(l.value.fk_value_col_id=e,b("change",{filter:{...l.value},type:"fk_value_col_id",prevValue:n,value:e,index:a.index}))},P=dl(x,500);function x(e,n,i){var d,m;if(!l.value.id&&k.value){P(e,n,i);return}l.value.id?k.value=!1:k.value=!0,l.value.value=e,(d=a.handler)!=null&&d.rowChange?(m=a.handler)==null||m.rowChange({filter:l.value,type:"value",prevValue:n,value:e,index:i}):b("change",{filter:{...l.value},type:"value",prevValue:n,value:e,index:i}),I.value=""}const Q=e=>{const n=l.value.value,i=e;I.value=e,l.value.value=e,P(i,n,a.index)},Z=()=>{b("delete",{filter:{...l.value},index:a.index})};async function J(){const e=l.value.dynamic;l.value.dynamic=!1,l.value.fk_value_col_id=null,b("change",{filter:{...l.value},type:"dynamic",prevValue:e,value:!1,index:a.index})}const ee=async()=>{const e=l.value.dynamic;l.value.dynamic=xe(l.value,y.value,a.dbClientType)&&D.value,b("change",{filter:{...l.value},type:"dynamic",prevValue:e,value:l.value.dynamic,index:a.index})};return(e,n)=>{const i=nl,d=tl,m=ul,c=il,g=Sl,T=ol,A=sl,N=rl,H=ll("e");return r(),w("div",F({class:["flex flex-row gap-x-0 w-full nc-filter-wrapper bg-white",`nc-filter-wrapper-${t(l).fk_column_id}`]},e.containerProps),[e.index===0?(r(),w("div",F({key:0,class:"flex items-center !min-w-18 !max-w-18 pl-3 nc-filter-where-label"},e.logicalOpsProps),z(e.$t("labels.where")),17)):q((r(),p(d,F({key:1},e.logicalOpsProps,{value:t(l).logical_op,"dropdown-match-select-width":!1,class:["h-full !max-w-18 !min-w-18 capitalize",{"nc-disabled-logical-op":t(S)||e.index>1&&!e.isLogicalOpChangeAllowed}],"hide-details":"",disabled:t(S)||e.index>1&&!e.isLogicalOpChangeAllowed,"dropdown-class-name":"nc-dropdown-filter-logical-op",onChange:n[0]||(n[0]=s=>U(s)),onClick:n[1]||(n[1]=Y(()=>{},["stop"]))}),{default:h(()=>[(r(),w(L,null,oe(te,s=>G(i,{key:s.value,value:s.value},{default:h(()=>[f("div",Dl,[f("div",Tl,z(s.text),1),t(l).logical_op===s.value?(r(),p(W(("iconMap"in e?e.iconMap:t(le)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):_("",!0)])]),_:2},1032,["value"])),64))]),_:1},16,["value","disabled","class"])),[[H,["c:filter:logical-op:select",{link:!!e.link,webHook:!!e.webHook,widget:!!e.widget}]]]),al(e.$slots,"fieldInaccessibleError",{},void 0,!0),O("fieldInaccessibleError")?_("",!0):(r(),w(L,{key:2},[G(m,F({value:t(l).fk_column_id,"disable-smartsheet":!!e.widget},e.columnSelectProps,{class:["nc-filter-field-select min-w-32 max-h-8",{"max-w-32":!e.webHook,"!w-full":e.webHook}],disabled:t(S),"db-client-type":e.dbClientType,meta:t(B),onClick:n[2]||(n[2]=Y(()=>{},["stop"])),onChange:n[3]||(n[3]=s=>ie(s))}),null,16,["value","disable-smartsheet","class","disabled","db-client-type","meta"]),t(j)&&t(j).length>0?q((r(),p(d,F({key:0},e.comparisonOpsProps,{value:t(l).comparison_op,"dropdown-match-select-width":!1,class:["caption nc-filter-operation-select !min-w-26.75 max-h-8",{"!max-w-26.75":!e.webHook,"!w-full":e.webHook}],placeholder:e.$t("labels.operation"),density:"compact",variant:"solo",disabled:t(S),"hide-details":"","dropdown-class-name":"nc-dropdown-filter-comp-op !max-w-80",onChange:n[4]||(n[4]=s=>se(s))}),{default:h(()=>[(r(!0),w(L,null,oe(t(j),s=>(r(),p(i,{key:s.value,value:s.value},{default:h(()=>[f("div",Vl,[f("div",Il,z(s.text),1),t(l).comparison_op===s.value?(r(),p(W(("iconMap"in e?e.iconMap:t(le)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):_("",!0)])]),_:2},1032,["value"]))),128))]),_:1},16,["value","placeholder","class","disabled"])),[[H,["c:filter:comparison-op:select",{link:!!e.link,webHook:!!e.webHook,widget:!!e.widget}]]]):_("",!0),["blank","notblank"].includes(t(l).comparison_op)?(r(),w("div",Pl)):(r(),w(L,{key:2},[t(C)&&t(C).length>0?q((r(),p(d,F({key:0,value:t(l).comparison_sub_op},e.comparisonSubOpsProps,{"dropdown-match-select-width":!1,class:["caption nc-filter-sub_operation-select min-w-28",{"flex-grow w-full":!t(D),"max-w-28":t(D)&&!e.webHook}],placeholder:e.$t("labels.operationSub"),density:"compact",variant:"solo",disabled:t(S),"hide-details":"","dropdown-class-name":"nc-dropdown-filter-comp-sub-op",onChange:n[5]||(n[5]=s=>o(s))}),{default:h(()=>[(r(!0),w(L,null,oe(t(C),s=>(r(),p(i,{key:s.value,value:s.value},{default:h(()=>[f("div",Ml,[G(c,{"show-on-truncate-only":"",class:"truncate flex-1"},{title:h(()=>[we(z(s.text),1)]),default:h(()=>[we(" "+z(s.text),1)]),_:2},1024),t(l).comparison_sub_op===s.value?(r(),p(W(("iconMap"in e?e.iconMap:t(le)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):_("",!0)])]),_:2},1032,["value"]))),128))]),_:1},16,["value","class","placeholder","disabled"])),[[H,["c:filter:sub-comparison-op:select",{link:!!e.link,webHook:!!e.webHook,widget:!!e.widget}]]]):_("",!0),f("div",jl,[t(D)?(r(),w(L,{key:0},[e.link&&(t(l).dynamic||t(l).fk_value_col_id)?(r(),w("div",Ll,[t(D)?(r(),p(m,{key:0,modelValue:t(l).fk_value_col_id,"onUpdate:modelValue":n[6]||(n[6]=s=>t(l).fk_value_col_id=s),"disable-smartsheet":e.widget,class:"nc-filter-field-select min-w-32 w-full max-h-8",columns:t(R),meta:t(B),onChange:n[7]||(n[7]=s=>u(s))},null,8,["modelValue","disable-smartsheet","columns","meta"])):_("",!0)])):(r(),p(g,F({key:1},e.inputValueProps,{class:["nc-filter-value-select rounded-md min-w-34",{"!w-full":e.webHook}],column:t(y),filter:t(l),disabled:t(S),"db-client-type":e.dbClientType,onUpdateFilterValue:n[8]||(n[8]=s=>Q(s)),onClick:n[9]||(n[9]=Y(()=>{},["stop"]))}),null,16,["class","column","filter","disabled","db-client-type"])),e.link?(r(),p(N,{key:2,class:"nc-settings-dropdown h-full flex items-center min-w-0 rounded-lg",trigger:["click"],placement:"bottom",disabled:e.isLockedView},{overlay:h(()=>[f("div",Bl,[f("div",Rl,[f("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:n[10]||(n[10]=s=>J())},[f("div",Ul,[n[13]||(n[13]=f("div",{class:"flex flex-row items-center justify-start gap-x-3"},"Static condition",-1)),!t(l).dynamic&&!t(l).fk_value_col_id?(r(),p(T,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):_("",!0)]),n[14]||(n[14]=f("div",{class:"flex flex-row text-xs text-gray-400"},"Filter based on static value",-1))]),q((r(),w("div",{class:ue(["px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",("isDynamicFilterAllowed"in e?e.isDynamicFilterAllowed:t(xe))(t(l),t(y),e.dbClientType)&&t(D)?"cursor-pointer":"cursor-not-allowed"]),onClick:n[11]||(n[11]=s=>ee())},[f("div",Al,[n[15]||(n[15]=f("div",{class:"flex flex-row items-center justify-start gap-x-2.5"},"Dynamic condition",-1)),t(l).dynamic||t(l).fk_value_col_id?(r(),p(T,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):_("",!0)]),n[16]||(n[16]=f("div",{class:"flex flex-row text-xs text-gray-400"},"Filter based on dynamic value",-1))],2)),[[H,["c:filter:dynamic-filter"]]])])])]),default:h(()=>[G(A,{type:"text",size:"small"},{default:h(()=>[G(T,{icon:"settings"})]),_:1})]),_:1},8,["disabled"])):_("",!0)],64)):(r(),w("div",Nl))])],64)),f("div",{class:ue({"cursor-wait":e.isLoadingFilter})},[!t(l).readOnly&&!e.disabled?q((r(),p(A,F({key:0},e.deleteButtonProps,{type:"text",size:"small",disabled:e.isLockedView,class:["nc-filter-item-remove-btn self-center",{"pointer-events-none":e.isLoadingFilter}],onClick:n[12]||(n[12]=Y(s=>Z(),["stop"]))}),{default:h(()=>[(r(),p(W(("iconMap"in e?e.iconMap:t(le)).deleteListItem)))]),_:1},16,["disabled","class"])),[[H,["c:filter:delete",{link:!!e.link,webHook:!!e.webHook,widget:!!e.widget}]]]):_("",!0)],2)],64))],16)}}}),Kl=Object.assign(Fe(Hl,[["__scopeId","data-v-20531ddb"]]),{__name:"SmartsheetToolbarFilterRow"});export{Kl as _};
