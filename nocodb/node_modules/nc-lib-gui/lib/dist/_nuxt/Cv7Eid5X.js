import{e as Ke,J as Oe,a9 as Ae,G as i,aZ as Ge,r as u,o1 as ze,fT as Pe,gb as qe,kX as He,kr as Xe,a7 as Ye,V as Ze,a8 as oe,n as v,em as Je,k9 as Qe,jf as We,kY as ea,gy as aa,gC as ta,as as la,b7 as sa,b0 as na,a_ as P,aQ as ie,bx as oa,bv as ia,gD as ra,j7 as ca,jd as ua,ko as da,Y as ma,iC as fa,g as pa,i_ as va,kZ as ga,c as b,o as r,I as S,L as a,a as g,K as I,N as re,b as y,w as c,M as ya,P as ce,ar as ha,an as B,aq as ue,aT as de,bD as ba,ag as h,c4 as wa,ap as _a,d as E,t as w,oB as T,ol as d,ok as xa,eU as me,eO as ka,bX as Ca,j as Ia,om as fe,cn as Ea,bh as pe,ez as ja,_ as Ua}from"./DOFFjK0_.js";import{a as Fa,g as $a}from"./DzBSAsxR.js";import{M as Sa}from"./Gdi8QzHW.js";import{u as ve}from"./CV-2bRRD.js";import{R as Ma,_ as Na}from"./D4c215jk.js";const Da={key:0,class:"w-full max-w-full"},La={class:"rounded-lg border-1 border-nc-border-gray-medium w-full max-w-full"},Ra={class:"w-full max-w-full max-h-[328px] nc-scrollbar-thin p-1"},Va={class:"w-full flex gap-2 items-center py-1.5"},Ba={class:"flex flex-col w-[calc(100%_-_40px)]"},Ta={class:"w-full flex gap-3"},Ka={key:0,class:"h-full text-center flex items-center justify-center gap-3 mt-4"},Oa={key:0,class:"absolute -bottom-1 w-[calc(100%_+_16px)] border-b-1 border-nc-border-gray-medium -ml-4"},Aa={class:"w-full flex gap-2 items-center"},Ga={class:"w-full flex gap-3"},za=Ke({__name:"Editor",props:{modelValue:{},rowIndex:{},location:{},forceMulti:{type:Boolean},options:{}},emits:["update:modelValue"],setup(K,{emit:ge}){const q=ge,{isMobileMode:ye}=Oe(),{t:Pa}=Ae(),H=i(Ge),X=i(ze,u(!1)),x=i(Pe),M=i(qe),Y=i(He,u(!1)),Z=i(Xe,u(!1)),he=Ye(),be=Ze(),{basesUser:we}=oe(he),{idUserMap:_e}=oe(be),xe=v(()=>H.value.base_id?we.value.get(H.value.base_id)||[]:[]),O=v(()=>Z.value||Y.value),D=i(Je,u(!1)),A=i(Qe,u(!1)),U=v(()=>{var e;return K.forceMulti||((e=x.value.meta)==null?void 0:e.is_multi)}),J=i(We,u(void 0)),ke=i(ea,u(!1)),F=u(),o=u(!1),G=u(!1),Q=i(aa,u(!1)),N=i(ta,null),f=u(),{isUIAllowed:Ce}=la(),{showUpgradeToUseCurrentUserFilter:qa}=sa(),W=v(()=>{var e;return!A.value&&D.value&&((e=na(x.value.meta))==null?void 0:e.isList)}),k=v(()=>[...[],...K.options??Fa(x.value,!1,D.value,xe.value)]),z=v(()=>k.value.filter(e=>!e.deleted)),Ie=v(()=>z.value.filter(e=>f.value?P([e.display_name,e.email],f.value):!0)),Ee=v(()=>k.value.reduce((e,l)=>(l.id&&(e[l.id]=l),l.email&&(e[l.email.trim()]=l),e),{})),ee=v(()=>Ce("dataEdit")),_=v(()=>(ee.value||D.value)&&O.value),m=v({get:()=>$a(Ee.value,K.modelValue),set:e=>{f.value="";const l=[];e&&e.length&&e.forEach(n=>{const p=k.value.find(C=>C.id===n);p&&l.push(p.id)}),U.value?q("update:modelValue",e!=null&&e.length?l.join(","):null):(q("update:modelValue",e!=null&&e.length?l[l.length-1]:null),o.value=!1)}}),je=v(()=>{var e,l;return U.value?(m.value||[]).map(n=>n.value):((l=(e=m.value||[])==null?void 0:e[0])==null?void 0:l.value)||""});ie(o,(e,l)=>{var n,p,C,j,R,V;W.value||(e||(f.value=""),_.value&&(e?(V=(R=(j=F.value)==null?void 0:j.$el)==null?void 0:R.querySelector("input"))==null||V.focus():(C=(p=(n=F.value)==null?void 0:n.$el)==null?void 0:p.querySelector("input"))==null||C.blur()))}),ie(O,(e,l)=>{e||(o.value=!1)}),ve(Z,e=>{var l;switch(e.key){case"Escape":if(N){N.trigger();return}o.value=!1;break;case"Enter":_.value&&O.value&&!o.value&&(e.stopPropagation(),ae(),o.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!_.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!oa()&&(e.stopPropagation(),o.value=!0);break}},{immediate:!0,isGridCell:!0}),ve(o,e=>{e.key==="Escape"&&(o.value=!1,N==null||N.trigger())},{isGridCell:!1,immediate:!0});const Ue=()=>{var e,l,n;f.value=(n=(l=(e=F.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:n.value},Fe=(e,l)=>{var n,p;((n=e.target)!=null&&n.classList.contains("ant-tag-close-icon")||(p=e.target)!=null&&p.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),l())};function ae(){G.value||(o.value=_.value&&!o.value)}ia(document,"click",e=>{var l;o.value&&F.value&&!F.value.$el.contains(e.target)&&!((l=document.querySelector(".nc-dropdown-user-select-cell.active"))!=null&&l.contains(e.target))&&(Y.value=!1,o.value=!1)},!0);const $e=(e,l)=>{const n=k.value.find(p=>p.id===l.value);return n?P([n.display_name,n.email],e):!1},L=e=>{var l,n;return!((n=(l=_e.value)==null?void 0:l[e])!=null&&n.deleted)},Se=e=>{if(e.key==="Tab"){o.value=!1;return}else if(e.key==="Escape"&&D.value){o.value=!1;return}e.stopPropagation()},te=()=>{var e;G.value=!0,setTimeout(()=>{G.value=!1},250),!(ke.value&&((e=m.value)!=null&&e.length))&&(o.value=!0)},Me=i(ra,u(!1)),Ne=i(ca,!1),De=i(ua,u(!1)),Le=i(da,u(!1)),Re=i(fa,ma({}));return pa(()=>{De.value&&Ne&&!Me.value&&!A.value&&!Le.value&&va(()=>{te();const e=Re.keyboardKey;e&&ga(e)&&(f.value=e)})}),(e,l)=>{const n=ya,p=ha,C=wa,j=_a,R=me,V=ka,Ve=Ca,Be=ja;return r(),b("div",{class:h(["nc-cell-field nc-user-select h-full w-full flex items-center",{"read-only":a(M)}]),onClick:ae},[a(W)?(r(),b("div",Da,[g("div",La,[a(z).length>6?(r(),b("div",{key:0,class:"border-b-1 border-nc-border-gray-medium pl-1 group",onClick:l[1]||(l[1]=re(()=>{},["stop"]))},[y(p,{ref:"inputRef",value:a(f),"onUpdate:value":l[0]||(l[0]=t=>ce(f)?f.value=t:null),placeholder:e.$t("general.search"),class:"nc-user-select-search-field-input !pl-2 !pr-1.5 flex-1 !py-2","allow-clear":"",autocomplete:"off",bordered:!1},{prefix:c(()=>[y(n,{icon:"search",class:"nc-search-icon text-nc-content-gray-muted opacity-50 h-4 w-4 mr-1.5"})]),_:1},8,["value","placeholder"])])):I("",!0),g("div",Ra,[(r(),S(de(a(U)?a(xa):a(Na)),{value:a(je),disabled:a(M)||!a(_),class:"nc-field-layout-list nc-user-select-list","onUpdate:value":l[2]||(l[2]=t=>{m.value=a(U)?t:[t]})},{default:c(()=>[(r(!0),b(B,null,ue(a(k),t=>(r(),b(B,{key:t.id||t.email},[t.deleted?I("",!0):(r(),S(de(a(U)?a(ba):a(Ma)),{key:t.id||t.email,value:t.id,"data-testid":`select-option-${a(x).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:h([`nc-select-option-${a(x).title}-${t.email}`,{"!hidden nc-hidden-option":!("searchCompare"in e?e.searchCompare:a(P))([t.display_name,t.email],a(f)??"")}])},{default:c(()=>[g("div",Va,[y(C,{user:t,size:"base",class:"flex-none",disabled:!L(t.id||t.email)},null,8,["user","disabled"]),g("div",Ba,[g("div",Ta,[y(j,{class:h(["text-bodyDefaultSmBold !leading-5 capitalize truncate max-w-full text-gray-800",{"!text-gray-500":!L(t.id||t.email)}]),"show-on-truncate-only":"",placement:"bottom"},{title:c(()=>{var s;return[E(w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(T))(t.email)),1)]}),default:c(()=>{var s;return[E(" "+w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(T))(t.email)),1)]}),_:2},1032,["class"])]),y(j,{class:"text-xs !leading-4 text-nc-content-gray-muted truncate max-w-full","show-on-truncate-only":"",placement:"bottom"},{title:c(()=>[E(w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),default:c(()=>[E(" "+w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),_:2},1024)])])]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},40,["value","disabled"])),a(z).length&&a(f)&&!a(Ie).length?(r(),b("div",Ka,[y(R,{image:("Empty"in e?e.Empty:a(me)).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData"),class:"!my-0"},null,8,["image","description"])])):I("",!0)])]),!a(M)&&!a(U)&&a(m).length?(r(),b("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[3]||(l[3]=t=>m.value=[])},w(e.$t("labels.clearSelection")),1)):I("",!0)])):(r(),S(Be,{key:1,ref_key:"aselect",ref:F,value:a(m),"onUpdate:value":l[5]||(l[5]=t=>ce(m)?m.value=t:null),mode:"multiple",class:h(["w-full overflow-hidden",{"caret-transparent":!a(ee)}]),placeholder:a(A)?e.$t("labels.optional"):"",bordered:!1,"clear-icon":"","show-search":!a(ye),"show-arrow":a(_)&&!a(M),open:a(o)&&a(_),disabled:a(M)||!a(_),"dropdown-class-name":`nc-dropdown-user-select-cell !min-w-256px ${a(X)?"!min-w-256px":"!min-w-180px"}  ${a(o)?"active":""}`,"filter-option":$e,"search-value":a(f)??"",onSearch:Ue,onFocus:te,onBlur:l[6]||(l[6]=t=>o.value=!1),onKeydown:Se},{suffixIcon:c(()=>[y(n,{icon:"arrowDown",class:"text-gray-700 nc-select-expand-btn"})]),tagRender:c(({label:t,value:s,onClose:le})=>{var se,ne;return[a(k).find($=>$.id===s)?(r(),S(Ve,{key:0,class:h(["rounded-tag nc-selected-option !pl-0",{"!my-0":!a(J)||a(J)===1}]),style:{display:"flex",alignItems:"center"},color:s===a(d)?("themeV4Colors"in e?e.themeV4Colors:a(fe)).brand[50]:e.location==="filter"?("themeV4Colors"in e?e.themeV4Colors:a(fe)).gray[200]:"#ccc",closable:a(_)&&((((se=a(m))==null?void 0:se.length)??0)>1||!((ne=a(x))!=null&&ne.rqd)),"close-icon":("h"in e?e.h:a(Ia))(a(Sa),{class:["ms-close-icon"]}),onClick:$=>Fe($,le),onClose:le},{default:c(()=>{var $;return[g("span",{style:Ea({color:a(pe).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(pe).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:h(["flex items-stretch gap-2",{"text-sm":a(Q),"text-small":!a(Q)}])},[g("div",null,[y(C,{size:"auto",user:{display_name:t!=null&&t.includes("@")?"":t.trim(),email:t,meta:($=a(k).find(Te=>Te.id===s))==null?void 0:$.meta},class:h(["!text-[0.5rem] !h-[16.8px]",{"!bg-white":s===a(d)}]),disabled:!L(s),"show-placeholder-icon":s===a(d)},null,8,["user","class","disabled","show-placeholder-icon"])]),g("span",{class:h({"text-gray-600":!L(s)&&s!==a(d),"text-nc-content-brand":s===a(d),"font-600":a(X)})},w(t),3)],6)]}),_:2},1032,["class","color","closable","close-icon","onClick","onClose"])):I("",!0)]}),default:c(()=>[(r(!0),b(B,null,ue(a(k),t=>(r(),b(B,{key:t.id||t.email},[t.deleted?I("",!0):(r(),S(V,{key:0,value:t.id,"data-testid":`select-option-${a(x).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:h([`nc-select-option-${a(x).title}-${t.email}`,{"nc-select-option-current-user mb-2":t.email===a(d)}]),onClick:l[4]||(l[4]=re(()=>{},["stop"]))},{default:c(()=>[t.email===a(d)?(r(),b("div",Oa)):I("",!0),g("div",Aa,[y(C,{user:t,size:"base",class:"flex-none","show-placeholder-icon":t.email===a(d)},null,8,["user","show-placeholder-icon"]),g("div",{class:h(["flex flex-col",{"w-[calc(100%_-_32px)]":!a(m).find(s=>s.email===t.email),"w-[calc(100%_-_68px)]":!!a(m).find(s=>s.email===t.email)}])},[g("div",Ga,[y(j,{class:h(["text-bodyDefaultSmBold !leading-5 capitalize truncate max-w-full",{"text-nc-content-brand":t.email===a(d),"text-gray-800":t.email!==a(d)}]),"show-on-truncate-only":"",placement:"bottom"},{title:c(()=>{var s;return[E(w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(T))(t.email)),1)]}),default:c(()=>{var s;return[E(" "+w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(T))(t.email)),1)]}),_:2},1032,["class"])]),y(j,{class:"text-xs !leading-4 text-nc-content-gray-muted truncate max-w-full","show-on-truncate-only":"",placement:"bottom"},{title:c(()=>[E(w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),default:c(()=>[E(" "+w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),_:2},1024)],2),a(m).find(s=>s.email===t.email)?(r(),S(n,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):I("",!0)])]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},8,["value","placeholder","show-search","show-arrow","open","disabled","class","dropdown-class-name","search-value"]))],2)}}}),Wa=Object.assign(Ua(za,[["__scopeId","data-v-037489d9"]]),{__name:"CellUserEditor"});export{Wa as default};
