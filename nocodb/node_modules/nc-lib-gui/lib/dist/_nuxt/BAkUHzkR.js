const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CMyFGii6.js","./DOFFjK0_.js","./entry.DDfSYhWa.css","./qgYlKlk5.js","./Cb5B9eG-.js","./C_qz9woQ.js","./DA4KItu_.js","./CV-2bRRD.js","./TimeSelector.DAR2lbHN.css","./D8wgK-Ih.js","./HdsRe6lq.js","./index.N-A1gxk9.css","./DzBSAsxR.js","./FilterInput.7KjqjE1F.css","./DGuB8RA-.js","./4fFkR2QG.js","./Pagination.XVPzwtel.css","./D2QgEzTv.js","./SJHyi9T4.js","./DG2ZEhLK.js","./CAfhvBOi.js","./BYGCxle3.js","./DcFNOSET.js","./boyBAVNN.js","./4PLl4EP6.js","./Bgc5K1P7.js","./DEAKw9Pl.js","./CHgOe2F-.js","./CYkscC4Z.js","./ps5He39s.js","./Cl-qOJW6.js","./BcKPINb2.js","./VirtualCell.6f0pX0MN.css","./CkXo2doe.js","./Czlq_f4Y.js","./Cgx2iu1G.js","./C6nWwNvX.js","./Cell.Dgtcn0F2.css"])))=>i.map(i=>d[i]);
import{e as Ne,S as Te,G as r,r as c,fT as Pe,kP as Re,kO as Ve,ja as Me,jd as Be,gD as De,em as Fe,gB as Ue,mm as $e,j7 as Ge,Y as re,j3 as ze,j8 as We,ko as ce,iC as Ke,gE as Xe,jf as de,n as y,aQ as R,g2 as v,aj as a,fU as O,fw as V,fF as Ye,gX as M,aX as B,hh as qe,a_ as He,kr as Qe,g as Ze,eN as Je,bz as el,g$ as me,g3 as ll,fX as tl,c as u,I as b,L as e,o as n,w as K,a as N,cn as al,ag as w,K as C,an as I,f_ as fe,aq as D,aS as ve,b as X,t as Y,a3 as nl,ar as sl,P as ol,M as ul,d as il,f7 as rl,aG as cl,bw as dl,hU as ml,aW as pe,aZ as fl}from"./DOFFjK0_.js";import{g as vl}from"./D2QgEzTv.js";import{u as pl}from"./YRJcuhQv.js";import{u as hl}from"./CV-2bRRD.js";const yl=ve(()=>pe(()=>import("./CMyFGii6.js").then(k=>k.V),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url).then(k=>k.default||k)),gl=ve(()=>pe(()=>import("./CkXo2doe.js").then(k=>k.C),__vite__mapDeps([33,1,2,7,8,34,35,36,24,18,17,22,23,37]),import.meta.url).then(k=>k.default||k)),kl=["src"],_l={key:0,class:"flex h-full virtual-lookup-cells"},bl={key:0},Ol={key:0,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},wl={key:1,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},Il={class:"flex flex-wrap gap-2 items-start overflow-y-auto px-3 py-2"},Al={key:0,class:"px-2 py-6 text-gray-500 flex flex-col items-center gap-6 text-center"},jl=Ne({__name:"Lookup",setup(k){const{metas:F,getMeta:q}=Te(),S=r(Pe,c()),H=r(Re),m=r(Ve,c()),he=r(Me,c(!1)),Q=r(Be,c(!1)),Z=r(De,c(!1)),ye=r(Fe,c(!1)),E=r(Ue,null),x=r($e,null),ge=r(Ge,!1),ke=r(We,re(ze)),_e=r(ce,c(!1)),be=r(Ke,re({})),U=r(Xe,null),$=c(1),g=r(de,c(1));B(de,$);const A=y(()=>{var l,s,d;if((l=S.value)!=null&&l.fk_model_id)return(d=(s=F.value[S.value.fk_model_id])==null?void 0:s.columns)==null?void 0:d.find(h=>{var _,j;return h.id===((j=(_=S.value)==null?void 0:_.colOptions)==null?void 0:j.fk_relation_column_id)})});R(S,async l=>{!(l!=null&&l.fk_model_id)||F.value[l==null?void 0:l.fk_model_id]||await q(l.fk_model_id)},{immediate:!0}),R(A,async l=>{l&&l.colOptions&&await q(l.colOptions.fk_related_model_id)},{immediate:!0});const J=y(()=>{var l;if(A.value&&((l=A.value)!=null&&l.colOptions))return F.value[A.value.colOptions.fk_related_model_id]}),t=y(()=>{var l,s;return(s=(l=J.value)==null?void 0:l.columns)==null?void 0:s.find(d=>{var h,_;return d.id===((_=(h=S.value)==null?void 0:h.colOptions)==null?void 0:_.fk_lookup_column_id)})});R([t,g],()=>{t.value&&!v(t.value)?$.value=1:$.value=g.value},{immediate:!0});const f=y(()=>{var l,s,d,h,_,j,P,i;if(((l=t.value)==null?void 0:l.uidt)===a.Checkbox&&[O.BELONGS_TO,O.ONE_TO_ONE].includes((d=(s=A.value)==null?void 0:s.colOptions)==null?void 0:d.type)){const o=!!(H&&((_=H.value)!=null&&_.row[(h=A.value)==null?void 0:h.title]));return!m.value&&!o?[]:(V(m.value)?m.value:[m.value]).map(vl)}if(!m.value)return[];if(((j=t.value)==null?void 0:j.uidt)===a.Attachment){if([O.BELONGS_TO,O.ONE_TO_ONE].includes((i=(P=A.value)==null?void 0:P.colOptions)==null?void 0:i.type))return V(m.value)?m.value:[m.value];if(V(m.value)&&m.value.every(o=>Ye(o)?!0:V(o)?!o.length||M(o[0]):!1))return m.value.filter(o=>o!==null).reduce((o,Le)=>(o.push(...Le),o),[])}return Array.isArray(m.value)?m.value.filter(o=>o!==null):[m.value]});B(fl,J),B(ce,c(!0)),B(qe,c(!0));const{showEditNonEditableFieldWarning:Oe,showClearNonEditableFieldWarning:we,activateShowEditNonEditableFieldWarning:ee}=pl(),L=c(""),Ie=[a.ID,a.SingleLineText,a.LongText,a.SingleSelect,a.MultiSelect,a.Year,a.PhoneNumber,a.Email,a.Number,a.Decimal,a.Currency,a.Percent,a.Duration,a.Rating,a.Formula],Ae=y(()=>t.value?Ie.includes(t.value.uidt):!1),le=y(()=>!t.value||f.value.length<2),G=y(()=>f.value.filter(l=>He(l,L.value))),p=c(!1),te=c(null),ae=`lookup-${Math.floor(Math.random()*99999)}`,je=y(()=>{var l;return(l=te.value)==null?void 0:l.closest("td, .nc-data-cell")}),z=c(null),ne=r(Qe,c(!1));function T(l){l.type==="click"&&(Z.value||ye.value||ne.value)&&(p.value=!p.value)}const se=l=>{if(!(!(l instanceof KeyboardEvent)||!l.target||dl(l))&&ml(l))return p.value=!p.value,!0};Ze(()=>{Je(je.value,l=>{var s;(s=l.target)!=null&&s.closest(`.${ae}`)||(p.value=!1)}),x==null||x.on(T),E==null||E.on(T),U==null||U.on(se),!(_e.value||!ge||!ke||Z.value||!Q.value)&&(se(be.event)||(p.value=!0))}),el(()=>{x==null||x.off(T),E==null||E.off(T)}),R(p,l=>{setTimeout(()=>{var s,d;l&&z.value&&((d=(s=z.value)==null?void 0:s.querySelector(".lookup-search-input input"))==null||d.focus())},200)}),hl(ne,l=>{switch(l.key){case"Enter":p.value=!0,l.stopPropagation();break}});const oe=y(()=>{const l=v(t.value);return[`${[a.MultiSelect,a.SingleSelect,a.User].includes(t.value.uidt)?"pl-2":l?"":"px-1"}`,{"min-h-0 min-w-0":l,"!w-auto ":!l}]}),Ee=y(()=>he.value||t.value&&v(t.value)?void 0:g.value?`${g.value===1?me[1]-4:me[`${g.value}`]-(Q.value?17:0)}px`:"2.85rem"),W=l=>{l.target&&l.target.closest(".nc-attachment-item")&&(l.stopPropagation(),p.value=!1)},xe=[a.Rollup,a.Formula],ue=y(()=>{var l;return xe.includes((l=t.value)==null?void 0:l.uidt)}),Ce=r(ll,c({isPageDesignerPreviewPanel:!1})),{getPossibleAttachmentSrc:Se}=tl(),ie=y(()=>{var l;return((l=Se(f.value[0]))==null?void 0:l[0])??""});return(l,s)=>{const d=yl,h=gl,_=ul,j=sl,P=cl;return e(Ce).isPageDesignerPreviewPanel&&e(ie)?(n(),u("img",{key:0,src:e(ie),class:"object-contain h-full w-full"},null,8,kl)):(n(),b(P,{key:1,disabled:e(le),trigger:[],visible:!e(le)&&e(p),"auto-close":!1,"overlay-class-name":`!min-w-[300px] nc-links-dropdown ${e(p)?"active":""}`},{overlay:K(()=>[e(t)?(n(),u("div",{key:0,ref_key:"dropdownOverlayRef",ref:z,class:w(["w-[300px] max-h-[320px] flex flex-col rounded-sm lookup-dropdown outline-none",[ae]]),tabindex:"0",onKeydown:s[2]||(s[2]=nl(i=>p.value=!1,["esc"]))},[e(Ae)?(n(),b(j,{key:0,value:e(L),"onUpdate:value":s[1]||(s[1]=i=>ol(L)?L.value=i:null),placeholder:l.$t("general.search"),class:"lookup-search-input"},{prefix:K(()=>[X(_,{icon:"search",class:"text-nc-content-gray-muted"})]),_:1},8,["value","placeholder"])):C("",!0),N("div",Il,[e(L)&&!e(G).length?(n(),u("div",Al,[s[3]||(s[3]=N("img",{src:rl,class:"!w-[164px] flex-none",alt:"No search results found"},null,-1)),il(" "+Y(l.$t("title.noResultsMatchedYourSearch")),1)])):e(fe)(e(t))&&!e(ue)?(n(),u(I,{key:1},[e(t).uidt!==e(a).LinkToAnotherRecord||e(t).uidt===e(a).LinkToAnotherRecord&&[e(O).BELONGS_TO,e(O).ONE_TO_ONE].includes(e(t).colOptions.type)?(n(!0),u(I,{key:0},D(e(G),(i,o)=>(n(),b(d,{key:o,"edit-enabled":!1,"model-value":i,column:e(t),"read-only":!0},null,8,["model-value","column"]))),128)):C("",!0)],64)):(n(),u(I,{key:2},[("isAttachment"in l?l.isAttachment:e(v))(e(t))&&e(f)[0]&&("ncIsObject"in l?l.ncIsObject:e(M))(e(f)[0])?(n(),u("div",{key:0,class:"nc-lookup-attachment-wrapper",onClick:W},[X(h,{"model-value":e(f),column:e(t),"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"])])):(n(!0),u(I,{key:1},D(e(G),(i,o)=>(n(),u("div",{key:o,class:w(["flex-none",{"bg-nc-bg-default rounded-full":!("isAttachment"in l?l.isAttachment:e(v))(e(t)),"border-gray-200 rounded border-1 max-w-full":![e(a).Attachment,e(a).MultiSelect,e(a).SingleSelect,e(a).User,e(a).CreatedBy,e(a).LastModifiedBy].includes(e(t).uidt),"min-h-0 min-w-0":("isAttachment"in l?l.isAttachment:e(v))(e(t))}]),onClick:W},[e(t).uidt===e(a).Rollup?(n(),b(d,{key:0,"edit-enabled":!1,"read-only":!0,"model-value":i,column:e(t),class:"px-2"},null,8,["model-value","column"])):(n(),b(h,{key:1,"model-value":i,column:e(t),"edit-enabled":!1,virtual:!0,"read-only":!0,class:w(e(oe))},null,8,["model-value","column","class"]))],2))),128))],64))])],34)):C("",!0)]),default:K(()=>[N("div",{ref_key:"triggerRef",ref:te,class:"nc-cell-field h-full w-full nc-lookup-cell",tabindex:"-1",style:al({height:e(Ee)}),onDblclick:s[0]||(s[0]=(...i)=>e(ee)&&e(ee)(...i))},[N("div",{class:w(["h-full w-full overflow-hidden",{"nc-cell-lookup-scroll":e(g)===1,"flex gap-1":!(e(t)&&("isAttachment"in l?l.isAttachment:e(v))(e(t))&&e(f)[0]&&("ncIsObject"in l?l.ncIsObject:e(M))(e(f)[0]))}]),onClick:W},[e(t)?(n(),u(I,{key:0},[e(fe)(e(t))&&!e(ue)?(n(),u("div",_l,[e(t).uidt!==e(a).LinkToAnotherRecord||e(t).uidt===e(a).LinkToAnotherRecord&&[e(O).BELONGS_TO,e(O).ONE_TO_ONE].includes(e(t).colOptions.type)?(n(!0),u(I,{key:0},D(e(f),(i,o)=>(n(),b(d,{key:o,"edit-enabled":!1,"model-value":i,column:e(t),"read-only":!0},null,8,["model-value","column"]))),128)):(n(),b(d,{key:1,"edit-enabled":!1,"read-only":!0,"model-value":e(f),column:e(t)},null,8,["model-value","column"]))])):(n(),u(I,{key:1},[("isAttachment"in l?l.isAttachment:e(v))(e(t))&&e(f)[0]&&("ncIsObject"in l?l.ncIsObject:e(M))(e(f)[0])?(n(),u("div",bl,[X(h,{"model-value":e(f),column:e(t),"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"])])):(n(),u("div",{key:1,class:w(["max-h-full max-w-full w-full nc-cell-lookup-scroll !overflow-x-hidden",{"nc-scrollbar-thin ":e(g)!==1&&!("isAttachment"in l?l.isAttachment:e(v))(e(t))}])},[N("div",{class:w(["flex gap-1.5 w-full h-full",{"flex-wrap":e(g)!==1&&!("isAttachment"in l?l.isAttachment:e(v))(e(t)),"!overflow-hidden nc-cell-lookup-scroll":e(g)===1||("isAttachment"in l?l.isAttachment:e(v))(e(t)),"items-center":e(g)===1,"items-start":e(g)!==1,"py-[3px]":!("isAttachment"in l?l.isAttachment:e(v))(e(t))}])},[(n(!0),u(I,null,D(e(f),(i,o)=>(n(),u("div",{key:o,class:w(["flex-none",{"bg-nc-bg-default rounded-full":!("isAttachment"in l?l.isAttachment:e(v))(e(t)),"border-gray-200 rounded border-1 max-w-full":![e(a).Attachment,e(a).MultiSelect,e(a).SingleSelect,e(a).User,e(a).CreatedBy,e(a).LastModifiedBy].includes(e(t).uidt),"min-h-0 min-w-0":("isAttachment"in l?l.isAttachment:e(v))(e(t))}])},[e(t).uidt===e(a).Rollup?(n(),b(d,{key:0,"edit-enabled":!1,"read-only":!0,"model-value":i,column:e(t),class:"px-2"},null,8,["model-value","column"])):(n(),b(h,{key:1,"model-value":i,column:e(t),"edit-enabled":!1,virtual:!0,"read-only":!0,class:w(e(oe))},null,8,["model-value","column","class"]))],2))),128))],2),e(Oe)?(n(),u("div",Ol,Y(l.$t("msg.info.computedFieldEditWarning")),1)):C("",!0),e(we)?(n(),u("div",wl,Y(l.$t("msg.info.computedFieldDeleteWarning")),1)):C("",!0)],2))],64))],64)):C("",!0)],2)],36)]),_:1},8,["disabled","visible","overlay-class-name"]))}}}),Ll=Object.assign(jl,{__name:"VirtualCellLookup"});export{Ll as default};
