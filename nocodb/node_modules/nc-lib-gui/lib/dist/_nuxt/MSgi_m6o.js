const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B3rHhvyL.js","./DOFFjK0_.js","./entry.DDfSYhWa.css","./RichTextOptions.DOxF6Dx4.css"])))=>i.map(i=>d[i]);
import{e as Le,G as Ae,r as f,jd as qe,aL as Ue,n as Y,lh as Ve,li as Ge,lj as He,lk as Je,ll as Ye,lm as Qe,bv as $e,eN as Oe,ac as Me,c as m,o as l,ag as B,L as s,K as $,t as C,an as pe,I as x,b as p,N as me,ad as Q,aS as Ze,O as Re,w as _,M as Be,$ as j,aW as Xe,J as Ie,as as et,bm as tt,b5 as ot,a8 as Ee,a7 as st,aZ as at,u as nt,aQ as Te,aV as lt,i as rt,aJ as it,a as d,aq as ct,c4 as ut,aG as dt,d as R,ep as pt,aT as ie,b9 as ce,aA as mt,ap as _t,a3 as ue,P as Se,bk as de,bj as ft,_ as vt}from"./DOFFjK0_.js";import{_ as yt}from"./JKos0pQW.js";import{_ as xt}from"./D_wq2ltS.js";import{_ as bt}from"./9aYOtC5C.js";import{M as ht,_ as gt}from"./BdLxRlCP.js";import{S as kt,P as wt,u as Ct,E as $t,t as Et}from"./YaKnxhzO.js";import{u as Tt}from"./CNJqPN7Y.js";import{u as St}from"./AxsiR11P.js";import{a as Lt}from"./D1gZ4Fpg.js";const At=Ze(()=>Xe(()=>import("./B3rHhvyL.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(N=>N.default||N)),Ot={key:0,class:"truncate"},Mt={key:0},Rt={key:1,class:"flex justify-between pt-1 rich-text-bottom-bar items-center"},Bt=Le({__name:"RichComment",props:{hideOptions:{type:Boolean,default:!0},value:{},readOnly:{type:Boolean},syncValueChange:{type:Boolean},autofocus:{type:Boolean},autofocusToEnd:{type:Boolean},placeholder:{},renderAsText:{type:Boolean}},emits:["update:value","focus","blur","save"],setup(N,{expose:b,emit:T}){const v=N,y=T,Z=Ae(qe,f(!1)),h=f(!1),g=Ue(),S=f(null),U=f(null),L=Y({get:()=>Ve.preprocessMarkdown(v.value,!0),set:e=>{y("update:value",e)}}),F=[kt.configure({heading:!1,codeBlock:!1,code:!1,strike:!1,hardBreak:!1,italic:!1}),Ge,He,Je,Ye,Qe,wt.configure({emptyEditorClass:"is-editor-empty",placeholder:v.placeholder}),ht.configure({breaks:!0,transformPastedText:!1})];function X(e){return!e||!(e!=null&&e.trim())?!0:/^\s*(<br\s*\/?>\s*)*$/i.test(e)}const i=Ct({content:L.value,extensions:F,onUpdate:({editor:e})=>{let o=e.storage.markdown.getMarkdown();((e==null?void 0:e.isActive("bulletList"))||(e==null?void 0:e.isActive("orderedList"))||(e==null?void 0:e.isActive("blockquote")))&&(o.endsWith("<br>")&&(o=o.slice(0,-4)),o.endsWith("<br> ")&&(o=o.slice(0,-5))),L.value=X(o)?"":`${o}`},editable:!v.readOnly,autofocus:v.autofocus,onCreate:()=>{v.autofocusToEnd&&j(()=>{var e;(e=i.value)==null||e.commands.setContent(L.value)})},onFocus:()=>{h.value=!0,y("focus")},onBlur:e=>{const o=e==null?void 0:e.event.relatedTarget;o&&(o!=null&&o.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")||(h.value=!1,y("blur")))},editorProps:{handleKeyDown(e,o){if(o.key==="Enter"&&!o.ctrlKey&&!o.shiftKey&&!o.metaKey){const{state:c}=e,{selection:k}=c;if(!k.empty)return!0}}}}),V=(e,o)=>{i.value&&(i.value.commands.setContent(e,!1),o&&W())};function A(){var e;!v.readOnly&&!g.shift.value&&((e=i.value)==null||e.chain().focus().run())}function W(){i.value&&j(()=>{var e;(e=i.value)==null||e.chain().focus().run()})}$e(S,"focusout",e=>{var c;const o=e==null?void 0:e.relatedTarget;((c=o==null?void 0:o.classList)!=null&&c.contains("tiptap")||!(o!=null&&o.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")))&&(h.value=!1,y("blur"))},!0),$e(U,"focusout",e=>{var c;const o=e==null?void 0:e.relatedTarget;!o&&((c=e.target)!=null&&c.closest(".comment-bubble-menu, .nc-comment-save-btn, .nc-mention-list, .mention, .rich-text-bottom-bar, .tippy-content, .nc-comment-rich-editor"))||o!=null&&o.closest(".comment-bubble-menu, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .tippy-content, .nc-mention-list, .nc-comment-rich-editor")||(h.value=!1,y("blur"))},!0),Oe(S,e=>{if(!h.value)return;const o=e==null?void 0:e.target;o!=null&&o.closest(".tippy-content, .nc-rich-text-comment, .nc-comment-save-btn, .nc-mention-list, .rich-text-bottom-bar, .mention, .comment-bubble-menu, .nc-comment-rich-editor")||(h.value=!1,y("blur"))});const P=f(!1),I=e=>{i.value&&(P.value?P.value=!1:i.value.isActive("bulletList")||i.value.isActive("orderedList")||i.value.isActive("blockquote")?e.stopPropagation():y("save"))};let z;const ee=e=>{var c,k,u,M;if(!((c=L.value)!=null&&c.length)){V("");return}z&&clearTimeout(z),((k=i.value)==null?void 0:k.isActive("bulletList"))||((u=i.value)==null?void 0:u.isActive("orderedList"))||((M=i.value)==null?void 0:M.isActive("blockquote"))?(P.value=!0,z=setTimeout(()=>{P.value=!1},1e3)):I(e)},r=e=>{var o,c;e.altKey&&e.key==="Enter"||e.shiftKey&&e.key==="Enter"?e.stopPropagation():e.key==="Enter"?ee(e):e.key==="Escape"&&(h.value=!1,y("blur"),(c=(o=document.querySelector('.nc-drawer-expanded-form.active > div[tabindex="0"]'))==null?void 0:o.focus)==null||c.call(o))},O=e=>{e.preventDefault(),e.stopPropagation(),y("save")};return b({setEditorContent:V,focusEditor:W}),(e,o)=>{var G,D;const c=gt,k=At,u=Be,M=Re,te=Me("e");return l(),m("div",{class:B([{readonly:e.readOnly,"nc-rich-text-grid":s(Z)},"nc-rich-text-comment flex flex-col w-full h-full"]),tabindex:1,onFocus:A},[e.renderAsText?(l(),m("div",Ot,[s(i)?(l(),m("span",Mt,C(((G=s(i))==null?void 0:G.getText())??""),1)):$("",!0)])):(l(),m(pe,{key:1},[s(i)?(l(),x(c,{key:0,ref_key:"richTextLinkOptionRef",ref:U,editor:s(i),"is-comment":!0,"is-form-field":!0,onBlur:o[0]||(o[0]=oe=>h.value=!1)},null,8,["editor"])):$("",!0),p(s($t),{ref_key:"editorDom",ref:S,editor:s(i),class:B([{"p-1":!v.readOnly,"px-[0.25rem]":v.readOnly},"nc-rich-text-content flex flex-col nc-comment-rich-editor w-full scrollbar-thin scrollbar-thumb-gray-200 nc-rich-truncate scrollbar-track-transparent"]),onKeydown:me(r,["stop"])},null,8,["editor","class"]),e.hideOptions?$("",!0):(l(),m("div",Rt,[p(k,{editor:s(i),class:"!bg-transparent"},null,8,["editor"]),Q((l(),x(M,{disabled:!((D=s(L))!=null&&D.length),class:"!disabled:bg-gray-100 nc-comment-save-btn !h-7 !w-7 !shadow-none",size:"xsmall",onClick:O},{default:_(()=>[p(u,{icon:"ncSendAlt"})]),_:1},8,["disabled"])),[[te,["a:row-expand:comment:save"]]])]))],64))],34)}}}),Pt=Object.assign(Bt,{__name:"SmartsheetExpandedFormRichComment"}),Dt={key:0,class:"flex flex-col items-center justify-center w-full h-full"},Kt={key:1,class:"flex flex-col h-full"},jt={key:0,class:"flex flex-col my-1 text-center justify-center h-full nc-scrollbar-thin"},Nt={class:"text-center text-3xl text-gray-700"},Ft={class:"font-medium text-center my-6 text-gray-500"},Wt={class:"flex items-start justify-between"},zt={class:"flex h-[28px] items-center gap-3 w-[calc(100%_-_40px)]"},qt={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},Ut={class:"bg-white rounded-lg"},Vt={class:"flex items-center gap-4 py-3 px-2"},Gt={class:"flex flex-col"},Ht={class:"font-semibold text-gray-800"},Jt={class:"text-xs text-gray-600"},Yt={key:0,class:"px-3 rounded-b-lg !text-[13px] items-center text-gray-600 flex gap-1 bg-gray-100 py-1.5"},Qt={class:"text-xs text-gray-500"},Zt={class:"flex items-center"},Xt={class:"flex gap-2 items-center"},It={class:"flex gap-2 items-center"},eo={class:"flex gap-2 items-center"},to={key:1},oo={key:1,class:"space-y-1 pl-9"},so=["innerHTML"],ao={key:2,class:"px-3 pb-3 nc-comment-input !rounded-br-2xl gap-2 flex"},no=Le({__name:"Comments",setup(N){const{user:b,appInfo:T}=Ie(),{dashboardUrl:v}=Tt(),{isUIAllowed:y}=et(),{copy:Z}=tt(),h=ot(),g=Y(()=>y("commentEdit")),{isExpandedFormCommentMode:S}=Ee(St()),U=st(),{basesUser:L}=Ee(U),F=Ae(at,f()),{deleteComment:X,resolveComment:i,isCommentsLoading:V,comments:A,loadComments:W,updateComment:P,saveComment:I,primaryKey:z,parsedHtmlComments:ee}=Lt(),r=f(),O=f(),e=f(!1),o=f(!1),c=f(null),k=f(),u=f(""),M=nt(),te=Y(()=>{var t,n;return(t=F.value)!=null&&t.base_id?L.value.get((n=F.value)==null?void 0:n.base_id)||[]:[]}),G=lt(Ne,1e3);function D(){O.value&&O.value.scrollTo({top:O.value.scrollHeight,behavior:"smooth"})}const oe=async()=>{var n,w,E,q,H;if(!u.value.trim())return;for(;u.value.endsWith("<br />")||u.value.endsWith(`
`);)u.value.endsWith("<br />")?u.value=u.value.slice(0,-6):u.value=u.value.slice(0,-2);o.value=!0,A.value=[...A.value,{id:`temp-${new Date().getTime()}`,comment:u.value,created_at:new Date().toISOString(),created_by:(n=b.value)==null?void 0:n.id,created_by_email:(w=b.value)==null?void 0:w.email,created_display_name:((E=b.value)==null?void 0:E.display_name)??"",created_by_meta:((q=b.value)==null?void 0:q.meta)??""}];const t=u.value;u.value="",(H=k==null?void 0:k.value)==null||H.setEditorContent("",!0),await j(()=>{D()});try{await I(t),await j(()=>{S.value=!0}),D()}catch(J){console.error(J)}},Pe=async t=>{var n;await Z(encodeURI(`${v==null?void 0:v.value}#/${h.params.typeOrId}/${h.params.baseId}/${(n=F.value)==null?void 0:n.id}?rowId=${z.value}&commentId=${t.id}`))};function _e(t){const n=document.querySelector(`.${t}`);n&&n.scrollIntoView({behavior:"smooth",block:"center"})}function De(t){e.value&&(t.preventDefault(),t.stopPropagation(),r.value=void 0,W(),e.value=!1,r.value=void 0)}function Ke(t){r.value={...t},e.value=!0,j(()=>{_e(t.id)})}const se=Y({get(){var t;return((t=r.value)==null?void 0:t.comment)||""},set(t){r.value&&(r.value.comment=t)}});async function fe(){var n;if(!e.value||!((n=r.value)!=null&&n.comment))return;for(;r.value.comment.endsWith("<br />")||r.value.comment.endsWith(`
`);)r.value.comment.endsWith("<br />")?r.value.comment=r.value.comment.slice(0,-6):r.value.comment=r.value.comment.slice(0,-2);o.value=!0;const t={...r.value};e.value=!1,r.value=void 0,await P(t.id,{comment:t.comment}),W()}const ve=t=>{var n,w;return t.created_by===((n=b.value)==null?void 0:n.id)?"You":(w=t.created_display_name)!=null&&w.trim()?t.created_display_name||"Shared source":t.created_by_email?t.created_by_email:"Shared source"};function ye(){c.value&&(c.value=null)}Te(O,()=>{setTimeout(()=>{j(()=>{const t=M.currentRoute.value.query,n=t.commentId;n?(M.push({query:{rowId:t.rowId}}),_e(n),c.value=n,Oe(document.querySelector(`.${c.value}`),ye)):D()})},100)});const je=t=>{const n=te.value.find(w=>w.email===t);return n?n.roles??(n.workspace_roles?ft[n.workspace_roles]??de.NO_ACCESS:de.NO_ACCESS):de.NO_ACCESS},ae=[];function Ne(){xe(),document.querySelectorAll(".nc-rich-link-tooltip").forEach(t=>{const n=Object.values(t.attributes).find(E=>E.name==="data-tooltip");if(!n)return;const w=Et(t,{content:`<span class="tooltip nc-rich-link-tooltip-popup">${n.value}</span>`,placement:"top",allowHTML:!0,arrow:!0,animation:"fade",duration:0});ae.push(w)})}function xe(){ae.forEach(t=>t==null?void 0:t.destroy()),ae.length=0}const be=t=>{t.key!=="Escape"&&t.stopPropagation()};return Te(A,()=>{G()},{immediate:!0}),rt(()=>{xe()}),(t,n)=>{const w=it,E=Be,q=ut,H=yt,J=dt,ne=Re,le=xt,Fe=mt,We=bt,he=_t,ge=Pt,re=Me("e");return l(),m("div",{class:B(["h-full",{"pb-1":!s(g)}])},[s(V)?(l(),m("div",Dt,[p(w,{size:"xlarge"})])):(l(),m("div",Kt,[s(A).length===0?(l(),m("div",jt,[d("div",Nt,[p(E,{icon:"commentHere"})]),d("div",Ft,C(s(g)?t.$t("activity.startCommenting"):t.$t("activity.noCommentsYet")),1)])):(l(),m("div",{key:1,ref_key:"commentsWrapperEl",ref:O,class:"flex flex-col h-full py-1 nc-scrollbar-thin"},[(l(!0),m(pe,null,ct(s(A),(a,ze)=>{var ke,we,Ce;return l(),m("div",{key:a.id,class:B([[{"mt-auto":ze===0},a.id],"nc-comment-item"]),onMouseover:ye},[d("div",{class:B([{"hover:bg-gray-100":((ke=s(r))==null?void 0:ke.id)!==a.id,"nc-hovered-comment bg-gray-100":s(c)===a.id},"group gap-3 overflow-hidden px-3 py-2 transition-colors"])},[d("div",Wt,[d("div",{class:B(["flex items-start gap-3 flex-1",{"w-[calc(100%)] group-hover:w-[calc(100%_-_50px)]":!s(T).ee,"w-[calc(100%_-_44px)] group-hover:w-[calc(100%_-_72px)]":s(T).ee&&a.resolved_by,"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_72px)]":s(T).ee&&!a.resolved_by&&s(g),"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_44px)]":s(T).ee&&!a.resolved_by&&!s(g)}])},[p(q,{user:{display_name:a==null?void 0:a.created_display_name,email:a==null?void 0:a.created_by_email,meta:a==null?void 0:a.created_by_meta},class:"mt-0.5",size:"medium"},null,8,["user"]),d("div",zt,[p(J,{placement:"topLeft",trigger:["hover"],class:"flex-none max-w-[calc(100%_-_72px)]"},{overlay:_(()=>[d("div",Ut,[d("div",Vt,[p(q,{class:"border-1 border-gray-200 rounded-full",user:{display_name:a==null?void 0:a.created_display_name,email:a==null?void 0:a.created_by_email,meta:a==null?void 0:a.created_by_meta},size:"base"},null,8,["user"]),d("div",Gt,[d("div",Ht,C(ve(a)),1),d("div",Jt,C(a.created_by_email),1)])]),s(y)("dataEdit")?(l(),m("div",Yt,[n[4]||(n[4]=R(" Has ")),p(H,{size:"sm",border:!1,role:je(a.created_by_email)},null,8,["role"]),n[5]||(n[5]=R(" role in base "))])):$("",!0)])]),default:_(()=>[d("div",qt,C(ve(a)),1)]),_:2},1024),d("div",Qt,C(("timeAgo"in t?t.timeAgo:s(pt))(a.created_at)),1)])],2),d("div",Zt,[s(r)?$("",!0):(l(),x(J,{key:0,class:"nc-comment-more-actions !hidden !group-hover:block","overlay-class-name":"!min-w-[160px]",placement:"bottomRight"},{overlay:_(()=>[p(We,{variant:"small"},{default:_(()=>[s(b)&&a.created_by_email===s(b).email&&s(g)?Q((l(),x(le,{key:0,onClick:K=>Ke(a)},{default:_(()=>[d("div",Xt,[(l(),x(ie(("iconMap"in t?t.iconMap:s(ce)).rename),{class:"cursor-pointer"})),R(" "+C(t.$t("general.edit")),1)])]),_:2},1032,["onClick"])),[[re,["c:comment-expand:comment:edit"]]]):$("",!0),Q((l(),x(le,{onClick:K=>Pe(a)},{default:_(()=>[d("div",It,[(l(),x(ie(("iconMap"in t?t.iconMap:s(ce)).copy),{class:"cursor-pointer"})),R(" "+C(t.$t("general.copy"))+" URL ",1)])]),_:2},1032,["onClick"])),[[re,["c:comment-expand:comment:copy"]]]),s(b)&&a.created_by_email===s(b).email&&s(g)?(l(),m(pe,{key:1},[p(Fe),Q((l(),x(le,{class:"!text-red-500 !hover:bg-red-50",onClick:K=>s(X)(a.id)},{default:_(()=>[d("div",eo,[(l(),x(ie(("iconMap"in t?t.iconMap:s(ce)).delete),{class:"cursor-pointer"})),R(" "+C(t.$t("general.delete")),1)])]),_:2},1032,["onClick"])),[[re,["c:row-expand:comment:delete"]]])],64)):$("",!0)]),_:2},1024)]),default:_(()=>[p(ne,{class:"nc-expand-form-more-actions !hover:bg-gray-200 !w-7 !h-7 !bg-transparent",size:"xsmall",type:"text"},{default:_(()=>[p(E,{class:"text-md",icon:"threeDotVertical"})]),_:1})]),_:2},1024)),s(T).ee?(l(),m("div",to,[!a.resolved_by&&s(g)?(l(),x(he,{key:0},{title:_(()=>[R(C(t.$t("activity.clickToResolve")),1)]),default:_(()=>[p(ne,{class:"nc-resolve-comment-btn !w-7 !h-7 !bg-transparent !hover:bg-gray-200 !hidden !group-hover:block",size:"xsmall",type:"text",onClick:K=>s(i)(a.id)},{default:_(()=>[p(E,{class:"text-md",icon:"checkCircle"})]),_:2},1032,["onClick"])]),_:2},1024)):a.resolved_by?(l(),x(he,{key:1},{title:_(()=>[R(C(`${t.$t("activity.resolvedBy")} ${a.resolved_display_name}`),1)]),default:_(()=>[p(ne,{class:"!h-7 !w-7 !bg-transparent !hover:bg-gray-200 text-semibold",size:"xsmall",type:"text",onClick:K=>s(i)(a.id)},{default:_(()=>[p(E,{class:"text-md rounded-full bg-[#17803D] text-white",icon:"checkFill"})]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0)])):$("",!0)])]),d("div",{class:B([{"mt-3":a.id===((we=s(r))==null?void 0:we.id)},"flex-1 flex flex-col gap-1 max-w-[calc(100%)]"])},[a.id===((Ce=s(r))==null?void 0:Ce.id)&&s(g)?(l(),x(ge,{key:0,value:s(se),"onUpdate:value":n[0]||(n[0]=K=>Se(se)?se.value=K:null),autofocus:"","autofocus-to-end":"","hide-options":!1,class:"expanded-form-comment-edit-input cursor-text expanded-form-comment-input !py-2 !px-2 !m-0 w-full !border-1 !border-gray-200 !rounded-lg !bg-white !text-gray-800 !text-small !leading-18px !max-h-[240px]","data-testid":"expanded-form-comment-input",onSave:fe,onKeydown:[ue(De,["esc"]),be,ue(me(fe,["exact","prevent"]),["enter"])],onBlur:n[1]||(n[1]=()=>{r.value=void 0,e.value=!1})},null,8,["value","onKeydown"])):(l(),m("div",oo,[d("div",{class:"nc-rich-text-content !text-small !leading-18px !text-gray-800",innerHTML:s(ee)[a.id]},null,8,so)]))],2)],2)],34)}),128))],512)),s(g)?(l(),m("div",ao,[p(ge,{ref_key:"commentInputRef",ref:k,value:s(u),"onUpdate:value":n[2]||(n[2]=a=>Se(u)?u.value=a:null),"hide-options":!1,placeholder:`${t.$t("general.comment")}...`,class:"expanded-form-comment-input !py-2 !px-2 cursor-text border-1 rounded-lg w-full bg-transparent !text-gray-800 !text-small !leading-18px !max-h-[240px]",autofocus:s(S),"data-testid":"expanded-form-comment-input",onFocus:n[3]||(n[3]=a=>S.value=!1),onKeydown:[be,ue(me(oe,["exact","prevent"]),["enter"])],onSave:oe},null,8,["value","placeholder","autofocus","onKeydown"])])):$("",!0)]))],2)}}}),lo=Object.assign(vt(no,[["__scopeId","data-v-9402a142"]]),{__name:"SmartsheetExpandedFormSidebarComments"}),yo=Object.freeze(Object.defineProperty({__proto__:null,default:lo},Symbol.toStringTag,{value:"Module"}));export{yo as C,lo as _,Pt as a};
