import{_ as k}from"./Bvj7PEZG.js";import{e as V,f as g,J as D,G as c,r as p,cd as A,aY as I,jb as L,ac as M,c as T,o as r,b as $,ad as j,w as m,d as _,t as B,I as u,a as N,L as d,aJ as F,aT as P,b9 as O,N as G,n_ as J,an as R,a4 as l,ai as v,a5 as U,n$ as z,y as H,bs as K,dp as W}from"./DOFFjK0_.js";import{_ as Y}from"./D_wq2ltS.js";const q={class:"flex flex-row items-center nc-base-menu-item !py-0 children:flex-none"},Q=V({__name:"ExportSubActions",setup(X){const{$api:f,$poller:b}=g(),{appInfo:w}=D(),x=c(A,p(!1)),n=c(I),y=c(L,p(null)),E=e=>e.startsWith("http")?e:`${w.value.ncSiteUrl||W}/${e}`,S=async e=>{if(e=E(e),await z(e)){H(e,{open:K});return}const a=document.createElement("a");a.href=e,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},t=p(!1),h=async e=>{try{if(t.value||!n.value.id)return;t.value=!0;let s;if(x.value){if(!n.value.uuid)return;const a={headers:{"xc-password":y.value||""}};s=await f.public.exportData(n.value.uuid,e,{},a)}else s=await f.export.data(n.value.id,e,{});l.info("Preparing CSV for download..."),b.subscribe({id:s.id},async a=>{var o,i;a.status!=="close"&&(a.status===v.COMPLETED?(l.info("Successfully exported data!"),S((i=(o=a.data)==null?void 0:o.result)==null?void 0:i.url),t.value=!1):a.status===v.FAILED&&(l.error("Failed to export data!"),t.value=!1))})}catch(s){l.error(await U(s)),t.value=!1}};return(e,s)=>{const a=k,o=F,i=Y,C=M("e");return r(),T(R,null,[$(a,null,{default:m(()=>[_(B(e.$t("labels.downloadData")),1)]),_:1}),j((r(),u(i,{onClick:s[0]||(s[0]=G(Z=>h(d(J).CSV),["stop"]))},{default:m(()=>[N("div",q,[d(t)?(r(),u(o,{key:0,size:"regular"})):(r(),u(P(("iconMap"in e?e.iconMap:d(O)).ncFileTypeCsvSmall),{key:1,class:"w-4"})),s[1]||(s[1]=_(" CSV "))])]),_:1})),[[C,["a:download:csv"]]])],64)}}}),te=Object.assign(Q,{__name:"SmartsheetToolbarExportSubActions"});export{te as default};
