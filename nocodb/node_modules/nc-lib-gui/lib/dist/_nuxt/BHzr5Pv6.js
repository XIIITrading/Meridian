import{e as X,a9 as Z,f as ee,a8 as j,V as te,G as ae,r as v,eY as se,n as y,a7 as ne,J as le,g as ie,c as u,o as n,a as c,b as o,w as l,d as r,t as a,L as d,ap as oe,I as b,aT as x,b9 as k,P as ce,ar as de,ag as V,at as pe,O as ue,aI as re,bY as me,K as U,an as _e,a4 as B,a5 as fe}from"./DOFFjK0_.js";import{_ as he}from"./sgaWLnOz.js";import{_ as ve}from"./BRY4OykS.js";import"./4fFkR2QG.js";const be={class:"h-full flex flex-row w-full items-center justify-center"},ye={class:"w-full h-full flex flex-col"},we={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},ge={class:"flex"},xe={class:"flex items-center gap-2 text-gray-600 font-light"},ke={class:"flex flex-row items-center w-full gap-x-1"},Ie={class:"flex"},Ce={key:1,class:"flex flex-row gap-x-2"},$e={class:"flex"},Me={key:0,class:"flex items-center gap-2 max-w-full"},Ne={class:"min-w-5 flex items-center justify-center"},Te={key:1,class:"flex items-center gap-2 max-w-full"},je={class:"min-w-5 flex items-center justify-center"},Ve={key:2},Ue={key:0},Be={key:1},Le=X({__name:"UIAcl",props:{sourceId:{}},setup(L){const A=L,{t:m}=Z(),{$api:I,$e:R}=ee(),{base:S}=j(te()),W=ae(se,v()),f=y(()=>{var e;return W.value??((e=S.value)==null?void 0:e.id)}),{bases:G}=j(ne()),z=y(()=>G.value.get(f.value)??{}),{includeM2M:D}=le(),E=v(["editor","commenter","viewer"]),w=v(!1),_=v([]),h=v(""),C=y(()=>_.value.filter(e=>(e==null?void 0:e.source_id)===A.sourceId&&(typeof(e==null?void 0:e._ptn)=="string"&&e._ptn.toLowerCase().includes(h.value.toLowerCase())||typeof(e==null?void 0:e.title)=="string"&&e.title.toLowerCase().includes(h.value.toLowerCase())))),g=y(()=>E.value.reduce((e,i)=>({...e,[i]:_.value.filter(p=>p.disabled[i]).length===0}),{})),F=e=>{const i=!g.value[e];_.value.forEach(p=>{p.disabled[e]=i,p.edited=!0})};async function $(){try{if(!f.value)return;w.value=!0,_.value=await I.base.modelVisibilityList(f.value,{includeM2M:D.value})}catch(e){console.error(e)}finally{w.value=!1}}async function O(){try{if(!f.value)return;await I.base.modelVisibilitySet(f.value,_.value.filter(e=>e.edited)),B.success(m("msg.success.updatedUIACL"))}catch(e){B.error(await fe(e))}R("a:proj-meta:ui-acl")}const P=(e,i)=>{e.disabled[i]=!e.disabled[i],e.edited=!0};ie(async()=>{_.value.length===0&&await $()});const Y=[{key:"name",title:m("labels.tableName"),name:"Table Name",minWidth:220,padding:"0px 12px",dataIndex:"_ptn"},{key:"name",title:m("labels.viewName"),name:"View Name",minWidth:220,padding:"0px 12px",dataIndex:"title"},{key:"action",title:m("objects.roleType.editor"),name:"editor",width:120,minWidth:120,padding:"0px 12px"},{key:"action",title:m("objects.roleType.commenter"),name:"commenter",width:135,minWidth:135,padding:"0px 12px"},{key:"action",title:m("objects.roleType.viewer"),name:"viewer",width:120,minWidth:120,padding:"0px 12px"}];return(e,i)=>{const p=oe,H=de,J=pe,K=ue,M=me,N=he,q=re,Q=ve;return n(),u("div",be,[c("div",ye,[o(p,{class:"mb-4 first-letter:capital","show-on-truncate-only":""},{title:l(()=>[r(a(d(z).title),1)]),default:l(()=>[i[1]||(i[1]=c("span",null," Control view visibility for different roles to manage access efficiently. ",-1))]),_:1,__:[1]}),c("div",we,[o(H,{value:d(h),"onUpdate:value":i[0]||(i[0]=s=>ce(h)?h.value=s:null),placeholder:e.$t("placeholder.searchModels"),"allow-clear":"",class:"nc-acl-search nc-input-border-on-value !w-[400px] nc-input-sm"},{prefix:l(()=>[(n(),b(x(("iconMap"in e?e.iconMap:d(k)).search),{class:"text-gray-600"}))]),_:1},8,["value","placeholder"]),c("div",ge,[o(J,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:$},{default:l(()=>[c("div",xe,[(n(),b(x(("iconMap"in e?e.iconMap:d(k)).reload),{class:V({"animate-infinite animate-spin !text-success":d(w)})},null,8,["class"])),r(" "+a(e.$t("general.reload")),1)])]),_:1}),o(K,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:O},{default:l(()=>[c("div",ke,[(n(),b(x(("iconMap"in e?e.iconMap:d(k)).save))),c("div",Ie,a(e.$t("general.save")),1)])]),_:1})])]),o(Q,{columns:Y,data:d(C),"row-height":"44px","header-row-height":"44px",class:"h-[calc(100%_-_88px)] w-full"},{headerCell:l(({column:s})=>[s.key==="name"?(n(),u(_e,{key:0},[r(a(s.title),1)],64)):U("",!0),s.key==="action"?(n(),u("div",Ce,[o(M,{checked:d(g)[s.name],"onUpdate:checked":t=>d(g)[s.name]=t,disabled:!d(C).length,class:"!m-0 !top-0",onChange:t=>F(s.name)},null,8,["checked","onUpdate:checked","disabled","onChange"]),c("div",$e,a(s.title),1)])):U("",!0)]),bodyCell:l(({column:s,record:t})=>{var T;return[s.name==="Table Name"?(n(),u("div",Me,[c("div",Ne,[o(N,{meta:{meta:t.table_meta,type:t.ptype},class:"text-gray-500"},null,8,["meta"])]),o(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[r(a(t._ptn),1)]),default:l(()=>[r(" "+a(t._ptn),1)]),_:2},1024)])):s.name==="View Name"?(n(),u("div",Te,[c("div",je,[(T=t==null?void 0:t.meta)!=null&&T.icon?(n(),b(N,{key:0,meta:{meta:t.meta,type:"view"},class:"text-gray-500 !text-sm !children:w-5 !children:h-5"},null,8,["meta"])):(n(),b(q,{key:1,meta:t,class:"text-gray-500"},null,8,["meta"]))]),o(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[r(a(t.is_default?e.$t("title.defaultView"):t.title),1)]),default:l(()=>[r(" "+a(t.is_default?e.$t("title.defaultView"):t.title),1)]),_:2},1024)])):(n(),u("div",Ve,[o(p,null,{title:l(()=>[t.disabled[s.name]?(n(),u("span",Ue,a(e.$t("labels.clickToMake"))+" '"+a(t.title)+"' "+a(e.$t("labels.visibleForRole"))+" "+a(s.name)+" "+a(e.$t("labels.inUI"))+" dashboard",1)):(n(),u("span",Be,a(e.$t("labels.clickToHide"))+" '"+a(t.title)+"' "+a(e.$t("labels.forRole"))+":"+a(s.name)+" "+a(e.$t("labels.inUI")),1))]),default:l(()=>[o(M,{checked:!t.disabled[s.name],class:V(`nc-acl-${t.title}-${s.name}-chkbox !ml-0.25`),onChange:Ae=>P(t,s.name)},null,8,["checked","class","onChange"])]),_:2},1024)]))]}),_:1},8,["data"])])])}}}),ze=Object.assign(Le,{__name:"DashboardSettingsUIAcl"});export{ze as default};
