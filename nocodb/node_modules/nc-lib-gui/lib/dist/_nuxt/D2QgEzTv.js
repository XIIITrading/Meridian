import{g1 as S,jq as O,h3 as T,jr as F,js as R,ip as $,jt as b,iu as C,ju as U,iv as Y,iw as x,jv as L,is as I,iq as B,iK as P,ir as M,it as J,jw as q,jx as E,hb as z,jy as H,ha as X,iX as G,hd as K,he as Q,g2 as W,gs as w,ga as Z,h9 as v,hc as V,aC as tt,f_ as it,aj as y,b0 as g,h2 as rt,cm as d,i3 as nt,jo as st,hH as et,i4 as at,i7 as ft,j5 as N,ih as ct,fU as ot,h1 as ut,jz as pt}from"./DOFFjK0_.js";const Rt=(t,r)=>{if(!t||!r)return null;const i=r.filter(n=>n.pk);if(i.length>1)return i.map(n=>{var s,a;return((a=(s=t==null?void 0:t[n.title])==null?void 0:s.toString)==null?void 0:a.call(s).replaceAll("_","\\_"))??null}).join("___");if(i.length){const n=(t==null?void 0:t[i[0].title])??null;return n===null?null:`${n}`}},$t=(t,r)=>{const i={},n=r==null?void 0:r.filter(s=>s.pk);if(t&&n&&n.length)for(const s of n)s.title&&(i[s.title]=t[s.title]);return i},bt=t=>!t&&!Array.isArray(t)?null:t.filter(r=>r.pk).map(r=>r.title).join("___"),Ct=(t,r)=>{for(const[i,n]of Object.entries(r))if(Object.keys(t).every(s=>t[s]===n.row[s]))return parseInt(i);return-1};async function Ut({getMeta:t,row:r,meta:i,ltarState:n,throwError:s,undo:a=!1}){var c;const e=new Set,f=await((c=i.columns)==null?void 0:c.reduce(async(u,o)=>{const _=await u;if(n&&o.uidt===y.LinkToAnotherRecord&&o.colOptions.type===ot.BELONGS_TO&&(n[o.title]||r[o.title])){const p=n[o.title]||r[o.title],k=o.colOptions,h=i.columns.find(m=>k.fk_child_column_id===m.id),j=await t(k.fk_related_model_id);j&&h&&(_[h.title]=p[j.columns.find(m=>m.id===k.fk_parent_column_id).title],_[h.title]!==null&&_[h.title]!==void 0&&e.delete(h.title))}return ut(o,r)&&e.add(o.title),(!o.ai||a)&&(r==null?void 0:r[o.title])!==null&&(_[o.title]=r==null?void 0:r[o.title]),_},Promise.resolve({})));if(s&&e.size)throw new Error(`Missing required columns: ${[...e].join(", ")}`);return{missingRequiredColumns:e,insertObj:f}}const Yt=(t=[])=>t.reduce((i,n)=>{if(!tt(n)&&!it(n)&&![y.Attachment,y.Rollup,y.Lookup,y.Formula,y.Barcode,y.QrCode].includes(n.uidt)&&S(n==null?void 0:n.cdf)&&!/^\w+\(\)|CURRENT_TIMESTAMP$/.test(n.cdf)){const s=n.cdf;i[n.title]=typeof s=="string"?s.replace(/^['"]|['"]$/g,""):s}return i},{}),xt=(t,r)=>!t||!r||!r.title?!0:!S(t.row[r.title]);function Lt(t,r,i,n,s,a){return pt({filters:t,data:r,columns:i,client:n,metas:s,options:a})}const It=t=>t?!!(O(t)||T(t)):!1,_t=t=>!!t&&t!=="0"&&t!==0&&t!=="false",dt=(t,r)=>{const{col:i,isMysql:n}=r;return t?t?Array.isArray(t)?t.join(", "):t.toString():n(i.source_id)?t.toString().split(",").join(", "):t.split(", "):""},yt=(t,r)=>{var n;const i=((n=g(r.meta))==null?void 0:n.date_format)??"YYYY-MM-DD";if(t){if(d(t).isValid())return d(/^\d+$/.test(String(t))?+t:t).format(i);{const s=nt(t);if(s)return s.format(i)}}else return"";return""},gt=t=>t&&d(t).isValid()?d(t.toString(),"YYYY").format("YYYY"):"",A=(t,r)=>{var p,k;const{col:i,isXcdbBase:n}=r;if(!t||!d(t).isValid())return"";const s=g(i.meta),a=(s==null?void 0:s.date_format)??st[0],e=(s==null?void 0:s.time_format)??et[0],f=`${a} ${e}`,c=void 0,{timezonize:u}=at(c==null?void 0:c.name),o="";return n(i.source_id)?((k=u(d(t)))==null?void 0:k.format(f))+o:((p=u(d(/^\d+$/.test(t)?+t:t)))==null?void 0:p.format(f))+o},kt=(t,r)=>{var s;const i=(s=g(r==null?void 0:r.meta))!=null&&s.is12hrFormat?"hh:mm A":"HH:mm";if(!t)return"";let n=d(t);return n.isValid()||(n=d(t,"HH:mm:ss")),n.isValid()||(n=d(`1999-01-01 ${t}`)),n.isValid()?n.format(i):""},ht=(t,r)=>{var n;const i=((n=g(r.meta))==null?void 0:n.duration)||0;return ft(t,i)},lt=t=>t?`${t}%`:"",mt=(t,r)=>{const i={currency_locale:"en-US",currency_code:"USD",...g(r.meta)};try{return t==null||isNaN(t)?t??"":new Intl.NumberFormat(i.currency_locale||"en-US",{style:"currency",currency:i.currency_code||"USD"}).format(+t)}catch{return t}},D=(t,r)=>{const{meta:i,baseUsers:n=new Map}=r;if(!t)return"";const s=i!=null&&i.base_id?n.get(i==null?void 0:i.base_id)||[]:[];return typeof t=="string"?t.split(",").map(e=>{const f=s.find(c=>c.id===e||c.email===e);return f?f.display_name||f.email:e.id}).join(", "):Array.isArray(t)?t.map(a=>{const e=s.find(f=>f.id===a.id||f.email===a.email);return e?e.display_name||e.email:a.id}).join(", "):t?t.display_name||t.email:""},jt=(t,r)=>{if(!N(t)&&!t||isNaN(Number(t)))return"";const i=g(r.meta);return Number(t).toFixed((i==null?void 0:i.precision)??1)},At=t=>!N(t)&&!t||isNaN(Number(t))?"":Number(t).toString(),Dt=(t,r)=>g(r.meta).richMode?(t==null?void 0:t.replace(/[*_~\[\]]|<\/?[^>]+(>|$)/g,""))||"":rt(r)?(t==null?void 0:t.value)||"":t||"",St=(t,r)=>{var o,_;const{col:i,meta:n,metas:s}=r,a=i.colOptions,e=a.fk_relation_column_id?(_=(o=n==null?void 0:n.columns)==null?void 0:o.find(p=>p.id===a.fk_relation_column_id))==null?void 0:_.colOptions:null,f=(e==null?void 0:e.fk_related_model_id)&&(s==null?void 0:s[e.fk_related_model_id]);let c=f==null?void 0:f.columns.find(p=>p.id===a.fk_rollup_column_id);if(!c)return(t==null?void 0:t.toString())??"";c={...c};const u=ct(c.uidt??y.SingleLineText);return c.meta={...g(c==null?void 0:c.meta),...g(i==null?void 0:i.meta)},u.includes(a.rollup_function??"")&&(c.uidt=y.Decimal),l(t,{...r,col:c})},Nt=(t,r)=>{var u,o,_;const{col:i,meta:n,metas:s}=r,a=i.colOptions,e=a.fk_relation_column_id?(_=(o=(u=(n==null?void 0:n.value)??n)==null?void 0:u.columns)==null?void 0:o.find(p=>p.id===a.fk_relation_column_id))==null?void 0:_.colOptions:i.colOptions,f=(e==null?void 0:e.fk_related_model_id)&&(s==null?void 0:s[e.fk_related_model_id]),c=f==null?void 0:f.columns.find(p=>p.id===((a==null?void 0:a.fk_lookup_column_id)??(f==null?void 0:f.columns.find(k=>k.pv).id)));return Array.isArray(t)?t.map(p=>l(p,{...r,col:c})).join(", "):l(t,{...r,col:c})},Ot=t=>Array.isArray(t)?t.map(r=>`${r.title}`).join(", "):t,Tt=(t,r)=>{var a,e,f;const{col:i,t:n}=r;typeof(i==null?void 0:i.meta)=="string"&&(i.meta=JSON.parse(i.meta));const s=+t||0;return s?s===1?`1 ${((e=i==null?void 0:i.meta)==null?void 0:e.singular)||n("general.link")}`:`${s} ${((f=i==null?void 0:i.meta)==null?void 0:f.plural)||n("general.links")}`:`0 ${((a=i==null?void 0:i.meta)==null?void 0:a.plural)||n("general.links")}`},l=(t,r)=>{var a,e,f,c;const{col:i,abstractType:n,isUnderLookup:s}=r;if(!i)return"";if(F(i)){const[u,o]=(t||"").split(";");return u&&o?`${u}; ${o}`:t}if(R(i))return Dt(t,i);if($(i,n))return _t(t)?"Checked":"Unchecked";if(b(i))return dt(t,r);if(C(i,n))return yt(t,i);if(U(i,n))return gt(t);if(Y(i,n))return A(t,r);if(x(i,n))return kt(t,i);if(L(i))return ht(t,i);if(I(i))return lt(t);if(B(i))return mt(t,i);if(P(i))return D(t,r);if(M(i))return jt(t,i);if(J(i))return t?`${t}`:"0";if(q(i,n))return At(t);if(E(i))try{return s?JSON.stringify(typeof t=="string"?JSON.parse(t):t):JSON.stringify(JSON.parse(t),null,2)}catch{return t}if(z(i))return St(t,r);if(H(i))return Tt(t,r);if(X(i)||G(i.uidt,i.colOptions))return Nt(t,r);if(K(i))return A(t,r);if(Q(i))return D(t,r);if(W(i))return Ot(t);if(w(i))if((a=i==null?void 0:i.meta)!=null&&a.display_type){const u={uidt:(e=i==null?void 0:i.meta)==null?void 0:e.display_type,...(f=i==null?void 0:i.meta)==null?void 0:f.display_column_meta};return l(t,{...r,col:u})}else{const u=Z(t,!0);if(u&&v(u))return u}return V(i)?i.colOptions.type==="url"?t:(c=i.colOptions)==null?void 0:c.label:t};export{kt as a,l as b,Yt as c,bt as d,Rt as e,It as f,_t as g,Ct as h,xt as i,Ut as p,$t as r,Lt as v};
