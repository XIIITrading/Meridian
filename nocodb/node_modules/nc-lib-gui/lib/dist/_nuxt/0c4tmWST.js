const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B2f1fstS.js","./DOFFjK0_.js","./entry.DDfSYhWa.css","./BYGCxle3.js","./VirtualCell.krPvGNjk.css","./CxSafZTa.js","./Cell.DrFrP4_9.css","./CMyFGii6.js","./qgYlKlk5.js","./Cb5B9eG-.js","./C_qz9woQ.js","./DA4KItu_.js","./CV-2bRRD.js","./TimeSelector.DAR2lbHN.css","./D8wgK-Ih.js","./HdsRe6lq.js","./index.N-A1gxk9.css","./DzBSAsxR.js","./FilterInput.7KjqjE1F.css","./DGuB8RA-.js","./4fFkR2QG.js","./Pagination.XVPzwtel.css","./D2QgEzTv.js","./SJHyi9T4.js","./DG2ZEhLK.js","./CAfhvBOi.js","./DcFNOSET.js","./boyBAVNN.js","./4PLl4EP6.js","./Bgc5K1P7.js","./DEAKw9Pl.js","./CHgOe2F-.js","./CYkscC4Z.js","./ps5He39s.js","./Cl-qOJW6.js","./BcKPINb2.js","./VirtualCell.6f0pX0MN.css","./CkXo2doe.js","./Czlq_f4Y.js","./Cgx2iu1G.js","./C6nWwNvX.js","./Cell.Dgtcn0F2.css","./DRQrXP7Q.js","./PlainCell.CJha1QXQ.css","./CiBV2ZED.js","./DDEVLD8O.js","./ZNRZafJ9.js","./BhfICdUA.js","./NRjd0XWG.js","./RfUK_fd6.js","./SelectOptions.DqNkMQ-A.css","./BNo10Mdm.js","./index.C8L8AhJa.css","./hehmy6V1.js","./BvG7Iv4q.js","./CyXz1Zkk.js","./CPChVVVr.js","./D4c215jk.js","./B3Wp9c04.js","./CFXGfO_A.js","./VKUQM8lk.js","./YaKnxhzO.js","./BqWeTF94.js","./-rIuSlCu.js","./BrfakvRE.js","./sgaWLnOz.js","./D_wq2ltS.js","./Item.C85DUSg3.css","./9aYOtC5C.js","./index.CotXCNy2.css","./CQugZrqw.js","./index._6B72PDH.css","./BpgQOThx.js","./DmoodaOn.js","./Bo7kLdUR.js","./B3tDgntu.js","./Db9kSA7A.js","./EditOrAddProvider.C2farLzy.css","./CyKx2u6B.js","./yjlRPiAT.js","./CJtI8BMq.js","./D1gZ4Fpg.js","./C1uRXLg7.js","./DunK-51v.js","./DivDataCell.D_9SDUsb.css","./MSgi_m6o.js","./JKos0pQW.js","./BdLxRlCP.js","./Markdown.CUPXKfeQ.css","./CNJqPN7Y.js","./AxsiR11P.js","./C9H3ht2d.js","./Comments.BKDN6dt-.css","./DiUleKVo.js","./JUJEmhCv.js","./Modal.CB1oWLel.css","./lL-0_K96.js","./BClTqpVB.js","./CtJu2gHc.js","./MNXVOE4I.js","./LockView.BWC8JyQk.css","./D0vnHTOx.js","./BRTCxTHu.js","./SpSJ8E4d.js","./Dh5zKH8k.js","./ColumnMenu.DQG9Y5_N.css","./B4YnCsMc.js","./6zXueAcs.js","./Byuk3M83.js","./D-8_fbld.js","./DminWhpq.js","./PaginationV2.BFLN34RV.css","./1_lWk-g2.js","./Pagination.B5Gl1nyf.css","./DPZQP7x8.js"])))=>i.map(i=>d[i]);
var np=Object.defineProperty;var op=(t,n,o)=>n in t?np(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;var vo=(t,n,o)=>op(t,typeof n!="symbol"?n+"":n,o);import{f as da,a9 as oa,G as fn,r as V,cd as zl,a7 as Es,a8 as Go,V as Ca,n as le,gj as ju,aH as Ul,aY as cs,W as Fi,dJ as Uo,gk as ir,as as gl,b7 as ql,gl as gr,aC as ra,gm as ws,cm as rl,eo as lp,gn as ya,u as fs,a4 as tn,a5 as pl,f_ as xo,S as oi,fA as ap,eV as pf,eW as ip,f8 as Hs,e as ko,fj as rp,fk as sp,am as wr,ah as Bi,go as xl,g as ti,ac as Yl,c as B,K as me,L as e,o as p,an as en,aq as ho,I as X,ap as Aa,w as J,ad as Nt,ag as Dt,b as ue,M as $l,t as se,d as tt,_ as Ol,af as ba,a as z,aS as Co,gp as Qr,gq as hf,cf as fl,cg as vl,gr as mf,aD as hl,aW as Ro,av as Bn,J as nl,O as ca,gs as Uu,aX as yo,gt as gf,fX as xi,g0 as wf,gu as yf,gv as bf,gw as _f,b3 as yr,al as up,aQ as Hn,$ as tl,aJ as Ys,c4 as Gu,ep as Ms,eT as Hu,f$ as xf,dj as dp,P as bo,dk as cp,aG as Gi,aT as po,b9 as Bo,aA as br,bm as qs,b5 as vs,aZ as Ai,a3 as ls,N as ro,gx as Zd,ak as _r,fQ as Ea,gy as fp,T as Ra,eN as Xs,Q as Ts,gz as vp,a1 as lr,by as kf,fs as Cf,bw as pp,gA as hp,cb as ec,gB as Yu,gC as Rf,gD as mp,dw as Sf,ao as qu,gE as If,gF as Ff,c6 as Xu,bW as ka,fS as Xo,b0 as jn,bz as Ku,aj as pe,gG as lo,gh as Ju,gH as Wa,gI as tc,gJ as Su,a6 as Af,aL as Ef,aE as xr,Y as ki,gK as ll,gL as Qu,bv as Ml,gM as Wl,gN as Vi,gO as nc,bx as sa,aU as Va,gP as bi,gQ as za,gR as Mf,gS as rr,gT as sr,gU as Qo,gV as Cl,gW as Yo,gX as Sa,fw as Rl,g1 as ua,gY as as,gZ as Tf,gb as Ks,aM as Hi,ge as Zu,g_ as Js,g$ as Wo,h0 as $f,h1 as $s,h2 as _a,h3 as is,h4 as Of,h5 as Cs,h6 as gp,i as Ga,h7 as ed,cn as Xn,bY as Df,eJ as Lf,bn as Nf,bc as Iu,h8 as _i,h9 as Ci,ha as wp,hb as yp,hc as Pf,hd as Os,he as rs,ax as ss,hf as Gl,hg as Bf,hh as Wf,hi as zf,hj as Vf,fr as bp,hk as Fu,ab as Zr,aw as oc,hl as _p,s as xp,dy as kp,dC as Cp,hm as Ji,hn as Qs,ho as Rp,hp as jf,hq as Ds,cE as Au,hr as Sp,cG as kr,hs as Ip,ht as Fp,hu as Ap,hv as Ep,hw as Ri,cP as Mp,cV as Tp,cX as $p,cQ as Op,hx as Dp,hy as Lp,cT as Np,hz as Pp,hA as Bp,hB as Wp,hC as zp,hD as Vp,hE as jp,hF as Up,hG as ml,hH as ur,hI as Gp,hJ as Hp,hK as Yp,hL as ts,hM as Zs,hN as Pt,hO as Sl,hP as lc,hQ as Tl,c5 as qp,j as ia,hR as na,hS as Hl,hT as td,hU as Cr,hV as Xp,hW as Kp,hX as Jn,hY as Eu,hZ as Jp,h_ as Qp,h$ as qo,i0 as ns,i1 as Zp,i2 as wa,i3 as eh,i4 as th,i5 as nh,fG as Si,fF as eu,fq as Rs,i6 as ac,i7 as oh,i8 as lh,i9 as ah,ia as ji,ib as Wi,ic as ih,id as rh,bk as su,bj as sh,ie as ic,ig as Uf,du as uh,ih as dh,ii as Gf,g2 as uu,fU as Qi,ij as ch,ik as fh,il as vh,im as nr,g8 as ys,g9 as rc,ga as sc,io as uc,ip as ph,iq as hh,ir as mh,is as gh,it as wh,iu as yh,iv as bh,iw as _h,ix as xh,iy as kh,iz as Ch,iA as Rh,b_ as Sh,iB as Ih,iC as Fh,iD as kl,iE as Ah,iF as du,iG as dc,iH as cc,iI as fc,iJ as vc,bh as ar,iK as Eh,iL as Hf,iM as Mh,iN as Yf,iO as nd,iP as qf,iQ as Xf,iR as Kf,iS as Th,iT as Ss,iU as $h,iV as pc,iW as Oh,iX as Dh,iY as Lh,iZ as Jf,i_ as Nh,i$ as Ph,j0 as Bh,j1 as cu,j2 as Wh,j3 as zh,fv as Vh,j4 as jh,dx as Uh,j5 as hc,j6 as Gh,j7 as Hh,j8 as Yh,j9 as qh,fl as Mu,ja as Xh,bX as Kh,jb as Jh,U as Qh,jc as Zh,c3 as em,em as tm,fV as nm,jd as om,je as lm,c7 as fu,jf as am}from"./DOFFjK0_.js";import{u as Il,a as im}from"./DG2ZEhLK.js";import{u as Qf}from"./SJHyi9T4.js";import{u as Zf}from"./4PLl4EP6.js";import{u as rm,_ as ev,a as sm}from"./D1gZ4Fpg.js";import{u as od}from"./BYGCxle3.js";import{u as Ha}from"./B3Wp9c04.js";import{e as qt,p as tv,r as Pi,g as nv,a as um,b as dm,c as cm,d as mc}from"./D2QgEzTv.js";import{a as ov,b as ld}from"./C1uRXLg7.js";import{_ as Rr}from"./DGuB8RA-.js";import{_ as Ya}from"./D_wq2ltS.js";import{_ as qa}from"./9aYOtC5C.js";import fm from"./DunK-51v.js";import{S as lv}from"./ps5He39s.js";import{_ as vm,a as av}from"./MSgi_m6o.js";import{_ as ad,c as El}from"./CkXo2doe.js";import{i as Ls,g as Ns,a as pm,b as hm,c as mm,d as gm,e as wm,f as ym,h as bm}from"./Bo7kLdUR.js";import{u as iv}from"./CNJqPN7Y.js";import{u as Sr}from"./AxsiR11P.js";import _m from"./DiUleKVo.js";import{r as vu}from"./CJtI8BMq.js";import{u as ps}from"./Bgc5K1P7.js";import{u as xm,a as id}from"./DcFNOSET.js";import{u as rd}from"./CV-2bRRD.js";import{_ as km,R as Cm}from"./D4c215jk.js";import{u as rv}from"./C9H3ht2d.js";import{p as sv}from"./lL-0_K96.js";import{u as Ps}from"./BClTqpVB.js";import{S as uv}from"./CYkscC4Z.js";import{_ as Rm}from"./BNo10Mdm.js";import{u as Sm}from"./CtJu2gHc.js";import Im from"./MNXVOE4I.js";import{_ as Fm}from"./CMyFGii6.js";import{b as Am}from"./D0vnHTOx.js";import{_ as Em}from"./CiBV2ZED.js";import{Q as Mm}from"./B4YnCsMc.js";import{u as Tm}from"./6zXueAcs.js";import{g as gc}from"./DzBSAsxR.js";import{u as $m}from"./Byuk3M83.js";import{p as Bs,s as Om,A as wc,v as Dm,f as Lm,a as Nm}from"./Dh5zKH8k.js";import{u as Pm}from"./DmoodaOn.js";import{g as Bm}from"./D-8_fbld.js";import{a as Wm,u as zm}from"./ZNRZafJ9.js";import{C as Vm,_ as jm}from"./Db9kSA7A.js";import{u as Um}from"./DminWhpq.js";const[Gm,Hm]=Qf((t,n,o,l)=>{var Je,cn,Pn,Et,Rn,mt;const{$e:a,$state:i,$api:s}=da(),{t:r}=oa(),d=fn(zl,V(!1)),c=V([]),f=V(!1),v=V(!0),h=V(0),y=V(new Set),b=Es(),{basesUser:_}=Go(b),{base:m}=Go(Ca()),g=le(()=>t.value.base_id?_.value.get(t.value.base_id)||[]:[]),{sharedView:C}=ju(),w=V(!C.value||((Je=C.value)==null?void 0:Je.type)===Ul.GALLERY||((cn=C.value)==null?void 0:cn.type)===Ul.KANBAN||(Et=(Pn=n.value)==null?void 0:Pn.rowMeta)!=null&&Et.new?n.value:{row:{},oldRow:{},rowMeta:{}});(mt=(Rn=w.value)==null?void 0:Rn.rowMeta)!=null&&mt.fromExpandedForm&&(w.value.rowMeta.fromExpandedForm=!0);const S=Zf(w),x=fn(cs,V()),{addUndo:$,clone:I,defineViewScope:F}=Fi(),E=fn(ir,Uo()),{comments:M,resolveComment:U,loadComments:L,updateComment:G,deleteComment:ae,saveComment:ve,isCommentsLoading:xe}=rm(t,w),{isUIAllowed:ne}=gl(),{handleUpgradePlan:he,isPaymentEnabled:W}=ql();od();const j=le(()=>!0),Ee=ot=>!0,Ye=le(()=>{var ot,gt,zt,Ht;if((ot=w==null?void 0:w.value)!=null&&ot.row){const Yt=(zt=(gt=t==null?void 0:t.value)==null?void 0:gt.columns)==null?void 0:zt.find(Xt=>Xt.pv);return Yt?(Ht=w.value.row)==null?void 0:Ht[Yt.title]:void 0}}),{fieldsMap:Ge,isLocalMode:ke}=Ha(),Y=fn(gr,V(null)),we=le(()=>l?o.value?(t.value.columns??[]).filter(ot=>{var gt;return!ra(ot)&&!!((gt=ot.meta)!=null&&gt.defaultViewColVisibility)&&(!S.isNew.value||!ws(ot))}).sort((ot,gt)=>{var zt,Ht;return(((zt=ot.meta)==null?void 0:zt.defaultViewColOrder)??1/0)-(((Ht=gt.meta)==null?void 0:Ht.defaultViewColOrder)??1/0)}):(t.value.columns??[]).filter(ot=>{var gt;return(!S.isNew.value||!ws(ot))&&!ra(ot)&&!!((gt=ot.meta)!=null&&gt.defaultViewColVisibility)}):Y.value?S.isNew.value?Y.value.filter(ot=>!ws(ot)):Y.value:[]),oe=le(()=>{var gt;const ot=(((gt=t.value)==null?void 0:gt.columns)??[]).filter(zt=>{var Ht,Yt;return!ra(zt)&&!((Ht=we.value)!=null&&Ht.includes(zt))&&(ke.value&&(zt!=null&&zt.id)&&Ge.value[zt.id]?(Yt=Ge.value[zt.id])==null?void 0:Yt.initialShow:!0)&&(!S.isNew.value||!ws(zt))});return l?o.value?ot.sort((zt,Ht)=>{var Yt,Xt;return(((Yt=zt.meta)==null?void 0:Yt.defaultViewColOrder)??1/0)-(((Xt=Ht.meta)==null?void 0:Xt.defaultViewColOrder)??1/0)}):ot:ot.sort((zt,Ht)=>{var Yt,Xt;return(((Yt=Ge.value[zt.id])==null?void 0:Yt.order)??1/0)-(((Xt=Ge.value[Ht.id])==null?void 0:Xt.order)??1/0)})}),ye=ot=>`${ot.id}|${ot.created_at}`,ie=le(()=>qt(w.value.row,t.value.columns)),H=V(""),Ae=V(!1),Ie=async(ot,gt=!0)=>{var Ht,Yt,Xt,un;if(!ne("recordAuditList")||!w.value&&!ot)return;const zt=ot??qt(w.value.row,t.value.columns);if(!(!zt||!t.value.base_id))try{gt&&(f.value=!0);const bt=await s.internal.getOperation(m.value.fk_workspace_id??ap,t.value.base_id??m.value.id,{operation:"recordAuditList",fk_model_id:t.value.id,row_id:zt,cursor:H.value});bt.list=bt.list.filter(ft=>!(ft!=null&&ft.op_type.includes("INSERT")));const xt=(Ht=bt.list)==null?void 0:Ht[bt.list.length-1];xt&&(H.value=ye(xt)),Ae.value=!((Yt=bt.pageInfo)!=null&&Yt.isLastPage);const ct=((un=(Xt=bt.list)==null?void 0:Xt.reverse)==null?void 0:un.call(Xt))||[];c.value.unshift(...ct.map(ft=>{const Be=g.value.find(at=>at.id===ft.fk_user_id||at.email===ft.user);return{...ft,created_display_name:(Be==null?void 0:Be.display_name)??((Be==null?void 0:Be.email)??"").split("@")[0],created_by_email:Be==null?void 0:Be.email,created_by_meta:Be==null?void 0:Be.meta}}))}catch(bt){console.error(bt);const xt=await pf(bt);if(W.value&&xt.error===ip.PLAN_LIMIT_EXCEEDED){const ct=xt.details;he({title:r("upgrade.updateToExtendRecordHistory"),content:r("upgrade.updateToExtendRecordHistorySubtitle",{activePlan:ct.plan,plan:ct.higherPlan,period:ce(+(ct.limit??14))}),limitOrFeature:Hs.LIMIT_AUDIT_RETENTION})}else tn.error(xt.message)}finally{f.value=!1}};function ce(ot){if(ot===1/0)return"3+ years";if(ot<14)return`${ot} day${ot===1?"":"s"}`;if(ot<30){const gt=Math.floor(ot/7);return`${gt} week${gt===1?"":"s"}`}else if(ot<365){const gt=Math.floor(ot/30);return`${gt} month${gt===1?"":"s"}`}else{const gt=Math.floor(ot/365);return gt>3?`${gt}+ years`:`${gt} year${gt===1?"":"s"}`}}const te=async()=>{Ae.value&&await Ie()},Le=async()=>{H.value="",c.value=[],Ae.value=!1,await Ie()},Ne=ot=>{var gt,zt;return((zt=(gt=i.user)==null?void 0:gt.value)==null?void 0:zt.email)===ot},lt=async()=>{var ot;if(((ot=x.value)==null?void 0:ot.type)===Ul.KANBAN){const{loadKanbanData:gt}=ov();await gt()}},je=async(ot={},gt=!1,{kanbanClbk:zt}={})=>{var Xt,un,bt,xt;if(!t.value.id)return;let Ht;const Yt=((Xt=w.value.rowMeta)==null?void 0:Xt.new)??!1;if(Yt){const{getMeta:ct}=oi(),{missingRequiredColumns:ft,insertObj:Be}=await tv({meta:t.value,ltarState:ot,getMeta:ct,row:w.value.row,throwError:!0});if(ft.size)return;if(Ht=await s.dbTableRow.create("noco",t.value.base_id,t.value.id,{...Be,...ot||{}}),Object.assign(w.value,{row:Ht,rowMeta:{...w.value.rowMeta,new:!1},oldRow:{...Ht}}),!gt){const at=qt(Ht,(un=t.value)==null?void 0:un.columns),kt=Pi(w.value.row,(bt=t.value)==null?void 0:bt.columns);$({redo:{fn:async st=>{await s.dbTableRow.create("noco",m.value.id,t.value.id,{...kt,...st}),await lt(),E==null||E.trigger()},args:[I(Be)]},undo:{fn:async st=>{var u,R,P;const qe=await s.dbViewRow.delete("noco",((u=t.value)==null?void 0:u.base_id)??m.value.id,(R=t.value)==null?void 0:R.id,(P=x.value)==null?void 0:P.id,encodeURIComponent(st));if(qe.message)throw new Error(qe.message);await lt(),E==null||E.trigger()},args:[at]},scope:F({view:x.value})})}}else{const ct=[...y.value].reduce((ft,Be)=>(ft[Be]=w.value.row[Be],ft),{});if(Object.keys(ct).length){const ft=qt(w.value.row,t.value.columns);if(!ft)return tn.info(r("msg.info.updateNotAllowedWithoutPK"));if(await s.dbTableRow.update(ya,t.value.base_id??m.value.id,t.value.id,encodeURIComponent(ft),ct),!gt){const Be=[...y.value].reduce((at,kt)=>(at[kt]=w.value.oldRow[kt],at),{});$({redo:{fn:async(at,kt)=>{await s.dbTableRow.update(ya,m.value.id,t.value.id,encodeURIComponent(at),kt),await lt(),E==null||E.trigger()},args:[ft,I(ct)]},undo:{fn:async(at,kt)=>{await s.dbTableRow.update(ya,m.value.id,t.value.id,encodeURIComponent(at),kt),await lt(),E==null||E.trigger()},args:[ft,I(Be)]},scope:F({view:x.value})})}v.value&&await Promise.all([L()])}else{tn.info(r("msg.info.noColumnsToUpdate"));return}}return((xt=x.value)==null?void 0:xt.type)===Ul.KANBAN&&zt&&zt(w.value,Yt),y.value=new Set,a("a:row-expand:add"),Ht},He=()=>{y.value=new Set},Q=async(ot,gt=!1,zt=!1)=>{var Xt,un,bt,xt,ct,ft,Be,at;if((un=(Xt=w==null?void 0:w.value)==null?void 0:Xt.rowMeta)!=null&&un.new||d.value||!((bt=t.value)!=null&&bt.id))return;const Ht=ot??qt(w.value.row,t.value.columns);if(!Ht)return;let Yt={};try{Yt=await s.dbTableRow.read(ya,(((xt=t.value)==null?void 0:xt.base_id)??((ct=m==null?void 0:m.value)==null?void 0:ct.id))||((Be=(ft=C.value)==null?void 0:ft.view)==null?void 0:Be.base_id),t.value.id,encodeURIComponent(Ht),{getHiddenColumn:!0})}catch(kt){if(((at=kt.response)==null?void 0:at.status)===404){const st=fs();tn.error(r("msg.noRecordFound")),st.replace({query:{}})}else tn.error(`${await pl(kt)}`)}try{gt&&(Yt={...w.value.row,...(t.value.columns??[]).reduce((kt,st)=>(xo(st)&&st.title&&st.title in Yt&&(kt[st.title]=Yt[st.title]),kt),{})}),zt&&(Yt=Object.keys(Yt).reduce((kt,st)=>(Object.prototype.hasOwnProperty.call(w.value.row,st)?kt[st]=w.value.row[st]:kt[st]=Yt[st],kt),{})),Object.assign(w.value,{row:Yt,oldRow:{...Yt},rowMeta:{...w.value.rowMeta}})}catch{tn.error(`${r("msg.error.errorLoadingRecord")}`)}},Mt=async ot=>{var gt;try{const zt=ot??qt(w.value.row,t.value.columns),Ht=await s.dbTableRow.delete(ya,((gt=t.value)==null?void 0:gt.base_id)??m.value.id,t.value.id,encodeURIComponent(zt));if(Ht.message)return tn.info(`Record delete failed: ${`Unable to delete record with ID ${ot} because of the following:
              
${Ht.message.join(`
`)}.

              Clear the data first & try again`})}`),!1}catch(zt){tn.error(`${r("msg.error.deleteFailed")}: ${await pl(zt)}`)}},_e=le(()=>{var gt,zt,Ht;const ot=[];try{const Yt=JSON.parse(JSON.stringify(c.value));for(const Xt of Yt){if(Xt.op_type!=="DATA_UPDATE"){ot.push(Xt);continue}const un=JSON.parse(Xt.details);for(const bt of Object.keys(un.data||{})){if(!((gt=un.column_meta)!=null&&gt[bt])){delete un.data[bt],delete un.old_data[bt],delete un.column_meta[bt];continue}if(["CreatedTime","CreatedBy","LastModifiedTime","LastModifiedBy"].includes((Ht=(zt=un.column_meta)==null?void 0:zt[bt])==null?void 0:Ht.type)){delete un.data[bt],delete un.old_data[bt],delete un.column_meta[bt];continue}}Object.values(un.column_meta||{}).length>0&&(Xt.details=JSON.stringify(un),ot.push(Xt))}}catch(Yt){console.error(Yt)}return ot}),wn=le(()=>{var zt,Ht,Yt,Xt,un,bt,xt,ct,ft;const ot=[],gt=(Be,at,kt,st)=>{Be.consolidated_ref_display_values_links||(Be.consolidated_ref_display_values_links=[]),Be.consolidated_ref_display_values_unlinks||(Be.consolidated_ref_display_values_unlinks=[]),st==="link"?Be.consolidated_ref_display_values_unlinks.find(qe=>qe.refRowId===at)?Be.consolidated_ref_display_values_unlinks.splice(Be.consolidated_ref_display_values_unlinks.findIndex(qe=>qe.refRowId===at),1):Be.consolidated_ref_display_values_links.find(qe=>qe.refRowId===at)||Be.consolidated_ref_display_values_links.push({refRowId:at,value:kt}):Be.consolidated_ref_display_values_links.find(qe=>qe.refRowId===at)?Be.consolidated_ref_display_values_links.splice(Be.consolidated_ref_display_values_links.findIndex(qe=>qe.refRowId===at),1):Be.consolidated_ref_display_values_unlinks.find(qe=>qe.refRowId===at)||Be.consolidated_ref_display_values_unlinks.push({refRowId:at,value:kt})};try{const Be=JSON.parse(JSON.stringify(_e.value));for(;Be.length>0;){const at=Be.shift();if(at.op_type==="DATA_LINK"||at.op_type==="DATA_UNLINK"){const kt=ot.findLast(qe=>qe.op_type==="DATA_LINK"||qe.op_type==="DATA_UNLINK"),st=JSON.parse(at.details);if(!kt)gt(st,st.ref_row_id,st.ref_display_value,at.op_type==="DATA_LINK"?"link":"unlink"),at.details=JSON.stringify(st),ot.push(at);else{const qe=JSON.parse(kt.details);kt.user===at.user&&rl(at.created_at).diff(rl(kt.created_at),"second")<=30&&qe.link_field_id===st.link_field_id&&qe.ref_table_title===st.ref_table_title?(gt(qe,st.ref_row_id,st.ref_display_value,at.op_type==="DATA_LINK"?"link":"unlink"),((zt=qe.consolidated_ref_display_values_links)==null?void 0:zt.length)>0||(Ht=qe.consolidated_ref_display_values_unlinks)!=null&&Ht.length?kt.details=JSON.stringify(qe):ot.pop()):(gt(st,st.ref_row_id,st.ref_display_value,at.op_type==="DATA_LINK"?"link":"unlink"),at.details=JSON.stringify(st),ot.push(at))}}else if(at.op_type==="DATA_UPDATE"){const kt=ot.findLast(u=>u.op_type==="DATA_UPDATE");if(!kt||kt.user!==at.user||rl(at.created_at).diff(rl(kt.created_at),"second")>30){ot.push(at);continue}const st=JSON.parse(at.details),qe=JSON.parse(kt.details);for(const u of Object.values(st.column_meta??{}))if(["MultiSelect","SingleSelect"].includes(u.type)&&((Yt=qe==null?void 0:qe.column_meta)!=null&&Yt[u==null?void 0:u.title])){qe.data[u.title]=st.data[u.title];for(const R of((un=(Xt=st.column_meta[u.title])==null?void 0:Xt.options)==null?void 0:un.choices)??[])(bt=qe.column_meta[u.title])!=null&&bt.options.choices.find(P=>P.id===R.id)||qe.column_meta[u.title].options.choices.push(R);kt.details=JSON.stringify(qe),delete st.old_data[u.title],delete st.data[u.title],delete st.column_meta[u.title],at.details=JSON.stringify(st)}else(xt=qe==null?void 0:qe.column_meta)!=null&&xt[u==null?void 0:u.title]&&qe.old_data[u.title]?(qe.data[u.title]=st.data[u.title],kt.details=JSON.stringify(qe),delete st.old_data[u.title],delete st.data[u.title],delete st.column_meta[u.title],at.details=JSON.stringify(st)):(ct=st==null?void 0:st.column_meta)!=null&&ct[u==null?void 0:u.title]&&!((ft=qe==null?void 0:qe.column_meta)!=null&&ft[u==null?void 0:u.title])&&(qe.column_meta||(qe.column_meta={}),qe.old_data||(qe.old_data={}),qe.data||(qe.data={}),qe.column_meta[u.title]=st.column_meta[u.title],qe.old_data[u.title]=st.old_data[u.title],qe.data[u.title]=st.data[u.title],kt.details=JSON.stringify(qe),delete st.old_data[u.title],delete st.data[u.title],delete st.column_meta[u.title],at.details=JSON.stringify(st));Object.values(st.column_meta).length>0&&ot.push(at)}else ot.push(at)}}catch(Be){console.error(Be)}return ot}),It=le(()=>{const ot=[...wn.value].map(Ht=>({user:Ht.user,displayName:Ht.created_display_name,created_at:Ht.created_at,type:"audit",audit:Ht})),gt=[...M.value].map(Ht=>({...Ht,user:Ht.created_by_email,displayName:Ht.created_display_name,type:"comment"}));return[...ot,...gt].sort((Ht,Yt)=>rl(Ht.created_at).isBefore(rl(Yt.created_at))?-1:1)}),Tt=lp(async()=>{var ot,gt,zt;if(((ot=t.value)==null?void 0:ot.base_id)!==((gt=m.value)==null?void 0:gt.id))return await b.getBaseRoles((zt=t.value)==null?void 0:zt.base_id,{skipUpdatingUser:!0})});return{...S,loadComments:L,deleteComment:ae,loadAudits:Ie,comments:M,audits:c,isAuditLoading:f,clearColumns:He,auditCommentGroups:It,consolidatedAudits:wn,hasMoreAudits:Ae,loadMoreAudits:te,resetAuditPages:Le,resolveComment:U,isCommentsLoading:xe,saveComment:ve,isYou:Ne,commentsDrawer:v,row:w,deleteRowById:Mt,displayValue:Ye,save:je,changedColumns:y,loadRow:Q,primaryKey:ie,saveRowAndStay:h,updateComment:G,baseRoles:Tt,fieldsFromParent:Y,fields:we,hiddenFields:oe,isAllowedAddNewRecord:j,getIsAllowedEditField:Ee,meta:t}},"expanded-form-store");function Ei(){const t=Hm();if(t==null)throw new Error("Please call `useExpandedFormStore` on the appropriate parent component");return t}const Ym={key:0,class:"tab-wrapper flex flex-row rounded-lg border-1 border-nc-border-gray-medium bg-white h-7 overflow-hidden"},qm=["onClick"],Xm={key:0,class:"tab-title nc-tab"},Km=ko({__name:"ViewModeSelector",props:rp({view:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const n=t,o=sp(t,"modelValue");gl(),fn(zl,V(!1));const{isSqlView:l}=Il(),{isNew:a,commentsDrawer:i,baseRoles:s}=Ei(),r=wr(),d=le(()=>Bi),c=le(()=>[{icon:"menu",value:xl.FIELD,tooltip:"Fields"},{icon:o.value===xl.ATTACHMENT?"ncFileTextSolid":"ncFileText",value:xl.ATTACHMENT,tooltip:"File Preview"},{icon:o.value===xl.DISCUSSION?"ncMessageSquare1Solid":"ncMessageSquare1Outline",value:xl.DISCUSSION,tooltip:"Discussion",hidden:l.value}].filter(f=>!f.hidden));return ti(()=>{var f;if(!d.value&&o.value!==xl.FIELD){if(o.value=xl.FIELD,!((f=n.view)!=null&&f.id))return;r.setCurrentViewExpandedFormMode(n.view.id,xl.FIELD)}}),(f,v)=>{const h=$l,y=Aa,b=Yl("e");return e(d)?(p(),B("div",Ym,[(p(!0),B(en,null,ho(e(c),(_,m)=>(p(),X(y,{key:_.value,disabled:!_.tooltip},{title:J(()=>[tt(se(_.tooltip),1)]),default:J(()=>[Nt((p(),B("div",{class:Dt(["tab",[`nc-tab-${o.value}`,{active:o.value===_.value,"first-tab":m===0,"last-tab":m===e(c).length-1}]]),onClick:g=>o.value=_.value},[ue(h,{icon:_.icon,class:"tab-icon"},null,8,["icon"]),_.title?(p(),B("div",Xm,se(f.$t(_.title)),1)):me("",!0)],10,qm)),[[b,[`c:project:mode:${_.value}`]]])]),_:2},1032,["disabled"]))),128))])):me("",!0)}}}),Jm=Object.assign(Ol(Km,[["__scopeId","data-v-3a413a48"]]),{__name:"SmartsheetExpandedFormViewModeSelector"}),Qm=Co(()=>Ro(()=>import("./B2f1fstS.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>t.default||t)),Zm=Co(()=>Ro(()=>import("./CxSafZTa.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(t=>t.default||t)),eg=Co(()=>Ro(()=>import("./CMyFGii6.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url).then(t=>t.default||t)),tg=Co(()=>Ro(()=>import("./CkXo2doe.js").then(t=>t.C),__vite__mapDeps([37,1,2,12,13,38,39,40,28,23,22,26,27,41]),import.meta.url).then(t=>t.default||t)),ng=["col-id","data-testid"],og=ko({__name:"ColumnList",props:{fields:{},forceVerticalMode:{type:Boolean},isLoading:{type:Boolean},showColCallback:{type:Function},isHiddenCol:{type:Boolean}},setup(t){const n=t,{changedColumns:o,isNew:l,loadRow:a,row:i}=Ei(),{isSqlView:s}=Il(),r=fn(zl,V(!1)),{isUIAllowed:d}=gl(),c=le(()=>!d("dataEdit")||r.value||s.value),f=v=>{var h;return((h=n.showColCallback)==null?void 0:h.call(n,v))||!xo(v)||!l.value||hl(v)};return(v,h)=>{const y=Qm,b=Zm,_=lv,m=eg,g=tg,C=fm,w=Rr,S=Aa;return p(!0),B(en,null,ho(v.fields,x=>Nt((p(),B("div",{key:x.title,class:Dt([`nc-expand-col-${x.title}`,"nc-expanded-form-row w-full"]),"col-id":x.id,"data-testid":`nc-expand-col-${x.title}`},[z("div",{class:Dt(["flex items-start nc-expanded-cell min-h-[32px]",{"flex-row sm:gap-x-2 <lg:flex-col <lg:w-full":!n.forceVerticalMode,"flex-col w-full":n.forceVerticalMode}])},[z("div",{class:Dt(["flex-none flex items-center rounded-lg overflow-hidden",{"w-45 <lg:w-full <lg:px-0 <lg:mb-2 h-[32px] xs:h-auto":!n.forceVerticalMode,"w-full px-0 mb-2 h-auto":n.forceVerticalMode}])},[e(xo)(x)?(p(),X(y,{key:0,column:x,class:"nc-expanded-cell-header h-full flex-none","is-hidden-col":v.isHiddenCol,"show-lock-icon":""},null,8,["column","is-hidden-col"])):(p(),X(b,{key:1,column:x,class:"nc-expanded-cell-header flex-none","is-hidden-col":v.isHiddenCol,"show-lock-icon":""},null,8,["column","is-hidden-col"]))],2),v.isLoading?(p(),X(_,{key:0,active:"",class:"h-8 flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(p(),X(S,{key:1,"tooltip-style":{zIndex:"1049"},class:Dt(["!<lg:w-full !<lg:flex-none lg:flex-1 flex",{"w-full !flex-none":n.forceVerticalMode,"lg:max-w-[calc(100%_-_188px)]":!n.forceVerticalMode}]),placement:"right",disabled:!("showReadonlyColumnTooltip"in v?v.showReadonlyColumnTooltip:e(Qr))(x),arrow:!1},{title:J(()=>[tt(se(v.$t("msg.info.fieldReadonly")),1)]),default:J(()=>[x.title?(p(),X(w,{key:0,class:"w-full","tooltip-style":{zIndex:"1049"},entity:e(vl).FIELD,"entity-id":x.id,permission:e(fl).RECORD_FIELD_EDIT,placement:"right","show-pointer-event-none":!1,"hide-on-click":"",disabled:("showReadonlyColumnTooltip"in v?v.showReadonlyColumnTooltip:e(Qr))(x)||!("showEditRestrictedColumnTooltip"in v?v.showEditRestrictedColumnTooltip:e(hf))(x)},{default:J(({isAllowed:$})=>[ue(C,{class:Dt(["flex-1 bg-white px-1 min-h-8 flex items-center relative",{"w-full":n.forceVerticalMode,"!select-text nc-system-field bg-nc-bg-gray-extralight !text-nc-content-inverted-primary-disabled cursor-pointer":("showReadonlyColumnTooltip"in v?v.showReadonlyColumnTooltip:e(Qr))(x),"!select-text nc-readonly-div-data-cell":e(c)||!$}])},{default:J(()=>[e(xo)(x)?(p(),X(m,{key:0,modelValue:e(i).row[x.title],"onUpdate:modelValue":I=>e(i).row[x.title]=I,column:x,"read-only":e(c)||!$,row:e(i),"is-allowed":$},null,8,["modelValue","onUpdate:modelValue","column","read-only","row","is-allowed"])):(p(),X(g,{key:1,modelValue:e(i).row[x.title],"onUpdate:modelValue":[I=>e(i).row[x.title]=I,I=>e(o).add(x.title)],active:!0,column:x,"edit-enabled":!0,"read-only":("ncIsPlaywright"in v?v.ncIsPlaywright:e(mf))()?e(c)||!$:e(c)||!$||("showReadonlyColumnTooltip"in v?v.showReadonlyColumnTooltip:e(Qr))(x),"is-allowed":$},null,8,["modelValue","onUpdate:modelValue","column","read-only","is-allowed"]))]),_:2},1032,["class"])]),_:2},1032,["entity","entity-id","permission","disabled"])):me("",!0)]),_:2},1032,["class","disabled"]))],2)],10,ng)),[[ba,f(x)]])),128)}}}),lg=Object.assign(Ol(og,[["__scopeId","data-v-20235b94"]]),{__name:"SmartsheetExpandedFormPresentorsFieldsColumnList"}),ag={ref:"expandedFormScrollWrapper",class:"flex flex-col flex-grow gap-5 h-full max-h-full nc-scrollbar-thin items-center w-full p-4 xs:px-4 xs:pt-4 xs:pb-2 xs:gap-6 children:max-w-[588px] <lg:children:max-w-[450px]"},ig={key:0,class:"flex w-full <lg:px-1 items-center py-6"},rg=ko({__name:"Columns",props:{fields:{},hiddenFields:{},isLoading:{type:Boolean},forceVerticalMode:{type:Boolean}},setup(t){const o=Bn(t,"isLoading"),{loadRow:l,row:a}=Ei(),{isMobileMode:i}=nl(),s=V(!1);return(r,d)=>{const c=lg,f=$l,v=ca;return p(),B("div",ag,[ue(c,{fields:r.fields,"force-vertical-mode":r.forceVerticalMode,"is-loading":e(o)},null,8,["fields","force-vertical-mode","is-loading"]),r.hiddenFields.length>0?(p(),B("div",ig,[d[1]||(d[1]=z("div",{class:"flex-grow h-px mr-1 bg-gray-100"},null,-1)),ue(v,{size:e(i)?"medium":"small",class:"flex-shrink !text-sm overflow-hidden !text-gray-500 !font-weight-500",type:"secondary",onClick:d[0]||(d[0]=h=>s.value=!e(s))},{default:J(()=>[tt(se(e(s)?`Hide ${r.hiddenFields.length} hidden`:`Show ${r.hiddenFields.length} hidden`)+" "+se(r.hiddenFields.length>1?"fields":"field")+" ",1),ue(f,{icon:"chevronDown",class:Dt([e(s)?"transform rotate-180":"","ml-1"])},null,8,["class"])]),_:1},8,["size"]),d[2]||(d[2]=z("div",{class:"flex-grow h-px ml-1 bg-gray-100"},null,-1))])):me("",!0),r.hiddenFields.length>0&&e(s)?(p(),X(c,{key:1,fields:r.hiddenFields,"is-hidden-col":"","force-vertical-mode":r.forceVerticalMode,"is-loading":e(o),"show-col-callback":h=>("isFormula"in r?r.isFormula:e(Uu))(h)},null,8,["fields","force-vertical-mode","is-loading","show-col-callback"])):me("",!0)],512)}}}),dv=Object.assign(rg,{__name:"SmartsheetExpandedFormPresentorsFieldsColumns"}),sg=ko({__name:"MiniColumnsWrapper",setup(t){const{fields:n,hiddenFields:o}=Ei();return(l,a)=>{const i=dv;return p(),X(i,{fields:e(n),"hidden-fields":e(o),"is-loading":!1,"force-vertical-mode":"",class:"mini-columns-wrapper"},null,8,["fields","hidden-fields"])}}}),cv=Object.assign(sg,{__name:"SmartsheetExpandedFormPresentorsFieldsMiniColumnsWrapper"});function Xa(){}Xa.prototype={diff:function(n,o){var l,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=a.callback;typeof a=="function"&&(i=a,a={});var s=this;function r(S){return S=s.postProcess(S,a),i?(setTimeout(function(){i(S)},0),!0):S}n=this.castInput(n,a),o=this.castInput(o,a),n=this.removeEmpty(this.tokenize(n,a)),o=this.removeEmpty(this.tokenize(o,a));var d=o.length,c=n.length,f=1,v=d+c;a.maxEditLength!=null&&(v=Math.min(v,a.maxEditLength));var h=(l=a.timeout)!==null&&l!==void 0?l:1/0,y=Date.now()+h,b=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(b[0],o,n,0,a);if(b[0].oldPos+1>=c&&_+1>=d)return r(yc(s,b[0].lastComponent,o,n,s.useLongestToken));var m=-1/0,g=1/0;function C(){for(var S=Math.max(m,-f);S<=Math.min(g,f);S+=2){var x=void 0,$=b[S-1],I=b[S+1];$&&(b[S-1]=void 0);var F=!1;if(I){var E=I.oldPos-S;F=I&&0<=E&&E<d}var M=$&&$.oldPos+1<c;if(!F&&!M){b[S]=void 0;continue}if(!M||F&&$.oldPos<I.oldPos?x=s.addToPath(I,!0,!1,0,a):x=s.addToPath($,!1,!0,1,a),_=s.extractCommon(x,o,n,S,a),x.oldPos+1>=c&&_+1>=d)return r(yc(s,x.lastComponent,o,n,s.useLongestToken));b[S]=x,x.oldPos+1>=c&&(g=Math.min(g,S-1)),_+1>=d&&(m=Math.max(m,S+1))}f++}if(i)(function S(){setTimeout(function(){if(f>v||Date.now()>y)return i();C()||S()},0)})();else for(;f<=v&&Date.now()<=y;){var w=C();if(w)return w}},addToPath:function(n,o,l,a,i){var s=n.lastComponent;return s&&!i.oneChangePerToken&&s.added===o&&s.removed===l?{oldPos:n.oldPos+a,lastComponent:{count:s.count+1,added:o,removed:l,previousComponent:s.previousComponent}}:{oldPos:n.oldPos+a,lastComponent:{count:1,added:o,removed:l,previousComponent:s}}},extractCommon:function(n,o,l,a,i){for(var s=o.length,r=l.length,d=n.oldPos,c=d-a,f=0;c+1<s&&d+1<r&&this.equals(l[d+1],o[c+1],i);)c++,d++,f++,i.oneChangePerToken&&(n.lastComponent={count:1,previousComponent:n.lastComponent,added:!1,removed:!1});return f&&!i.oneChangePerToken&&(n.lastComponent={count:f,previousComponent:n.lastComponent,added:!1,removed:!1}),n.oldPos=d,c},equals:function(n,o,l){return l.comparator?l.comparator(n,o):n===o||l.ignoreCase&&n.toLowerCase()===o.toLowerCase()},removeEmpty:function(n){for(var o=[],l=0;l<n.length;l++)n[l]&&o.push(n[l]);return o},castInput:function(n){return n},tokenize:function(n){return Array.from(n)},join:function(n){return n.join("")},postProcess:function(n){return n}};function yc(t,n,o,l,a){for(var i=[],s;n;)i.push(n),s=n.previousComponent,delete n.previousComponent,n=s;i.reverse();for(var r=0,d=i.length,c=0,f=0;r<d;r++){var v=i[r];if(v.removed)v.value=t.join(l.slice(f,f+v.count)),f+=v.count;else{if(!v.added&&a){var h=o.slice(c,c+v.count);h=h.map(function(y,b){var _=l[f+b];return _.length>y.length?_:y}),v.value=t.join(h)}else v.value=t.join(o.slice(c,c+v.count));c+=v.count,v.added||(f+=v.count)}}return i}function bc(t,n){var o;for(o=0;o<t.length&&o<n.length;o++)if(t[o]!=n[o])return t.slice(0,o);return t.slice(0,o)}function _c(t,n){var o;if(!t||!n||t[t.length-1]!=n[n.length-1])return"";for(o=0;o<t.length&&o<n.length;o++)if(t[t.length-(o+1)]!=n[n.length-(o+1)])return t.slice(-o);return t.slice(-o)}function Tu(t,n,o){if(t.slice(0,n.length)!=n)throw Error("string ".concat(JSON.stringify(t)," doesn't start with prefix ").concat(JSON.stringify(n),"; this is a bug"));return o+t.slice(n.length)}function $u(t,n,o){if(!n)return t+o;if(t.slice(-n.length)!=n)throw Error("string ".concat(JSON.stringify(t)," doesn't end with suffix ").concat(JSON.stringify(n),"; this is a bug"));return t.slice(0,-n.length)+o}function Gr(t,n){return Tu(t,n,"")}function bs(t,n){return $u(t,n,"")}function xc(t,n){return n.slice(0,ug(t,n))}function ug(t,n){var o=0;t.length>n.length&&(o=t.length-n.length);var l=n.length;t.length<n.length&&(l=t.length);var a=Array(l),i=0;a[0]=0;for(var s=1;s<l;s++){for(n[s]==n[i]?a[s]=a[i]:a[s]=i;i>0&&n[s]!=n[i];)i=a[i];n[s]==n[i]&&i++}i=0;for(var r=o;r<t.length;r++){for(;i>0&&t[r]!=n[i];)i=a[i];t[r]==n[i]&&i++}return i}var Ws="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",dg=new RegExp("[".concat(Ws,"]+|\\s+|[^").concat(Ws,"]"),"ug"),hs=new Xa;hs.equals=function(t,n,o){return o.ignoreCase&&(t=t.toLowerCase(),n=n.toLowerCase()),t.trim()===n.trim()};hs.tokenize=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o;if(n.intlSegmenter){if(n.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');o=Array.from(n.intlSegmenter.segment(t),function(i){return i.segment})}else o=t.match(dg)||[];var l=[],a=null;return o.forEach(function(i){/\s/.test(i)?a==null?l.push(i):l.push(l.pop()+i):/\s/.test(a)?l[l.length-1]==a?l.push(l.pop()+i):l.push(a+i):l.push(i),a=i}),l};hs.join=function(t){return t.map(function(n,o){return o==0?n:n.replace(/^\s+/,"")}).join("")};hs.postProcess=function(t,n){if(!t||n.oneChangePerToken)return t;var o=null,l=null,a=null;return t.forEach(function(i){i.added?l=i:i.removed?a=i:((l||a)&&kc(o,a,l,i),o=i,l=null,a=null)}),(l||a)&&kc(o,a,l,null),t};function cg(t,n,o){return hs.diff(t,n,o)}function kc(t,n,o,l){if(n&&o){var a=n.value.match(/^\s*/)[0],i=n.value.match(/\s*$/)[0],s=o.value.match(/^\s*/)[0],r=o.value.match(/\s*$/)[0];if(t){var d=bc(a,s);t.value=$u(t.value,s,d),n.value=Gr(n.value,d),o.value=Gr(o.value,d)}if(l){var c=_c(i,r);l.value=Tu(l.value,r,c),n.value=bs(n.value,c),o.value=bs(o.value,c)}}else if(o)t&&(o.value=o.value.replace(/^\s*/,"")),l&&(l.value=l.value.replace(/^\s*/,""));else if(t&&l){var f=l.value.match(/^\s*/)[0],v=n.value.match(/^\s*/)[0],h=n.value.match(/\s*$/)[0],y=bc(f,v);n.value=Gr(n.value,y);var b=_c(Gr(f,y),h);n.value=bs(n.value,b),l.value=Tu(l.value,f,b),t.value=$u(t.value,f,f.slice(0,f.length-b.length))}else if(l){var _=l.value.match(/^\s*/)[0],m=n.value.match(/\s*$/)[0],g=xc(m,_);n.value=bs(n.value,g)}else if(t){var C=t.value.match(/\s*$/)[0],w=n.value.match(/^\s*/)[0],S=xc(C,w);n.value=Gr(n.value,S)}}var fg=new Xa;fg.tokenize=function(t){var n=new RegExp("(\\r?\\n)|[".concat(Ws,"]+|[^\\S\\n\\r]+|[^").concat(Ws,"]"),"ug");return t.match(n)||[]};var sd=new Xa;sd.tokenize=function(t,n){n.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var o=[],l=t.split(/(\n|\r\n)/);l[l.length-1]||l.pop();for(var a=0;a<l.length;a++){var i=l[a];a%2&&!n.newlineIsToken?o[o.length-1]+=i:o.push(i)}return o};sd.equals=function(t,n,o){return o.ignoreWhitespace?((!o.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!o.newlineIsToken||!n.includes(`
`))&&(n=n.trim())):o.ignoreNewlineAtEof&&!o.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),n.endsWith(`
`)&&(n=n.slice(0,-1))),Xa.prototype.equals.call(this,t,n,o)};var vg=new Xa;vg.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var pg=new Xa;pg.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function Ou(t){"@babel/helpers - typeof";return Ou=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ou(t)}var us=new Xa;us.useLongestToken=!0;us.tokenize=sd.tokenize;us.castInput=function(t,n){var o=n.undefinedReplacement,l=n.stringifyReplacer,a=l===void 0?function(i,s){return typeof s>"u"?o:s}:l;return typeof t=="string"?t:JSON.stringify(Du(t,null,null,a),a,"  ")};us.equals=function(t,n,o){return Xa.prototype.equals.call(us,t.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"),o)};function Du(t,n,o,l,a){n=n||[],o=o||[],l&&(t=l(a,t));var i;for(i=0;i<n.length;i+=1)if(n[i]===t)return o[i];var s;if(Object.prototype.toString.call(t)==="[object Array]"){for(n.push(t),s=new Array(t.length),o.push(s),i=0;i<t.length;i+=1)s[i]=Du(t[i],n,o,l,a);return n.pop(),o.pop(),s}if(t&&t.toJSON&&(t=t.toJSON()),Ou(t)==="object"&&t!==null){n.push(t),s={},o.push(s);var r=[],d;for(d in t)Object.prototype.hasOwnProperty.call(t,d)&&r.push(d);for(r.sort(),i=0;i<r.length;i+=1)d=r[i],s[d]=Du(t[d],n,o,l,d);n.pop(),o.pop()}else s=t;return s}var Lu=new Xa;Lu.tokenize=function(t){return t.slice()};Lu.join=Lu.removeEmpty=function(t){return t};const os=(t,n)=>cg(t,n).map(o=>({text:o.value,op:o.added?"added":o.removed?"removed":"unchanged"})),hg=Co(()=>Ro(()=>import("./DOFFjK0_.js").then(t=>t.oO),__vite__mapDeps([1,2]),import.meta.url).then(t=>t.default||t)),mg={class:"flex items-center gap-1 !text-gray-600 text-xs font-weight-500 nc-audit-mini-item-header"},gg={class:"flex items-center gap-2 mt-3 flex-wrap"},wg={key:0,class:"border-1 border-red-500 rounded-md bg-red-50 w-full p-0.5"},yg={class:"flex flex-col items-start gap-0.5"},bg={class:"flex items-center gap-2 w-full"},_g={class:"flex items-center justify-center w-8 aspect-square"},xg={key:1,class:"nc-attachment flex items-center justify-center"},kg={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-gray-600"},Cg={class:"text-xs font-weight-500 p-2 text-gray-500"},Rg={key:1,class:"border-1 border-green-500 rounded-md bg-green-50 w-full p-0.5"},Sg={class:"flex flex-col items-start gap-0.5"},Ig={class:"flex items-center gap-2 w-full"},Fg={class:"flex items-center justify-center w-8 aspect-square"},Ag={key:1,class:"nc-attachment flex items-center justify-center"},Eg={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-gray-600"},Mg={class:"text-xs font-weight-500 p-2 text-gray-500"},Tg={key:0,class:"text-small1 text-red-700 border-1 border-red-200 rounded-md px-1 bg-red-50 line-through break-all"},$g={key:1,class:"text-small1 text-green-700 border-1 border-green-200 rounded-md px-1 bg-green-50 break-all"},Og={key:2,class:"w-full"},Dg={key:0,class:"max-w-full text-small1 text-red-700 border-1 border-red-200 rounded-md px-1 mr-1 bg-red-50 line-through decoration-clone"},Lg={key:1,class:"max-w-full text-small1 text-green-700 border-1 border-green-200 rounded-md px-1 mr-1 bg-green-50 decoration-clone"},Ng={key:2},Pg={key:3,class:"w-full"},Bg={key:4,class:"overflow-x-auto nc-scrollbar-thin whitespace-nowrap"},Wg={key:0,class:"text-small1 text-red-700 border-1 border-red-200 rounded-md px-1 bg-red-50 line-through decoration-clone inline"},zg={key:1,class:"text-small1 text-green-700 border-1 border-green-200 rounded-md px-1 bg-green-50 decoration-clone inline"},Vg={key:2,class:"inline text-small1"},jg=ko({__name:"AuditMiniItem",props:{audit:{}},setup(t){const n=t,o=le(()=>{try{return JSON.parse(n.audit.details||"")}catch{return{}}}),l=le(()=>o.value.old_data??{}),a=le(()=>o.value.data??{}),i=le(()=>o.value.column_meta??{}),s=le(()=>Object.keys(a.value));yo(gf,V(!0));const{getPossibleAttachmentSrc:r}=xi();function d(g){var C,w,S,x,$;return{...((w=(C=i.value)==null?void 0:C[g])==null?void 0:w.options)??{},options:($=(x=(S=i.value)==null?void 0:S[g])==null?void 0:x.options)==null?void 0:$.choices}}function c(g){var x,$;const C=((x=i.value)==null?void 0:x[g])??{},w=d(g),S=w.icon||(C.type==="Rating"?"star":"circle-check");return{...w,...C,icon:C.type==="Rating"?bf[S]:_f[S],duration:w.duration_format?($=yf.find(I=>I.title===w.duration_format))==null?void 0:$.id:void 0,is12hrFormat:w["12hr_format"],isLocaleString:w.locale_string,isDisplayTimezone:(w==null?void 0:w.isDisplayTimezone)||(w==null?void 0:w.is_display_timezone),useSameTimezoneForAll:(w==null?void 0:w.useSameTimezoneForAll)||(w==null?void 0:w.use_same_timezone_for_all)}}function f(g){var S,x,$,I,F;const C=l.value[g],w=a.value[g];return((x=(S=i.value)==null?void 0:S[g])==null?void 0:x.type)==="Attachment"?C==null?void 0:C.filter(E=>!(w!=null&&w.some(M=>M.title===E.title))):((I=($=i.value)==null?void 0:$[g])==null?void 0:I.type)==="MultiSelect"?((F=C==null?void 0:C.filter)==null?void 0:F.call(C,E=>{var M;return!((M=w==null?void 0:w.includes)!=null&&M.call(w,E))}))??C:C}function v(g){var S,x,$,I,F;const C=l.value[g],w=a.value[g];return((x=(S=i.value)==null?void 0:S[g])==null?void 0:x.type)==="Attachment"?w==null?void 0:w.filter(E=>!(C!=null&&C.some(M=>M.title===E.title))):((I=($=i.value)==null?void 0:$[g])==null?void 0:I.type)==="MultiSelect"?((F=w==null?void 0:w.filter)==null?void 0:F.call(w,E=>{var M;return!((M=C==null?void 0:C.includes)!=null&&M.call(C,E))}))??w:w}function h(g){const C=l.value[g],w=a.value[g];return!C&&!w?[]:os(C?JSON.stringify(C,null,2):"",w?JSON.stringify(w,null,2):"")}function y(g){var C,w;return!["Checkbox","SingleSelect","MultiSelect"].includes((w=(C=i.value)==null?void 0:C[g])==null?void 0:w.type)&&!c(g).is_progress}function b(g){var C,w;return["SingleSelect","MultiSelect"].includes((w=(C=i.value)==null?void 0:C[g])==null?void 0:w.type)}function _(g){return![void 0,null,""].includes(g)}function m(g){var C,w;return["URL","PhoneNumber","Email"].includes((w=(C=i.value)==null?void 0:C[g])==null?void 0:w.type)}return(g,C)=>{const w=wf,S=Aa,x=hg,$=ev,I=ad;return p(!0),B(en,null,ho(e(s),F=>{var E,M,U,L,G,ae,ve,xe,ne,he,W,j,Ee,Ye,Ge,ke,Y,we,oe,ye;return p(),B("div",{key:F,class:"py-2 px-3"},[z("div",mg,[ue(w,{"column-meta":{uidt:(E=e(i)[F])==null?void 0:E.type,dt:((M=e(i)[F])==null?void 0:M.type)==="Number"?"bigint":void 0},class:"!m-0"},null,8,["column-meta"]),ue(S,{class:"truncate","show-on-truncate-only":""},{title:J(()=>[tt(se(F),1)]),default:J(()=>[tt(" "+se(F),1)]),_:2},1024)]),z("div",gg,[((U=e(i)[F])==null?void 0:U.type)==="Attachment"?(p(),B(en,{key:0},[((L=f(F))==null?void 0:L.length)>0?(p(),B("div",wg,[z("div",yg,[(p(!0),B(en,null,ho(f(F),(ie,H)=>(p(),B("div",{key:ie.url||ie.title,class:"border-1 border-gray-200 rounded-md bg-white w-full"},[z("div",bg,[z("div",_g,[("isImage"in g?g.isImage:e(Ls))(ie.title,ie.mimetype??ie.type)?(p(),X(x,{key:0,alt:ie.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(r)(ie,"small")},null,8,["alt","srcs"])):(p(),B("div",xg,[ue($,{item:ie,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",kg,se(ie.title),1),z("span",Cg,se(("getReadableFileSize"in g?g.getReadableFileSize:e(Ns))(ie.size)),1)])]))),128))])])):me("",!0),((G=v(F))==null?void 0:G.length)>0?(p(),B("div",Rg,[z("div",Sg,[(p(!0),B(en,null,ho(v(F),(ie,H)=>(p(),B("div",{key:ie.url||ie.title,class:"border-1 border-gray-200 rounded-md bg-white w-full"},[z("div",Ig,[z("div",Fg,[("isImage"in g?g.isImage:e(Ls))(ie.title,ie.mimetype??ie.type)?(p(),X(x,{key:0,alt:ie.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(r)(ie,"small")},null,8,["alt","srcs"])):(p(),B("div",Ag,[ue($,{item:ie,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",Eg,se(ie.title),1),z("span",Mg,se(("getReadableFileSize"in g?g.getReadableFileSize:e(Ns))(ie.size)),1)])]))),128))])])):me("",!0)],64)):m(F)?(p(),B(en,{key:1},[_(e(l)[F])?(p(),B("div",Tg,se(e(l)[F]),1)):me("",!0),_(e(a)[F])?(p(),B("div",$g,se(e(a)[F]),1)):me("",!0)],64)):((ae=e(i)[F])==null?void 0:ae.type)==="SingleLineText"?(p(),B("div",Og,[(p(!0),B(en,null,ho(("diffTextBlocks"in g?g.diffTextBlocks:e(os))(e(l)[F]||"",e(a)[F]||""),(ie,H)=>(p(),B(en,{key:H},[ie.op==="removed"?(p(),B("span",Dg,se(ie.text),1)):ie.op==="added"?(p(),B("span",Lg,se(ie.text),1)):(p(),B("span",Ng,se(ie.text),1))],64))),128))])):((ve=e(i)[F])==null?void 0:ve.type)==="LongText"?(p(),B("div",Pg,[(p(!0),B(en,null,ho(("diffTextBlocks"in g?g.diffTextBlocks:e(os))(((xe=e(i)[F])==null?void 0:xe.type)==="LongText"&&((he=(ne=e(i)[F])==null?void 0:ne.options)!=null&&he.ai)?((W=e(l)[F])==null?void 0:W.value)||"":e(l)[F]||"",((j=e(i)[F])==null?void 0:j.type)==="LongText"&&((Ye=(Ee=e(i)[F])==null?void 0:Ee.options)!=null&&Ye.ai)?((Ge=e(a)[F])==null?void 0:Ge.value)||"":e(a)[F]||""),(ie,H)=>{var Ae,Ie,ce;return p(),B(en,{key:H},[ie.op==="removed"?(p(),B("span",{key:0,class:Dt(["max-w-full text-red-700 px-1 bg-red-50 rounded-md line-through decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ae=e(i)[F])==null?void 0:Ae.type)==="LongText"}])},se(ie.text),3)):ie.op==="added"?(p(),B("span",{key:1,class:Dt(["max-w-full text-green-700 px-1 bg-green-50 rounded-md decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ie=e(i)[F])==null?void 0:Ie.type)==="LongText"}])},se(ie.text),3)):(p(),B("span",{key:2,class:Dt(["max-w-full !leading-[18px]",{"whitespace-pre-wrap":((ce=e(i)[F])==null?void 0:ce.type)==="LongText"}])},se(ie.text),3))],64)}),128))])):((ke=e(i)[F])==null?void 0:ke.type)==="JSON"?(p(),B("div",Bg,[(p(!0),B(en,null,ho(h(F),(ie,H)=>(p(),B(en,{key:H},[ie.op==="removed"?(p(),B("pre",Wg,se(ie.text),1)):ie.op==="added"?(p(),B("pre",zg,se(ie.text),1)):(p(),B("pre",Vg,se(ie.text),1))],64))),128))])):(p(),B(en,{key:5},[_(f(F))?(p(),B("div",{key:0,class:Dt(["max-w-full nc-audit-mini-item-cell nc-audit-removal !text-red-700 border-1 border-red-200 rounded-md bg-red-50 line-through",{"px-1 py-0.25":y(F),"!p-0.25":b(F)}])},[ue(I,{column:{uidt:(Y=e(i)[F])==null?void 0:Y.type,dt:((we=e(i)[F])==null?void 0:we.type)==="Number"?"bigint":void 0,meta:c(F),colOptions:d(F)},"model-value":f(F),"edit-enabled":!1,"read-only":"",class:Dt([{"min-w-[100px]":c(F).is_progress},"!text-red-700"])},null,8,["column","model-value","class"])],2)):me("",!0),_(v(F))?(p(),B("div",{key:1,class:Dt(["nc-audit-mini-item-cell nc-audit-addition border-1 border-green-200 rounded-md bg-green-50",{"px-1 py-0.25":y(F),"!p-0.25":b(F)}])},[ue(I,{column:{uidt:(oe=e(i)[F])==null?void 0:oe.type,dt:((ye=e(i)[F])==null?void 0:ye.type)==="Number"?"bigint":void 0,meta:c(F),colOptions:d(F)},"model-value":v(F),"edit-enabled":!1,"read-only":"",class:Dt([{"min-w-[100px]":c(F).is_progress},"!text-green-700"])},null,8,["column","model-value","class"])],2)):me("",!0)],64))])])}),128)}}}),Ug=Object.assign(Ol(jg,[["__scopeId","data-v-c22a4c2c"]]),{__name:"SmartsheetExpandedFormSidebarAuditMiniItem"}),Gg={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Hg(t,n){return p(),B("svg",Gg,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1)]))}const Yg=yr({name:"mdi-history",render:Hg}),qg={class:"h-full"},Xg={key:0,class:"flex flex-col items-center justify-center w-full h-full"},Kg={key:0,class:"flex flex-col text-center justify-center h-full"},Jg={class:"text-center text-3xl text-gray-600"},Qg={key:0,class:"text-center text-gray-600"},Zg={class:"font-bold"},ew={key:0,class:"text-center text-gray-600 my-2"},tw={class:"font-bold"},nw={key:1,class:"p-3 text-center"},ow={class:"group gap-3 overflow-hidden px-3 py-2 transition hover:bg-gray-100"},lw={class:"flex items-start justify-between"},aw={class:"flex items-start gap-3 flex-1 w-full"},iw={class:"flex h-[28px] items-center gap-2 w-[calc(100%_-_40px)]"},rw={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},sw={class:"text-xs text-gray-500"},uw={key:0,class:"pl-9"},dw={key:0,class:"rounded-lg border-1 border-gray-200 bg-gray-50 divide-y py-2 px-3"},cw={key:1,class:"rounded-lg border-1 border-gray-200 bg-gray-50 divide-y py-2 px-3"},fw={key:1,class:"pl-9"},vw={key:2,class:"pl-9"},pw={class:"rounded-lg border-1 border-gray-200 bg-gray-50 divide-y py-2 px-3"},hw={class:"flex items-center gap-2 !text-gray-600 text-xs nc-audit-mini-item-header mb-3"},mw={class:"!border-none audit-link-container"},gw={key:0,class:"audit-link-removal"},ww={key:1,class:"audit-link-addition"},yw={key:3,class:"ml-9 rounded-lg border-1 border-gray-200 bg-gray-50 divide-y"},bw=ko({__name:"Audits",setup(t){const{user:n}=nl(),{primaryKey:o,consolidatedAudits:l,isAuditLoading:a,loadMoreAudits:i,resetAuditPages:s,hasMoreAudits:r}=Ei(),{getPlanLimit:d}=up(),c=le(()=>{const g=d(Hs.LIMIT_AUDIT_RETENTION);return g===14?"2 weeks":g===60?"2 months":g===180?"6 months":g===365?"1 year":null}),f=V(null);Hn(o,()=>{s()});function v(){var g;(g=f.value)==null||g.scrollBy({top:5e4,behavior:"smooth"})}const h=g=>{var C,w;return g.user===((C=n.value)==null?void 0:C.email)?"You":(w=g.created_display_name)!=null&&w.trim()?g.created_display_name||"Shared source":g.user?g.user:"Shared source"},y=V(!1);function b(){y.value=!0,i(),tl(()=>{var g,C;(C=(g=document.querySelector('.nc-drawer-expanded-form.active > div[tabindex="0"]'))==null?void 0:g.focus)==null||C.call(g)})}Hn(l,()=>{if(y.value){y.value=!0;return}tl(()=>{setTimeout(()=>{v()},500)})},{immediate:!0});function _(g){try{return JSON.parse(g)}catch{return{}}}function m(g){var C;return!!(g.version===0||["LINK_RECORD","UNLINK_RECORD"].includes((g==null?void 0:g.op_sub_type)||"")&&((C=g.details)!=null&&C.startsWith("<span")))}return(g,C)=>{const w=Ys,S=Yg,x=ca,$=Gu,I=Aa,F=xf,E=Ug,M=Yl("dompurify-html");return p(),B("div",qg,[e(a)&&e(l).length===0?(p(),B("div",Xg,[ue(w,{size:"xlarge"})])):(p(),B("div",{key:1,ref_key:"auditsWrapperEl",ref:f,class:"flex flex-col h-full nc-scrollbar-thin pb-1"},[e(l).length===0?(p(),B("div",Kg,[z("div",Jg,[ue(S)]),C[3]||(C[3]=z("div",{class:"font-bold text-center my-1 text-gray-600"},"See changes to this record",-1)),e(c)?(p(),B("div",Qg,[C[1]||(C[1]=tt(" Your current plan provides ")),z("span",Zg,se(e(c)),1),C[2]||(C[2]=tt(" of revision history. "))])):me("",!0)])):(p(),B(en,{key:1},[C[7]||(C[7]=z("div",{class:"mt-auto"},null,-1)),e(c)?(p(),B("div",ew,[C[4]||(C[4]=tt(" You have ")),z("span",tw,se(e(c)),1),C[5]||(C[5]=tt(" of revision history. "))])):me("",!0),e(r)?(p(),B("div",nw,[ue(x,{size:"small",type:"secondary",onClick:C[0]||(C[0]=U=>b())},{default:J(()=>C[6]||(C[6]=[tt(" Load earlier ")])),_:1,__:[6]})])):me("",!0),(p(!0),B(en,null,ho(e(l),U=>{var L,G;return p(),B("div",{key:U.id,class:Dt([`${U.id}`,"nc-audit-item"])},[z("div",ow,[z("div",lw,[z("div",aw,[ue($,{user:{email:(U==null?void 0:U.created_by_email)||(U==null?void 0:U.user),display_name:(U==null?void 0:U.created_display_name)||(U==null?void 0:U.user),meta:U==null?void 0:U.created_by_meta},class:"mt-0.5",size:"medium"},null,8,["user"]),z("div",iw,[z("div",rw,se(h(U)),1),z("div",sw,[ue(I,null,{title:J(()=>[tt(se(("parseStringDateTime"in g?g.parseStringDateTime:e(Hu))(U.created_at)),1)]),default:J(()=>[tt(" "+se(("timeAgo"in g?g.timeAgo:e(Ms))(U.created_at)),1)]),_:2},1024)])])])]),m(U)?(p(),B("div",uw,[U.details?Nt((p(),B("div",dw,null,512)),[[M,U.details]]):(p(),B("div",cw,se(U.description),1))])):(U==null?void 0:U.op_type)==="DATA_INSERT"?(p(),B("div",fw,"created the record.")):["DATA_LINK","DATA_UNLINK"].includes(U==null?void 0:U.op_type)?(p(),B("div",vw,[z("div",pw,[z("div",hw,[ue(F,{"column-meta":{uidt:"Links",colOptions:{type:_(U.details).type}},class:"!m-0"},null,8,["column-meta"]),tt(" "+se(_(U.details).link_field_title),1)]),z("div",mw,[((L=_(U.details).consolidated_ref_display_values_unlinks)==null?void 0:L.length)>0?(p(),B("div",gw,[(p(!0),B(en,null,ho(_(U.details).consolidated_ref_display_values_unlinks,ae=>(p(),B("span",{key:ae.refRowId,class:"audit-link-item"},se(ae.value),1))),128))])):me("",!0),((G=_(U.details).consolidated_ref_display_values_links)==null?void 0:G.length)>0?(p(),B("div",ww,[(p(!0),B(en,null,ho(_(U.details).consolidated_ref_display_values_links,ae=>(p(),B("span",{key:ae.refRowId,class:"audit-link-item"},se(ae.value),1))),128))])):me("",!0)])])])):(U==null?void 0:U.op_type)==="DATA_UPDATE"?(p(),B("div",yw,[ue(E,{audit:U},null,8,["audit"])])):me("",!0)])],2)}),128))],64))],512))])}}}),_w=Object.assign(Ol(bw,[["__scopeId","data-v-949e5855"]]),{__name:"SmartsheetExpandedFormSidebarAudits"}),xw={class:"flex flex-col bg-white !h-full w-full rounded-br-2xl overflow-hidden"},kw={class:"flex items-center gap-2"},Cw={class:"<lg:hidden"},Rw={class:"flex items-center gap-2"},Sw={class:"<lg:hidden"},Iw={class:"flex items-center gap-2"},Fw={class:"<lg:hidden"},Aw=ko({__name:"index",props:{showFieldsTab:{type:Boolean}},setup(t){const n=t,{isSqlView:o}=Il(),l=Ei(),a=V(n.showFieldsTab?"fields":"comments");return Hn(a,i=>{i==="audits"&&l.loadAudits()}),(i,s)=>{const r=$l,d=cv,c=cp,f=vm,v=_w,h=dp,y=Yl("e");return p(),B("div",xw,[ue(h,{"active-key":e(a),"onUpdate:activeKey":s[0]||(s[0]=b=>bo(a)?a.value=b:null),class:"h-full"},{default:J(()=>[n.showFieldsTab?(p(),X(c,{key:"fields",class:"w-full h-full"},{tab:J(()=>[Nt((p(),B("div",kw,[ue(r,{icon:"fields",class:"w-4 h-4"}),z("span",Cw,se(i.$t("objects.fields")),1)])),[[y,["c:row-expand:fields"]]])]),default:J(()=>[ue(d)]),_:1})):me("",!0),e(o)?me("",!0):(p(),X(c,{key:"comments",class:"w-full h-full"},{tab:J(()=>[Nt((p(),B("div",Rw,[ue(r,{icon:"messageCircle",class:"w-4 h-4"}),z("span",Sw,se(i.$t("general.comments")),1)])),[[y,["c:row-expand:comment"]]])]),default:J(()=>[ue(f)]),_:1})),e(o)?me("",!0):(p(),X(c,{key:"audits",class:"w-full"},{tab:J(()=>[Nt((p(),B("div",Iw,[ue(r,{icon:"audit",class:"w-4 h-4"}),z("span",Fw,se(i.$t("labels.revisionHistory")),1)])),[[y,["c:row-expand:audit"]]])]),default:J(()=>[ue(v)]),_:1}))]),_:1},8,["active-key"])])}}}),Ew=Object.assign(Ol(Aw,[["__scopeId","data-v-0b726f44"]]),{__name:"SmartsheetExpandedFormSidebar"}),Mw={class:"h-full flex flex-row"},Tw={key:0,class:"p-2"},$w={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},Ow={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-copy-url"},Dw={"data-testid":"nc-expanded-form-delete"},Lw={key:1},Nw={key:2,class:"p-2"},Pw={class:"xs:px-1"},Bw={key:1,class:"p-2"},Ww={name:"ExpandedFormPresentorsFields"},zw=ko({...Ww,props:{rowId:{},fields:{},hiddenFields:{},isUnsavedDuplicatedRecordExist:{type:Boolean},isUnsavedFormExist:{type:Boolean},isLoading:{type:Boolean},isSaving:{type:Boolean},newRecordSubmitBtnText:{}},emits:["copyRecordUrl","deleteRow","save"],setup(t,{emit:n}){const o=t,l=n,a=Bn(o,"rowId"),i=Bn(o,"fields"),s=Bn(o,"hiddenFields"),r=Bn(o,"isUnsavedDuplicatedRecordExist"),d=Bn(o,"isUnsavedFormExist"),c=Bn(o,"isLoading"),f=Bn(o,"isSaving"),v=Bn(o,"newRecordSubmitBtnText"),{commentsDrawer:h,changedColumns:y,isNew:b,loadRow:_,row:m,meta:g,isAllowedAddNewRecord:C}=Ei(),{isSqlView:w}=Il(),{isUIAllowed:S}=gl(),{isMobileMode:x}=nl(),$=le(()=>!b.value&&h.value&&S("commentList")&&!w.value),I=le(()=>S("dataEdit")&&!w.value);return(F,E)=>{const M=dv,U=$l,L=ca,G=Ya,ae=br,ve=Rr,xe=qa,ne=Gi,he=Ew,W=Yl("e");return p(),B("div",Mw,[z("div",{class:Dt(["h-full flex xs:w-full flex-col overflow-hidden",{"w-full":!e($),"flex-1":e($)}])},[ue(M,{fields:e(i),"hidden-fields":e(s),"is-loading":e(c)},null,8,["fields","hidden-fields","is-loading"]),e(I)?(p(),B("div",{key:0,class:Dt(["w-full flex items-center justify-end px-2 xs:p-0 xs:gap-x-4 xs:justify-between",{"xs(border-t-1 border-gray-200)":!e(b)}])},[!e(b)&&e(x)?(p(),B("div",Tw,[ue(ne,{placement:"bottomRight",class:"p-2"},{overlay:J(()=>[ue(xe,{variant:"small"},{default:J(()=>{var j;return[ue(G,{onClick:E[0]||(E[0]=Ee=>e(_)())},{default:J(()=>[Nt((p(),B("div",$w,[(p(),X(po(("iconMap"in F?F.iconMap:e(Bo)).reload),{class:"cursor-pointer"})),tt(" "+se(F.$t("general.reload")),1)])),[[W,["c:row-expand:reload"]]])]),_:1}),e(a)?(p(),X(G,{key:0,onClick:E[1]||(E[1]=Ee=>e(b)?()=>{}:l("copyRecordUrl"))},{default:J(()=>[Nt((p(),B("div",Ow,[(p(),X(po(("iconMap"in F?F.iconMap:e(Bo)).copy),{class:"cursor-pointer nc-duplicate-row"})),tt(" "+se(F.$t("labels.copyRecordURL")),1)])),[[W,["c:row-expand:copy-url"]]])]),_:1})):me("",!0),ue(ae),e(S)("dataEdit")&&!e(b)?(p(),X(ve,{key:1,entity:e(vl).TABLE,"entity-id":(j=e(g))==null?void 0:j.id,permission:e(fl).TABLE_RECORD_DELETE},{default:J(({isAllowed:Ee})=>[Nt((p(),X(G,{class:Dt({"!text-red-500 !hover:bg-red-50":Ee}),disabled:!Ee,onClick:E[2]||(E[2]=Ye=>!e(b)&&l("deleteRow"))},{default:J(()=>[z("div",Dw,[(p(),X(po(("iconMap"in F?F.iconMap:e(Bo)).delete),{class:"cursor-pointer nc-delete-row"})),E[4]||(E[4]=tt(" Delete record "))])]),_:2},1032,["class","disabled"])),[[W,["c:row-expand:delete"]]])]),_:1},8,["entity","entity-id","permission"])):me("",!0)]}),_:1})]),default:J(()=>[ue(L,{disabled:e(c),class:"nc-expand-form-more-actions",type:"secondary",size:"small"},{default:J(()=>[ue(U,{class:Dt([e(c)?"text-gray-300":"text-gray-700","text-md"]),icon:"threeDotVertical"},null,8,["class"])]),_:1},8,["disabled"])]),_:1})])):(p(),B("div",Lw)),e(x)&&!e(w)?(p(),B("div",Nw,[Nt((p(),X(L,{disabled:!e(C)&&e(b)||e(y).size===0&&!e(d),loading:e(f),class:Dt(["nc-expand-form-save-btn !xs:text-sm !px-2",{"!h-7":!e(x)}]),"data-testid":"nc-expanded-form-save",type:"primary",size:e(x)?"small":"xsmall",onClick:E[3]||(E[3]=j=>l("save"))},{default:J(()=>[z("div",Pw,se(e(v)??e(b)?"Create Record":"Save Record"),1)]),_:1},8,["disabled","loading","class","size"])),[[W,["c:row-expand:save"]]])])):me("",!0)],2)):(p(),B("div",Bw))],2),e($)&&!e(r)?(p(),B("div",{key:0,class:Dt(["nc-comments-drawer border-l-1 relative border-gray-200 bg-gray-50 w-1/3 max-w-[400px] min-w-0 h-full xs:hidden rounded-br-2xl",{active:e(h)&&e(S)("commentList")}])},[ue(he)],2)):me("",!0)])}}}),Vw=Object.assign(zw,{__name:"SmartsheetExpandedFormPresentorsFields"}),jw={};function Uw(t,n){return p(),B("div")}const Gw=Object.assign(Ol(jw,[["render",Uw]]),{__name:"SmartsheetExpandedFormPresentorsAttachments"}),Hw=Co(()=>Ro(()=>import("./DOFFjK0_.js").then(t=>t.oO),__vite__mapDeps([1,2]),import.meta.url).then(t=>t.default||t)),Yw={class:"ml-6.5"},qw={class:"text-small1 font-weight-500 inline-flex items-center flex-wrap gap-1 w-full max-w-full"},Xw={class:"rounded-md px-1 !h-[20px] inline-flex items-center gap-1 text-nc-content-gray-emphasis border-1 border-nc-border-gray-medium"},Kw={class:"text-small1 font-weight-500"},Jw={key:0,class:"w-full"},Qw={class:"border-1 border-red-200 rounded-md bg-red-50 p-0.5 flex flex-col items-start gap-0.5 w-[284px]"},Zw={class:"flex items-center gap-2 w-full"},ey={class:"flex items-center justify-center w-8 aspect-square"},ty={key:1,class:"nc-attachment flex items-center justify-center"},ny={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-gray-600"},oy={class:"text-xs font-weight-500 p-2 text-gray-500"},ly={key:1,class:"w-full"},ay={class:"border-1 border-green-200 rounded-md bg-green-50 p-0.5 flex flex-col items-start gap-0.5 w-[284px]"},iy={class:"flex items-center gap-2 w-full"},ry={class:"flex items-center justify-center w-8 aspect-square"},sy={key:1,class:"nc-attachment flex items-center justify-center"},uy={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-gray-600"},dy={class:"text-xs font-weight-500 p-2 text-gray-500"},cy={key:0,class:"max-w-full text-red-700 border-1 border-red-200 rounded-md px-1 bg-red-50 line-through decoration-clone !leading-[18px]"},fy={key:1,class:"max-w-full text-green-700 border-1 border-green-200 rounded-md px-1 bg-green-50 decoration-clone !leading-[18px]"},vy={key:2,class:"max-w-full !leading-[18px]"},py={key:2,class:"w-full border-1 rounded-md p-1"},hy={class:"w-full flex justify-start"},my={key:0,class:"!text-red-700 border-1 border-red-200 rounded-md bg-red-50 line-through !mb-0 mt-1 p-1 max-w-full nc-scrollbar-thin"},gy={class:"w-full flex justify-start"},wy={key:0,class:"!text-green-700 border-1 border-green-200 rounded-md bg-green-50 !mb-0 mt-1 p-1 max-w-full nc-scrollbar-thin"},yy=["data-label"],by=["data-label"],_y=ko({__name:"AuditInfoExpressive",props:{audit:{}},setup(t){const n=t,o=le(()=>{try{return JSON.parse(n.audit.details||"")}catch{return{}}}),l=le(()=>o.value.old_data??{}),a=le(()=>o.value.data??{}),i=le(()=>o.value.column_meta??{}),s=le(()=>Object.keys(a.value));yo(gf,V(!0));const{getPossibleAttachmentSrc:r}=xi();function d(_){var m,g,C,w,S;return{...((g=(m=i.value)==null?void 0:m[_])==null?void 0:g.options)??{},options:(S=(w=(C=i.value)==null?void 0:C[_])==null?void 0:w.options)==null?void 0:S.choices}}function c(_){var w,S;const m=((w=i.value)==null?void 0:w[_])??{},g=d(_),C=g.icon||(m.type==="Rating"?"star":"circle-check");return{...g,...m,icon:m.type==="Rating"?bf[C]:_f[C],duration:g.duration_format?(S=yf.find(x=>x.title===g.duration_format))==null?void 0:S.id:void 0,is12hrFormat:g["12hr_format"],isLocaleString:g.locale_string,isDisplayTimezone:(g==null?void 0:g.isDisplayTimezone)||(g==null?void 0:g.is_display_timezone),useSameTimezoneForAll:(g==null?void 0:g.useSameTimezoneForAll)||(g==null?void 0:g.use_same_timezone_for_all)}}function f(_){var C,w,S,x,$;const m=l.value[_],g=a.value[_];return((w=(C=i.value)==null?void 0:C[_])==null?void 0:w.type)==="Attachment"?m==null?void 0:m.filter(I=>!(g!=null&&g.some(F=>F.title===I.title))):((x=(S=i.value)==null?void 0:S[_])==null?void 0:x.type)==="MultiSelect"?(($=m==null?void 0:m.filter)==null?void 0:$.call(m,I=>{var F;return!((F=g==null?void 0:g.includes)!=null&&F.call(g,I))}))??m:m}function v(_){var C,w,S,x,$;const m=l.value[_],g=a.value[_];return((w=(C=i.value)==null?void 0:C[_])==null?void 0:w.type)==="Attachment"?g==null?void 0:g.filter(I=>!(m!=null&&m.some(F=>F.title===I.title))):((x=(S=i.value)==null?void 0:S[_])==null?void 0:x.type)==="MultiSelect"?(($=g==null?void 0:g.filter)==null?void 0:$.call(g,I=>{var F;return!((F=m==null?void 0:m.includes)!=null&&F.call(m,I))}))??g:g}function h(_){var m,g;return!["Checkbox","SingleSelect","MultiSelect","User"].includes((g=(m=i.value)==null?void 0:m[_])==null?void 0:g.type)&&!c(_).is_progress}function y(_){var m,g;return["SingleSelect","MultiSelect","User"].includes((g=(m=i.value)==null?void 0:m[_])==null?void 0:g.type)}function b(_){return![void 0,null,""].includes(_)}return(_,m)=>{const g=$l,C=wf,w=Aa,S=Hw,x=ev,$=ad;return p(!0),B(en,null,ho(e(s),I=>{var F,E,M,U,L,G,ae,ve,xe,ne,he,W,j,Ee,Ye,Ge,ke,Y,we,oe,ye;return p(),B("div",{key:I,class:"relative not-last:mb-4"},[ue(g,{icon:"ncNode",class:Dt(["w-[16px] h-[16px] text-gray-500 bg-white absolute left-0 transform -translate-x-1/2",[["JSON","Attachment","SingleLineText","LongText"].includes((F=e(i)[I])==null?void 0:F.type)?"top-1":"top-1/2 -translate-y-2/5"]])},null,8,["class"]),z("div",Yw,[z("div",qw,[m[0]||(m[0]=z("span",{class:"text-gray-600 text-xs"}," changed ",-1)),z("span",Xw,[ue(C,{"column-meta":{uidt:(E=e(i)[I])==null?void 0:E.type,dt:((M=e(i)[I])==null?void 0:M.type)==="Number"?"bigint":void 0},class:"!w-[16px] !h-[16px] !m-0 !text-nc-content-gray-emphasis"},null,8,["column-meta"]),ue(w,{class:"truncate","show-on-truncate-only":""},{title:J(()=>[tt(se(I),1)]),default:J(()=>[z("span",Kw,se(I),1)]),_:2},1024)]),((U=e(i)[I])==null?void 0:U.type)==="Attachment"?(p(),B(en,{key:0},[((L=f(I))==null?void 0:L.length)>0?(p(),B("div",Jw,[z("div",Qw,[(p(!0),B(en,null,ho(f(I),(ie,H)=>(p(),B("div",{key:ie.url||ie.title,class:"border-1 border-gray-200 rounded-md bg-white w-full"},[z("div",Zw,[z("div",ey,[("isImage"in _?_.isImage:e(Ls))(ie.title,ie.mimetype??ie.type)?(p(),X(S,{key:0,alt:ie.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(r)(ie,"small")},null,8,["alt","srcs"])):(p(),B("div",ty,[ue(x,{item:ie,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",ny,se(ie.title),1),z("span",oy,se(("getReadableFileSize"in _?_.getReadableFileSize:e(Ns))(ie.size)),1)])]))),128))])])):me("",!0),((G=v(I))==null?void 0:G.length)>0?(p(),B("div",ly,[z("div",ay,[(p(!0),B(en,null,ho(v(I),(ie,H)=>(p(),B("div",{key:ie.url||ie.title,class:"border-1 border-gray-200 rounded-md bg-white w-full"},[z("div",iy,[z("div",ry,[("isImage"in _?_.isImage:e(Ls))(ie.title,ie.mimetype??ie.type)?(p(),X(S,{key:0,alt:ie.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(r)(ie,"small")},null,8,["alt","srcs"])):(p(),B("div",sy,[ue(x,{item:ie,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",uy,se(ie.title),1),z("span",dy,se(("getReadableFileSize"in _?_.getReadableFileSize:e(Ns))(ie.size)),1)])]))),128))])])):me("",!0)],64)):((ae=e(i)[I])==null?void 0:ae.type)==="SingleLineText"?(p(!0),B(en,{key:1},ho(("diffTextBlocks"in _?_.diffTextBlocks:e(os))(e(l)[I]||"",e(a)[I]||""),(ie,H)=>(p(),B(en,{key:H},[ie.op==="removed"?(p(),B("span",cy,se(ie.text),1)):ie.op==="added"?(p(),B("span",fy,se(ie.text),1)):(p(),B("span",vy,se(ie.text),1))],64))),128)):((ve=e(i)[I])==null?void 0:ve.type)==="LongText"?(p(),B("div",py,[(p(!0),B(en,null,ho(("diffTextBlocks"in _?_.diffTextBlocks:e(os))(((xe=e(i)[I])==null?void 0:xe.type)==="LongText"&&((he=(ne=e(i)[I])==null?void 0:ne.options)!=null&&he.ai)?((W=e(l)[I])==null?void 0:W.value)||"":e(l)[I]||"",((j=e(i)[I])==null?void 0:j.type)==="LongText"&&((Ye=(Ee=e(i)[I])==null?void 0:Ee.options)!=null&&Ye.ai)?((Ge=e(a)[I])==null?void 0:Ge.value)||"":e(a)[I]||""),(ie,H)=>{var Ae,Ie,ce;return p(),B(en,{key:H},[ie.op==="removed"?(p(),B("span",{key:0,class:Dt(["max-w-full text-red-700 px-1 bg-red-50 rounded-md line-through decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ae=e(i)[I])==null?void 0:Ae.type)==="LongText"}])},se(ie.text),3)):ie.op==="added"?(p(),B("span",{key:1,class:Dt(["max-w-full text-green-700 px-1 bg-green-50 rounded-md decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ie=e(i)[I])==null?void 0:Ie.type)==="LongText"}])},se(ie.text),3)):(p(),B("span",{key:2,class:Dt(["max-w-full !leading-[18px]",{"whitespace-pre-wrap":((ce=e(i)[I])==null?void 0:ce.type)==="LongText"}])},se(ie.text),3))],64)}),128))])):((ke=e(i)[I])==null?void 0:ke.type)==="JSON"?(p(),B(en,{key:3},[z("div",hy,[b(f(I))?(p(),B("pre",my,se(f(I)),1)):me("",!0)]),z("div",gy,[b(v(I))?(p(),B("pre",wy,se(v(I)),1)):me("",!0)])],64)):(p(),B(en,{key:4},[b(f(I))?(p(),B("div",{key:0,"data-label":f(I),class:Dt(["max-w-full nc-expressive-mini-item-cell nc-audit-removal !text-red-700 border-1 border-red-200 rounded-md bg-red-50 line-through",{"px-1 py-0":h(I),"!px-0.25 !py-0.25":y(I)}])},[ue($,{column:{uidt:(Y=e(i)[I])==null?void 0:Y.type,dt:((we=e(i)[I])==null?void 0:we.type)==="Number"?"bigint":void 0,meta:c(I),colOptions:d(I)},"model-value":f(I),"edit-enabled":!1,"read-only":!0,class:Dt(["!text-red-700",{"min-w-[100px]":c(I).is_progress}])},null,8,["column","model-value","class"])],10,yy)):me("",!0),b(v(I))?(p(),B("div",{key:1,"data-label":v(I),class:Dt(["max-w-full nc-expressive-mini-item-cell nc-audit-addition border-1 border-green-200 rounded-md bg-green-50",{"px-1 py-0":h(I),"!px-0.25 !py-0.25":y(I)}])},[ue($,{column:{uidt:(oe=e(i)[I])==null?void 0:oe.type,dt:((ye=e(i)[I])==null?void 0:ye.type)==="Number"?"bigint":void 0,meta:c(I),colOptions:d(I)},"model-value":v(I),"edit-enabled":!1,"read-only":!0,class:Dt(["!text-green-700",{"min-w-[100px]":c(I).is_progress}])},null,8,["column","model-value","class"])],10,by)):me("",!0)],64))])])])}),128)}}}),xy=Object.assign(Ol(_y,[["__scopeId","data-v-68555e17"]]),{__name:"SmartsheetExpandedFormPresentorsDiscussionAuditInfoExpressive"}),ky={class:"py-4 ml-15.8 border-l border-gray-300"},Cy={class:"flex items-center h-[32px] gap-2 mb-2"},Ry={class:"w-[28px] h-[28px] bg-white flex items-center justify-center bg-white rounded-full border border-1 !border-gray-200 shadow-sm -ml-3.5"},Sy={class:"text-small1 mb-0"},Iy={class:"font-weight-700"},Fy={key:0,class:"font-weight-500 text-gray-600"},Ay={key:1,class:"font-weight-500 text-gray-600"},Ey={key:2,class:"font-weight-500 text-gray-600"},My={class:"text-xs font-weight-500 text-gray-500"},Ty={key:0,class:"relative mb-2"},$y={key:2,class:"relative mb-2"},Oy={class:"text-sm ml-6.5 inline-flex items-center flex-wrap gap-1"},Dy={class:"rounded-md px-1 !h-[20px] inline-flex items-center gap-1 text-nc-content-gray-emphasis border-1 border-nc-border-gray-medium"},Ly={class:"text-small1 font-weight-500"},Ny={key:0,class:"flex gap-1 flex-wrap"},Py={class:"!text-small p-0.5 font-weight-500 border-1 border-red-200 rounded-md bg-red-50 inline-flex items-center gap-1"},By={key:1,class:"flex gap-1 flex-wrap"},Wy={class:"!text-small1 p-0.5 font-weight-500 border-1 border-green-200 rounded-md bg-green-50 inline-flex items-center gap-1"},zy=ko({__name:"EntryAudit",props:{auditGroup:{}},setup(t){const n=t,{user:o}=nl(),l=le(()=>{try{return Object.keys(JSON.parse(n.auditGroup.audit.details||"").data).length}catch{return"-"}});function a(s,r){try{return JSON.parse(s.details||"")[r]}catch{return"-"}}const i=le(()=>{var s,r;return n.auditGroup.user===((s=o.value)==null?void 0:s.email)?"You":(r=n.auditGroup.displayName)!=null&&r.trim()?n.auditGroup.displayName.trim()||"Shared source":n.auditGroup.displayName?n.auditGroup.displayName:"Shared source"});return(s,r)=>{var y,b,_,m,g,C,w,S,x;const d=$l,c=Gu,f=Aa,v=xy,h=xf;return p(),B("div",ky,[z("div",Cy,[z("div",Ry,[ue(d,{icon:"ncPenLine",class:"w-[16px] h-[16px] text-gray-500"})]),ue(c,{user:{email:n.auditGroup.user,display_name:n.auditGroup.displayName,meta:(y=n.auditGroup.audit)==null?void 0:y.created_by_meta},class:"w-[24px] aspect-square"},null,8,["user"]),z("p",Sy,[z("span",Iy,se(e(i)),1),((b=n.auditGroup.audit)==null?void 0:b.op_type)==="DATA_INSERT"?(p(),B("span",Fy," created a record. ")):((_=n.auditGroup.audit)==null?void 0:_.op_type)==="DATA_UPDATE"?(p(),B("span",Ay," updated "+se(e(l))+" fields ",1)):((m=n.auditGroup.audit)==null?void 0:m.op_type)==="DATA_LINK"?(p(),B("span",Ey," updated 1 field ")):me("",!0)]),z("div",My,[ue(f,null,{title:J(()=>{var $;return[tt(se(("parseStringDateTime"in s?s.parseStringDateTime:e(Hu))(($=n.auditGroup.audit)==null?void 0:$.created_at)),1)]}),default:J(()=>{var $;return[tt(" "+se(("timeAgo"in s?s.timeAgo:e(Ms))(($=n.auditGroup.audit)==null?void 0:$.created_at)),1)]}),_:1})])]),((g=n.auditGroup.audit)==null?void 0:g.op_type)==="DATA_INSERT"?(p(),B("div",Ty,[ue(d,{icon:"ncNode",class:"w-[16px] h-[16px] text-gray-500 bg-white absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-1/2"}),r[0]||(r[0]=z("p",{class:"text-sm font-weight-500 mb-1 ml-6.5"},"Record was created.",-1))])):((C=n.auditGroup.audit)==null?void 0:C.op_type)==="DATA_UPDATE"?(p(),X(v,{key:1,audit:n.auditGroup.audit},null,8,["audit"])):["DATA_LINK","DATA_UNLINK"].includes((w=n.auditGroup.audit)==null?void 0:w.op_type)?(p(),B("div",$y,[ue(d,{icon:"ncNode",class:"w-[16px] h-[16px] text-gray-500 bg-white absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-1/2"}),z("div",Oy,[r[1]||(r[1]=z("span",{class:"text-small1 text-gray-600 font-weight-500"}," changed ",-1)),z("span",Dy,[ue(h,{"column-meta":{uidt:"Links",colOptions:{type:a(n.auditGroup.audit,"type")}},class:"!w-[16px] !h-[16px] !m-0"},null,8,["column-meta"]),z("span",Ly,se(a(n.auditGroup.audit,"link_field_title")),1)]),((S=a(n.auditGroup.audit,"consolidated_ref_display_values_unlinks"))==null?void 0:S.length)>0?(p(),B("div",Ny,[z("span",Py,[(p(!0),B(en,null,ho(a(n.auditGroup.audit,"consolidated_ref_display_values_unlinks"),$=>(p(),B("span",{key:$.refRowId,class:"text-brand-500 font-weight-500 line-through px-1 bg-[#F0F3FF] !rounded-md"},se($.value),1))),128))])])):me("",!0),((x=a(n.auditGroup.audit,"consolidated_ref_display_values_links"))==null?void 0:x.length)>0?(p(),B("div",By,[z("span",Wy,[(p(!0),B(en,null,ho(a(n.auditGroup.audit,"consolidated_ref_display_values_links"),$=>(p(),B("span",{key:$.refRowId,class:"text-brand-500 font-weight-500 px-1 bg-[#F0F3FF] !rounded-md"},se($.value),1))),128))])])):me("",!0)])])):me("",!0)])}}}),Vy=Object.assign(zy,{__name:"SmartsheetExpandedFormPresentorsDiscussionEntryAudit"}),jy={class:"relative my-4 nc-audit-comment-block"},Uy={class:"absolute left-0"},Gy={class:"text-xs text-gray-500"},Hy={key:0,class:"flex items-center gap-2"},Yy={class:"flex gap-2 items-center"},qy={class:"flex gap-2 items-center"},Xy=ko({__name:"EntryComment",props:{comment:{}},setup(t){const n=t,{user:o}=nl(),{copy:l}=qs(),{dashboardUrl:a}=iv(),i=vs(),s=fn(Ai,V()),{loadComments:r,resolveComment:d,updateComment:c,deleteComment:f,primaryKey:v}=sm(),{isUIAllowed:h}=gl(),y=le(()=>h("commentEdit")),b=E=>{var M,U;return E.created_by===((M=o.value)==null?void 0:M.id)?"You":(U=E.created_display_name)!=null&&U.trim()?E.created_display_name||"Shared source":E.created_by_email?E.created_by_email:"Shared source"},_=le(()=>b(n.comment)==="You"),m=E=>E.updated_at!==E.created_at&&E.updated_at?`[(edited)](a~~~###~~~Edited_${Ms(E.updated_at).replace(" ","_")}) `:"",g=V(!1),C=V();function w(E){C.value={...E},g.value=!0}function S(E){g.value&&(E.preventDefault(),E.stopPropagation(),C.value=void 0,r(),g.value=!1,C.value=void 0)}const x=le({get(){var E;return((E=C.value)==null?void 0:E.comment)||""},set(E){C.value&&(C.value.comment=E)}});async function $(){var M;if(!g.value||!((M=C.value)!=null&&M.comment))return;for(;C.value.comment.endsWith("<br />")||C.value.comment.endsWith(`
`);)C.value.comment.endsWith("<br />")?C.value.comment=C.value.comment.slice(0,-6):C.value.comment=C.value.comment.slice(0,-2);const E={...C.value};g.value=!1,C.value=void 0,await c(E.id,{comment:E.comment}),r()}function I(){g.value=!1,C.value=void 0}async function F(E){var M;await l(encodeURI(`${a==null?void 0:a.value}#/${i.params.typeOrId}/${i.params.baseId}/${(M=s.value)==null?void 0:M.id}?rowId=${v.value}&commentId=${E.id}`))}return(E,M)=>{var Ee;const U=Gu,L=Aa,G=$l,ae=ca,ve=Ya,xe=br,ne=qa,he=Gi,W=av,j=Yl("e");return p(),B("div",jy,[z("div",Uy,[ue(U,{user:{email:n.comment.user,display_name:n.comment.displayName,meta:n.comment.created_by_meta},size:"base",class:"w-[36px] h-[36px] !aspect-square !text-small"},null,8,["user"])]),z("div",{class:Dt(["flex-1 bg-white rounded-lg border-1 group ml-11.5",{"border-brand-200":e(_),"border-gray-200":!e(_)}])},[z("div",{class:Dt(["flex items-center gap-2 bg-nc-bg-gray-extralight px-4 py-1 border-b rounded-t-lg text-nc-content-gray min-h-[37px]",{"!bg-[#F0F3FF] border-brand-200":e(_),"border-gray-200":!e(_)}])},[z("span",{class:Dt(["font-medium text-sm",{"text-brand-600":e(_)}])},se(b(n.comment)),3),z("span",Gy,[ue(L,null,{title:J(()=>[tt(se(("parseStringDateTime"in E?E.parseStringDateTime:e(Hu))(n.comment.created_at)),1)]),default:J(()=>[tt(" "+se(("timeAgo"in E?E.timeAgo:e(Ms))(n.comment.created_at)),1)]),_:1})]),M[8]||(M[8]=z("div",{class:"flex-1"},null,-1)),e(C)?me("",!0):(p(),B("div",Hy,[e(o)&&n.comment.created_by_email===e(o).email&&e(y)?(p(),X(L,{key:0,class:"opacity-0 transition !duration-150 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto"},{title:J(()=>M[6]||(M[6]=[tt("Click to edit")])),default:J(()=>[ue(ae,{class:"!w-7 !h-7 !bg-transparent !hover:bg-gray-200",size:"xsmall",type:"text",onClick:M[0]||(M[0]=Ye=>w(n.comment))},{default:J(()=>[ue(G,{class:"text-md",icon:"pencil"})]),_:1})]),_:1})):me("",!0),e(C)?me("",!0):(p(),X(he,{key:1,class:"opacity-0 transition !duration-150 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto","overlay-class-name":"!min-w-[160px]",placement:"bottomRight"},{overlay:J(()=>[ue(ne,{variant:"small"},{default:J(()=>[Nt((p(),X(ve,{onClick:M[1]||(M[1]=Ye=>F(n.comment))},{default:J(()=>[z("div",Yy,[(p(),X(po(("iconMap"in E?E.iconMap:e(Bo)).copy),{class:"cursor-pointer"})),tt(" "+se(E.$t("general.copy"))+" URL ",1)])]),_:1})),[[j,["c:comment-expand:comment:copy"]]]),e(o)&&n.comment.created_by_email===e(o).email&&e(y)?(p(),B(en,{key:0},[ue(xe),Nt((p(),X(ve,{class:"!text-red-500 !hover:bg-red-50",onClick:M[2]||(M[2]=Ye=>e(f)(n.comment.id))},{default:J(()=>[z("div",qy,[(p(),X(po(("iconMap"in E?E.iconMap:e(Bo)).delete),{class:"cursor-pointer"})),tt(" "+se(E.$t("general.delete")),1)])]),_:1})),[[j,["c:row-expand:comment:delete"]]])],64)):me("",!0)]),_:1})]),default:J(()=>[ue(ae,{class:"!w-7 !h-7 !bg-transparent !hover:bg-gray-200",size:"xsmall",type:"text"},{default:J(()=>[ue(G,{class:"text-md",icon:"threeDotVertical"})]),_:1})]),_:1})),!n.comment.resolved_by&&e(y)?(p(),X(L,{key:2,class:"opacity-0 transition !duration-150 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto"},{title:J(()=>M[7]||(M[7]=[tt("Click to resolve")])),default:J(()=>[ue(ae,{class:"!w-7 !h-7 !bg-transparent !hover:bg-gray-200",size:"xsmall",type:"text",onClick:M[3]||(M[3]=Ye=>e(d)(n.comment.id))},{default:J(()=>[ue(G,{class:"text-md",icon:"checkCircle"})]),_:1})]),_:1})):n.comment.resolved_by?(p(),X(L,{key:3},{title:J(()=>[tt(se(`Resolved by ${n.comment.resolved_display_name}`),1)]),default:J(()=>[ue(ae,{class:"!h-7 !w-7 !bg-transparent !hover:bg-gray-200 text-semibold",size:"xsmall",type:"text",onClick:M[4]||(M[4]=Ye=>e(d)(n.comment.id))},{default:J(()=>[ue(G,{class:"text-md rounded-full bg-[#17803D] text-white",icon:"checkFill"})]),_:1})]),_:1})):me("",!0)]))],2),n.comment.id===((Ee=e(C))==null?void 0:Ee.id)&&e(y)?(p(),X(W,{key:0,value:e(x),"onUpdate:value":M[5]||(M[5]=Ye=>bo(x)?x.value=Ye:null),autofocus:"","autofocus-to-end":"","hide-options":!1,class:"cursor-text expanded-form-comment-input !py-3 !px-4 !pr-3 !m-0 w-full !border-1 !border-gray-200 !rounded-lg !bg-white !text-gray-800 !text-small !leading-18px !max-h-[240px]","data-testid":"expanded-form-comment-input","sync-value-change":"",onSave:$,onKeydown:[ls(S,["esc"]),ls(ro($,["exact","prevent"]),["enter"])],onBlur:I},null,8,["value","onKeydown"])):(p(),X(W,{key:1,value:`${n.comment.comment}  ${m(n.comment)}`,class:"!text-small !leading-18px !text-gray-800 px-4 py-3","read-only":"","sync-value-change":""},null,8,["value"]))],2)])}}}),Ky=Object.assign(Ol(Xy,[["__scopeId","data-v-64710d39"]]),{__name:"SmartsheetExpandedFormPresentorsDiscussionEntryComment"}),Jy={class:"h-full flex flex-row nc-discussion-mode-container"},Qy={key:0,class:"w-[680px] max-w-full fflex-grow-0 flex-shrink-0 flex flex-col px-6 2xl:px-0"},Zy={class:"w-full h-15 flex-grow-0 flex-shrink-0 ml-15.8 border-l-1 border-gray-300 relative"},e0={class:"w-[680px] max-w-full pb-4"},t0={key:0,class:"w-full border-t border-gray-200 px-6 2xl:px-0 sticky bottom-0 pb-4 -mb-4 bg-white z-10"},n0={key:1,class:"w-full px-6 2xl:px-0"},o0={name:"ExpandedFormPresentorsDiscussion"},l0=ko({...o0,props:{isUnsavedDuplicatedRecordExist:{type:Boolean}},setup(t){const o=Bn(t,"isUnsavedDuplicatedRecordExist"),{saveComment:l,commentsDrawer:a,isNew:i,audits:s,comments:r,auditCommentGroups:d,hasMoreAudits:c,loadMoreAudits:f}=Ei(),{isUIAllowed:v}=gl(),{isExpandedFormCommentMode:h}=Go(Sr()),y=le(()=>!i.value&&a.value&&v("commentList"));ti(()=>{$()});const b=Zd("refAuditsEnd"),_=Zd("refRichComment"),m=V(""),g=V(!1);function C(){var I;l(m.value),m.value="",(I=_==null?void 0:_.value)==null||I.setEditorContent("",!0)}function w(){g.value=!0,f()}const S=le(()=>s.value.length),x=le(()=>r.value.length);Hn([m,S,x],()=>{$()});function $(){setTimeout(()=>{var I;if(g.value){g.value=!1;return}(I=b.value)==null||I.scrollIntoView({behavior:"smooth"})},200)}return(I,F)=>{const E=ca,M=Vy,U=Ky,L=av,G=cv;return p(),B("div",Jy,[z("div",{class:Dt(["relative h-full overflow-y-auto nc-scrollbar-thin flex flex-col items-center justify-start overflow-x-hidden",{"w-full":!e(y),"flex-1":e(y)}])},[F[8]||(F[8]=z("div",{class:"w-[680px] max-w-full flex-grow flex flex-col px-6 2xl:px-0"},[z("div",{class:"w-full h-0 flex-grow ml-15.8 border-l-1 border-gray-300"})],-1)),e(c)?(p(),B("div",Qy,[z("div",Zy,[ue(E,{size:"small",type:"secondary",class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",onClick:F[0]||(F[0]=ae=>w())},{default:J(()=>F[5]||(F[5]=[tt(" Load more ")])),_:1,__:[5]})])])):me("",!0),z("div",e0,[(p(!0),B(en,null,ho(e(d),ae=>(p(),B("div",{key:ae.created_at,class:"w-full px-6 2xl:px-0"},[ae.type==="audit"?(p(),X(M,{key:0,"audit-group":ae},null,8,["audit-group"])):(p(),X(U,{key:1,comment:ae},null,8,["comment"]))]))),128)),e(v)("commentEdit")?(p(),B("div",t0,[F[6]||(F[6]=z("div",{class:"font-bold my-3"},"Add a comment",-1)),ue(L,{ref_key:"refRichComment",ref:_,value:e(m),"onUpdate:value":[F[1]||(F[1]=ae=>bo(m)?m.value=ae:null),F[3]||(F[3]=ae=>$())],"hide-options":!1,placeholder:"Comment...",class:"expanded-form-comment-input !py-2 !px-2 cursor-text border-1 rounded-lg !text-gray-800 !text-small !leading-18px !max-h-[240px] bg-white !w-auto","data-testid":"expanded-form-comment-input",autofocus:e(h),onFocus:F[2]||(F[2]=ae=>h.value=!1),onKeydown:[F[4]||(F[4]=ro(()=>{},["stop"])),ls(ro(C,["exact","prevent"]),["enter"])],onSave:C},null,8,["value","autofocus","onKeydown"])])):(p(),B("div",n0,F[7]||(F[7]=[z("div",{class:"w-full h-4 flex-grow ml-15.8 -mb-4 border-l-1 border-gray-300"},null,-1)]))),z("div",{ref_key:"refAuditsEnd",ref:b},null,512)])],2),e(y)&&!e(o)?(p(),B("div",{key:0,class:Dt(["nc-comments-drawer border-l-1 relative border-gray-200 bg-white w-1/3 max-w-[400px] min-w-0 h-full xs:hidden rounded-br-2xl",{active:e(a)&&e(v)("commentList")}])},[ue(G)],2)):me("",!0)])}}}),a0=Object.assign(Ol(l0,[["__scopeId","data-v-06e6e9e6"]]),{__name:"SmartsheetExpandedFormPresentorsDiscussion"}),i0=Co(()=>Ro(()=>import("./DRQrXP7Q.js"),__vite__mapDeps([42,1,2,22,43]),import.meta.url).then(t=>t.default||t)),r0={class:"h-[85vh] xs:max-h-full xs:h-full max-h-215 flex flex-col"},s0={key:0,class:"flex-none h-4 flex items-center justify-center"},u0={class:"flex gap-2 min-h-7 flex-shrink-0 w-full items-center nc-expanded-form-header p-4 xs:px-2 xs:py-0 xs:min-h-[48px] border-b-1 border-gray-200"},d0={class:"flex gap-2 min-w-0 min-h-8"},c0={class:"flex gap-2"},f0={key:0,class:"flex items-center"},v0={key:1,class:"flex-1 flex items-center gap-2 xs:flex-row-reverse xs:justify-end min-w-0"},p0={key:0,class:"hidden md:flex items-center rounded-lg bg-gray-100 px-2 py-1 gap-2"},h0={class:"nc-expanded-form-table-name whitespace-nowrap"},m0={key:1,class:"flex items-center truncate font-bold text-gray-800 text-xl overflow-hidden"},g0={key:2,class:"flex items-center font-bold text-gray-800 text-2xl overflow-hidden"},w0={class:"min-w-[120px] md:min-w-[300px]"},y0={class:"ml-auto"},b0={class:"flex gap-2"},_0={class:"xs:px-1"},x0={"data-testid":"nc-expanded-form-copy-url",class:"flex items-center relative h-4 w-4"},k0={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},C0={"data-testid":"nc-expanded-form-copy-url",class:"flex gap-2 items-center"},R0={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-duplicate"},S0={class:"-ml-0.25"},I0={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-delete"},F0={class:"-ml-0.25"},A0={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700"},E0={class:"text-ellipsis overflow-hidden select-none w-full pl-1.75 break-keep whitespace-nowrap"},M0={class:""},T0={class:"flex flex-row items-center gap-x-2 text-base font-bold"},$0={class:"flex font-medium mt-2"},O0={class:"flex flex-row justify-end gap-x-2 mt-5"},D0={name:"ExpandedForm"},L0=ko({...D0,props:{modelValue:{type:Boolean},state:{},meta:{},loadRow:{type:Boolean},useMetaFields:{type:Boolean},row:{},rowId:{},view:{},showNextPrevIcons:{type:Boolean},firstRow:{type:Boolean},lastRow:{type:Boolean},closeAfterSave:{type:Boolean},newRecordHeader:{},skipReload:{type:Boolean},newRecordSubmitBtnText:{},expandForm:{type:Function},maintainDefaultViewOrder:{type:Boolean}},emits:["update:modelValue","cancel","next","prev","createdRecord","deletedRecord","updateRowCommentCount"],setup(t,{expose:n,emit:o}){var K;const l=t,a=o,i=wr(),{activeView:s}=Go(i),r=V(0),d=V(),{dashboardUrl:c}=iv(),{copy:f}=qs(),{isMobileMode:v}=nl(),{t:h}=oa(),{rowId:y,row:b,state:_,meta:m,lastRow:g,firstRow:C,maintainDefaultViewOrder:w}=_r(l),S=vs(),x=fs(),$=V(!1),I=V(!1),F=V(!1),{isUIAllowed:E}=gl(),M=V(),U=fn(ir,Uo()),L=fn(Ea,Uo()),{addOrEditStackRow:G}=ov(),{isExpandedFormCommentMode:ae}=Go(Sr()),{showRecordPlanLimitExceededModal:ve}=ql(),{withLoading:xe}=ps();yo(Yu,void 0);const ne=fn(fp,V(!1)),he=fn(zl,V(!1));yo(Ai,m),yo(Rf,void 0);const W=V(!0),j=V(!1),Ee=Gm(m,b,w,!!l.useMetaFields),{commentsDrawer:Ye,changedColumns:Ge,deleteRowById:ke,displayValue:Y,state:we,isNew:oe,loadRow:ye,primaryKey:ie,row:H,comments:Ae,save:Ie,loadComments:ce,loadAudits:te,clearColumns:Le,baseRoles:Ne,fields:lt,hiddenFields:je,isAllowedAddNewRecord:He}=Ee,Q=O=>{a(O),W.value=!0},Mt=le(()=>{var O;return(O=m.value)==null?void 0:O.title}),_e=V(!he.value&&Bi?((K=l.view)==null?void 0:K.expanded_record_mode)??xl.FIELD:xl.FIELD);Hn(_e,async O=>{var ge,ee,Me;const Z=(ge=l.view)==null?void 0:ge.id;if(Z){if(O===xl.FIELD||O===xl.DISCUSSION)await i.setCurrentViewExpandedFormMode(Z,O);else if(O===xl.ATTACHMENT){const We=(ee=lt.value)==null?void 0:ee.find(Xe=>Xe.uidt==="Attachment");await i.setCurrentViewExpandedFormMode(Z,O,((Me=l.view)==null?void 0:Me.attachment_mode_column_id)??(We==null?void 0:We.id))}}});const wn=le(()=>{var O,Z;return((Z=(O=m.value)==null?void 0:O.columns)==null?void 0:Z.find(ge=>{var ee;return ge.pv&&((ee=lt.value)==null?void 0:ee.includes(ge))}))??null});L.on(xe(async O=>{var ge;if(O!=null&&O.skipLoadingRowId&&(O==null?void 0:O.skipLoadingRowId)===ie.value)return;(O==null?void 0:O.relatedTableMetaId)&&(O==null?void 0:O.rowId)&&(O==null?void 0:O.relatedTableMetaId)===((ge=m.value)==null?void 0:ge.id)&&(O==null?void 0:O.rowId)===y.value?await ye(y.value):O!=null&&O.relatedTableMetaId&&(O!=null&&O.rowId)?await ye(y.value,!0):await ye(y.value,!1,!0)}));const It=V(!1),{isSqlView:Tt}=im(V({}),m);xm(m),Hn(_,()=>{_.value?we.value=_.value:we.value={}},{immediate:!0});const Je=Ra(l,"modelValue",a,{defaultValue:!1}),cn=(O=!1)=>{var Z,ge;O?Je.value=!1:E("dataEdit",Ne.value)?Ge.value.size>0?mt.value=!0:((ge=(Z=H.value)==null?void 0:Z.rowMeta)!=null&&ge.new&&a("cancel"),Je.value=!1):Je.value=!1},Pn=()=>{if(ve())return;It.value=!0,$.value=!0,I.value=!0;const O={...H.value.row};delete O.ncRecordId;const Z=Object.assign({},{row:O,oldRow:{},rowMeta:{new:!0}});setTimeout(async()=>{H.value=Z,It.value=!1,tn.success(h("msg.success.rowDuplicatedWithoutSavedYet"))},500)},Et=async()=>{var O,Z;j.value=!0;try{let ge;((O=s.value)==null?void 0:O.type)===Ul.KANBAN&&(ge=(ee,Me)=>{G(ee,Me)}),oe.value?await Ie(we.value,void 0,{kanbanClbk:ge}):(await Ie(void 0,void 0,{kanbanClbk:ge}),await ye()),l.skipReload||(await(U==null?void 0:U.trigger()),await(L==null?void 0:L.trigger())),$.value=!1,l.closeAfterSave?Je.value=!1:I.value&&(qt(H.value.row,m.value.columns)!==y.value&&((Z=l==null?void 0:l.expandForm)==null||Z.call(l,H.value)),setTimeout(()=>{I.value=!1},500)),a("createdRecord",H.value.row)}catch(ge){oe.value?tn.error(`Add row failed: ${await pl(ge)}`):tn.error(`${h("msg.error.rowUpdateFailed")}: ${await pl(ge)}`)}j.value=!1},Rn=V(!1),mt=V(!1),ot=V(void 0),gt=()=>{var O,Z,ge,ee;Rn.value&&(Q("next"),(Z=(O=H.value)==null?void 0:O.rowMeta)!=null&&Z.new&&a("cancel"),Rn.value=!1),mt.value&&(mt.value=!1,(ee=(ge=H.value)==null?void 0:ge.rowMeta)!=null&&ee.new&&a("cancel"),Je.value=!1),Le()},zt=async()=>{if(Ge.value.size>0){Rn.value=!0,ot.value="next";return}Q("next")},Ht=async()=>{if(Ge.value.size>0){Rn.value=!0,ot.value="prev";return}Q("prev")},Yt=async()=>{var Z,ge,ee;const O=`${c==null?void 0:c.value}#/${S.params.typeOrId}/${S.params.baseId}/${(Z=m.value)==null?void 0:Z.id}${l.view?`/${l.view.id}`:""}?rowId=${ie.value}${(ge=S.query)!=null&&ge.path?`&path=${(ee=S.query)==null?void 0:ee.path}`:""}`;await f(encodeURI(O)),F.value=!0,await Cf(5e3),F.value=!1},Xt=async()=>{Rn.value&&($.value=!1,await Et(),ot.value?Q(ot.value):Q("next"),Rn.value=!1,ot.value=void 0),mt.value&&(mt.value=!1,await Et(),Je.value=!1)},un=fn(ir,Uo()),bt=Uo();if(bt.on(()=>{un==null||un.trigger({shouldShowLoading:!1}),!oe.value&&(ye(void 0,!0),te(y.value,!1))}),yo(ir,bt),ne.value&&H.value.rowMeta.new)for(const[O,Z]of Object.entries(H.value.row))Z&&Ge.value.add(O);yo(mp,Je);const xt=async O=>{await Promise.allSettled([ce(O,!1),ye(O)]),W.value=!1},ct=V();ti(async()=>{F.value=!1,W.value=!0;const O=!ae.value;let Z=!1;l.loadRow&&!l.rowId?(await xt(),Z=!0):l.rowId&&l.loadRow&&!Z?await xt(l.rowId):H.value=l.row,_e.value===xl.DISCUSSION&&await te(y.value,!1),W.value=!1,O&&oe.value&&setTimeout(()=>{var ge,ee,Me;(Me=(ee=(ge=ct.value)==null?void 0:ge.$el)==null?void 0:ee.querySelector("input,select,textarea"))==null||Me.focus()},300)});const ft=()=>{if(!He.value){tn.toast(h("objects.permissions.addNewRecordTooltip"));return}setTimeout(async()=>{H.value={row:{},oldRow:{},rowMeta:{new:!0}},we.value={},r.value++,Je.value=!0},500)};rd(Je,async O=>{var Z,ge,ee;if(!(!O.altKey||oe.value||!l.showNextPrevIcons||pp(O)||hp()))if(O.key==="ArrowLeft"){if(O.stopPropagation(),C.value)return;Q("prev")}else if(O.key==="ArrowRight"){if(O.stopPropagation(),g.value)return;zt()}else if(O.code==="KeyS"){if((Z=document.activeElement)==null||Z.blur(),O.stopPropagation(),!He.value&&oe.value){tn.toast(h("objects.permissions.addNewRecordTooltip"));return}try{oe.value?(await Ie(we.value),bt==null||bt.trigger(null)):(await Et(),bt==null||bt.trigger(null))}catch(Me){oe.value?tn.error(`Add row failed: ${await pl(Me)}`):tn.error(`${h("msg.error.rowUpdateFailed")}: ${await pl(Me)}`)}}else O.code==="KeyN"&&((ee=(ge=document.activeElement)==null?void 0:ge.blur)==null||ee.call(ge),Ge.value.size>0?ec.confirm({title:h("msg.saveChanges"),okText:h("general.save"),cancelText:h("labels.discard"),onOk:async()=>{await Et(),bt==null||bt.trigger(null),ft()},onCancel:()=>{ft()}}):oe.value?ec.confirm({title:"Do you want to save the record?",okText:h("general.save"),cancelText:h("labels.discard"),onOk:async()=>{try{await Ie(we.value),bt==null||bt.trigger(null),ft()}catch(Me){tn.error(`${h("msg.error.rowUpdateFailed")}: ${await pl(Me)}`)}},onCancel:()=>{ft()}}):ft())},{immediate:!0,isGridCell:!1});const Be=V(!1),at=()=>{Be.value=!0},kt=async()=>{await ke(ie.value||void 0),a("deletedRecord"),tn.success(h("msg.rowDeleted")),Be.value=!1,cn(!0),await L.trigger({shouldShowLoading:!1,skipLoadingRowId:ie.value||void 0})};Hn(y,async O=>{await xt(O)});const st=le({get:()=>mt.value||Rn.value,set:O=>{mt.value=O}}),qe=O=>{let Z=!1;document.querySelectorAll(".ant-select-dropdown").forEach(ge=>{Z=Z||ge.checkVisibility()}),!Z&&(Ge.value.size===0&&!$.value?(Je.value=O,ne.value&&a("cancel")):!O&&E("dataEdit",Ne.value)?st.value=!0:Je.value=O)},u=V("");Hn([M,W],()=>{if(v.value)return;const O=M.value;O&&!W.value&&(O.scrollTop=O.scrollHeight,setTimeout(()=>{tl(()=>{const Z=x.currentRoute.value.query,ge=Z.columnId;ge?(x.push({query:{rowId:Z.rowId}}),u.value=ge,D(ge),Xs(document.querySelector(`[col-id="${ge}"]`),()=>{u.value=null})):O.scrollTop=0})},125))});const R=le(()=>v.value?{placement:"bottom"}:{}),P=le(()=>{var O,Z,ge,ee;return oe.value&&((Z=(O=b.value)==null?void 0:O.rowMeta)==null?void 0:Z.ltarState)&&Object.keys((ee=(ge=b.value)==null?void 0:ge.rowMeta)==null?void 0:ee.ltarState).length>0});Hn(()=>Ae.value.length,O=>{a("updateRowCommentCount",O)});function D(O){const Z=document.querySelector(`.${O}`);Z&&Z.scrollIntoView({behavior:"smooth",block:"center"})}return n({stopLoading:()=>{tl(()=>{W.value=!1})}}),(O,Z)=>{const ge=$l,ee=ca,Me=Aa,We=lv,Xe=i0,nt=Jm,et=Rr,ut=Ya,Ke=br,Qe=qa,ht=Gi,Vt=Vw,Pe=Gw,Se=a0,$t=_m,be=Yl("e");return p(),B(en,null,[(p(),X(po(e(v)?e(vp):Ts),lr({"body-style":{padding:0},class:[{active:e(Je)},"nc-drawer-expanded-form"],closable:!1,footer:null,visible:e(Je),width:e(Ye)&&e(E)("commentList",e(Ne))?"min(80vw,1280px)":"min(70vw,768px)",size:e(v)?"medium":"small"},e(R),{"onUpdate:visible":qe}),{default:J(()=>{var ze,wt,q,Fe;return[z("div",r0,[e(v)?(p(),B("div",s0,[z("div",{class:"flex-none h-full flex items-center justify-center cursor-pointer",onClick:cn},Z[22]||(Z[22]=[z("div",{class:"w-[72px] h-[2px] rounded-full bg-[#49494a]"},null,-1)]))])):me("",!0),z("div",u0,[z("div",d0,[z("div",c0,[l.showNextPrevIcons?(p(),X(Me,{key:0,class:"flex items-center"},{title:J(()=>[tt(se(O.$t("labels.prevRow"))+" "+se(("renderAltOrOptlKey"in O?O.renderAltOrOptlKey:e(vu))())+" + ",1)]),default:J(()=>[ue(ee,{disabled:e(C)||e(W),class:"nc-prev-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:Ht},{default:J(()=>[ue(ge,{icon:"chevronDown",class:"transform rotate-180"})]),_:1},8,["disabled"])]),_:1})):me("",!0),l.showNextPrevIcons?(p(),X(Me,{key:1,class:"flex items-center"},{title:J(()=>[tt(se(O.$t("labels.nextRow"))+" "+se(("renderAltOrOptlKey"in O?O.renderAltOrOptlKey:e(vu))())+" + ",1)]),default:J(()=>[ue(ee,{disabled:e(g)||e(W),class:"nc-next-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:zt},{default:J(()=>[ue(ge,{icon:"chevronDown"})]),_:1},8,["disabled"])]),_:1})):me("",!0)]),e(W)?(p(),B("div",f0,[ue(We,{active:"",class:"!h-6 !sm:mr-14 !w-52 !rounded-md !overflow-hidden",size:"small"})])):(p(),B("div",v0,[l.showNextPrevIcons?me("",!0):(p(),B("div",p0,[ue(ge,{icon:"table",class:"text-gray-700 flex-none"}),z("span",h0,se(e(Mt)),1)])),(ze=e(b).rowMeta)!=null&&ze.new||l.newRecordHeader?(p(),B("div",m0,se(l.newRecordHeader??O.$t("activity.newRecord")),1)):e(Y)&&!((q=(wt=e(b))==null?void 0:wt.rowMeta)!=null&&q.new)?(p(),B("div",g0,[z("span",w0,[ue(Xe,{modelValue:e(Y),"onUpdate:modelValue":Z[0]||(Z[0]=vt=>bo(Y)?Y.value=vt:null),column:e(wn),"show-tooltip":""},null,8,["modelValue","column"])])])):me("",!0)]))]),z("div",y0,[ue(nt,{modelValue:e(_e),"onUpdate:modelValue":Z[1]||(Z[1]=vt=>bo(_e)?_e.value=vt:null),view:O.view,class:"nc-expanded-form-mode-switch"},null,8,["modelValue","view"])]),z("div",b0,[!e(v)&&e(E)("dataEdit",e(Ne))&&!e(Tt)?(p(),X(et,{key:0,entity:e(vl).TABLE,"entity-id":(Fe=e(m))==null?void 0:Fe.id,permission:e(fl).TABLE_RECORD_ADD,disabled:!e(oe),arrow:"","default-tooltip":`${("renderAltOrOptlKey"in O?O.renderAltOrOptlKey:e(vu))()} + S`},{default:J(({isAllowed:vt})=>[Nt((p(),X(ee,{disabled:!vt||e(Ge).size===0&&!e($)&&!e(P),loading:e(j),class:"nc-expand-form-save-btn !xs:text-base !h-7 !px-2","data-testid":"nc-expanded-form-save",type:"primary",size:"xsmall",onClick:Et},{default:J(()=>[z("div",_0,se(O.newRecordSubmitBtnText??O.$t("activity.saveRow")),1)]),_:2},1032,["disabled","loading"])),[[be,["c:row-expand:save"]]])]),_:1},8,["entity","entity-id","permission","disabled","default-tooltip"])):me("",!0),ue(Me,null,{title:J(()=>[tt(se(e(F)?O.$t("labels.copiedRecordURL"):O.$t("labels.copyRecordURL")),1)]),default:J(()=>[!e(oe)&&e(y)&&!e(v)?(p(),X(ee,{key:0,disabled:e(W),class:"!<lg:hidden text-gray-700 !h-7 !w-7",type:"text",size:"xsmall",onClick:Z[2]||(Z[2]=vt=>Yt())},{default:J(()=>[Nt((p(),B("div",x0,[ue(kf,{name:"icon-fade",duration:200},{default:J(()=>[e(F)?(p(),X(po(("iconMap"in O?O.iconMap:e(Bo)).check),{key:0,class:"cursor-pointer nc-duplicate-row h-4 w-4"})):(p(),X(po(("iconMap"in O?O.iconMap:e(Bo)).copy),{key:1,class:"cursor-pointer nc-duplicate-row h-4 w-4"}))]),_:1})])),[[be,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):me("",!0)]),_:1}),!e(oe)&&e(y)&&!e(v)?(p(),X(ht,{key:1,placement:"bottomRight"},{overlay:J(()=>[ue(Qe,{variant:"small"},{default:J(()=>{var vt,Re;return[ue(ut,{onClick:Z[3]||(Z[3]=yt=>e(ye)())},{default:J(()=>[Nt((p(),B("div",k0,[(p(),X(po(("iconMap"in O?O.iconMap:e(Bo)).reload),{class:"cursor-pointer"})),tt(" "+se(O.$t("general.reload"))+" "+se(O.$t("objects.record")),1)])),[[be,["c:row-expand:reload"]]])]),_:1}),!e(oe)&&e(y)?(p(),X(ut,{key:0,type:"secondary",class:"!lg:hidden",disabled:e(W),onClick:Z[4]||(Z[4]=yt=>Yt())},{default:J(()=>[Nt((p(),B("div",C0,[(p(),X(po(("iconMap"in O?O.iconMap:e(Bo)).copy),{class:"cursor-pointer"})),tt(" "+se(O.$t("labels.copyRecordURL")),1)])),[[be,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):me("",!0),e(E)("dataEdit",e(Ne))&&!e(Tt)?(p(),X(et,{key:1,entity:e(vl).TABLE,"entity-id":(vt=e(m))==null?void 0:vt.id,permission:e(fl).TABLE_RECORD_ADD,placement:"right"},{default:J(({isAllowed:yt})=>[ue(ut,{disabled:!yt,onClick:Z[5]||(Z[5]=_t=>e(oe)?()=>{}:Pn())},{default:J(()=>[Nt((p(),B("div",R0,[(p(),X(po(("iconMap"in O?O.iconMap:e(Bo)).duplicate),{class:"cursor-pointer nc-duplicate-row"})),z("span",S0,se(O.$t("labels.duplicateRecord")),1)])),[[be,["c:row-expand:duplicate"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):me("",!0),e(E)("dataEdit",{roles:e(Ne)})&&!e(Tt)?(p(),X(Ke,{key:2})):me("",!0),e(E)("dataEdit",e(Ne))&&!e(Tt)?(p(),X(et,{key:3,entity:e(vl).TABLE,"entity-id":(Re=e(m))==null?void 0:Re.id,permission:e(fl).TABLE_RECORD_DELETE,placement:"right"},{default:J(({isAllowed:yt})=>[ue(ut,{class:Dt({"!text-red-500 !hover:bg-red-50":yt}),disabled:!yt,onClick:Z[6]||(Z[6]=_t=>!e(oe)&&at())},{default:J(()=>[Nt((p(),B("div",I0,[(p(),X(po(("iconMap"in O?O.iconMap:e(Bo)).delete),{class:"cursor-pointer nc-delete-row"})),z("span",F0,se(O.$t("general.deleteEntity",{entity:O.$t("objects.record").toLowerCase()})),1)])),[[be,["c:row-expand:delete"]]])]),_:2},1032,["class","disabled"])]),_:1},8,["entity","entity-id","permission"])):me("",!0)]}),_:1})]),default:J(()=>[ue(ee,{type:"text",size:"xsmall",class:"nc-expand-form-more-actions !w-7 !h-7",disabled:e(W)},{default:J(()=>[ue(ge,{icon:"threeDotVertical",class:Dt(["text-md",e(W)?"text-gray-300":"text-gray-700"])},null,8,["class"])]),_:1},8,["disabled"])]),_:1})):me("",!0),ue(ee,{class:"nc-expand-form-close-btn !w-7 !h-7","data-testid":"nc-expanded-form-close",type:"text",size:"xsmall",onClick:cn},{default:J(()=>[ue(ge,{class:"text-md text-gray-700 h-4 w-4",icon:"close"})]),_:1})])]),z("div",{ref_key:"wrapper",ref:d,class:"flex-grow h-[calc(100%_-_4rem)] w-full"},[e(_e)===e(xl).FIELD?(p(),X(Vt,{key:0,"row-id":e(y),fields:e(lt)??[],"hidden-fields":e(je),"is-unsaved-duplicated-record-exist":e(I),"is-unsaved-form-exist":e($),"is-loading":e(W),"is-saving":e(j),"new-record-submit-btn-text":O.newRecordSubmitBtnText,onCopyRecordUrl:Z[7]||(Z[7]=vt=>Yt()),onDeleteRow:Z[8]||(Z[8]=vt=>at()),onSave:Z[9]||(Z[9]=vt=>Et()),"onUpdate:modelValue":Z[10]||(Z[10]=vt=>a("update:modelValue",vt)),onCreatedRecord:Z[11]||(Z[11]=vt=>a("createdRecord",vt)),onUpdateRowCommentCount:Z[12]||(Z[12]=vt=>a("updateRowCommentCount",vt))},null,8,["row-id","fields","hidden-fields","is-unsaved-duplicated-record-exist","is-unsaved-form-exist","is-loading","is-saving","new-record-submit-btn-text"])):e(_e)===e(xl).ATTACHMENT?(p(),X(Pe,{key:1,"row-id":e(y),view:l.view,fields:e(lt)??[],"hidden-fields":e(je),"is-unsaved-duplicated-record-exist":e(I),"is-unsaved-form-exist":e($),"is-loading":e(W),"is-saving":e(j),"new-record-submit-btn-text":O.newRecordSubmitBtnText,onCopyRecordUrl:Z[13]||(Z[13]=vt=>Yt()),onDeleteRow:Z[14]||(Z[14]=vt=>at()),onSave:Z[15]||(Z[15]=vt=>Et()),"onUpdate:modelValue":Z[16]||(Z[16]=vt=>a("update:modelValue",vt)),onCreatedRecord:Z[17]||(Z[17]=vt=>a("createdRecord",vt)),onUpdateRowCommentCount:Z[18]||(Z[18]=vt=>a("updateRowCommentCount",vt))},null,8,["row-id","view","fields","hidden-fields","is-unsaved-duplicated-record-exist","is-unsaved-form-exist","is-loading","is-saving","new-record-submit-btn-text"])):e(_e)===e(xl).DISCUSSION?(p(),X(Se,{key:2,"is-unsaved-duplicated-record-exist":e(I)},null,8,["is-unsaved-duplicated-record-exist"])):me("",!0)],512)])]}),_:1},16,["class","visible","width","size"])),ue($t,{visible:e(Be),"onUpdate:visible":Z[20]||(Z[20]=ze=>bo(Be)?Be.value=ze:null),"entity-name":"Record","on-delete":kt},{"entity-preview":J(()=>[z("span",null,[z("div",A0,[z("div",E0,[ue(Xe,{modelValue:e(Y),"onUpdate:modelValue":Z[19]||(Z[19]=ze=>bo(Y)?Y.value=ze:null),column:e(wn)},null,8,["modelValue","column"])])])])]),_:1},8,["visible"]),ue(Ts,{visible:e(st),"onUpdate:visible":Z[21]||(Z[21]=ze=>bo(st)?st.value=ze:null),size:"small"},{default:J(()=>[z("div",M0,[z("div",T0,se(O.$t("tooltip.saveChanges")),1),z("div",$0,se(O.$t("activity.doYouWantToSaveTheChanges")),1),z("div",O0,[ue(ee,{type:"secondary",size:"small",onClick:gt},{default:J(()=>[tt(se(O.$t("labels.discard")),1)]),_:1}),ue(ee,{key:"submit",type:"primary",size:"small",loading:e(j),onClick:Xt},{default:J(()=>[tt(se(O.$t("tooltip.saveChanges")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])],64)}}}),ud=Object.assign(L0,{__name:"SmartsheetExpandedForm"}),fv=Object.freeze(Object.defineProperty({__proto__:null,default:ud},Symbol.toStringTag,{value:"Module"})),N0={"data-testid":"nc-expand-table-modal",class:"flex flex-col"},P0={class:"mb-2 nc-content-gray"},B0={class:"flex flex-row mt-5 justify-end gap-x-2"},W0={class:"flex gap-2 items-center"},z0={class:"flex gap-2 items-center"},V0=ko({__name:"DeleteAll",props:{modelValue:{type:Boolean},rows:{}},emits:["cancel","update:modelValue","deleteAll"],setup(t,{emit:n}){const o=t,l=n,a=Ra(o,"modelValue",l);Sf("esc",()=>{a.value=!1,l("update:modelValue",!1)});const i=()=>{a.value=!1,l("cancel")};return(s,r)=>{const d=ca,c=Ts;return e(a)?(p(),X(c,{key:0,visible:e(a),"onUpdate:visible":r[1]||(r[1]=f=>bo(a)?a.value=f:null),"show-separator":!1,header:s.$t("activity.deleteAllRecords"),size:"small",onKeydown:r[2]||(r[2]=ls(f=>a.value=!1,["esc"]))},{default:J(()=>[r[3]||(r[3]=z("div",{class:"flex justify-between w-full text-base font-semibold mb-2 text-nc-content-gray-emphasis items-center"},se("Delete all records"),-1)),z("div",N0,[z("div",P0,"Are you sure you want to delete all "+se(s.rows)+" records present in this view?",1)]),r[4]||(r[4]=z("div",{class:"bg-nc-bg-gray-light py-2 px-4 flex items-center gap-4 w-full rounded-lg"},[z("div",{class:"leading-5 text-nc-content-gray"},"This action cannot be undone.")],-1)),z("div",B0,[z("div",W0,[ue(d,{"data-testid":"nn-record-delete-cancel",type:"secondary",size:"small",onClick:i},{default:J(()=>[tt(se(s.$t("labels.cancel")),1)]),_:1})]),z("div",z0,[ue(d,{"data-testid":"nc-record-delete-all",type:"danger",size:"small",onClick:r[0]||(r[0]=f=>l("deleteAll"))},{default:J(()=>[tt(se(s.$t("general.delete")),1)]),_:1})])])]),_:1,__:[3,4]},8,["visible","header"])):me("",!0)}}}),vv=Object.assign(V0,{__name:"DlgRecordDeleteAll"}),j0={"data-testid":"nc-expand-upsert-modal",class:"flex flex-col"},U0={class:"mb-2 nc-content-gray"},G0={key:0,class:"font-bold"},H0={class:"font-bold"},Y0={class:"font-bold"},q0={class:"flex flex-row mt-5 justify-end gap-x-2"},X0={class:"flex gap-2 items-center"},K0={class:"flex gap-2 items-center"},J0=ko({__name:"Upsert",props:{newRows:{},modelValue:{type:Boolean},newColumns:{},cellsOverwritten:{},rowsUpdated:{},isAddingEmptyRowPermitted:{type:Boolean,default:!0},meta:{}},emits:["update:expand","cancel","update:modelValue"],setup(t,{emit:n}){const o=t,l=n,a=Ra(o,"modelValue",l),{isAddingEmptyRowPermitted:i}=_r(o),{showRecordPlanLimitExceededModal:s}=ql(),r=V(i.value),d=()=>{r.value&&s({callback(f){f==="ok"&&(a.value=!1)}})||(l("update:expand",r.value),a.value=!1)};Sf("esc",()=>{a.value=!1,l("update:modelValue",!1)});const c=()=>{a.value=!1,l("cancel")};return(f,v)=>{const h=Cm,y=Rr,b=km,_=ca,m=Ts;return e(a)?(p(),X(m,{key:0,visible:e(a),"onUpdate:visible":v[1]||(v[1]=g=>bo(a)?a.value=g:null),"show-separator":!1,header:f.$t("activity.createTable"),size:"small",onKeydown:v[2]||(v[2]=ls(g=>a.value=!1,["esc"]))},{default:J(()=>[v[6]||(v[6]=z("div",{class:"flex justify-between w-full text-base font-semibold mb-2 text-nc-content-gray-emphasis items-center"},se("Do you want to expand this table ?"),-1)),z("div",j0,[z("div",U0,[v[3]||(v[3]=tt(" To accommodate your pasted data, we need to ")),f.cellsOverwritten&&f.rowsUpdated?(p(),B("span",G0," overwrite "+se(f.cellsOverwritten)+" "+se(f.cellsOverwritten===1?"cell":"cells")+" in "+se(f.rowsUpdated)+" "+se(f.rowsUpdated===1?"record":"records"),1)):me("",!0),f.newRows?(p(),B(en,{key:1},[f.cellsOverwritten||f.rowsUpdated?(p(),B(en,{key:0},[tt(" and ")],64)):me("",!0),z("span",H0," insert "+se(f.newRows)+" additional "+se(f.newRows===1?"record":"records"),1)],64)):me("",!0),f.newColumns?(p(),B(en,{key:2},[f.cellsOverwritten||f.rowsUpdated||f.newRows?(p(),B(en,{key:0},[tt(" and ")],64)):me("",!0),z("span",Y0," insert "+se(f.newColumns)+" additional "+se(f.newColumns===1?"field":"fields"),1)],64)):me("",!0)]),(f.newRows??0)>0?(p(),X(b,{key:0,value:e(r),"onUpdate:value":v[0]||(v[0]=g=>bo(r)?r.value=g:null)},{default:J(()=>{var g;return[ue(y,{entity:e(vl).TABLE,"entity-id":(g=f.meta)==null?void 0:g.id,permission:e(fl).TABLE_RECORD_ADD},{default:J(()=>[ue(h,{"data-testid":"nc-table-expand-yes",style:{display:"flex",height:"30px",lineHeight:"30px"},value:!0,disabled:!e(i)},{default:J(()=>v[4]||(v[4]=[z("div",{class:"nc-content-gray"},[z("span",{class:"font-semibold"}," Expand "),tt(" table to accommodate all pasted cells ")],-1)])),_:1,__:[4]},8,["disabled"])]),_:1},8,["entity","entity-id","permission"]),ue(h,{"data-testid":"nc-table-expand-no",style:{display:"flex",lineHeight:"30px"},value:!1},{default:J(()=>v[5]||(v[5]=[z("div",{class:"nc-content-gray leading-5"},[z("span",{class:"font-semibold"}," Don't expand "),tt(" the table. Values beyond the table's current size will be skipped. ")],-1)])),_:1,__:[5]})]}),_:1},8,["value"])):me("",!0)]),z("div",q0,[z("div",X0,[ue(_,{"data-testid":"nc-table-expand-cancel",type:"secondary",size:"small",onClick:c},{default:J(()=>[tt(se(f.$t("labels.cancel")),1)]),_:1})]),z("div",K0,[ue(_,{"data-testid":"nc-table-expand",type:"primary",size:"small",onClick:d},{default:J(()=>[tt(se(f.$t("labels.continue")),1)]),_:1})])])]),_:1,__:[6]},8,["visible","header"])):me("",!0)}}}),pv=Object.assign(J0,{__name:"DlgRecordUpsert"}),Q0={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},Z0={"clip-path":"url(#clip0_1422_4212)"},e1=["stroke"],t1=["stroke"],n1=["stroke"],o1=["stroke"],l1=["stroke"],a1=["stroke"],i1=["stroke"],r1=["stroke"],s1=ko({__name:"Spinner",props:{stroke:{default:"#4A5268"}},setup(t){return(n,o)=>(p(),B("svg",Q0,[z("g",Z0,[z("path",{class:"loader-line",d:"M8 12V14.6667",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,e1),z("path",{class:"loader-line",d:"M10.8267 10.8267L12.7133 12.7133",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,t1),z("path",{class:"loader-line",d:"M12 8H14.6667",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,n1),z("path",{class:"loader-line",d:"M10.8267 5.17335L12.7133 3.28668",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,o1),z("path",{class:"loader-line",d:"M8 1.33331V3.99998",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,l1),z("path",{class:"loader-line",d:"M3.28662 3.28668L5.17329 5.17335",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,a1),z("path",{class:"loader-line",d:"M1.33325 8H3.99992",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,i1),z("path",{class:"loader-line",d:"M3.28662 12.7133L5.17329 10.8267",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,r1)]),o[0]||(o[0]=z("defs",null,[z("clipPath",{id:"clip0_1422_4212"},[z("rect",{width:"16",height:"16",fill:"white"})])],-1))]))}}),u1=Object.assign(s1,{__name:"GeneralSpinner"}),d1=ko({__name:"TableDataCell",props:{active:{type:Boolean}},setup(t){const n=t,{active:o}=_r(n),l=V(),a=Uo(),i=Uo();yo(Yu,a),yo(If,i),yo(Ff,l);const s=r=>{a.trigger(r),i.trigger(r)};return rd(o,r=>{i.trigger(r)},{isGridCell:!0,immediate:!0}),(r,d)=>(p(),B("td",{ref_key:"el",ref:l,class:"select-none",onClick:s},[qu(r.$slots,"default")],512))}}),hv=Object.assign(d1,{__name:"SmartsheetTableDataCell"}),c1={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function f1(t,n){return p(),B("svg",c1,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16z"},null,-1)]))}const dd=yr({name:"mdi-message-outline",render:f1}),mv=({fields:t,tableBodyEl:n,gridWrapper:o})=>{const{eventBus:l,isDefaultView:a,meta:i}=Il(),{addUndo:s,defineViewScope:r}=Fi(),{activeView:d}=Go(wr()),{gridViewCols:c,updateGridViewColumn:f}=Ha(),{leftSidebarWidth:v}=Go(rv()),{width:h}=Xu(),y=V(!1),b=V(null),_=V(null),m=V(null),g=(I,F)=>{var E,M,U;(E=i.value)!=null&&E.columns&&(i.value.columns=(i.value.columns||[]).map(L=>(L.id!==I||(L.meta={...jn(L.meta||{}),defaultViewColOrder:F}),L)),(U=(M=i.value)==null?void 0:M.columnsById)!=null&&U[I]&&(i.value.columnsById[I].meta={...jn(i.value.columnsById[I].meta),defaultViewColOrder:F}))},C=async(I,F)=>{const E=c.value[I],M=c.value[F];if(!E||!M)return;const U=t.value.findIndex(he=>he.id===F),L=U<t.value.length-1?t.value[U+1]:null,G=L?c.value[L.id]:null,ae=t.value[t.value.length-1],ve=c.value[ae.id];if(G===null&&ve===null)return;const xe=G?M.order+(G.order-M.order)/2:ve.order+1,ne=E.order;E.order=xe,a.value&&E.fk_column_id&&g(E.fk_column_id,xe),s({undo:{fn:async()=>{t.value&&(E.order=ne,a.value&&g(E.fk_column_id,ne),await f(I,{order:ne}),l.emit(Xo.FIELD_RELOAD))},args:[]},redo:{fn:async()=>{t.value&&(E.order=xe,a.value&&g(E.fk_column_id,xe),await f(I,{order:xe}),l.emit(Xo.FIELD_RELOAD))},args:[]},scope:r({view:d.value})}),await f(I,{order:xe},!0),l.emit(Xo.FIELD_RELOAD)},w=async()=>{y.value=!0;try{if(!_.value)return;_.value.style.left="0px",_.value.style.height="0px",await C(b.value.id,m.value)}catch(I){console.error("Failed to reorder column: ",I)}finally{y.value=!1}b.value=null,m.value=null};return{onDrag:I=>{if(I.preventDefault(),!I.dataTransfer||!b.value||!_.value)return;if(I.clientX===0){w();return}const F=_.value.getBoundingClientRect().top,M=document.elementsFromPoint(I.clientX,F).find(G=>G.classList.contains("nc-grid-column-header"));M&&(m.value=(M==null?void 0:M.getAttribute("data-col"))??null);const U=I.clientX-v.value;U>=0&&(_.value.style.left=`${U.toString()}px`);const L=parseFloat(getComputedStyle(document.documentElement).fontSize);U<v.value+1*L?setTimeout(()=>{o.value.scrollLeft-=2.5},250):h.value-U-v.value<15*L&&setTimeout(()=>{o.value.scrollLeft+=2.5},250)},onDragStart:(I,F)=>{var G;if(!F.dataTransfer)return;const E=document.querySelector('[data-testid="drag-icon-placeholder"]');if(!E||!_.value)return;F.dataTransfer.dropEffect="none",F.dataTransfer.effectAllowed="none",F.dataTransfer.setDragImage(E,10,10),F.dataTransfer.clearData(),F.dataTransfer.setData("text/plain",I),b.value=t.value.find(ae=>ae.id===I)??null;const M=parseFloat(getComputedStyle(document.documentElement).fontSize),U=((G=n.value)==null?void 0:G.getBoundingClientRect().height)??6.1*M;_.value.style.height=`${U}px`;const L=F.clientX-v.value;L>=0&&_.value&&(_.value.style.left=`${L.toString()}px`)},onDragEnd:async I=>{I.preventDefault(),await ka(()=>!y.value).toBeTruthy(),!(!I.dataTransfer||!b.value||!m.value)&&w()},draggedCol:b,dragColPlaceholderDomRef:_,toBeDroppedColId:m}},v1=({updateRecordOrder:t,gridWrapper:n,virtualMargin:o,rowSlice:l,rowHeight:a,totalRows:i,cachedRows:s})=>{const r=V(!1),d=V(null),c=V(0),f=V(null),v=V(0),h=V(0),y=V(32),b=V(null),_=V(!1),m=V(null),g=V(null),C=(M,U)=>{const L=M.cloneNode(!0);return L.style.position="absolute",L.style.background="white",L.style.width="500px",L.style.overflowX="hidden",L.style.height=`${M.offsetHeight}px`,L.style.pointerEvents="none",L.style.zIndex="1000",L.style.border="1px solid #D5D5D9",L.style.transition="transform",L.style.borderRadius="6px",L.style.boxShadow="0px 12px 16px -4px rgba(0, 0, 0, 0.10), 0px 4px 6px -2px rgba(0, 0, 0, 0.06)",L.style.transformOrigin="center center",L.style.animation="dragStart 0.2s ease-out forwards",L.setAttribute("data-testid",`grid-row-${U}`),document.body.appendChild(L),L},w=M=>{!g.value||!n.value||(g.value.style.top=`${h.value+48+44+32}px`,g.value.style.left=`${M}px`)},S=()=>{g.value&&(g.value.remove(),g.value=null)},x=(M,U=!1)=>{try{if(M!==null?(M.preventDefault(),b.value=M):M=b.value,!n.value||!M)return;const L=n.value.getBoundingClientRect(),G=L.bottom-L.top;h.value=Math.max(0,Math.min(c.value+M.clientY-v.value,G-a.value)),w(M.clientX);const ae=M.clientY-L.top+n.value.scrollTop,ve=Math.max(0,Math.min(Math.round(ae/a.value),i.value+1)),xe=Math.max(0,l.start-o),ne=Math.max(xe,Math.min(ve,l.end+o));y.value=Math.max(ne*a.value,32)+(a.value===32?0:32),y.value===0&&a.value!==32&&(y.value=y.value-32);const he=ve-l.start-(a.value===32?1:0);if(!_.value||!U){const j=Math.ceil(G/100*10),Ee=M.clientY-L.top,Ye=G-Ee;let Ge=0;const ke=n.value.scrollTop>0,Y=n.value.scrollTop<n.value.scrollHeight-G;if(Ee<j&&ke?Ge=-(6-Math.ceil(Math.max(0,Ee)/j*6)):Ye<j&&Y&&(Ge=6-Math.ceil(Math.max(0,Ye)/j*6)),Ge!==0){const we=n.value.scrollTop+Ge;we>=0&&we<=n.value.scrollHeight-G?(_.value=!0,n.value.scrollTop=we,m.value!==null&&cancelAnimationFrame(m.value),m.value=requestAnimationFrame(()=>{x(null,!1)})):_.value=!1}else _.value=!1,m.value!==null&&(cancelAnimationFrame(m.value),m.value=null)}const W=s.value.get(Math.max(l.start+he,0));f.value=W,(W==null?void 0:W.rowMeta.rowIndex)!==d.value.rowMeta.rowIndex&&(W==null?void 0:W.rowMeta.rowIndex)!==d.value.rowMeta.rowIndex+1?y.value=Math.max(ne*a.value,32)+(a.value===32?0:32):y.value=-9999}catch(L){console.error("Error in moveHandler:",L),I()}},$=async M=>{var U,L,G,ae,ve,xe,ne,he;try{M.preventDefault(),I();const W=((L=(U=d.value)==null?void 0:U.rowMeta)==null?void 0:L.rowIndex)===((ae=(G=f.value)==null?void 0:G.rowMeta)==null?void 0:ae.rowIndex)||((xe=(ve=f.value)==null?void 0:ve.rowMeta)==null?void 0:xe.rowIndex)===((he=(ne=d.value)==null?void 0:ne.rowMeta)==null?void 0:he.rowIndex)+1;d.value&&d.value.rowMeta.rowIndex!==void 0&&!W&&await t(d.value.rowMeta.rowIndex,f.value?f.value.rowMeta.rowIndex:null),d.value=null,f.value=null}catch(W){console.error("Error in mouseUp:",W),I()}};function I(){try{r.value=!1,_.value=!1,S(),m.value!==null&&(cancelAnimationFrame(m.value),m.value=null),window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",$)}catch(M){console.error("Error in cancel:",M)}}const F=M=>M*a.value,E=(M,U)=>{var L;try{const G=U.target.closest(`[data-testid="grid-row-${M.rowMeta.rowIndex}"]`);if(!G)return;d.value=M,c.value=F(M.rowMeta.rowIndex)-(((L=n.value)==null?void 0:L.scrollTop)||0),v.value=U.clientY,h.value=32,y.value=32,f.value=null,g.value=C(G,M.rowMeta.rowIndex),w(U.clientX),r.value=!0,x(U),window.addEventListener("mousemove",x),window.addEventListener("mouseup",$)}catch(G){console.error("Error in startDragging:",G),I()}};return Ku(()=>{I()}),{startDragging:E,draggingRecord:d,cancel:I,isDragging:r,targetTop:y}};function tu(){const{nestedFilters:t,allFilters:n,sorts:o,validFiltersFromUrlParams:l,meta:a}=Il(),i=!1,s=le(()=>{var v;return(((v=a.value)==null?void 0:v.columns)||[]).filter(h=>h.uidt===pe.User).map(h=>h.id)}),r=le(()=>{const v=new Set,h=y=>{var b;if(y&&y.length>0)for(const _ of y)_.is_group?(((b=_.children)==null?void 0:b.length)??0)>0&&h(_.children):_.fk_column_id&&v.add(_.fk_column_id)};return h([...n.value,...t.value,...l.value]),v}),d=le(()=>{const v=new Set;if(!(o!=null&&o.value)||o.value.length===0)return v;for(const h of o.value)h.fk_column_id&&v.add(h.fk_column_id);return v}),c=(v,h=!1)=>{if(h)return r.value.has(v)?"FILTERED":d.value.has(v)?"SORTED":void 0};return{appearanceConfig:{FILTERED:{cellBgColor:lo.green[50],"cellBgColor.hovered":lo.green[100],"cellBgColor.selected":lo.green[100],cellBorderColor:lo.gray[200],"cellBorderColor.hovered":lo.gray[200],"cellBorderColor.selected":lo.gray[200],cellBgClass:"!bg-green-50 column-filtered",toolbarBgClass:"!bg-nc-bg-green-light !hover:bg-nc-bg-green-dark",toolbarChipBgClass:"bg-nc-bg-green-dark group-hover:bg-green-200",toolbarTextClass:"text-green-700",headerBgColor:"#27D6650A",headerBgClass:"relative !bg-[#ffffff88] after:content-[''] after:absolute after:block after:inset-0 !after:bg-[#27D6650A] after:pointer-events-none"},SORTED:{cellBgColor:lo.orange[50],"cellBgColor.hovered":lo.orange[100],"cellBgColor.selected":lo.orange[100],cellBorderColor:lo.gray[200],"cellBorderColor.hovered":lo.gray[200],"cellBorderColor.selected":lo.gray[200],cellBgClass:"!bg-orange-50 column-sorted !border-b-gray-200",toolbarBgClass:"!bg-nc-bg-orange-light !hover:bg-nc-bg-orange-dark",toolbarChipBgClass:"bg-nc-bg-orange-dark group-hover:bg-orange-200",toolbarTextClass:"text-orange-700",headerBgColor:"#FA82310A",headerBgClass:"relative !bg-[#ffffff88] after:content-[''] after:absolute after:block after:inset-0 !after:bg-[#FA82310A] after:pointer-events-none"}},filteredColumnIds:r,sortedColumnIds:d,isColumnSortedOrFiltered:c,userColumnIds:s,isCellColouringEnabled:i}}const cd=()=>{const{t}=oa();return{paste:async()=>{try{if(!navigator.clipboard)throw new Error(t("msg.error.pasteFromClipboardError"));const o=await navigator.clipboard.readText(),l=new Event("paste",{bubbles:!1,cancelable:!0});return Object.defineProperty(l,"clipboardData",{value:{getData:()=>o||""}}),document.dispatchEvent(l),!0}catch{return tn.error(t("msg.error.pasteFromClipboardError")),!1}}}},[p1,h1]=Qf((t,n,o,l)=>{const{$api:a}=da(),i=fn(gr,V([])),s=fn(zl,V(!1)),{gridViewCols:r,updateGridViewColumn:d}=Ha(),{nestedFilters:c}=Il(),{isUIAllowed:f}=gl(),{fetchAggregatedData:v}=ju(),h=V({}),y=fn(Ju),b=le(()=>i.value.map((x,$)=>({field:x,index:$})).filter(x=>x.index!==0).map(x=>{const $=r.value[x.field.id];return $?{value:h.value[x.field.title]??null,field:$,column:x.field,index:x.index,width:`${Number(($.width??"").replace("px",""))}px`||"180px"}:{field:null,index:x.index}})),_=le(()=>{var S;return!((S=i.value)!=null&&S.length)||!r.value?{field:null,width:"180px"}:{value:h.value[i.value[0].title]??null,column:i.value[0],field:r.value[i.value[0].id],width:`${Number((r.value[i.value[0].id].width??"").replace("px",""))+80}px`||"260px"}}),m=S=>{var x,$;return S.uidt===pe.Formula&&(($=(x=S.colOptions)==null?void 0:x.parsed_tree)!=null&&$.dataType)?tc(S.uidt,S.colOptions.parsed_tree):tc(S.uidt)},g=async S=>{await ka(()=>!!n.value).toBeTruthy({timeout:1e4}).then(async()=>{var x,$;if(!(!((x=t.value)!=null&&x.type)||(($=t.value)==null?void 0:$.type)!==Ul.GRID))try{const I=s.value?await v({where:o==null?void 0:o.value,filtersArr:c.value,...S?{aggregation:S}:{}}):await a.dbDataTableAggregate.dbDataTableAggregate(n.value.id,{viewId:t.value.id,where:o==null?void 0:o.value,...f("filterSync")?{}:{filterArrJson:JSON.stringify(c.value)},...S?{aggregation:S}:{}});Object.assign(h.value,I),l==null||l.trigger()}catch(I){console.log(I),tn.error(await pf(I))}})},C=async(S,x)=>{var $;await(y==null?void 0:y.trigger({fields:[{title:(($=i.value.find(I=>I.id===S))==null?void 0:$.title)??"",aggregation:x}]})),await d(S,{aggregation:x}),l==null||l.trigger()},w=le(()=>i.value.filter(S=>{var x,$,I;return!(!(S!=null&&S.id)||!(S!=null&&S.title)||!Uu(S)||!r.value[S.id]||!((x=r.value[S.id])!=null&&x.aggregation)||(($=r.value[S.id])==null?void 0:$.aggregation)===Wa.None||!((I=S.colOptions)!=null&&I.formula_raw))}).map(S=>{var x,$;return{id:S.id,aggregation:((x=r.value[S.id])==null?void 0:x.aggregation)??Wa.None,formula_raw:(($=S.colOptions)==null?void 0:$.formula_raw)??""}}));return y==null||y.on(async S=>{var x;if((!S||!((x=S==null?void 0:S.fields)!=null&&x.length))&&await g(),S!=null&&S.fields){const $=S.fields.reduce((I,F)=>{const E=i.value.find(M=>M.title===F.title);if(!(E!=null&&E.id))return I;I[E.id]=F.aggregation??r.value[E.id].aggregation??Wa.None;for(const M of w.value)!I[M.id]&&M.formula_raw.includes(F.title)&&(I[M.id]=M.aggregation);return I},{});await g(Object.entries($).map(([I,F])=>({field:I,type:F})))}}),{loadViewAggregate:g,isPublic:s,aggregations:h,updateAggregate:C,getAggregations:m,displayFieldComputed:_,visibleFieldsComputed:b}});function nu(){const t=h1();if(t==null)throw new Error("Please call `useProvideViewAggregate` on the appropriate parent component");return t}class zs{constructor(n=null,o=null){vo(this,"_start");vo(this,"_end");vo(this,"_oldStart");vo(this,"_oldEnd");this._start=n,this._end=o??this._start,this._oldStart=n,this._oldEnd=o??this._start}isEmpty(){return this._start==null||this._end==null}isSingleCell(){var n,o,l,a;return!this.isEmpty()&&((n=this._start)==null?void 0:n.col)===((o=this._end)==null?void 0:o.col)&&((l=this._start)==null?void 0:l.row)===((a=this._end)==null?void 0:a.row)}isSingleRow(){var n,o;return!this.isEmpty()&&((n=this._start)==null?void 0:n.row)===((o=this._end)==null?void 0:o.row)}isCellInRange(n){return!this.isEmpty()&&n.row>=this.start.row&&n.row<=this.end.row&&n.col>=this.start.col&&n.col<=this.end.col}isRowInRange(n){return!this.isEmpty()&&n>=this.start.row&&n<=this.end.row}isColInRange(n){return!this.isEmpty()&&n>=this.start.col&&n<=this.end.col}isDifferentColSelection(){return this.isEmpty()||this.isSingleCell()?!1:this.oldStart.col!==this.start.col||this.oldEnd.col!==this.end.col}get start(){var n,o,l,a;return{row:Math.min(((n=this._start)==null?void 0:n.row)??NaN,((o=this._end)==null?void 0:o.row)??NaN),col:Math.min(((l=this._start)==null?void 0:l.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}get oldStart(){var n,o,l,a;return{row:Math.min(((n=this._oldStart)==null?void 0:n.row)??NaN,((o=this._oldEnd)==null?void 0:o.row)??NaN),col:Math.min(((l=this._oldStart)==null?void 0:l.col)??NaN,((a=this._oldEnd)==null?void 0:a.col)??NaN)}}get end(){var n,o,l,a;return{row:Math.max(((n=this._start)==null?void 0:n.row)??NaN,((o=this._end)==null?void 0:o.row)??NaN),col:Math.max(((l=this._start)==null?void 0:l.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}get oldEnd(){var n,o,l,a;return{row:Math.max(((n=this._oldStart)==null?void 0:n.row)??NaN,((o=this._oldEnd)==null?void 0:o.row)??NaN),col:Math.max(((l=this._oldStart)==null?void 0:l.col)??NaN,((a=this._oldEnd)==null?void 0:a.col)??NaN)}}startRange(n){this._start=n,this._end=n,this._oldStart=n,this._oldEnd=n}endRange(n){this._oldEnd=this._end,this._end=n}clear(){this._oldStart=this._start,this._oldEnd=this._end,this._start=null,this._end=null}}const dr=async t=>{if(!t.addOptions||t.addOptions.length===0)return;t.col.colOptions||(t.col.colOptions={options:[]});const n=t.col.colOptions.options.length??0,o=typeof t.addOptions[0]=="string"?t.addOptions.map((l,a)=>({fk_column_id:t.col.id,title:l,order:n+a+1,color:Su.light[(n+a)%Su.light.length]})):t.addOptions;t.col.colOptions.options=[...t.col.colOptions.options,...o],await t.api.dbTableColumn.update(t.col.id,t.col)},pu=0;function gv(t,n,o,l,a,i,s,r,d,c,f,v,h,y,b,_,m,g,C,w,S,x,$,I=!0){const F=V(t),E=100,M=50,{t:U}=oa(),{copy:L}=qs(),{getMeta:G,metas:ae}=oi(),{appInfo:ve}=nl(),{isMysql:xe,isPg:ne}=Ca(),{base:he}=Go(Ca()),{api:W}=Af(),{$api:j}=da(),{addUndo:Ee,clone:Ye,defineViewScope:Ge}=Fi(),{isDataReadOnly:ke}=gl(),{meta:Y}=Ef(),{isAiFeaturesEnabled:we}=xr(),{isSqlView:oe,isExternalSource:ye}=Il(),{blockExternalSourceRecordVisibility:ie,showUpgradeToAddMoreAttachmentsInCell:H,maxAttachmentsAllowedInCell:Ae}=ql(),{batchUploadFiles:Ie}=xi(),ce=V(!1),te=typeof e(o)=="object"&&Array.isArray(e(o)),Le=V(C),Ne=V(a),lt=V(!1),je=V(!1),He=V(g),Q=ki(new zs),Mt=ki(new zs),_e=ki({row:null,col:null}),wn=le(()=>{var R;return(R=e(n))==null?void 0:R.length}),It=le(()=>!(_e.row===null||_e.col===null||isNaN(_e.row)||isNaN(_e.col))),Tt=le(()=>ie(ye.value)&&e(l)>=ll);function Je(R,P){const D={...P};if(Math.abs(P.row-R.row)+1>E){const K=P.row>R.row?1:-1;D.row=R.row+(E-1)*K}return D}function cn(R,P){_e.row===R&&_e.col===P||(Ne.value=!1,_e.row=R,_e.col=P)}const Pn=(R,P,D)=>{var K;const fe=(P.title&&R.row[P.title])??"";return as.parseValue(fe,{col:P,isMysql:xe,isPg:ne,meta:F.value,metas:ae.value,rowId:Yo(P)?qt(R.row,(K=F.value)==null?void 0:K.columns):null})},Et=(R,P,D)=>{let fe="<table>",K="";const O=[];return R.forEach((Z,ge)=>{let ee="<tr>";const Me=[];P.forEach((We,Xe)=>{const nt=Pn(Z,We);ee+=`<td>${nt}</td>`,K=`${K}${nt}${P.length-1!==Xe?"	":""}`,Me.push(nt)}),fe+=`${ee}</tr>`,R.length-1!==ge&&(K=`${K}
`),O.push(Me)}),fe+="</table>",{html:fe,text:K,json:O}},Rn=async(R,P)=>{var Z;const{html:D,text:fe}=Et(R,P),K=new Blob([D],{type:"text/html"}),O=new Blob([fe],{type:"text/plain"});return((Z=navigator.clipboard)==null?void 0:Z.write([new ClipboardItem({[K.type]:K,[O.type]:O})]))??L(fe)};async function mt(R){try{if(Q.start!==null&&Q.end!==null&&!Q.isSingleCell()){let P;if(te)P=e(o).slice(Q.start.row,Q.end.row+1);else{const fe=Math.floor(Q.start.row/M),K=Math.floor(Q.end.row/M),O=new Set;for(let Z=fe;Z<=K;Z++)O.add(Z);await Promise.all([...O].map(S)),P=await $(Q.start.row,Q.end.row)}const D=e(n).slice(Q.start.col,Q.end.col+1);await Rn(P,D),tn.toast(U(`msg.toast.nCell${P.length*D.length===1?"":"s"}Copied`,{n:P.length*D.length}))}else{const P=(R==null?void 0:R.row)??_e.row,D=(R==null?void 0:R.col)??_e.col;if(P!=null&&D!=null){const fe=te?e(o)[P]:e(o).get(P);if(!fe)return;const K=e(n)[D],O=Pn(fe,K);await L(ua(O)?O:""),tn.toast(U("msg.toast.nCellCopied",{n:1}))}}}catch{tn.error(U("msg.error.copyToClipboardError"))}}const ot=le(()=>{const R={};if(Mt._start===null||Mt._end===null)return R;for(let P=Mt.start.row;P<=Mt.end.row;P++)for(let D=Mt.start.col;D<=Mt.end.col;D++)R[`${P}-${D}`]=!0;return R}),gt=le(()=>{const R={};if(_e.row!==null&&_e.col!==null&&(R[`${_e.row}-${_e.col}`]=!0),Q._start===null||Q._end===null)return R;for(let P=Q.start.row;P<=Q.end.row;P++)for(let D=Q.start.col;D<=Q.end.col;D++)R[`${P}-${D}`]=!0;return R});function zt(R,P,D){if(je.value){const K=te?e(o)[P]:e(o).get(P);if(!K||!Q._start||!Q._end||K.rowMeta.new)return;const O=Math.min(Q._start.row+100,P),Z=ce.value?Math.min(Q._start.col+100,D):Q._end.col;Mt.endRange({row:O,col:Z}),f==null||f(O,D);return}if(!lt.value)return;const fe=Je(Q.start,{row:P,col:D});Q.endRange(fe),f==null||f(fe.row,fe.col),R.preventDefault()}function Ht(R,P,D){if(!(((R==null?void 0:R.button)!==pu||(R==null?void 0:R.button)===pu&&R.ctrlKey)&&gt.value[`${P}-${D}`])){if(Ne.value||(lt.value=!0),s.value=!1,R.preventDefault(),R.shiftKey){(_e.col===null||_e.row===null)&&Q.startRange({row:P,col:D}),Q.endRange({row:P,col:D});return}Q.startRange({row:P,col:D}),(_e.row!==P||_e.col!==D)&&(_e.col=null)}}const Yt=(R,P,D)=>{(!R.shiftKey||_e.col===null||_e.row===null)&&cn(P,D),f==null||f(P,D)};function Xt(R,P,D=!1){return!R||!P?(D&&tn.toast("Please select a cell to paste"),!1):xo(P)||ra(P)||P!=null&&P.readonly?(D&&tn.toast(U("msg.info.pasteNotSupported")),!1):P.ai?(D&&tn.toast(U("msg.info.autoIncFieldNotEditable")),!1):P.pk&&!R.rowMeta.new?(D&&tn.toast(U("msg.info.editingPKnotSupported")),!1):!0}const un=async({rawMatrix:R,cpCols:P,rowToPaste:D,data:fe})=>{var nt;if(R.length===0)return;const K=D.end-D.start>0?1:-1,O=K===-1?R.reverse():R,Z=O[0].map((et,ut)=>O.map(Ke=>Ke[ut])),ge=[],ee=Math.abs(D.end-D.start)+1;for(const[et,ut]of Z.entries()){const Ke=P[et],Qe=as.populateFillHandle({column:Ke,highlightedData:ut,numberOfRows:ee});Qe&&ge.push(Qe)}const Me=[];let We=0;const Xe={};for(let et=D.start+K*R.length;K===1?et<=D.end:et>=D.end;et+=K){const ut=fe[et];if(ut){for(const[Ke,Qe]of P.entries()){const ht=El({value:ge[Ke][We],to:Qe.uidt,column:Qe,appInfo:e(ve),maxAttachmentsAllowedInCell:Ae.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:Xe[Qe.title],markInfoShown:()=>{Xe[Qe.title]=!0}},xe((nt=F.value)==null?void 0:nt.source_id),!0);ut.row[Qe.title]=ht}Me.push(ut)}We++}await(b==null?void 0:b(Me,P.map(et=>et.title)))},bt=R=>{var P,D;if(je.value)try{const fe=!!ce.value;je.value=!1,ce.value=!1;const K={};if(Mt._start===null||Mt._end===null)return;if(Q._start!==null&&Q._end!==null){const O={row:Q._start.row,col:Q._start.col};let Z;te?Z=e(o).slice(Q.start.row,Q.end.row+1):Z=Array.from(e(o)).filter(([ht])=>ht>=Q.start.row&&ht<=Q.end.row).map(([,ht])=>ht);const ge=e(n).slice(Q.start.col,Q.end.col+1),ee=Et(Z,ge).json,Me=Mt._start.row<=Mt._end.row?1:-1,We=Math.max(Q.start.row,Q.end.row,Mt._start.row,Mt._end.row),Xe=Math.min(Q.start.row,Q.end.row,Mt._start.row,Mt._end.row);if(!fe){const ht=te?e(o):e(o)instanceof Map?Array.from(e(o),([Vt,Pe])=>Pe):e(o);return un({data:ht,rawMatrix:ee,cpCols:ge,rowToPaste:{start:Me===1?Xe:We,end:Me===1?We:Xe}}).then(()=>{Mt._start===null||Mt._end===null||(Q.startRange(O),Q.endRange(Mt._end),cn(O.row,O.col),Mt.clear())})}let nt=Me===1?0:ee.length-1;const et=[],ut=[],Ke=[],Qe=[];for(let ht=Mt._start.row;Me===1?ht<=Mt._end.row:ht>=Mt._end.row;ht+=Me){const Vt=te?e(o)[ht]:e(o).get(ht);if(!Vt)continue;let Pe=0;gt.value[`${ht}-${Q.start.col}`]||et.push(Vt);for(let Se=Mt.start.col;Se<=Mt.end.col;Se++){const $t=e(n)[Se];if(!Xt(Vt,$t)){Pe++;continue}if(Q._start&&Q._end&&Q._start.col<=Se&&Se<=Q._end.col){ge.findIndex(ze=>ze.id===$t.id)===-1&&(Qe.includes($t.title)||Ke.push($t.title)),!Ke.includes($t.title)&&!Qe.includes($t.title)&&Ke.push($t.title);let be;try{be=El({value:ee[nt][Pe],to:$t.uidt,column:$t,appInfo:e(ve),maxAttachmentsAllowedInCell:Ae.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:K[$t.title],markInfoShown:()=>{K[$t.title]=!0}},xe((P=F.value)==null?void 0:P.source_id),!0)}catch(ze){if(ze instanceof bi)throw ze;be=null}be!==void 0&&(fe||(Vt.row[$t.title]=be))}else fe&&(Qe.push($t.title),ut.find(be=>{var ze,wt;return qt(be.row,(ze=F.value)==null?void 0:ze.columns)===qt(Vt.row,(wt=F.value)==null?void 0:wt.columns)})||ut.push(Vt));Pe++}Me===1?nt=nt<ee.length-1?nt+1:0:nt=nt>=1?nt-1:ee.length-1}if(fe){const ht=Z.map(Pe=>{var $t;const Se={Id:qt(Pe.row,($t=F.value)==null?void 0:$t.columns)};for(const be of Ke)Se[be]=Pe.row[be];for(const be of Qe)Se[be]="FILL";return Se}),Vt=et.map(Pe=>{var Se;return qt(Pe.row,(Se=F.value)==null?void 0:Se.columns)});j.ai.dataFill((D=F.value)==null?void 0:D.id,{rows:ht,generateIds:Vt,numRows:Vt.length}).then(Pe=>{if(!(Mt._start===null||Mt._end===null)){for(const Se of et.concat(ut)){const $t=Pe.find(be=>{var ze,wt;return qt(Se.row,(ze=F.value)==null?void 0:ze.columns)===qt(be,(wt=F.value)==null?void 0:wt.columns)});if($t)for(const be of Ke.concat(Qe))Se.row[be]=$t[be]}b==null||b(et.concat(ut),Ke.concat(Qe)).then(()=>{Mt._start===null||Mt._end===null||(Q.startRange(O),Q.endRange(Mt._end),cn(O.row,O.col),Mt.clear())})}});return}b==null||b(et,Ke).then(()=>{Mt._start===null||Mt._end===null||(Q.startRange(O),Q.endRange(Mt._end),cn(O.row,O.col),Mt.clear())})}else Mt.clear();return}catch(fe){(!(fe instanceof za)||!fe.isErrorSuppressed)&&(console.error(fe,fe.isErrorSuppressed),tn.error((fe==null?void 0:fe.message)||"Something went wrong"))}lt.value&&(lt.value=!1,setTimeout(()=>{Q._start&&(_e.row!==Q._start.row||_e.col!==Q._start.col)&&cn(Q._start.row,Q._start.col)},0))},ct=Qu(async R=>{var D,fe,K,O,Z,ge,ee,Me,We,Xe,nt,et,ut,Ke,Qe,ht,Vt,Pe,Se,$t,be,ze;const P=Va()?R.metaKey:R.ctrlKey;if(!(_e.row===null||_e.col===null))switch(R.key){case"Tab":Q.clear(),R.shiftKey?_e.col>0?(_e.col--,Ne.value=!1):_e.row>0&&(_e.row--,_e.col=e(wn.value)-1,Ne.value=!1):_e.col<e(wn.value)-1?(_e.col++,Ne.value=!1):_e.row<(te?e(o).length:e(l))-1&&(_e.row++,_e.col=0,Ne.value=!1),f==null||f();break;case"ArrowRight":R.shiftKey?P?(Ne.value=!1,Q.endRange({row:((D=Q._end)==null?void 0:D.row)??_e.row,col:e(wn.value)-1}),f==null||f((fe=Q._end)==null?void 0:fe.row,(K=Q._end)==null?void 0:K.col)):(((O=Q._end)==null?void 0:O.col)??_e.col)<e(wn.value)-1&&(Ne.value=!1,Q.endRange({row:((Z=Q._end)==null?void 0:Z.row)??_e.row,col:(((ge=Q._end)==null?void 0:ge.col)??_e.col)+1}),f==null||f((ee=Q._end)==null?void 0:ee.row,(Me=Q._end)==null?void 0:Me.col)):(Q.clear(),_e.col<e(wn.value)-1&&(_e.col++,Q.startRange({row:_e.row,col:_e.col}),f==null||f(),Ne.value=!1));break;case"ArrowLeft":R.shiftKey?P?(Ne.value=!1,Q.endRange({row:((We=Q._end)==null?void 0:We.row)??_e.row,col:0}),f==null||f((Xe=Q._end)==null?void 0:Xe.row,(nt=Q._end)==null?void 0:nt.col)):(((et=Q._end)==null?void 0:et.col)??_e.col)>0&&(Ne.value=!1,Q.endRange({row:((ut=Q._end)==null?void 0:ut.row)??_e.row,col:(((Ke=Q._end)==null?void 0:Ke.col)??_e.col)-1}),f==null||f((Qe=Q._end)==null?void 0:Qe.row,(ht=Q._end)==null?void 0:ht.col)):(Q.clear(),_e.col>0&&(_e.col--,Q.startRange({row:_e.row,col:_e.col}),f==null||f(),Ne.value=!1));break;case"ArrowUp":if(R.shiftKey){const wt=Q._start??_e;let q;P?q={row:0,col:((Vt=Q._end)==null?void 0:Vt.col)??_e.col}:q={row:(((Pe=Q._end)==null?void 0:Pe.row)??_e.row)-1,col:((Se=Q._end)==null?void 0:Se.col)??_e.col};const Fe=Je(wt,q);Ne.value=!1,Q.endRange(Fe),f==null||f(Fe.row,Fe.col,"instant")}else Q.clear(),_e.row>0&&(_e.row--,Q.startRange({row:_e.row,col:_e.col}),f==null||f(),Ne.value=!1);x==null||x();break;case"ArrowDown":if(R.shiftKey){const wt=Q._start??_e;let q;P?q={row:(te?e(o).length:e(l))-1,col:(($t=Q._end)==null?void 0:$t.col)??_e.col}:q={row:(((be=Q._end)==null?void 0:be.row)??_e.row)+1,col:((ze=Q._end)==null?void 0:ze.col)??_e.col};const Fe=Je(wt,q);Ne.value=!1,Q.endRange(Fe),f==null||f(Fe.row,Fe.col,"instant")}else Q.clear(),_e.row<(te?e(o).length:e(l))&&(_e.row++,Q.startRange({row:_e.row,col:_e.col}),f==null||f(),Ne.value=!1);x==null||x();break;case"Enter":{if(Q.clear(),Tt.value&&_e.row>=ll-1)return;let wt;te?wt=e(o)[_e.row]:wt=e(o).get(_e.row),c(wt,e(n)[_e.col]);break}case"Delete":case"Backspace":if(ke.value||Tt.value&&_e.row>=ll-1)return;Q.isSingleCell()?(Q.clear(),await r(_e)):await d();break}},60),ft=async R=>{if(te?await(h==null?void 0:h(R)):h!=null&&h(R))return!0;if(!(Wl()||Vi())&&!(!It.value||_e.row===null||_e.col===null))switch(R.key){case"Tab":case"Enter":case"Delete":case"Backspace":case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":R.preventDefault(),ct(R);break;default:{const P=te?e(o)[_e.row]:e(o).get(_e.row);if(!P)return;const D=e(n)[_e.col];if((!e(Ne)||!nc(D))&&!sa()&&(Va()?R.metaKey:R.ctrlKey))switch(R.keyCode){case 67:await mt();break}if(e(Ne)||R.ctrlKey||R.altKey||R.metaKey)return!0;if(Tt.value&&_e.row>=ll-1){R.preventDefault();return}if(oe.value)return;if(R.key.length===1){if(!e(i)&&!P.rowMeta.new)return tn.toast(U("msg.info.updateNotAllowedWithoutPK"));nc(D)&&c(P,D)&&D.title&&(D.uidt===pe.LongText?P.row[D.title]==="<br />"||P.row[D.title]==="<br>"?P.row[D.title]=R.key:jn(D.meta).richMode&&(P.row[D.title]=P.row[D.title]?P.row[D.title]+R.key:R.key):P.row[D.title]="")}}break}},Be=()=>Q.clear(),at=Q.clear.bind(Q),kt=async R=>{var D,fe,K,O,Z,ge,ee,Me,We,Xe,nt,et,ut,Ke,Qe,ht,Vt,Pe,Se,$t,be,ze,wt,q,Fe,vt,Re,yt;if(ke.value||oe.value||sa()||Wl()||Vi()||!It.value||e(Ne)||_e.row===null||_e.row===void 0||_e.col===null||_e.col===void 0)return;R.preventDefault();let P=((D=R.clipboardData)==null?void 0:D.getData("text/plain"))||"";P!=null&&P.endsWith(`
`)&&(P=P.replace(/\n$/,""));try{if(P!=null&&P.includes(`
`)||P!=null&&P.includes("	")){const _t=sv.parse(P,{delimiter:"	",escapeChar:"\\"});if(_t.errors.length>0)throw new Error(_t.errors[0].message);let Ze=_t.data;Ze=Ze.map(Ue=>Ue.map(Mo=>Mo==="null"?"":Mo));const on=Math.max(Ze.length,Q.end.row-Q.start.row+1),Kt=Ze[0].length,nn=e(n),pt=_e.col,mn=nn.length-pt,ln=Math.max(0,Kt-mn);let so=0,Sn,yn,kn;if(te){const{totalRows:Ue,page:Mo=1,pageSize:qn=100}=e(C);I?(so=Ue,Sn=(Mo-1)*qn+_e.row):(so=Math.max(0,(Ue??0)-(Mo-1)*qn),Sn=_e.row),yn=Math.max(0,so-Sn),kn=Math.max(0,on-yn)}else so=e(l)??0,Sn=_e.row,yn=Math.max(0,so-Sn),kn=Math.max(0,on-yn);let jt={continue:!1,expand:(kn>0||ln>0)&&!te};if(jt.expand&&!te&&(jt=await(v==null?void 0:v({newRows:kn,newColumns:ln,cellsOverwritten:Math.min(yn,on)*(Kt-ln),rowsUpdated:Math.min(yn,on)})),!jt.continue))return;let an;const rn=[];if(jt.expand){if(an=nn.slice(pt,pt+Kt),ln>0){const Ue=(await W.dbTableColumn.hash((fe=F.value)==null?void 0:fe.id)).hash,Mo=((O=(K=F.value)==null?void 0:K.columns)==null?void 0:O.length)||0;for(let qn=0;qn<ln;qn++){const eo={uidt:pe.SingleLineText,order:Mo+qn,column_order:{order:Mo+qn,view_id:(Z=He.value)==null?void 0:Z.id},view_id:(ge=He.value)==null?void 0:ge.id,table_name:(ee=F.value)==null?void 0:ee.table_name},to=Mf({metaColumns:[...((Me=F.value)==null?void 0:Me.columns)??[],...rn.map(({column:Zo})=>Zo)],formState:eo});rn.push({op:"add",column:{...eo,title:to}})}await W.dbTableColumn.bulk((We=F.value)==null?void 0:We.id,{hash:Ue,ops:rn}),await G((Xe=F==null?void 0:F.value)==null?void 0:Xe.id,!0),an=[...an,...rn.map(({column:qn})=>qn)]}}else an=e(n).slice(_e.col,_e.col+Kt);const En=e(o),Yn=[],ao=[],Zn=[];let So=!1;const To={};for(let Ue=0;Ue<on;Ue++){const Mo=Ue%Ze.length;let qn;if(Ue<yn){const eo=Sn+Ue;te?qn=Ue<En.length?En[eo]:{row:{},oldRow:{},rowMeta:{isExistingRow:!0,rowIndex:eo}}:qn=En.get(eo)||{row:{},oldRow:{},rowMeta:{isExistingRow:!0,rowIndex:eo}},Yn.push(qn)}else qn={row:{},oldRow:{},rowMeta:{isExistingRow:!1}},ao.push(qn);for(let eo=0;eo<Ze[Mo].length;eo++){const to=an[eo];if(to)if(to&&Xt(qn,to)){Zn.push(to.title);let Zo;try{Zo=El({value:Ze[Mo][eo],to:to.uidt,column:to,appInfo:e(ve),oldValue:to.uidt===pe.Attachment?qn.row[to.title]:void 0,maxAttachmentsAllowedInCell:Ae.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:To[to.title],markInfoShown:()=>{To[to.title]=!0}},xe((nt=F.value)==null?void 0:nt.source_id),!0),rr(to,Zo)}catch(ul){if(ul instanceof bi)throw ul;if(ul instanceof sr)await dr({api:j,col:to,addOptions:ul.missingOptions}),Zo=ul.value.join(",");else if(ul instanceof za)Zo=null;else throw ul}Zo!==void 0&&(qn.row[to.title]=Zo)}else(Qo(to)||Cl(to)||Yo(to))&&!So&&(tn.toast(U("msg.info.groupPasteIsNotSupportedOnLinksColumn")),So=!0)}}jt.expand&&!te?(await(_==null?void 0:_(ao,Yn,Zn,void 0,rn.map(({column:Ue})=>Ue))),f==null||f()):await(b==null?void 0:b(Yn,Zn))}else if(Q.isSingleCell()){const _t=te?e(o)[_e.row]:e(o).get(_e.row);if(!_t)return;const Ze=e(n)[_e.col];if(Qo(Ze)&&!((et=Ze.meta)!=null&&et.custom)){const Kt=El({value:P,to:Ze.uidt,column:Ze,appInfo:e(ve)},xe((ut=F.value)==null?void 0:ut.source_id));if(Kt===void 0||!Sa(Kt))return;const nn=(Qe=(Ke=F.value)==null?void 0:Ke.columns)==null?void 0:Qe.find(mn=>{var ln;return mn.id===((ln=Ze.colOptions)==null?void 0:ln.fk_child_column_id)});if(!nn)return;const pt=await G(Ze.colOptions.fk_related_model_id);return _t.oldRow[Ze.title]=_t.row[Ze.title],_t.oldRow[nn.title]=_t.row[Ze.title]?qt(_t.row[Ze.title],pt.columns):null,_t.row[Ze.title]=Kt==null?void 0:Kt.value,_t.row[nn.title]=Kt!=null&&Kt.value?qt(Kt.value,pt.columns):null,await(y==null?void 0:y({..._e,updatedColumnTitle:nn.title}))}if(Yo(Ze)){const Kt=El({value:P,to:Ze.uidt,column:Ze,appInfo:e(ve)},xe((ht=F.value)==null?void 0:ht.source_id));if(Kt===void 0||!Sa(Kt))return;const nn=qt(_t.row,(Vt=F.value)==null?void 0:Vt.columns);if(!nn)return;const pt=_t.row[Ze.title];_t.row[Ze.title]=Kt.value;let mn;try{mn=await W.dbDataTableRow.nestedListCopyPasteOrDeleteAll((Pe=F.value)==null?void 0:Pe.id,Ze.id,[{operation:"copy",rowId:Kt.rowId,columnId:Kt.columnId,fk_related_model_id:Kt.fk_related_model_id},{operation:"paste",rowId:nn,columnId:Ze.id,fk_related_model_id:Ze.colOptions.fk_related_model_id||Kt.fk_related_model_id}],{viewId:(Se=He==null?void 0:He.value)==null?void 0:Se.id})}catch{_t.row[Ze.title]=pt;return}if(mn&&(mn!=null&&mn.link)&&(mn!=null&&mn.unlink)&&Array.isArray(mn.link)&&Array.isArray(mn.unlink)){if(!mn.link.length&&!mn.unlink.length){_t.row[Ze.title]=pt;return}Ee(te?{redo:{fn:async(ln,so,Sn,yn,kn,jt)=>{var an,rn,En,Yn,ao,Zn,So,To;if(((an=Le.value)==null?void 0:an.pageSize)===(yn==null?void 0:yn.pageSize)){((rn=Le.value)==null?void 0:rn.page)!==(yn==null?void 0:yn.page)&&await(w==null?void 0:w(yn==null?void 0:yn.page));const Ue=qt(Sn.row,(En=F.value)==null?void 0:En.columns),Mo=e(o)[ln.row],qn=e(n)[ln.col];if(Ue===qt(Mo.row,(Yn=F.value)==null?void 0:Yn.columns)&&qn.id===so.id)await Promise.all([jt.link.length&&W.dbDataTableRow.nestedLink((ao=F.value)==null?void 0:ao.id,qn.id,encodeURIComponent(Ue),jt.link,{viewId:(Zn=He==null?void 0:He.value)==null?void 0:Zn.id}),jt.unlink.length&&W.dbDataTableRow.nestedUnlink((So=F.value)==null?void 0:So.id,qn.id,encodeURIComponent(Ue),jt.unlink,{viewId:(To=He==null?void 0:He.value)==null?void 0:To.id})]),Mo.row[qn.title]=kn,await(y==null?void 0:y(ln));else throw new Error(U("msg.recordCouldNotBeFound"))}else throw new Error(U("msg.pageSizeChanged"))},args:[Ye(_e),Ye(Ze),Ye(_t),Ye(Le.value),Ye(Kt.value),mn]},undo:{fn:async(ln,so,Sn,yn,kn,jt)=>{var an,rn,En,Yn,ao,Zn;if(((an=Le.value)==null?void 0:an.pageSize)===yn.pageSize){((rn=Le.value)==null?void 0:rn.page)!==yn.page&&await(w==null?void 0:w(yn.page));const So=qt(Sn.row,(En=F.value)==null?void 0:En.columns),To=e(o)[ln.row],Ue=e(n)[ln.col];if(So===qt(To.row,(Yn=F.value)==null?void 0:Yn.columns)&&Ue.id===so.id)await Promise.all([jt.unlink.length&&W.dbDataTableRow.nestedLink((ao=F.value)==null?void 0:ao.id,Ue.id,encodeURIComponent(So),jt.unlink),jt.link.length&&W.dbDataTableRow.nestedUnlink((Zn=F.value)==null?void 0:Zn.id,Ue.id,encodeURIComponent(So),jt.link)]),To.row[Ue.title]=kn,await(y==null?void 0:y(ln));else throw new Error(U("msg.recordCouldNotBeFound"))}else throw new Error(U("msg.pageSizeChanged"))},args:[Ye(_e),Ye(Ze),Ye(_t),Ye(Le.value),Ye(pt),mn]},scope:Ge({view:He==null?void 0:He.value})}:{redo:{fn:async(ln,so,Sn,yn,kn)=>{var En,Yn,ao,Zn,So,To;const jt=qt(Sn.row,(En=F.value)==null?void 0:En.columns),an=e(o).get(ln.row);if(!an)return;const rn=e(n)[ln.col];jt===qt(an.row,(Yn=F.value)==null?void 0:Yn.columns)&&rn.id===so.id&&(await Promise.all([kn.link.length&&W.dbDataTableRow.nestedLink((ao=F.value)==null?void 0:ao.id,rn.id,encodeURIComponent(jt),kn.link,{viewId:(Zn=He==null?void 0:He.value)==null?void 0:Zn.id}),kn.unlink.length&&W.dbDataTableRow.nestedUnlink((So=F.value)==null?void 0:So.id,rn.id,encodeURIComponent(jt),kn.unlink,{viewId:(To=He==null?void 0:He.value)==null?void 0:To.id})]),an.row[rn.title]=yn,await(y==null?void 0:y(ln)))},args:[Ye(_e),Ye(Ze),Ye(_t),Ye(Kt.value),mn]},undo:{fn:async(ln,so,Sn,yn,kn)=>{var En,Yn,ao,Zn;const jt=qt(Sn.row,(En=F.value)==null?void 0:En.columns),an=e(o).get(ln.row);if(!an)return;const rn=e(n)[ln.col];jt===qt(an.row,(Yn=F.value)==null?void 0:Yn.columns)&&rn.id===so.id&&(await Promise.all([kn.unlink.length&&W.dbDataTableRow.nestedLink((ao=F.value)==null?void 0:ao.id,rn.id,encodeURIComponent(jt),kn.unlink),kn.link.length&&W.dbDataTableRow.nestedUnlink((Zn=F.value)==null?void 0:Zn.id,rn.id,encodeURIComponent(jt),kn.link)]),an.row[rn.title]=yn,await(y==null?void 0:y(ln)))},args:[Ye(_e),Ye(Ze),Ye(_t),Ye(pt),mn]},scope:Ge({view:He==null?void 0:He.value})})}return await(y==null?void 0:y(_e))}if(!Xt(_t,Ze,!0))return;let on;try{on=El({value:P,to:Ze.uidt,column:Ze,appInfo:e(ve),files:Ze.uidt===pe.Attachment&&((be=($t=R.clipboardData)==null?void 0:$t.files)!=null&&be.length)?(ze=R.clipboardData)==null?void 0:ze.files:void 0,oldValue:_t.row[Ze.title],maxAttachmentsAllowedInCell:Ae.value,showUpgradeToAddMoreAttachmentsInCell:H},xe((wt=F.value)==null?void 0:wt.source_id)),rr(Ze,on)}catch(Kt){if(Kt instanceof bi)throw Kt;if(Kt instanceof sr)await dr({api:j,col:Ze,addOptions:Kt.missingOptions}),on=Kt.value.join(",");else if(Kt instanceof za)on=null;else throw Kt}if(Ze.uidt===pe.Attachment&&((Fe=(q=R.clipboardData)==null?void 0:q.files)!=null&&Fe.length)&&(on!=null&&on.length)){const Kt=await qe(on,Ze.id,_t.row[Ze.title])||[],nn=Rl(_t.row[Ze.title])?_t.row[Ze.title]:[];_t.row[Ze.title]=Kt.length||nn.length?JSON.stringify(nn.concat(Kt)):null}else on!==void 0&&(_t.row[Ze.title]=on);await(y==null?void 0:y(_e))}else{const _t=Q.start,Ze=Q.end,on=Math.min(_t.row,Ze.row),Kt=Math.max(_t.row,Ze.row),nn=Math.min(_t.col,Ze.col),pt=Math.max(_t.col,Ze.col),mn=e(n).slice(nn,pt+1);let ln;te?ln=e(o).slice(on,Kt+1):ln=Array.from(e(o)).filter(([an])=>an>=on&&an<=Kt).map(([,an])=>an);const so=[];let Sn,yn=!1;const kn={},jt=(vt=R.clipboardData)==null?void 0:vt.files;for(const an of ln)if(!(!an||an.rowMeta.new))for(const rn of mn){if(!rn.title||!Xt(an,rn)){(Qo(rn)||Cl(rn)||Yo(rn))&&!yn&&(tn.toast(U("msg.info.groupPasteIsNotSupportedOnLinksColumn")),yn=!0);continue}if(jt!=null&&jt.length){if(rn.uidt!==pe.Attachment)continue;if(Sn===void 0){const En=El({value:"",to:rn.uidt,column:rn,appInfo:e(ve),files:jt,oldValue:an.row[rn.title],maxAttachmentsAllowedInCell:Ae.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:kn[rn.title],markInfoShown:()=>{kn[rn.title]=!0}},xe((Re=F.value)==null?void 0:Re.source_id),!0);if(En!=null&&En.length){const Yn=await qe(En,rn.id,an.row[rn.title]);Sn=Yn?JSON.stringify(Yn):null}}}else try{Sn=El({value:P,to:rn.uidt,column:rn,appInfo:e(ve),oldValue:an.row[rn.title],maxAttachmentsAllowedInCell:Ae.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:kn[rn.title],markInfoShown:()=>{kn[rn.title]=!0}},xe((yt=F.value)==null?void 0:yt.source_id),!0),rr(rn,Sn)}catch(En){if(En instanceof bi)throw En;if(En instanceof sr)await dr({api:j,col:rn,addOptions:En.missingOptions}),Sn=En.value.join(",");else if(En instanceof za)Sn=null;else throw En}so.push(rn.title),Sn!==void 0&&(an.row[rn.title]=Sn)}if(!so.length)return;await(b==null?void 0:b(ln,so))}}catch(_t){(!(_t instanceof za)||!_t.isErrorSuppressed)&&(console.error(_t,_t.isErrorSuppressed),tn.error(await pl(_t)))}};function st(R){var P,D;(R==null?void 0:R.button)===pu&&(je.value=!0,Y!=null&&Y.value&&we.value&&(ce.value=!0),Q._start&&Q._end&&(Mt.startRange({row:(P=Q._start)==null?void 0:P.row,col:Q._start.col}),Mt.endRange({row:(D=Q._end)==null?void 0:D.row,col:Q._end.col})),R.preventDefault())}async function qe(R,P,D){var K;const fe=[];try{const O=await Ie(R,[ya,he.value.id,(K=F.value)==null?void 0:K.id,P].join("/"));for(const Z of O)fe.push({...Z,title:Tf(Z==null?void 0:Z.title,[...u(D),...fe].map(ge=>(ge==null?void 0:ge.title)||(ge==null?void 0:ge.fileName)),Z==null?void 0:Z.mimetype)});return fe}catch(O){tn.error(await pl(O)||U("msg.error.internalError"))}}function u(R){const P=jn(R);return P&&Array.isArray(P)?P:[]}return Ml(document,"keydown",ft),Ml(document,"mouseup",bt),Ml(document,"paste",kt),Ml(m,"mousedown",st),{isCellActive:It,handleMouseDown:Ht,handleMouseOver:zt,clearSelectedRange:at,copyValue:mt,activeCell:_e,handleCellClick:Yt,resetSelectedRange:Be,selectedRange:Q,makeActive:cn,isMouseDown:lt,isFillMode:je,selectRangeMap:gt,fillRangeMap:ot,metaKey:Y}}const m1=Co(()=>Ro(()=>import("./B2f1fstS.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>t.default||t)),g1=Co(()=>Ro(()=>import("./CxSafZTa.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(t=>t.default||t)),w1=Co(()=>Ro(()=>import("./CiBV2ZED.js").then(t=>t.E),__vite__mapDeps([44,1,2,45,46,47,48,49,24,23,3,22,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,40,72,32,31,33,30,34,73,74,28,26,27,75,76,77]),import.meta.url).then(t=>t.default||t)),y1=Co(()=>Ro(()=>import("./CyKx2u6B.js"),__vite__mapDeps([78,1,2]),import.meta.url).then(t=>t.default||t)),b1=Co(()=>Ro(()=>import("./CMyFGii6.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url).then(t=>t.default||t)),_1=Co(()=>Ro(()=>import("./CkXo2doe.js").then(t=>t.C),__vite__mapDeps([37,1,2,12,13,38,39,40,28,23,22,26,27,41]),import.meta.url).then(t=>t.default||t)),x1=Co(()=>Ro(()=>Promise.resolve().then(()=>vd),void 0,import.meta.url).then(t=>t.default||t)),k1=Co(()=>Ro(()=>import("./yjlRPiAT.js"),__vite__mapDeps([79,1,2,66,67,68,69,44,45,46,47,48,49,24,23,3,22,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,70,71,40,72,32,31,33,30,34,73,74,28,26,27,75,76,77,80,81,82,19,83,84,85,86,87,88,89,90,91,92,37,12,13,38,39,41,93,94,95,29,96,97,98,99,100,7,8,9,10,11,14,15,16,17,18,20,21,25,35,36,101,102,103,104,105,106,107,108,109,110,111]),import.meta.url).then(t=>t.default||t)),C1={class:"flex flex-col h-full w-full"},R1={key:0,class:"absolute h-full flex items-center justify-center z-70 w-full inset-0 bg-white/50"},S1={class:"flex gap-2 items-center"},I1={key:0},F1={class:"nc-grid-header transform"},A1={key:0,"data-testid":"nc-check-all",class:"flex items-center pl-2 pr-1 w-full h-full"},E1={key:1,class:"w-full h-full text-gray-500 flex pl-2 pr-1","data-testid":"nc-check-all"},M1=["colspan"],T1=["onXcstartresizing","onXcresize","onXcresizing"],$1=["draggable","onDragstart"],O1=["colspan"],D1={class:"absolute top-0 left-0 h-8 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},L1={class:"h-full w-[60px] flex items-center justify-center"},N1={class:"nc-edit-or-add-provider-wrapper"},P1={class:"!border-0 relative !xs:hidden",style:{borderWidth:"0px !important"}},B1={class:"sticky left-0 flex items-center gap-2 transform bg-yellow-500 px-2 py-1 rounded-br-md font-semibold text-xs text-gray-800"},W1={class:"sticky left-0 flex items-center gap-2 transform bg-yellow-500 px-2 py-1 rounded-br-md font-semibold text-xs text-gray-800"},z1=["data-testid"],V1=["data-testid"],j1={class:"w-full flex items-center h-full px-1 gap-0.5"},U1=["data-testid"],G1=["onClick"],H1={key:1,class:"cursor-pointer nc-expand flex items-center border-1 border-gray-100 active:ring rounded-md p-0.75 hover:bg-white hover:border-nc-border-gray-medium"},Y1={key:0,class:"opacity-0.4 gap-2 truncate flex items-center overflow-x-hidden text-sm text-nc-content-gray-muted"},q1={key:1,class:"w-full"},X1=["colspan"],K1={key:0,class:"opacity-0.4 gap-2 truncate flex items-center overflow-x-hidden text-sm text-nc-content-gray-muted"},J1={key:1,class:"w-full"},Q1=["colspan"],Z1={class:"nc-grid-add-new-cell-item h-8 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500"},eb=["colspan"],tb={class:"flex gap-2 items-center"},nb={key:0,class:"flex gap-2 items-center"},ob={key:1,class:"flex gap-2 items-center"},lb={class:"flex gap-2 items-center"},ab={class:"flex gap-2 items-center"},ib={class:"flex gap-2 items-center"},rb={class:"flex gap-2 items-center"},sb={class:"flex gap-2 items-center"},ub={class:"flex gap-2 items-center"},db={class:"flex gap-2 items-center"},cb={class:"flex gap-2 items-center"},fb={class:"flex gap-2 items-center"},vb={class:"flex gap-2 items-center"},pb={class:"flex gap-2 items-center"},hb={class:"flex gap-2 items-center"},mb={key:0,class:"sticky left-0 py-[120px]"},gb={class:"flex flex-col gap-5 p-6 max-w-[520px] text-center mx-auto"},wb={class:"flex flex-col gap-2"},yb={class:"text-base font-700 text-nc-content-gray"},bb={class:"flex items-center justify-center gap-3"},_b={href:"https://nocodb.com/pricing",target:"_blank"},xb={class:"flex shadow-nc-sm rounded-lg"},kb={class:"flex items-center gap-2"},Cb={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},Rb={class:"flex flex-row items-center justify-start gap-x-3"},Sb={class:"flex flex-row items-center justify-start gap-x-3"},Di=50,Cc=100,Ib=100,Rc=40,Fb=50,Sc=5,Zi=10,Ab=ko({__name:"InfiniteTable",props:{totalRows:{},actualTotalRows:{},data:{},rowHeightEnum:{},loadData:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},deleteSelectedRows:{type:Function},clearInvalidRows:{type:Function},deleteRangeOfRows:{type:Function},updateRecordOrder:{type:Function},bulkUpdateRows:{type:Function},bulkDeleteAll:{type:Function},bulkUpsertRows:{type:Function},expandForm:{type:Function},removeRowIfNew:{type:Function},rowSortRequiredRows:{},applySorting:{type:Function},clearCache:{type:Function},syncCount:{type:Function},selectedRows:{},chunkStates:{},isBulkOperationInProgress:{type:Boolean},selectedAllRecords:{type:Boolean},getRows:{type:Function}},emits:["bulkUpdateDlg","update:selectedAllRecords"],setup(t,{expose:n,emit:o}){const l=t,a=o,i=Ra(l,"selectedAllRecords",a),{withLoading:s}=ps(),{loadData:r,callAddEmptyRow:d,updateOrSaveRow:c,deleteRow:f,expandForm:v,clearCache:h,syncCount:y,bulkUpdateRows:b,bulkUpsertRows:_,deleteRangeOfRows:m,removeRowIfNew:g,clearInvalidRows:C,updateRecordOrder:w,applySorting:S,bulkDeleteAll:x,getRows:$}=l,I=fn(Ai,V()),F=fn(cs,V()),E=fn(gr,V([])),M=fn(Ks,V(!1)),U=fn(Hi,V(!1)),L=fn(zl,V(!1)),G=vs(),ae=fn(Ea,Uo()),ve=fn(Zu,Uo()),xe=fn(Js,void 0),{isMobileMode:ne,isAddNewRecordGridMode:he,setAddNewRecordGridMode:W}=nl(),{isPkAvail:j,isSqlView:Ee,eventBus:Ye,allFilters:Ge,sorts:ke,isExternalSource:Y}=Il(),{isColumnSortedOrFiltered:we,appearanceConfig:oe}=tu(),{$e:ye,$api:ie}=da(),{t:H}=oa(),{getMeta:Ae}=oi(),{addUndo:Ie,clone:ce,defineViewScope:te}=Fi(),{isViewColumnsLoading:Le,updateGridViewColumn:Ne,gridViewCols:lt,metaColumnById:je,resizingColOldWith:He}=Ha(),{isExpandedFormCommentMode:Q}=Go(Sr()),{paste:Mt}=cd(),{addLTARRef:_e,syncLTARRefs:wn,clearLTARCell:It,cleaMMCell:Tt}=id(),{loadViewAggregate:Je}=nu(),{isAiFeaturesEnabled:cn,generateRows:Pn,generatingRows:Et,generatingColumnRows:Rn,generatingColumns:mt,aiIntegrations:ot}=xr(),{showRecordPlanLimitExceededModal:gt,blockExternalSourceRecordVisibility:zt,showAsBluredRecord:Ht,isWsOwner:Yt,navigateToPricing:Xt}=ql(),un=V(),bt=V(),xt=V(),ct=le(()=>Le.value||!I.value),ft=V(!1),Be=le(()=>mf()),at={[pe.Attachment]:{minWidth:80,maxWidth:Number.POSITIVE_INFINITY},[pe.Button]:{minWidth:100,maxWidth:320}},kt=(k,T)=>{if(k.uidt in at){const{minWidth:re,maxWidth:De}=at[k.uidt];if(re<T&&T<De)return T;if(T<re)return re;if(T>De)return De}return T},st=(k,T)=>{if(!k||!Ci(T==null?void 0:T.detail))return;const re=T.detail.split("px")[0];Ne(k,{width:`${kt(je.value[k],re)}px`})},qe=(k,T)=>{if(!k||!Ci(T==null?void 0:T.detail))return;const re=T.detail.split("px")[0];lt.value[k].width=`${kt(je.value[k],re)}px`,Nn()},u=(k,T)=>{k&&(He.value=T.detail,ft.value=!0)},R=Bn(l,"data"),P=Bn(l,"rowSortRequiredRows"),D=Bn(l,"totalRows"),fe=le(()=>zt(Y.value)&&D.value>=ll),K=le(()=>fe.value?0:256),O=Bn(l,"chunkStates"),Z=Bn(l,"isBulkOperationInProgress"),ge=le(()=>ne.value?56:Wo[`${l.rowHeightEnum}`]??32),ee=ki({start:0,end:100}),Me=async(k,T=!1)=>{if(O.value[k])return;const re=k*Di,De=T?Ib:Di;if(!(re>=D.value)){O.value[k]="loading",T&&(O.value[k+1]="loading");try{(await r({offset:re,limit:De})).forEach(Jt=>R.value.set(Jt.rowMeta.rowIndex,Jt)),O.value[k]="loaded",T&&(O.value[k+1]="loaded")}catch(Wt){console.error(`Error fetching chunk ${k}:`,Wt),O.value[k]=void 0,T&&(O.value[k+1]=void 0)}}},We=ki({viewProgress:null,rowProgress:new Map,cellProgress:new Map}),Xe=le(()=>{const{start:k,end:T}=ee;return Array.from({length:Math.min(T,D.value)-k},(re,De)=>{var bn;const Wt=k+De,Jt=R.value.get(Wt);if(!Jt)return{row:{},oldRow:{},rowMeta:{rowIndex:Wt,isLoading:!0}};const pn=qt(Jt.row,((bn=I.value)==null?void 0:bn.columns)??[]);return Jt.rowMeta.rowProgress=We.rowProgress.get(String(pn)),Jt})}),nt=le(()=>{var k;return!bt.value||ee.start<=1?0:parseInt(`${((k=bt.value)==null?void 0:k.clientHeight)/(ge.value||32)}`)*3}),et=le(()=>{const k={length:ee.start>1?Math.min(ee.start-1,nt.value):0,rowHeight:ge.value,totalRowHeight:0};return k.totalRowHeight=k.length*k.rowHeight,k}),ut=le(()=>{const k={length:ee.end<D.value-1?Math.min(D.value-1-ee.end,nt.value):0,rowHeight:ge.value,totalRowHeight:0};return k.totalRowHeight=k.length*k.rowHeight,k}),Ke=le(()=>ge.value*(ee.start-et.value.length));let Qe=null;const ht=async(k=!1)=>{const{start:T,end:re}=ee,De=Math.floor(T/Di),Wt=Math.floor((re-1)/Di),Jt=new Set;for(let $n=De;$n<=Wt;$n++)O.value[$n]||Jt.add($n);const pn=Wt+1;re%Di>Di-Rc&&!O.value[pn]&&Jt.add(pn);const bn=De-1;bn>=0&&T%Di<Rc&&!O.value[bn]&&Jt.add(bn),Jt.size!==0&&(clearTimeout(Qe),Qe=setTimeout(async()=>{De===0&&!O.value[0]&&(await Me(0,!0),Jt.delete(0),Jt.delete(1)),await Promise.all([...Jt].map(Gt=>Me(Gt)));const fo=Math.max(0,T-Cc),dt=Math.min(D.value,re+Cc);h(fo,dt)},k?Fb:25))},{isUIAllowed:Vt,isDataReadOnly:Pe}=gl(),Se=le(()=>Vt("dataEdit")&&!Ee.value),$t=le(()=>!M.value&&Vt("fieldAdd")&&!Ee.value),{onDrag:be,onDragStart:ze,onDragEnd:wt,draggedCol:q,dragColPlaceholderDomRef:Fe,toBeDroppedColId:vt}=mv({fields:E,tableBodyEl:un,gridWrapper:bt}),Re=le(()=>{var k;return(((k=I.value)==null?void 0:k.columns)??[]).some(T=>$f(T))}),yt=le(()=>{var k,T;return((k=Ge.value)==null?void 0:k.length)||((T=ke.value)==null?void 0:T.length)||L.value}),_t=le(()=>{var k;return((k=ke.value)==null?void 0:k.length)||L.value||!j.value}),Ze=V(!1),on=V(!1),Kt=V(),nn=V(!1),pt=V(!1),mn=V(null),ln=V(!1),so=V(!1),Sn=V(!1),yn=Bn(l,"selectedRows"),kn=V(!1),jt=V(null),an=le({get:()=>yn.value.length&&Pe.value||jt.value===null&&!yn.value.length&&!i.value?!1:Sn.value,set:k=>{Sn.value=k}}),rn=(k,T)=>{Ee.value||(k.preventDefault(),T&&(jt.value=T))},En=V(!1);yo(Bf,En);const Yn=V(!1),ao=k=>ra(k)||wp(k)||yp(k)||Uu(k)||Pf(k)||xo(k)||Os(k)||rs(k)||k.readonly,Zn=le(()=>E.value.map(k=>({isVirtualCol:xo(k),isReadonly:ao(k)})));async function So(k,T=!1){var Wt;if(Pe.value||!k||!Se.value||!hl(E.value[k.col])&&xo(E.value[k.col])||E.value[k.col].readonly||Zn.value[k.col].isReadonly&&!xo(E.value[k.col]))return;const re=R.value.get(k.row);if(!re)return;const De=E.value[k.col];if(xo(De)){let Jt;const pn=re.row[De.title],bn=De.fk_model_id===((Wt=De.colOptions)==null?void 0:Wt.fk_related_model_id);Yo(De)&&re&&(Jt=await Tt(re,De)),Ie({undo:{fn:async($n,fo,dt,Gt,oo,gn)=>{var ea,fi,Vo;const wo=qt(dt.row,(ea=I.value)==null?void 0:ea.columns),On=R.value.get($n.row),Fo=E.value[$n.col];if(On&&Fo.title&&wo===qt(On.row,(fi=I.value)==null?void 0:fi.columns)&&Fo.id===fo.id)Qo(Fo)||Cl(Fo)?(On.row[Fo.title]=dt.row[Fo.title],await _e(On,On.row[Fo.title],Fo),await wn(On,On.row)):Yo(Fo)&&(await ie.dbDataTableRow.nestedLink((Vo=I.value)==null?void 0:Vo.id,Fo.id,encodeURIComponent(wo),Gt),On.row[Fo.title]=oo??null),it.col=$n.col,it.row=$n.row,gn&&ae.trigger({shouldShowLoading:!1}),io==null||io();else throw new Error(H("msg.recordCouldNotBeFound"))},args:[ce(k),ce(De),ce(re),Jt,pn]},redo:{fn:async($n,fo,dt,Gt)=>{var On,Fo;const oo=qt(dt.row,(On=I.value)==null?void 0:On.columns),gn=R.value.get($n.row),wo=E.value[$n.col];if(gn&&oo===qt(gn.row,(Fo=I.value)==null?void 0:Fo.columns)&&wo.id===fo.id)Qo(wo)||Cl(wo)?await It(gn,wo):Yo(wo)&&await Tt(gn,wo),it.col=$n.col,it.row=$n.row,Gt&&ae.trigger({shouldShowLoading:!1}),io==null||io();else throw new Error(H("msg.recordCouldNotBeFound"))},args:[ce(k),ce(De),ce(re),bn]},scope:te({view:F.value})}),(Qo(De)||Cl(De))&&await It(re,De),bn&&ae.trigger({shouldShowLoading:!1});return}if(De.title)switch(De.uidt){case pe.Checkbox:re.row[De.title]=!1;break;case pe.Rating:re.row[De.title]=0;break;default:re.row[De.title]=null;break}T||await(c==null?void 0:c(re,De.title))}function To(k,T){if(!(!Se.value||ln.value||M.value||ra(T)||T.readonly)){if(!j.value&&!k.rowMeta.new){tn.info(H("msg.info.updateNotAllowedWithoutPK"));return}if(T.ai){tn.info(H("msg.info.autoIncFieldNotEditable"));return}if(T.pk&&!k.rowMeta.new){tn.info(H("msg.info.editingPKnotSupported"));return}if(![pe.SingleSelect,pe.MultiSelect].includes(T.uidt))return ln.value=!0}}const Ue=le(()=>{var k;return Se.value&&!Ee.value&&!L.value&&!((k=I.value)!=null&&k.synced)}),Mo=le(()=>{var k;return(k=E.value)==null?void 0:k.length}),qn=le(()=>Array.from({length:11}).map(()=>({}))),eo=le(()=>{var k;return(k=Xe.value)==null?void 0:k.map(T=>{var Wt;const re=qt(T.row,((Wt=I.value)==null?void 0:Wt.columns)??[]),De=We.cellProgress.get(re);return E.value.map(Jt=>({isColumnRequiredAndNull:$s(Jt,T.row),cellProgress:De==null?void 0:De.get(Jt.id)}))})});function to(k){_l("instant"),setTimeout(()=>{Ze.value=!0,Kt.value=k},500)}function Zo(k=!1){mn.value=null,Ze.value=!1,Kt.value={},k&&setTimeout(()=>{_l("instant")},200)}async function ul(){const k=await St(D.value+1,!0);k&&(v==null||v(k,void 0,!0))}const ai=()=>{ve.trigger()},Ma=()=>{gt()||(W(!0),St())};function Cn(){gt()||(W(!1),ai())}const Ta=V(null),Ka=V(null),Mi=(k,T,re)=>{var dt,Gt;const De=T.getBoundingClientRect(),Wt=15,Jt=((dt=Ta.value)==null?void 0:dt.getBoundingClientRect().width)??0,pn=((Gt=Ka.value)==null?void 0:Gt.getBoundingClientRect().width)??0,bn=Jt+pn,$n={right:k.right+Jt-De.width-T.scrollLeft,left:k.left+Jt-T.scrollLeft-bn,bottom:k.bottom-De.height-T.scrollTop,top:k.top-T.scrollTop},fo={top:0,left:0};return fo.left=$n.right+(re==null?void 0:re.right)>0?T.scrollLeft+$n.right+(re==null?void 0:re.right)+Wt:$n.left-((re==null?void 0:re.left)||0)<0?T.scrollLeft+$n.left-((re==null?void 0:re.left)||0)-Wt:T.scrollLeft,fo.top=$n.bottom+(re==null?void 0:re.bottom)>0?T.scrollTop+$n.bottom+(re==null?void 0:re.bottom)+Wt:$n.top-(re==null?void 0:re.top)<0?T.scrollTop+$n.top-(re==null?void 0:re.top)-Wt:T.scrollTop,fo},al=()=>{C==null||C(),P.value.length&&(S==null||S(P.value))},fa=V(!1),$a=V(!1);async function Ja(){$a.value=!0;const{close:k}=ss(vv,{modelValue:$a,rows:D.value,"onUpdate:modelValue":T,onDeleteAll:async()=>{await(x==null?void 0:x()),T(),i.value=!1}});function T(){fa.value=!1,k(200)}await ka($a).toBe(!1)}async function Xl({newRows:k,newColumns:T,cellsOverwritten:re,rowsUpdated:De}){fa.value=!0;const Wt={continue:!1,expand:!0},{close:Jt}=ss(pv,{modelValue:fa,newRows:k,newColumns:T,cellsOverwritten:re,rowsUpdated:De,isAddingEmptyRowPermitted:!0,meta:I.value,"onUpdate:expand":bn,"onUpdate:modelValue":pn});function pn(){fa.value=!1,Jt(1e3)}async function bn($n){Wt.continue=!0,Wt.expand=$n,Jt(1e3)}return await ka(fa).toBe(!1),Wt}const{selectRangeMap:Oa,fillRangeMap:Qa,activeCell:it,handleMouseDown:Kl,handleMouseOver:No,handleCellClick:Io,clearSelectedRange:Po,copyValue:_o,isCellActive:Dl,resetSelectedRange:Ko,makeActive:Da,selectedRange:sn,isFillMode:wl,metaKey:Mn}=gv(I,E,R,D,ln,j,an,So,Vl,To,io,Xl,k=>{var Wt,Jt;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return k.preventDefault(),!0;if(Wl())return;if(sa()||Vi())return!0;const re=Va()?k.metaKey:k.ctrlKey,De=k.altKey;if(k.key===" "){if(k.shiftKey)return!0;const pn=Wl();if(!ln.value&&Dl.value&&it.row!==null&&!pn){k.preventDefault();const bn=R.value.get(it.row);return bn?(fe.value&&bn.rowMeta.rowIndex&&bn.rowMeta.rowIndex>=ll||v==null||v(bn),!0):void 0}}else if(k.key==="Escape"){if(ln.value)return ln.value=!1,!0}else if(k.key==="Enter"){if(k.shiftKey)return!0;if(ln.value)return ln.value=!1,!0}else if(k.key==="Tab"){if(!k.shiftKey&&it.row===D.value-1&&it.col===((Wt=E.value)==null?void 0:Wt.length)-1)return k.preventDefault(),Ue.value&&!fe.value&&(Yn.value=!0),!0;if(k.shiftKey&&it.row===0&&it.col===0)return k.preventDefault(),!0}if(re){if(!Dl.value||k.shiftKey)return;switch(k.key){case"ArrowUp":return k.preventDefault(),Po(),it.row=0,it.col=it.col??0,sn.startRange({row:it.row,col:it.col}),sn.endRange({row:it.row,col:it.col}),io==null||io(void 0,void 0,"instant"),ln.value=!1,al(),!0;case"ArrowDown":return k.preventDefault(),Po(),it.row=D.value-1,it.col=it.col??0,sn.startRange({row:it.row,col:it.col}),sn.endRange({row:it.row,col:it.col}),io==null||io(void 0,void 0,"instant"),ln.value=!1,al(),!0;case"ArrowRight":return k.preventDefault(),Po(),it.row=it.row??0,it.col=((Jt=E.value)==null?void 0:Jt.length)-1,sn.startRange({row:it.row,col:it.col}),sn.endRange({row:it.row,col:it.col}),io==null||io(),ln.value=!1,!0;case"ArrowLeft":return k.preventDefault(),Po(),it.row=it.row??0,it.col=0,sn.startRange({row:it.row,col:it.col}),sn.endRange({row:it.row,col:it.col}),io==null||io(),ln.value=!1,!0}}if(De)switch(k.keyCode){case 82:{Ue.value&&!fe.value&&(ye("c:shortcut",{key:"ALT + R"}),St(),it.row=D.value-1,it.col=0,Ko(),tl(()=>{var pn;(pn=document.querySelector("td.cell.active"))==null||pn.scrollIntoView({behavior:"smooth"})}));break}case 67:{$t.value&&(ye("c:shortcut",{key:"ALT + C"}),_l("instant"),setTimeout(()=>{Ze.value=!0},250));break}}},async k=>{var Wt;const T=R.value.get(k.row),re=k.col!==void 0?E.value[k.col]:null;if(!T||!re)return;if(!k.updatedColumnTitle&&xo(re)){re.fk_model_id===((Wt=re.colOptions)==null?void 0:Wt.fk_related_model_id)&&(ae==null||ae.trigger({shouldShowLoading:!1}));return}const De=R.value.get(k.row);if(De){const Jt={...De,rowMeta:{...De.rowMeta,isUpdatedFromCopyNPaste:{...De.rowMeta.isUpdatedFromCopyNPaste||{},[k.updatedColumnTitle||re.title]:!0}}};R.value.set(k.row,Jt)}await(c==null?void 0:c(T,k.updatedColumnTitle||re.title))},b,_,xt,F,void 0,void 0,Me,al,$);function Ve(k){Po(),Da(k??D.value-1,0),sn.startRange({row:it.row,col:it.col}),io==null||io(k)}async function Ut(k,T){await(c==null?void 0:c(k,null,null,{metaValue:I.value,viewMetaValue:F.value},T))}async function St(k,T=!1,re){if(gt({focusBtn:null})||fe.value&&!re&&!k&&!T)return;C==null||C(),P.value.length&&(S==null||S(P.value));const De=d==null?void 0:d(k);return!T&&De&&Ut(De,re),tl().then(()=>{Ve(k??D.value-1)}),De}const Ct=k=>{try{f==null||f(k),sn.isRowInRange(k)&&Po(),it.row===k&&(it.row=null,it.col=null)}catch(T){tn.error(T.message)}},dn=k=>{try{Q.value=!0;const T=R.value.get(k);v&&v(T),it.row=null,it.col=null,sn.clear()}catch(T){tn.error(T.message)}},_n=()=>{m==null||m(sn).then(()=>{Po(),it.row=null,it.col=null})},In=le(()=>{var k;if(sn.start.col===sn.end.col){const T=E.value[sn.start.col];return{enabled:_a(T)||is(T),disabled:!((k=T==null?void 0:T.colOptions)!=null&&k.fk_integration_id)}}return{enabled:!1,disabled:!1}}),Ot=le(()=>{if(sn.start.col===sn.end.col){const k=E.value[sn.start.col];return{enabled:Of(k),disabled:!1}}return{enabled:!1,disabled:!1}}),{runScript:xn}=Ps(),Qn=async()=>{var re;if(!Ot.value.enabled||!((re=I==null?void 0:I.value)!=null&&re.id)||!I.value.columns)return;const k=E.value[sn.start.col],T=await $(sn.start.row,sn.end.row+1);for(const De of T){const Wt=qt(De.row,I.value.columns);xn(k.colOptions.fk_script_id,De.row,{pk:Wt,fieldId:k.id})}},Jo=le(()=>Mn.value&&cn.value),Un=async()=>{var Jt,pn;if(!In.value.enabled||!((Jt=I==null?void 0:I.value)!=null&&Jt.id)||!I.value.columns)return;const k=E.value[sn.start.col];if(!k.id)return;const T=await $(sn.start.row,sn.end.row+1);if(!T||T.length===0)return;let re=[k.id];is(k)&&(re=Ci((pn=k.colOptions)==null?void 0:pn.output_column_ids)&&k.colOptions.output_column_ids.split(",").length>0?k.colOptions.output_column_ids.split(","):[]);const De=T.map(bn=>qt(bn.row,I.value.columns)).filter(bn=>bn!==null);Et.value.push(...De),Rn.value.push(k.id),mt.value.push(...re);const Wt=await Pn(I.value.id,k.id,De);if(Wt)for(const bn of Wt){const $n=Array.from(R.value.values()).find(fo=>qt(fo.row,I.value.columns)===qt(bn,I.value.columns));$n&&($n.row={...$n.row,...bn})}Et.value=Et.value.filter(bn=>!De.includes(bn)),Rn.value=Rn.value.filter(bn=>bn!==k.id),mt.value=mt.value.filter(bn=>!(re!=null&&re.includes(bn)))};Xs(un,k=>{if(nn.value||ft.value||an.value||it.row===null||it.col===null||Wl())return;const re=E.value[it.col];if(ln.value&&(xo(re)||re.uidt===pe.JSON)||wl.value)return;const De=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active,.nc-link-dropdown-root");k.target&&De&&(De===k.target||De!=null&&De.contains(k.target))||sa()||(al(),Po(),it.row=null,it.col=null)});const mo=k=>{if(!(it.row===null||it.col===null)){switch(ln.value=!1,Po(),k){case Gl.NEXT:it.row<D.value-1||St(),it.row++;break;case Gl.PREV:it.row>0&&it.row--;break}tl(()=>{io()})}};async function Vl(){if(!Se.value||Pe.value)return;const k=sn.start,T=sn.end,re=Math.min(k.col,T.col),De=Math.max(k.col,T.col),Wt=E.value.slice(re,De+1),Jt=await $(k.row,T.row),pn=[];let bn=!1;for(const $n of Jt)for(const fo of Wt)if(!(!$n||!fo||!fo.title)){if(xo(fo)){(Qo(fo)||Cl(fo)||Yo(fo))&&!bn&&(tn.info(H("msg.info.groupClearIsNotSupportedOnLinksColumn")),bn=!0);continue}ao(fo)||($n.row[fo.title]=null,pn.push(fo.title))}await(b==null?void 0:b(Jt,pn))}const Eo=le(()=>E.value.filter(k=>k.id&&lt.value[k.id]&&lt.value[k.id].width&&lt.value[k.id].show).map(k=>+lt.value[k.id].width.replace("px","")||180).reduce((k,T,re)=>(k.push(k[re]+T),k),[0])),yl=V(0),il=V(0);function io(k,T,re="instant"){if(k=k??it.row,T=T??it.col,k!==null&&T!==null&&bt.value){const De={top:k*ge.value,left:Eo.value[T],right:T===E.value.length-1?Eo.value[Eo.value.length-1]+180:Eo.value[T+1],bottom:(k+1)*ge.value},Wt=Mi(De,bt.value,{top:9,bottom:41,right:9});T===0&&(Wt.left=0);const Jt={top:Wt.top,left:Wt.left,behavior:re};k===D.value-1&&(Jt.top=bt.value.scrollHeight),T===E.value.length-1&&(Jt.left=bt.value.scrollWidth),bt.value.scrollTo(Jt)}}const Fl=V([]),va=async(k={})=>{var T,re,De,Wt;for(const Jt of k.data||R.value.entries())if(!((T=Jt.rowMeta)!=null&&T.fromExpandedForm)){if((re=Jt.rowMeta)!=null&&re.new){const pn=ce(Jt);await(c==null?void 0:c(Jt,"",Jt.rowMeta.ltarState||{},k))?Jt.rowMeta.changed=!1:k.keepNewRecords&&pn.rowMeta.new&&Object.keys(pn.row).length&&Fl.value.push(pn);continue}if((De=Jt.rowMeta)!=null&&De.changed){Jt.rowMeta.changed=!1;for(const pn of((Wt=k.metaValue||I.value)==null?void 0:Wt.columns)??[])xo(pn)||pn.uidt===pe.Attachment||pn.title in Jt.row&&Jt.row[pn.title]!==Jt.oldRow[pn.title]&&await(c==null?void 0:c(Jt,pn.title,{},k))}}},La=V(),el=()=>{var k;Ze.value=(k=La.value)==null?void 0:k.shouldKeepModalOpen()},no=V({start:0,end:0}),Ll=V(),ii=V(),Jl=V(),ri=V();let si=-1,qi=-1,ui=-1,di=-1;const ci=(k,T)=>{if(si===k&&qi===T)return{renderStart:ui,renderEnd:di};let re=0,De=0,Wt=Eo.value.length-1;for(;De<=Wt;){const pn=Math.floor((De+Wt)/2);if(Eo.value[pn]<=k&&Eo.value[pn+1]>k){re=pn;break}Eo.value[pn]<k?De=pn+1:Wt=pn-1}let Jt=Eo.value.findIndex(pn=>pn>T+k);return Jt=Jt===-1?Eo.value.length:Jt,si=k,qi=T,ui=re,di=Jt,{renderStart:re,renderEnd:Jt}},A=(k,T,re)=>re.start!==k||re.end!==T?(Object.assign(re,{start:k,end:T}),!0):!1,N=()=>{if(!bt.value){Object.assign(no.value,{start:0,end:0}),setTimeout(N,50);return}if(ii.value&&ii.value===yl.value&&Math.abs(Ll.value-il.value)<32*(Zi-2)&&Jl.value===D.value&&ri.value===E.value.length)return;ii.value=yl.value,Ll.value=il.value,ri.value=E.value.length;const{renderStart:k,renderEnd:T}=ci(yl.value,bt.value.clientWidth),re=Math.max(0,k-Sc),De=Math.min(E.value.length,T+Sc);A(re,De,no.value);const Wt=Math.max(0,Math.floor(il.value/ge.value)),Jt=Math.ceil(bt.value.clientHeight/ge.value),pn=Math.min(Wt+Jt,D.value),bn=Math.max(0,Wt-Zi),$n=Math.min(D.value,Math.max(pn+Zi,bn+50));(ee.start<10||Math.abs(bn-ee.start)>=Zi/2||Math.abs($n-ee.end)>=Zi/2||Jl.value!==D.value)&&(ee.start=bn,ee.end=$n,ht(!0),Jl.value=D.value)},Te=le(()=>E.value.slice(no.value.start,no.value.end).map((T,re)=>({field:T,index:re+no.value.start})).filter(T=>T.index!==0)),At=le(()=>{const k={length:no.value.start>0?no.value.start-1:0,width:0};return k.width=k.length?Eo.value[no.value.start]-Eo.value[1]:0,k}),Fn=le(()=>{const k={length:no.value.end<E.value.length-1?E.value.length-no.value.end:0,width:0};return k.width=k.length?Eo.value[E.value.length]-Eo.value[no.value.end]:0,k}),Vn=le(()=>2+Te.value.length+At.value.length+Fn.value.length),zo=V(),Ln=V();function Nn(){const k=isNaN(sn.end.row)?it.row:sn.end.row,T=isNaN(sn.end.col)?it.col:sn.end.col;if(k!==null&&T!==null){if(!bt.value||!bt.value)return;zo.value=(k+1)*ge.value+32,Ln.value=80+Eo.value[T+1]+(T===0?Math.max(0,bt.value.scrollLeft-bt.value.offsetLeft):0)}}const Oo=le(()=>sn.isEmpty()&&it.col&&Zn.value[it.col].isReadonly||!sn.isEmpty()&&Array.from({length:sn.end.col-sn.start.col+1}).every((k,T)=>Zn.value[sn.start.col+T].isReadonly)),co=le(()=>Oo.value&&(!sn.isSingleCell()||!jt.value||!Yo(E.value[jt.value.col])&&!Qo(E.value[jt.value.col]))),go=le(()=>Oo.value&&(!sn.isSingleCell()||!jt.value||!hl(E.value[jt.value.col]))),Ql=le(()=>{var k,T;return!Pe.value&&!M.value&&!ln.value&&(!sn.isEmpty()||it.row!==null&&it.col!==null)&&!((T=(k=R.value.get((isNaN(sn.end.row)?it.row:sn.end.row)??-1))==null?void 0:k.rowMeta)!=null&&T.new)&&it.col!==null&&E.value[it.col]&&D.value&&!Oo.value&&!Ee.value&&(!fe.value||sn.end.row<ll)});Hn([()=>sn.end.row,()=>sn.end.col,()=>it.row,()=>it.col],([k,T,re,De],[Wt,Jt,pn,bn])=>{(k!==Wt||T!==Jt||re!==pn||De!==bn)&&Nn()});const Nl=k=>{var T;switch(k.type){case"table":We.viewProgress={progress:k.data.progress,message:k.data.message};break;case"row":We.rowProgress.set(k.data.rowId,{progress:k.data.progress,message:k.data.message});break;case"cell":{We.cellProgress.has(k.data.rowId)||We.cellProgress.set(k.data.rowId,new Map),We.cellProgress.get(k.data.rowId).set(k.data.cellId,{progress:k.data.progress,message:k.data.message,icon:(T=k.data)==null?void 0:T.icon});break}}},Pl=k=>{switch(k.type){case"table":We.viewProgress=null,We.cellProgress=new Map,We.rowProgress=new Map;break;case"row":k.data.rowId&&(We.rowProgress.delete(k.data.rowId),We.rowProgress.set(k.data.rowId,null));break;case"cell":if(k.data.rowId&&k.data.cellId){const T=We.cellProgress.get(k.data.rowId);T&&(T.delete(k.data.cellId),T.size===0?We.cellProgress.delete(k.data.rowId):We.cellProgress.set(k.data.rowId,T))}break}};Ye.on(async(k,T)=>{k===Xo.FIELD_ADD&&(mn.value=T,Ze.value=!0),k===Xo.CLEAR_NEW_ROW&&(Po(),it.row=null,it.col=null,g==null||g(T))}),Hn(it,k=>{var pn,bn,$n;const T=k.row!==null?(pn=R.value.get(k.row))==null?void 0:pn.row:void 0,re=T&&k.col!==null?E.value[k.col]:void 0,De=T&&re?T[re.title]:void 0,Wt=qt(T,(bn=I.value)==null?void 0:bn.columns),Jt=($n=F.value)==null?void 0:$n.id;Ye.emit(Xo.CELL_SELECTED,{rowId:Wt,colId:re==null?void 0:re.id,val:De,viewId:Jt})});const ol=s(async k=>{var T;k!=null&&k.fieldAdd&&((T=bt.value)==null||T.scrollTo({top:0,left:0,behavior:"instant"})),await va({keepNewRecords:!0}),h(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),await y(),N(),await Promise.all([Je(),ht()]),Fl.value.forEach((re,De)=>{re.rowMeta.rowIndex=D.value+De,R.value.set(D.value+De,re)})});let bl=null;const{eventBus:pa}=Ps();pa.on(async(k,T)=>{k===Cs.UPDATE_PROGRESS&&Nl(T),k===Cs.RESET_PROGRESS&&Pl(T),k===Cs.RELOAD_VIEW&&await ol()}),gp(bt,{onScroll:k=>{bl&&cancelAnimationFrame(bl),bl=requestAnimationFrame(()=>{var T,re;yl.value=(T=k.target)==null?void 0:T.scrollLeft,il.value=(re=k.target)==null?void 0:re.scrollTop,N(),Nn(),bl=null})},throttle:100,behavior:"smooth"}),Ml(document,"mousedown",k=>{var T,re;(k.offsetX>((T=k.target)==null?void 0:T.clientWidth)||k.offsetY>((re=k.target)==null?void 0:re.clientHeight))&&(nn.value=!0),k.target.closest(".nc-grid-cell:not(.caption)")&&(so.value=!0)}),Ml(document,"mouseup",()=>{so.value=!1,setTimeout(()=>{nn.value=!1},100)}),Ml(document,"keyup",async k=>{var Wt;const T=Wl();k.key==="Alt"&&!T&&(on.value=!1);const re=document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"),De=Va()?k.metaKey:k.ctrlKey;Yn.value&&!T&&!re&&!sa()&&!De&&!k.shiftKey&&!k.altKey&&(k.key==="Tab"&&it.row===D.value-1&&it.col===((Wt=E.value)==null?void 0:Wt.length)-1||k.key==="ArrowDown"&&it.row===D.value-1&&Ue.value&&!fe.value)&&(St(),Yn.value=!1)}),Ml(document,"keydown",async k=>{const T=Va()?k.metaKey:k.ctrlKey;if(k.altKey&&!k.shiftKey&&!T)switch(k.keyCode){case 78:{Ue.value&&!fe.value&&St();break}}});const Zl=()=>{N(),Nn(),ht()};Ga(async()=>{const k=F.value,T=R.value.values();k&&Ae(k.fk_model_id,!1,!0).then(re=>{const De=re;De&&va({metaValue:De,viewMetaValue:k,data:T})}),ae==null||ae.off(ol),ve==null||ve.off(ul),xe==null||xe.off(Zl)}),ve==null||ve.on(ul),ae==null||ae.on(ol),xe==null||xe.on(Zl),Hn(an,()=>{an.value?kn.value=!1:(kn.value=!0,jt.value=null)}),Hn(F,async(k,T)=>{try{if(k&&k.id!==(T==null?void 0:T.id)&&(k.fk_model_id===G.params.viewId||L.value)){if(await ka(ct).toMatch(re=>!re),pt.value=!0,T!=null&&T.id){const re=await Ae(T.fk_model_id,!1,!0);re&&await va({viewMetaValue:T,metaValue:re,data:R.value.entries()})}try{await y(),N(),ee.end===0&&(ee.end=Math.min(100,D.value)),await Promise.allSettled([Je(),ht()])}catch(re){ed.isCancel(re)||(console.log(re),tn.error(H("msg.errorLoadingData")))}}}catch(re){console.error(re)}finally{pt.value=!1}},{immediate:!0}),Hn([()=>E.value.length,()=>R.value.size],()=>{N(),Nn(),ht()}),Hn(ge,()=>{N()}),yo(Wf,on),n({scrollToRow:Ve,openColumnCreate:to});const dl=(k,T)=>{v&&v(k,T),it.row=null,it.col=null,sn.clear()},Na=(k,T,re)=>{const De=R.value.get(T);if(it.row!==T&&al(),ne.value)return dl(De,E.value[re]);Io(k,T,re)};function _l(k){var T;(T=bt.value)==null||T.scrollTo({top:bt.value.scrollTop,left:bt.value.scrollWidth,behavior:k})}const de=le(()=>Eo.value[Eo.value.length-1]+80),Ce=le(()=>D.value*ge.value),{width:Oe,height:Ft}=Xu();Hn([Oe,Ft],()=>{N()},{immediate:!0});const rt=(k,T)=>{var De;const re=R.value.get(T==="above"?k.row:k.row+1);if(re){const Wt=qt(re.row,(De=I.value)==null?void 0:De.columns);St(k.row+(T==="above"?0:1),!1,Wt)}else St()},Rt=k=>{it.row=null,it.col=null,k.rowMeta.isDragging=!0,R.value.set(k.rowMeta.rowIndex,k)},{startDragging:Qt,isDragging:Zt,draggingRecord:Bt,targetTop:Lt}=v1({updateRecordOrder:w,onDragStart:Rt,gridWrapper:bt,virtualMargin:Zi,rowHeight:ge,totalRows:D,rowSlice:ee,cachedRows:R}),vn=(k,T)=>{L.value||(k.rowMeta.isDragging=!0,R.value.set(k.rowMeta.rowIndex,k),Qt(k,T))},Wn=k=>{var re;if(i.value)return;const T=R.value.get(k);T&&(T.rowMeta.selected=!((re=T.rowMeta)!=null&&re.selected),R.value.set(k,T))};Hn(i,k=>{var T;if(!k)for(const[re,De]of R.value.entries())(T=De.rowMeta)!=null&&T.selected&&(De.rowMeta.selected=!1,R.value.set(re,De))}),Hn(fe,k=>{he.value&&k&&W(!k)},{immediate:!0});const zn=le(()=>!l.rowHeightEnum||l.rowHeightEnum===1?"align-middle":"align-top"),Tn=k=>{var re;const T=we(k);if(T){const De=(re=oe[T])==null?void 0:re.cellBgClass;if(De)return{[De]:!0}}return{}},An=k=>{var re;const T=we(k,!0);if(T){const De=(re=oe[T])==null?void 0:re.headerBgClass;if(De)return{[De]:!0}}return{}};return(k,T)=>{var Fr,Ar,Er,Mr,Gn;const re=Ys,De=uv,Wt=Df,Jt=m1,pn=g1,bn=w1,$n=Lf,fo=y1,dt=$l,Gt=Aa,oo=ca,gn=Nf,wo=u1,On=b1,Fo=_1,ea=hv,fi=x1,Vo=Ya,Pa=br,Ti=dd,Za=qa,$i=Gi,Xi=k1,Oi=Yl("xc-ver-resize"),Ho=Yl("e");return p(),B("div",C1,[T[46]||(T[46]=z("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),z("div",{ref_key:"dragColPlaceholderDomRef",ref:Fe,class:Dt([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(q)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(q)?(p(),B("div",{key:0,style:Xn({"min-width":((Fr=e(lt)[e(q).id])==null?void 0:Fr.width)||"200px","max-width":((Ar=e(lt)[e(q).id])==null?void 0:Ar.width)||"200px",width:((Er=e(lt)[e(q).id])==null?void 0:Er.width)||"200px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):me("",!0)],2),e(Z)||e(We).viewProgress?(p(),B("div",R1,[z("div",S1,se((Mr=e(We).viewProgress)==null?void 0:Mr.progress)+" "+se((Gn=e(We).viewProgress)==null?void 0:Gn.message),1),ue(re,{size:"regular"})])):me("",!0),z("div",{ref_key:"gridWrapper",ref:bt,class:"nc-grid-wrapper min-h-0 flex-1 relative !overflow-auto"},[ue($i,{visible:e(an),"onUpdate:visible":T[32]||(T[32]=Kn=>bo(an)?an.value=Kn:null),trigger:e(Ee)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:J(()=>[ue(Za,{class:"!rounded !py-0",variant:"small",onClick:T[31]||(T[31]=Kn=>an.value=!1)},{default:J(()=>{var Kn;return[e(i)?me("",!0):(p(),B(en,{key:0},[("isEeUI"in k?k.isEeUI:e(Bi))&&!e(kn)&&!e(jt)&&!e(Pe)&&e(yn).length?(p(),X(Vo,{key:0,onClick:T[21]||(T[21]=Bl=>a("bulkUpdateDlg"))},{default:J(()=>[Nt((p(),B("div",tb,[(p(),X(po(("iconMap"in k?k.iconMap:e(Bo)).ncEdit))),tt(" "+se(k.$t("title.updateSelectedRows")),1)])),[[Ho,["a:row:update-bulk"]]])]),_:1})):me("",!0),!e(kn)&&!e(jt)&&!e(Pe)&&e(yn).length?(p(),X(Vo,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50","data-testid":"nc-delete-row",onClick:T[22]||(T[22]=Bl=>k.deleteSelectedRows([]))},{default:J(()=>[e(yn).length===1?Nt((p(),B("div",nb,[(p(),X(po(("iconMap"in k?k.iconMap:e(Bo)).delete))),tt(" "+se(k.$t("activity.deleteSelectedRow")),1)])),[[Ho,["a:row:delete"]]]):Nt((p(),B("div",ob,[(p(),X(po(("iconMap"in k?k.iconMap:e(Bo)).delete))),tt(" "+se(k.$t("activity.deleteSelectedRow")),1)])),[[Ho,["a:row:delete-bulk"]]])]),_:1})):me("",!0)],64)),e(i)?(p(),X(Vo,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50","data-testid":"nc-delete-all-row",onClick:T[23]||(T[23]=Bl=>Ja([]))},{default:J(()=>[Nt((p(),B("div",lb,[(p(),X(po(("iconMap"in k?k.iconMap:e(Bo)).delete))),tt(" "+se(k.$t("activity.deleteAllRecords")),1)])),[[Ho,["a:row:delete-all"]]])]),_:1})):me("",!0),e(Re)&&e(Se)&&!e(Pe)&&e(j)?(p(),B(en,{key:2},[e(jt)?(p(),X(Vo,{key:0,class:"nc-base-menu-item","data-testid":"context-menu-item-add-above",onClick:T[24]||(T[24]=Bl=>rt(e(jt),"above"))},{default:J(()=>[Nt((p(),B("div",ab,[ue(dt,{icon:"ncChevronUp"}),tt(" "+se(k.$t("general.insertAbove")),1)])),[[Ho,["a:row:insert:above"]]])]),_:1})):me("",!0),e(jt)&&!e(yt)?(p(),X(Vo,{key:1,class:"nc-base-menu-item","data-testid":"context-menu-item-add-below",onClick:T[25]||(T[25]=Bl=>rt(e(jt),"below"))},{default:J(()=>[Nt((p(),B("div",ib,[ue(dt,{icon:"ncChevronDown"}),tt(" "+se(k.$t("general.insertBelow")),1)])),[[Ho,["a:row:insert:below"]]])]),_:1})):me("",!0),e(jt)?(p(),X(Pa,{key:2})):me("",!0)],64)):me("",!0),e(jt)&&e(Se)&&!e(Pe)&&e(In).enabled?(p(),X(Gt,{key:3,disabled:!e(In).disabled},{title:J(()=>[tt(se(e(ot).length?k.$t("tooltip.aiIntegrationReConfigure"):k.$t("tooltip.aiIntegrationAddAndReConfigure")),1)]),default:J(()=>[ue(Vo,{class:"nc-base-menu-item","data-testid":"context-menu-item-bulk",disabled:e(In).disabled,onClick:Un},{default:J(()=>[z("div",rb,[ue(dt,{icon:"ncAutoAwesome",class:"h-4 w-4"}),tt(" Generate "+se(e(sn).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):me("",!0),e(Ot).enabled?(p(),X(Vo,{key:4,class:"nc-base-menu-item","data-testid":"context-menu-item-bulk-script",disabled:e(Ot).disabled,onClick:Qn},{default:J(()=>[z("div",sb,[ue(dt,{icon:"ncScript",class:"h-4 w-4"}),tt(" Execute "+se(e(sn).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])):me("",!0),e(jt)?(p(),X(Vo,{key:5,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:T[26]||(T[26]=Bl=>e(_o)(e(jt)))},{default:J(()=>[Nt((p(),B("div",ub,[ue(dt,{icon:"copy"}),tt(" "+se(k.$t("general.copy"))+" "+se(k.$t("objects.cell").toLowerCase()),1)])),[[Ho,["a:row:copy"]]])]),_:1})):me("",!0),e(jt)&&e(Se)&&!e(Pe)?(p(),X(Vo,{key:6,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(co),onClick:e(Mt)},{default:J(()=>[Nt((p(),B("div",db,[ue(dt,{icon:"paste"}),tt(" "+se(k.$t("general.paste"))+" "+se(k.$t("objects.cell").toLowerCase()),1)])),[[Ho,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):me("",!0),e(jt)&&e(Se)&&e(sn).isSingleCell()&&(e(hl)(e(E)[e(jt).col])||!((Kn=e(eo)[0])!=null&&Kn[e(jt).col].isVirtualCol))&&!e(Pe)?(p(),X(Vo,{key:7,class:"nc-base-menu-item",disabled:e(go),"data-testid":"context-menu-item-clear",onClick:T[27]||(T[27]=Bl=>So(e(jt)))},{default:J(()=>[Nt((p(),B("div",cb,[ue(dt,{icon:"close"}),tt(" "+se(k.$t("general.clear"))+" "+se(k.$t("objects.cell").toLowerCase()),1)])),[[Ho,["a:row:clear"]]])]),_:1},8,["disabled"])):e(jt)&&e(Se)&&!e(Pe)?(p(),X(Vo,{key:8,class:"nc-base-menu-item",disabled:e(Oo),"data-testid":"context-menu-item-clear",onClick:T[28]||(T[28]=Bl=>Vl())},{default:J(()=>[Nt((p(),B("div",fb,[ue(dt,{icon:"closeBox",class:"text-gray-500"}),tt(" "+se(k.$t("general.clear"))+" "+se(k.$t("objects.cell").toLowerCase()),1)])),[[Ho,["a:row:clear-range"]]])]),_:1},8,["disabled"])):me("",!0),e(jt)&&e(sn).isSingleCell()&&e(Vt)("commentEdit")&&!e(ne)?(p(),B(en,{key:9},[ue(Pa),ue(Vo,{class:"nc-base-menu-item",onClick:T[29]||(T[29]=Bl=>dn(e(jt).row))},{default:J(()=>[Nt((p(),B("div",vb,[ue(Ti,{class:"h-4 w-4"}),tt(" "+se(k.$t("general.add"))+" "+se(k.$t("general.comment").toLowerCase()),1)])),[[Ho,["a:row:comment"]]])]),_:1})],64)):me("",!0),e(Se)&&!e(Pe)?(p(),B(en,{key:10},[!e(kn)&&!e(jt)&&(e(yn).length||e(i))?me("",!0):(p(),X(Pa,{key:0})),e(jt)&&(e(sn).isSingleCell()||e(sn).isSingleRow())?(p(),X(Vo,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:T[30]||(T[30]=Bl=>Ct(e(jt).row))},{default:J(()=>[Nt((p(),B("div",pb,[ue(dt,{icon:"delete"}),tt(" "+se(k.$t("activity.deleteRow")),1)])),[[Ho,["a:row:delete"]]])]),_:1})):e(jt)&&e(m)?(p(),X(Vo,{key:2,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:_n},{default:J(()=>[Nt((p(),B("div",hb,[ue(dt,{icon:"delete",class:"text-gray-500 text-red-600"}),tt(" "+se(k.$t("activity.deleteRows")),1)])),[[Ho,["a:row:delete"]]])]),_:1})):me("",!0)],64)):me("",!0)]}),_:1})]),default:J(()=>{var Kn,Bl,Tr,$r,Or,Dr,Lr,Nr;return[z("div",null,[z("table",{class:Dt([{mobile:e(ne),desktop:!e(ne)},"nc-grid backgroundColorDefault !h-auto bg-white sticky top-0 z-5"])},[z("thead",null,[e(ct)?(p(),B("tr",I1,[(p(!0),B(en,null,ho(e(qn),($e,Do)=>(p(),B("td",{key:Do,class:Dt(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-45":Do!==0,"min-w-16":Do===0}])},[ue(De,{active:!0,title:!0,paragraph:!1,class:Dt(["ml-2 -mt-2",{"max-w-32":Do!==0,"max-w-5 !ml-3.5":Do===0}])},null,8,["class"])],2))),128))])):me("",!0),Nt(z("tr",F1,[z("th",{ref_key:"numColHeader",ref:Ta,class:"w-[80px] min-w-[80px]","data-testid":"grid-id-column"},[e(M)?(p(),B("div",E1,"#")):(p(),B("div",A1,[z("div",{class:Dt(["nc-no-label text-gray-500",{hidden:e(i)}])},"#",2),z("div",{class:Dt([{hidden:!e(i),flex:e(i),"pl-[21px]":e(Re)&&!e(_t),"pl-[2px]":!(e(Re)&&!e(_t))},"nc-check-all w-full items-center"])},[ue(Wt,{checked:e(i),"onUpdate:checked":T[0]||(T[0]=$e=>bo(i)?i.value=$e:null)},null,8,["checked"]),T[37]||(T[37]=z("span",{class:"flex-1"},null,-1))],2)]))],512),(Bl=(Kn=e(E))==null?void 0:Kn[0])!=null&&Bl.id?Nt((p(),B("th",lr({key:0,ref_key:"primaryColHeader",ref:Ka},e(Be)?{"data-col":e(E)[0].id,"data-title":e(E)[0].title}:{},{style:{"min-width":((Tr=e(lt)[e(E)[0].id])==null?void 0:Tr.width)||"180px","max-width":(($r=e(lt)[e(E)[0].id])==null?void 0:$r.width)||"180px",width:((Or=e(lt)[e(E)[0].id])==null?void 0:Or.width)||"180px"},class:["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(vt)===e(E)[0].id,"no-resize":e(U),...An((Lr=(Dr=e(E))==null?void 0:Dr[0])==null?void 0:Lr.id)}],onXcstartresizing:T[4]||(T[4]=$e=>u(e(E)[0].id,$e)),onXcresize:T[5]||(T[5]=$e=>st(e(E)[0].id,$e)),onXcresizing:T[6]||(T[6]=$e=>qe(e(E)[0].id,$e))}),[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:"false",onDragstart:T[1]||(T[1]=ro($e=>e(ze)(e(E)[0].id,$e),["stop"])),onDrag:T[2]||(T[2]=ro($e=>e(be)($e),["stop"])),onDragend:T[3]||(T[3]=ro($e=>e(wt)($e),["stop"]))},[e(E)[0]&&e(Zn)[0].isVirtualCol?(p(),X(Jt,{key:0,column:e(E)[0],"hide-menu":e(M)||!!e(ne)},null,8,["column","hide-menu"])):(p(),X(pn,{key:1,column:e(E)[0],"hide-menu":e(M)||!!e(ne)},null,8,["column","hide-menu"]))],32)],16)),[[Oi]]):me("",!0),e(At).length?(p(),B("th",{key:1,colspan:e(At).length,style:Xn({minWidth:`${e(At).width}px`,maxWidth:`${e(At).width}px`,width:`${e(At).width}px`}),class:"nc-grid-column-header"},null,12,M1)):me("",!0),(p(!0),B(en,null,ho(e(Te),({field:$e,index:Do})=>{var Pr,ei,Br;return Nt((p(),B("th",lr({key:$e.id},{ref_for:!0},e(Be)?{"data-col":$e.id,"data-title":$e.title}:{},{style:{"min-width":((Pr=e(lt)[$e.id])==null?void 0:Pr.width)||"180px","max-width":((ei=e(lt)[$e.id])==null?void 0:ei.width)||"180px",width:((Br=e(lt)[$e.id])==null?void 0:Br.width)||"180px"},class:["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(vt)===$e.id,"no-resize":e(U),...An($e.id)}],onXcstartresizing:jl=>u($e.id,jl),onXcresize:jl=>st($e.id,jl),onXcresizing:jl=>qe($e.id,jl)}),[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:e(ne)||Do===0||e(M)||!e(Se)||e(U)?"false":"true",onDragstart:ro(jl=>e(ze)($e.id,jl),["stop"]),onDrag:T[7]||(T[7]=ro(jl=>e(be)(jl),["stop"])),onDragend:T[8]||(T[8]=ro(jl=>e(wt)(jl),["stop"]))},[e(Zn)[Do].isVirtualCol?(p(),X(Jt,{key:0,column:$e,"hide-menu":e(M)||!!e(ne)},null,8,["column","hide-menu"])):(p(),X(pn,{key:1,column:$e,"hide-menu":e(M)||!!e(ne)},null,8,["column","hide-menu"]))],40,$1)],16,T1)),[[Oi]])}),128)),e(Fn).length?(p(),B("th",{key:2,colspan:e(Fn).length,style:Xn({minWidth:`${e(Fn).width}px`,maxWidth:`${e(Fn).width}px`,width:`${e(Fn).width}px`}),class:"nc-grid-column-header"},null,12,O1)):me("",!0),e($t)?Nt((p(),B("th",{key:3,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:T[15]||(T[15]=ro($e=>Ze.value=!0,["stop"]))},[z("div",D1,[ue($n,{visible:e(Ze),"onUpdate:visible":T[14]||(T[14]=$e=>bo(Ze)?Ze.value=$e:null),trigger:["click"],"overlay-class-name":"nc-dropdown-add-column",onVisibleChange:el},{overlay:J(()=>[z("div",N1,[e(Ze)?(p(),X(bn,{key:0,ref_key:"editOrAddProviderRef",ref:La,preload:e(Kt),"column-position":e(mn),class:Dt({hidden:e(En)}),onSubmit:T[9]||(T[9]=$e=>Zo(!0)),onCancel:T[10]||(T[10]=$e=>Zo()),onClick:T[11]||(T[11]=ro(()=>{},["stop"])),onKeydown:T[12]||(T[12]=ro(()=>{},["stop"])),onMounted:T[13]||(T[13]=$e=>Kt.value=void 0)},null,8,["preload","column-position","class"])):me("",!0)])]),default:J(()=>[z("div",L1,[(p(),X(po(("iconMap"in k?k.iconMap:e(Bo)).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:1},8,["visible"])])])),[[Ho,["c:column:add"]]]):me("",!0),z("th",P1,[z("div",{class:Dt(["absolute top-0 w-45",{"left-[60px]":e($t),"left-0":!e($t)}])},"  ",2)])],512),[[ba,!e(ct)]])])],2),Nt(z("div",{class:"dragging-record",style:Xn({width:`${e(Oe)}px`,top:`${e(Lt)}px`})},null,4),[[ba,e(Zt)]]),z("div",{class:"table-overlay",style:Xn({height:e(Z)?"100%":`${e(Ce)+e(K)}px`,width:`${e(de)}px`})},[z("table",{class:Dt(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(ne),desktop:!e(ne),"w-full":((Nr=e(Xe))==null?void 0:Nr.length)===0}]),onContextmenu:rn},[z("tbody",{ref_key:"tableBodyEl",ref:un,class:"xc-row-table !bg-red-100",style:Xn({transform:`translateY(${e(Ke)}px)`})},[e(et).length?(p(),X(fo,{key:0,"row-count":e(et).length,"row-height":e(et).rowHeight,"total-row-height":e(et).totalRowHeight,"col-count":e(Vn)},null,8,["row-count","row-height","total-row-height","col-count"])):me("",!0),(p(!0),B(en,null,ho(e(Xe),($e,Do)=>{var Pr;return p(),X(fi,{key:`${$e.rowMeta.rowIndex}-${(Pr=$e.rowMeta)==null?void 0:Pr.new}`,row:$e},{default:J(({state:ei})=>{var Br,jl,bd,_d,xd,kd,Cd,Rd,Sd,Id,Fd,Ad,Ed,Md,Td,$d,Od,Dd,Ld,Nd,Pd,Bd,Wd,zd,Vd,jd,Ud,Gd;return[(Br=$e.rowMeta)!=null&&Br.isValidationFailed?(p(),B("div",{key:0,style:Xn({top:`${(Do+1+e(et).length)*e(ge)-6}px`,zIndex:100001}),class:"absolute z-30 left-0 w-full flex"},[z("div",B1,[T[39]||(T[39]=tt(" Row filtered ")),ue(Gt,null,{title:J(()=>T[38]||(T[38]=[tt(" This record will be hidden as it does not match the filters applied to this view. ")])),default:J(()=>[ue(dt,{icon:"info",class:"w-4 h-4 text-gray-800"})]),_:1})])],4)):me("",!0),(jl=$e.rowMeta)!=null&&jl.isRowOrderUpdated?(p(),B("div",{key:1,style:Xn({top:`${(Do+1+e(et).length)*e(ge)-6}px`,zIndex:1e5}),class:"absolute transform z-30 left-0 w-full flex"},[z("div",W1,[T[41]||(T[41]=tt(" Row moved ")),ue(Gt,null,{title:J(()=>T[40]||(T[40]=[tt(" This record will move to a new position when you click outside of it. ")])),default:J(()=>[ue(dt,{icon:"info",class:"w-4 h-4 text-gray-800"})]),_:1})])],4)):me("",!0),z("tr",{class:Dt(["nc-grid-row transition-all duration-500 opacity-100 !xs:h-14",{"active-row":e(it).row===$e.rowMeta.rowIndex||((bd=e(sn)._start)==null?void 0:bd.row)===$e.rowMeta.rowIndex,"mouse-down":e(so)||e(wl),"selected-row":$e.rowMeta.selected||e(i),"invalid-row":((_d=$e.rowMeta)==null?void 0:_d.isValidationFailed)||((xd=$e.rowMeta)==null?void 0:xd.isRowOrderUpdated),"is-dragging":((kd=$e.rowMeta)==null?void 0:kd.rowIndex)===((Rd=(Cd=e(Bt))==null?void 0:Cd.rowMeta)==null?void 0:Rd.rowIndex)}]),style:Xn({height:`${e(ge)}px`,filter:e(Ht)(e(Y),$e.rowMeta.rowIndex+1)&&!$e.rowMeta.new?"blur(4px)":void 0,pointerEvents:e(Ht)(e(Y),$e.rowMeta.rowIndex+1)&&!$e.rowMeta.new?"none":"auto"}),"data-testid":`grid-row-${$e.rowMeta.rowIndex}`},[z("td",{class:"caption nc-grid-cell w-[80px] min-w-[80px]","data-testid":`cell-Id-${$e.rowMeta.rowIndex}`,onContextmenu:T[16]||(T[16]=uo=>jt.value=null)},[z("div",j1,[z("div",{class:Dt(["nc-row-no min-w-4 h-4 flex items-center justify-between text-gray-500 pl-1.5 w-full",{toggle:!e(M),hidden:((Sd=$e.rowMeta)==null?void 0:Sd.selected)||e(i),"text-[10px]":$e.rowMeta.rowIndex+1>=1e4,"text-xs":$e.rowMeta.rowIndex+1>=1e3,"text-small":$e.rowMeta.rowIndex+1<1e3}])},[z("span",null,se($e.rowMeta.rowIndex+1),1),T[42]||(T[42]=z("div",{class:"inline-block min-w-[4px] h-full rounded-full"},null,-1))],2),e(Re)&&!e(_t)?(p(),B("div",{key:0,class:Dt([{toggle:!e(M),"!block":((Id=$e.rowMeta)==null?void 0:Id.selected)||!!e(i)},"nc-drag-handle hidden"])},[ue(oo,{size:"xxsmall",type:"text",disabled:!!e(yn).length||!!e(i),onMousedown:uo=>vn($e,uo)},{default:J(()=>[ue(dt,{class:Dt({"text-nc-content-gray hover:text-nc-content-brand":!e(yn).length&&!e(i),"text-nc-content-gray-muted":!(!e(yn).length&&!e(i))}),icon:"ncDrag"},null,8,["class"])]),_:2},1032,["disabled","onMousedown"])],2)):me("",!0),e(M)?me("",!0):(p(),B("div",{key:1,class:Dt([{hidden:!((Fd=$e.rowMeta)!=null&&Fd.selected)&&!e(i),flex:((Ad=$e.rowMeta)==null?void 0:Ad.selected)||e(i),"pl-1.5":!(e(Re)&&!e(_t))},"nc-row-expand-and-checkbox"])},[ue(Wt,{checked:$e.rowMeta.selected||e(i),disabled:!$e.rowMeta.selected&&e(yn).length>=("EXTERNAL_SOURCE_VISIBLE_ROWS"in k?k.EXTERNAL_SOURCE_VISIBLE_ROWS:e(ll))||e(i),class:"!w-4 !h-4",onChange:uo=>Wn($e.rowMeta.rowIndex)},null,8,["checked","disabled","onChange"])],2)),z("div",{"data-testid":`nc-expand-${$e.rowMeta.rowIndex}`,class:"flex-1 flex items-center justify-end"},[(Ed=$e.rowMeta)!=null&&Ed.saving||(Md=$e.rowMeta)!=null&&Md.isLoading?(p(),X(gn,{key:0,class:"hidden nc-row-spinner items-center","data-testid":`row-save-spinner-${$e.rowMeta.rowIndex}`},null,8,["data-testid"])):(p(),B(en,{key:1},[(Td=$e.rowMeta)!=null&&Td.commentCount&&e(v)?Nt((p(),B("span",{key:0,class:Dt([{"nc-comment":($d=$e.rowMeta)==null?void 0:$d.commentCount,"text-[10px] font-600 px-0.5":$e.rowMeta.commentCount>99,"text-small font-500 px-0.8":$e.rowMeta.commentCount<=99},"text-center rounded-md rounded-bl-none transition-all border-1 border-brand-200 cursor-pointer font-sembold select-none leading-5 text-brand-500 bg-brand-50 hover:bg-brand-100 !min-h-4.5 !min-w-5 !leading-5 inline-block"]),onClick:uo=>dl($e,ei)},[tt(se($e.rowMeta.commentCount>99?"99+":$e.rowMeta.commentCount),1)],10,G1)),[[Ho,["c:expanded-form:open"]]]):(p(),B("div",H1,[e(v)?Nt((p(),X(po(("iconMap"in k?k.iconMap:e(Bo)).maximize),{key:0,class:"select-none transform nc-row-expand opacity-90 w-3.5 h-3.5",onClick:uo=>dl($e,ei)},null,8,["onClick"])),[[Ho,["c:row-expand:open"]]]):me("",!0)]))],64))],8,U1)])],40,V1),e(E)[0]?(p(),X(ea,lr({key:e(E)[0].id,active:e(it).row===$e.rowMeta.rowIndex&&e(it).col===0||((Od=e(sn)._start)==null?void 0:Od.row)===$e.rowMeta.rowIndex&&((Dd=e(sn)._start)==null?void 0:Dd.col)===0,class:["cell relative nc-grid-cell cursor-pointer",{active:e(Oa)[`${$e.rowMeta.rowIndex}-0`],"active-cell !after:h-[calc(100%-1px)]":e(it).row===$e.rowMeta.rowIndex&&e(it).col===0||((Ld=e(sn)._start)==null?void 0:Ld.row)===$e.rowMeta.rowIndex&&((Nd=e(sn)._start)==null?void 0:Nd.col)===0,"nc-required-cell":!((Pd=$e.rowMeta)!=null&&Pd.isLoading)&&((Wd=(Bd=e(eo)[Do])==null?void 0:Bd[0])==null?void 0:Wd.isColumnRequiredAndNull)&&!e(L),filling:e(Qa)[`${$e.rowMeta.rowIndex}-0`],readonly:((zd=e(Zn)[0])==null?void 0:zd.isReadonly)&&e(Se)&&((Vd=e(Oa))==null?void 0:Vd[`${$e.rowMeta.rowIndex}-0`]),"!border-r-blue-400 !border-r-3":e(vt)===e(E)[0].id,[e(zn)]:!0,...Tn(e(E)[0].id)}],style:{"min-width":((jd=e(lt)[e(E)[0].id])==null?void 0:jd.width)||"180px","max-width":((Ud=e(lt)[e(E)[0].id])==null?void 0:Ud.width)||"180px",width:((Gd=e(lt)[e(E)[0].id])==null?void 0:Gd.width)||"180px"},"data-testid":`cell-${e(E)[0].title}-${$e.rowMeta.rowIndex}`},{ref_for:!0},e(Be)?{"data-key":`data-key-${$e.rowMeta.rowIndex}-${e(E)[0].id}`,"data-col":e(E)[0].id,"data-title":e(E)[0].title,"data-row-index":$e.rowMeta.rowIndex,"data-col-index":0}:{},{onMousedown:uo=>e(Kl)(uo,$e.rowMeta.rowIndex,0),onMouseover:uo=>e(No)(uo,$e.rowMeta.rowIndex,0),onDblclick:uo=>To($e,e(E)[0]),onContextmenu:uo=>rn(uo,{row:$e.rowMeta.rowIndex,col:0}),onClick:uo=>Na(uo,$e.rowMeta.rowIndex,0)}),{default:J(()=>{var uo,jo,Wr,zr,Vr,jr;return[(uo=e(eo)[Do][0])!=null&&uo.cellProgress&&!e(pt)?(p(),B("div",Y1,[(Wr=(jo=e(eo)[Do][0])==null?void 0:jo.cellProgress)!=null&&Wr.icon?(p(),X(dt,{key:0,class:"w-4 h-4",icon:(Vr=(zr=e(eo)[Do][0])==null?void 0:zr.cellProgress)==null?void 0:Vr.icon},null,8,["icon"])):me("",!0),tt(" "+se((jr=e(eo)[Do][0])==null?void 0:jr.cellProgress.message)+" ",1),T[43]||(T[43]=z("div",{class:"flex-1"},null,-1)),ue(wo,{class:"w-4 h-4"})])):e(pt)?me("",!0):(p(),B("div",q1,[e(E)[0]&&e(Zn)[0].isVirtualCol&&e(E)[0].title?(p(),X(On,{key:0,modelValue:$e.row[e(E)[0].title],"onUpdate:modelValue":ha=>$e.row[e(E)[0].title]=ha,active:e(it).col===0&&e(it).row===$e.rowMeta.rowIndex,column:e(E)[0],row:$e,"read-only":!e(Se),onNavigate:mo,onSave:ha=>{var vi;return(vi=e(c))==null?void 0:vi($e,"",ei)}},null,8,["modelValue","onUpdate:modelValue","active","column","row","read-only","onSave"])):e(E)[0]&&e(E)[0].title?(p(),X(Fo,{key:1,modelValue:$e.row[e(E)[0].title],"onUpdate:modelValue":ha=>$e.row[e(E)[0].title]=ha,column:e(E)[0],"edit-enabled":!!e(Se)&&!!e(ln)&&e(it).col===0&&e(it).row===$e.rowMeta.rowIndex,"row-index":$e.rowMeta.rowIndex,active:e(it).col===0&&e(it).row===$e.rowMeta.rowIndex,"read-only":!e(Se),"onUpdate:editEnabled":T[17]||(T[17]=ha=>ln.value=ha),onNavigate:mo,onCancel:T[18]||(T[18]=ha=>ln.value=!1),onSave:ha=>{var vi;return(vi=e(c))==null?void 0:vi($e,e(E)[0].title,ei)}},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):me("",!0)]))]}),_:2},1040,["active","class","style","data-testid","onMousedown","onMouseover","onDblclick","onContextmenu","onClick"])):me("",!0),e(At).length?(p(),B("td",{key:1,colspan:e(At).length,style:Xn({minWidth:`${e(At).width}px`,maxWidth:`${e(At).width}px`,width:`${e(At).width}px`}),class:"nc-grid-cell"},null,12,X1)):me("",!0),(p(!0),B(en,null,ho(e(Te),({field:uo,index:jo})=>{var Wr,zr,Vr,jr,ha,vi,Hd,Yd;return p(),X(ea,lr({key:`cell-${jo}-${$e.rowMeta.rowIndex}`,active:e(it).row===$e.rowMeta.rowIndex&&e(it).col===jo||((Wr=e(sn)._start)==null?void 0:Wr.row)===$e.rowMeta.rowIndex&&((zr=e(sn)._start)==null?void 0:zr.col)===jo,class:["cell relative nc-grid-cell cursor-pointer",{active:e(Oa)[`${$e.rowMeta.rowIndex}-${jo}`],"active-cell":e(it).row===$e.rowMeta.rowIndex&&e(it).col===jo||((Vr=e(sn)._start)==null?void 0:Vr.row)===$e.rowMeta.rowIndex&&((jr=e(sn)._start)==null?void 0:jr.col)===jo,"nc-required-cell":!((ha=$e.rowMeta)!=null&&ha.isLoading)&&e(eo)[Do][jo].isColumnRequiredAndNull&&!e(L),filling:e(Qa)[`${$e.rowMeta.rowIndex}-${jo}`],readonly:e(Zn)[jo].isReadonly&&e(Se)&&e(Oa)[`${$e.rowMeta.rowIndex}-${jo}`],"!border-r-blue-400 !border-r-3":e(vt)===uo.id,[e(zn)]:!0,...Tn(uo.id)}],style:{"min-width":((vi=e(lt)[uo.id])==null?void 0:vi.width)||"180px","max-width":((Hd=e(lt)[uo.id])==null?void 0:Hd.width)||"180px",width:((Yd=e(lt)[uo.id])==null?void 0:Yd.width)||"180px"},"data-testid":`cell-${uo.title}-${$e.rowMeta.rowIndex}`},{ref_for:!0},e(Be)?{"data-key":`data-key-${$e.rowMeta.rowIndex}-${uo.id}`,"data-col":uo.id,"data-title":uo.title,"data-row-index":$e.rowMeta.rowIndex,"data-col-index":0}:{},{onMousedown:ma=>e(Kl)(ma,$e.rowMeta.rowIndex,jo),onMouseover:ma=>e(No)(ma,$e.rowMeta.rowIndex,jo),onClick:ma=>Na(ma,$e.rowMeta.rowIndex,jo),onDblclick:ma=>To($e,uo),onContextmenu:ma=>rn(ma,{row:$e.rowMeta.rowIndex,col:jo})}),{default:J(()=>{var ma,qd,Xd,Kd,Jd,Qd;return[(ma=e(eo)[Do][jo])!=null&&ma.cellProgress&&!e(pt)?(p(),B("div",K1,[(Xd=(qd=e(eo)[Do][jo])==null?void 0:qd.cellProgress)!=null&&Xd.icon?(p(),X(dt,{key:0,class:"w-4 h-4",icon:(Jd=(Kd=e(eo)[Do][jo])==null?void 0:Kd.cellProgress)==null?void 0:Jd.icon},null,8,["icon"])):me("",!0),tt(" "+se((Qd=e(eo)[Do][jo])==null?void 0:Qd.cellProgress.message)+" ",1),T[44]||(T[44]=z("div",{class:"flex-1"},null,-1)),ue(wo,{class:"w-4 h-4"})])):e(pt)?me("",!0):(p(),B("div",J1,[e(Zn)[jo].isVirtualCol&&uo.title?(p(),X(On,{key:0,modelValue:$e.row[uo.title],"onUpdate:modelValue":Ki=>$e.row[uo.title]=Ki,column:uo,row:$e,active:e(it).col===jo&&e(it).row===$e.rowMeta.rowIndex,"read-only":!e(Se),onNavigate:mo,onSave:Ki=>{var Ur;return(Ur=e(c))==null?void 0:Ur($e,"",ei)}},null,8,["modelValue","onUpdate:modelValue","column","row","active","read-only","onSave"])):uo.title?(p(),X(Fo,{key:1,modelValue:$e.row[uo.title],"onUpdate:modelValue":Ki=>$e.row[uo.title]=Ki,"edit-enabled":!!e(Se)&&!!e(ln)&&e(it).col===jo&&e(it).row===$e.rowMeta.rowIndex,active:e(it).col===jo&&e(it).row===$e.rowMeta.rowIndex,"read-only":!e(Se),column:uo,"row-index":$e.rowMeta.rowIndex,onSave:Ki=>{var Ur;return(Ur=e(c))==null?void 0:Ur($e,uo.title,ei)},onNavigate:mo,onCancel:T[19]||(T[19]=Ki=>ln.value=!1)},null,8,["modelValue","onUpdate:modelValue","edit-enabled","active","read-only","column","row-index","onSave"])):me("",!0)]))]}),_:2},1040,["active","class","style","data-testid","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128)),e(Fn).length?(p(),B("td",{key:2,colspan:e(Fn).length,style:Xn({minWidth:`${e(Fn).width}px`,maxWidth:`${e(Fn).width}px`,width:`${e(Fn).width}px`}),class:"nc-grid-cell"},null,12,Q1)):me("",!0)],14,z1)]}),_:2},1032,["row"])}),128)),e(ut).length?(p(),X(fo,{key:1,"row-count":e(ut).length,"row-height":e(ut).rowHeight,"total-row-height":e(ut).totalRowHeight,"col-count":e(Vn)},null,8,["row-count","row-height","total-row-height","col-count"])):me("",!0),e(Ue)&&!e(fe)?Nt((p(),B("tr",{key:2,class:Dt(["text-left nc-grid-add-new-cell mb-[80px] transition-all cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(Mo)===1}]),style:{height:"32px"},onClick:T[20]||(T[20]=$e=>St())},[z("td",Z1,[e(ct)?me("",!0):(p(),X(po(("iconMap"in k?k.iconMap:e(Bo)).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))]),z("td",{colspan:e(Mo),class:"!border-gray-100"},null,8,eb)],2)),[[Ho,["c:row:add:grid-bottom"]]]):me("",!0)],4)],34),Nt(z("div",{ref_key:"fillHandle",ref:xt,class:Dt(["nc-fill-handle",{"z-3":!e(sn).isEmpty()&&e(sn).end.col!==0,"z-4":e(sn).isEmpty()&&e(it).col!==0,"transition-all !bg-purple-400 !w-[10px] !h-[10px] !mt-[-5px] !ml-[-5px]":e(Jo)}]),style:Xn({top:`${e(zo)}px`,left:`${e(Ln)}px`,cursor:"crosshair"})},null,6),[[ba,e(Ql)]])],4)])]}),_:1},8,["visible","trigger"]),e(fe)?(p(),B("div",mb,[z("div",gb,[z("div",wb,[z("div",yb,se(k.$t("upgrade.upgradeToSeeMoreRecordInline")),1),z("div",null,se(k.$t("upgrade.upgradeToSeeMoreRecordInlineSubtitle",{plan:e(Iu).BUSINESS,limit:100,total:Math.max(l.totalRows,l.actualTotalRows),remaining:Math.max(l.totalRows,l.actualTotalRows)-100})),1)]),z("div",bb,[z("a",_b,[ue(oo,{size:"small",type:"secondary"},{default:J(()=>[tt(se(k.$t("msg.learnMore")),1)]),_:1})]),ue(oo,{size:"small",onClick:T[33]||(T[33]=Kn=>e(Xt)({limitOrFeature:e(Hs).LIMIT_EXTERNAL_SOURCE_PER_WORKSPACE,ctaPlan:e(Iu).BUSINESS}))},{default:J(()=>[tt(se(e(Yt)?k.$t("general.upgrade"):e(H)("general.requestUpgrade")),1)]),_:1})])])])):me("",!0)],512),z("div",{class:"absolute bottom-12 z-5 left-2",onClick:T[36]||(T[36]=ro(()=>{},["stop"]))},[e(Ue)&&!e(fe)?(p(),X($i,{key:0},{overlay:J(()=>[ue(Za,{variant:"small"},{default:J(()=>[Nt((p(),X(Vo,{class:"nc-new-record-with-grid group",disabled:e(fe),onClick:Ma},{default:J(()=>{var Kn;return[z("div",Rb,[(p(),X(po((Kn=("viewIcons"in k?k.viewIcons:e(_i))[e(Ul).GRID])==null?void 0:Kn.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(k.$t("activity.newRecord"))+" - "+se(k.$t("objects.viewType.grid")),1)]),e(he)?(p(),X(dt,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):me("",!0)]}),_:1},8,["disabled"])),[[Ho,["c:row:add:grid"]]]),Nt((p(),X(Vo,{class:"nc-new-record-with-form group",onClick:Cn},{default:J(()=>{var Kn;return[z("div",Sb,[(p(),X(po((Kn=("viewIcons"in k?k.viewIcons:e(_i))[e(Ul).FORM])==null?void 0:Kn.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(k.$t("activity.newRecord"))+" - "+se(k.$t("objects.viewType.form")),1)]),e(he)?me("",!0):(p(),X(dt,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]}),_:1})),[[Ho,["c:row:add:form"]]])]),_:1})]),default:J(()=>[z("div",xb,[e(ne)?Nt((p(),X(oo,{key:0,class:"nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:T[34]||(T[34]=ro(Kn=>Cn(),["stop"]))},{default:J(()=>[z("div",kb,[ue(dt,{icon:"plus"}),T[45]||(T[45]=tt(" New Record "))])]),_:1})),[[Ho,[e(he)?"c:row:add:grid":"c:row:add:form"]]]):Nt((p(),X(oo,{key:1,class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:T[35]||(T[35]=ro(Kn=>e(he)?St():Cn(),["stop"]))},{default:J(()=>[z("div",Cb,[ue(dt,{icon:"plus"}),e(he)?(p(),B(en,{key:0},[tt(se(k.$t("activity.newRecord")),1)],64)):(p(),B(en,{key:1},[tt(se(k.$t("activity.newRecord"))+" - "+se(k.$t("objects.viewType.form")),1)],64))])]),_:1})),[[Ho,[e(he)?"c:row:add:grid":"c:row:add:form"]]]),e(ne)?me("",!0):(p(),X(oo,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary",shadow:!1},{default:J(()=>[ue(dt,{icon:"arrowUp"})]),_:1}))])]),_:1})):me("",!0)]),ue(Xi,{"total-rows":Math.max(l.totalRows,l.actualTotalRows),"scroll-left":e(yl),"disable-pagination":!0},null,8,["total-rows","scroll-left"])])}}}),Eb=Object.assign(Ol(Ab,[["__scopeId","data-v-08f85007"]]),{__name:"SmartsheetGridInfiniteTable"}),Mb={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Tb(t,n){return p(),B("svg",Mb,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 4.1L14.1 6l1.4 1.4L16.9 6L18 7.1l-1.4 1.4L18 9.9L16.9 11l-1.4-1.4l-1.4 1.4L13 9.9l1.4-1.4zm-6.8.6h5v1.5h-5zm5.3 8.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2zm6.5 1.2h-5v-1.5h5zm0-2.4h-5v-1.5h5z"},null,-1)]))}const $b=yr({name:"mdi-calculator-variant",render:Tb}),Ob={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Db(t,n){return p(),B("svg",Ob,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.7 6.7 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95S18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0"},null,-1)]))}const Lb=yr({name:"mdi-reload",render:Db}),Nb={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Pb(t,n){return p(),B("svg",Nb,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6z"},null,-1)]))}const Bb=yr({name:"mdi-chevron-right",render:Pb}),Wb={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function zb(t,n){return p(),B("svg",Wb,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2zm-7 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm11 7h3V8h2v3h3v2h-3v3h-2v-3h-3z"},null,-1)]))}const Vb=yr({name:"mdi-table-column-plus-after",render:zb}),jb=()=>{const t=V(!1),n=async(...h)=>{},o=async(...h)=>{},l=async(...h)=>{},a=V(!1),i=V(),s=V(!1),r=V();return{loadMagic:t,predictColumnType:n,optionsMagic:o,predictFunction:l,table:{predictingNextColumn:a,predictedNextColumn:i,predictNextColumn:async(...h)=>{},predictingNextFormulas:s,predictedNextFormulas:r,predictNextFormulas:async(...h)=>{}},createTableMagic:async(...h)=>{},createSchemaMagic:async(...h)=>{}}},Ub=Co(()=>Ro(()=>import("./B2f1fstS.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>t.default||t)),Gb=Co(()=>Ro(()=>import("./CxSafZTa.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(t=>t.default||t)),Hb=Co(()=>Ro(()=>import("./CiBV2ZED.js").then(t=>t.E),__vite__mapDeps([44,1,2,45,46,47,48,49,24,23,3,22,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,40,72,32,31,33,30,34,73,74,28,26,27,75,76,77]),import.meta.url).then(t=>t.default||t)),Yb=Co(()=>Ro(()=>import("./CyKx2u6B.js"),__vite__mapDeps([78,1,2]),import.meta.url).then(t=>t.default||t)),qb=Co(()=>Ro(()=>import("./CMyFGii6.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url).then(t=>t.default||t)),Xb=Co(()=>Ro(()=>import("./CkXo2doe.js").then(t=>t.C),__vite__mapDeps([37,1,2,12,13,38,39,40,28,23,22,26,27,41]),import.meta.url).then(t=>t.default||t)),Kb=Co(()=>Ro(()=>Promise.resolve().then(()=>vd),void 0,import.meta.url).then(t=>t.default||t)),Jb=Co(()=>Ro(()=>import("./1_lWk-g2.js"),__vite__mapDeps([112,20,1,2,21,32,31,33,30,34,113]),import.meta.url).then(t=>t.default||t)),Qb=Co(()=>Ro(()=>import("./yjlRPiAT.js"),__vite__mapDeps([79,1,2,66,67,68,69,44,45,46,47,48,49,24,23,3,22,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,70,71,40,72,32,31,33,30,34,73,74,28,26,27,75,76,77,80,81,82,19,83,84,85,86,87,88,89,90,91,92,37,12,13,38,39,41,93,94,95,29,96,97,98,99,100,7,8,9,10,11,14,15,16,17,18,20,21,25,35,36,101,102,103,104,105,106,107,108,109,110,111]),import.meta.url).then(t=>t.default||t)),Zb={class:"flex items-center justify-center bg-white/80 absolute l-0 t-0 w-full h-full z-10 pb-10 pointer-events-none"},e_={class:"flex flex-col items-center justify-center gap-2"},t_=["innerHTML"],n_={key:0},o_={class:"nc-grid-header"},l_={class:"w-[64px] min-w-[64px]","data-testid":"grid-id-column"},a_={class:"w-full h-full flex pl-2 pr-1 items-center","data-testid":"nc-check-all"},i_={key:1,class:"text-gray-500"},r_=["data-col","data-title"],s_=["colspan"],u_=["data-col","data-title","onXcstartresizing","onXcresize","onXcresizing","onClick"],d_=["draggable","onDragstart"],c_=["colspan"],f_={class:"absolute top-0 left-0 h-8 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},v_={class:"h-full w-[60px] flex items-center justify-center"},p_={class:"flex flex-row items-center px-1 py-0.5 gap-1 w-full"},h_={class:"text-xs flex-1"},m_={class:"text-xs"},g_={class:"text-red-500 text-xs"},w_={class:"text-xs"},y_={class:"flex flex-row items-center px-1 py-0.5 gap-1 w-full"},b_={class:"text-xs flex-1"},__={class:"text-xs"},x_={class:"text-red-500 text-xs"},k_={class:"text-xs"},C_={class:"nc-edit-or-add-provider-wrapper"},R_={class:"!border-0 relative !xs:hidden",style:{borderWidth:"0px !important"}},S_=["data-testid"],I_=["data-testid"],F_={class:"w-[64px] pl-2 pr-1 items-center w-full flex gap-0.5"},A_=["data-testid"],E_=["onClick"],M_={key:1,class:"cursor-pointer flex items-center border-1 border-gray-100 active:ring rounded-md p-0.75 hover:bg-white hover:border-nc-border-gray-medium"},T_={key:0,class:"w-full"},$_=["colspan"],O_={key:0,class:"w-full"},D_=["colspan"],L_={class:"nc-grid-add-new-cell-item h-8 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500"},N_=["colspan"],P_={class:"flex gap-2 items-center"},B_={key:0,class:"flex gap-2 items-center"},W_={key:1,class:"flex gap-2 items-center"},z_={class:"flex gap-2 items-center"},V_={class:"flex gap-2 items-center"},j_={class:"flex gap-2 items-center"},U_={class:"flex gap-2 items-center"},G_={class:"flex gap-2 items-center"},H_={class:"flex gap-2 items-center"},Y_={class:"flex gap-2 items-center"},q_={class:"flex gap-2 items-center"},X_={class:"relative"},K_={class:"flex ml-1"},J_={"data-testid":"nc-pagination-add-record",class:"flex items-center px-2 text-gray-600 hover:text-black"},Q_={class:"relative overflow-visible min-h-17 w-10"},Z_={class:"flex flex-row items-center justify-between w-full"},ex={class:"flex flex-row items-center justify-start gap-x-2.5"},tx={class:"flex flex-row text-xs text-gray-400 ml-6.5"},nx={class:"flex flex-row items-center justify-between w-full"},ox={class:"flex flex-row items-center justify-start gap-x-2.5"},lx={class:"flex flex-row text-xs text-gray-400 ml-6.5"},ax={class:"flex shadow-nc-sm rounded-lg"},ix={class:"flex items-center gap-2"},rx={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},sx={class:"flex flex-row items-center justify-start gap-x-3"},ux={class:"flex flex-row items-center justify-start gap-x-3"},dx=!1,_s=10,cx=ko({__name:"Table",props:{data:{},vGroup:{},paginationData:{},loadData:{type:Function},changePage:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},selectedAllRecords:{type:Boolean},deleteRangeOfRows:{type:Function},rowHeightEnum:{},expandForm:{type:Function},deleteSelectedRows:{type:Function},removeRowIfNew:{type:Function},bulkUpdateRows:{type:Function},headerOnly:{type:Boolean},hideHeader:{type:Boolean},hideCheckbox:{type:Boolean},pagination:{},disableSkeleton:{type:Boolean},disableVirtualX:{type:Boolean},disableVirtualY:{type:Boolean}},emits:["update:selectedAllRecords","bulkUpdateDlg","toggleOptimisedQuery"],setup(t,{expose:n,emit:o}){const l=t,a=o,i=Ra(l,"selectedAllRecords",a),s=Bn(l,"paginationData"),r=Bn(l,"data"),d=Bn(l,"pagination"),c=Bn(l,"headerOnly"),f=Bn(l,"hideHeader"),v=Bn(l,"disableSkeleton"),h=Bn(l,"disableVirtualX"),y=Bn(l,"disableVirtualY"),{api:b}=Af(),{vGroup:_,loadData:m,changePage:g,callAddEmptyRow:C,updateOrSaveRow:w,deleteRow:S,expandForm:x,deleteSelectedRows:$,deleteRangeOfRows:I,removeRowIfNew:F,bulkUpdateRows:E}=l,M=fn(Ai,V()),U=fn(cs,V()),L=fn(gr,V([])),G=fn(Ks,V(!1)),ae=fn(Hi,V(!1)),ve=fn(zl,V(!1)),xe=fn(zf,V(!1)),ne=vs(),he=fn(Ea,Uo()),W=fn(Zu,Uo()),{isMobileMode:j,isAddNewRecordGridMode:Ee,setAddNewRecordGridMode:Ye}=nl(),Ge=fn(Vf,V()),{isPkAvail:ke,isSqlView:Y,eventBus:we}=Il(),{isColumnSortedOrFiltered:oe,appearanceConfig:ye}=tu(),{isViewDataLoading:ie,isPaginationLoading:H}=Go(wr()),{$e:Ae}=da(),{t:Ie}=oa(),{getMeta:ce}=oi(),{addUndo:te,clone:Le,defineViewScope:Ne}=Fi(),{isViewColumnsLoading:lt,updateGridViewColumn:je,gridViewCols:He,metaColumnById:Q,resizingColOldWith:Mt}=Ha(),{isExpandedFormCommentMode:_e}=Go(Sr()),{predictingNextColumn:wn,predictedNextColumn:It,predictingNextFormulas:Tt,predictedNextFormulas:Je,predictNextColumn:cn,predictNextFormulas:Pn}=jb().table,{paste:Et}=cd(),{addLTARRef:Rn,syncLTARRefs:mt,clearLTARCell:ot,cleaMMCell:gt}=id(),{loadViewAggregate:zt}=nu(),{showRecordPlanLimitExceededModal:Ht}=ql(),Yt=V(null),Xt=V(),un=V(),bt=V(),xt=V(),{height:ct}=bp(un),ft=le(()=>lt.value||!M.value),Be=V(!1),at=le(()=>j.value?56:Wo[`${l.rowHeightEnum}`]??32),{isUIAllowed:kt,isDataReadOnly:st}=gl(),qe=le(()=>kt("dataEdit")&&!Y.value),u=le(()=>!G.value&&kt("fieldAdd")&&!Y.value),{onDrag:R,onDragStart:P,onDragEnd:D,draggedCol:fe,dragColPlaceholderDomRef:K,toBeDroppedColId:O}=mv({fields:L,tableBodyEl:bt,gridWrapper:Xt}),{onLeft:Z,onRight:ge,onUp:ee,onDown:Me}=Sm({paginationDataRef:s,changePage:g,isViewDataLoading:ie}),{generateRows:We,generatingRows:Xe,generatingColumnRows:nt,generatingColumns:et,aiIntegrations:ut}=xr(),Ke=V(!1),Qe=V(!1),ht=V(!1),Vt=V(!1),Pe=V(),Se=V(!1),$t=V(!1),be=V(null),ze=V(!1),wt=V(!1),q=V(!1),Fe=V(null),vt=V(!1),Re=le({get:()=>{var A,N;return(A=l.data)!=null&&A.some(Te=>Te.rowMeta.selected)&&st.value||Fe.value===null&&!((N=l.data)!=null&&N.some(Te=>Te.rowMeta.selected))&&!i.value?!1:vt.value},set:A=>{vt.value=A}}),yt=(A,N)=>{Y.value||(A.preventDefault(),N&&(Fe.value=N))},_t=V(!1);yo(Bf,_t);const Ze=V(!1);async function on(A,N=!1){var Fn;if(st.value||!A||!qe.value||!hl(L.value[A.col])&&xo(L.value[A.col])||L.value[A.col].readonly||kn.value[A.col].isReadonly&&!xo(L.value[A.col]))return;const Te=r.value[A.row],At=L.value[A.col];if(xo(At)){let Vn;const zo=Te.row[At.title],Ln=At.fk_model_id===((Fn=At.colOptions)==null?void 0:Fn.fk_related_model_id);Yo(At)&&Te&&(Vn=await gt(Te,At)),te({undo:{fn:async(Nn,Oo,co,go,Ql,Nl,Pl)=>{var ol,bl,pa,Zl,dl;if(((ol=s.value)==null?void 0:ol.pageSize)===go.pageSize){((bl=s.value)==null?void 0:bl.page)!==go.page&&await(g==null?void 0:g(go.page));const Na=qt(co.row,(pa=M.value)==null?void 0:pa.columns),_l=r.value[Nn.row],de=L.value[Nn.col];if(de.title&&Na===qt(_l.row,(Zl=M.value)==null?void 0:Zl.columns)&&de.id===Oo.id)Qo(de)||Cl(de)?(_l.row[de.title]=co.row[de.title],await Rn(_l,_l.row[de.title],de),await mt(_l,_l.row)):Yo(de)&&(await b.dbDataTableRow.nestedLink((dl=M.value)==null?void 0:dl.id,de.id,encodeURIComponent(Na),Ql),_l.row[de.title]=Nl??null),Ue.col=Nn.col,Ue.row=Nn.row,Pl&&he.trigger({shouldShowLoading:!1}),_o==null||_o();else throw new Error(Ie("msg.recordCouldNotBeFound"))}else throw new Error(Ie("msg.pageSizeChanged"))},args:[Le(A),Le(At),Le(Te),Le(s.value),Vn,zo,Ln]},redo:{fn:async(Nn,Oo,co,go,Ql)=>{var Nl,Pl,ol,bl;if(((Nl=s.value)==null?void 0:Nl.pageSize)===go.pageSize){((Pl=s.value)==null?void 0:Pl.page)!==go.page&&await(g==null?void 0:g(go.page));const pa=qt(co.row,(ol=M.value)==null?void 0:ol.columns),Zl=r.value[Nn.row],dl=L.value[Nn.col];if(pa===qt(Zl.row,(bl=M.value)==null?void 0:bl.columns)&&dl.id===Oo.id)Qo(dl)||Cl(dl)?await ot(Zl,dl):Yo(dl)&&await gt(Zl,dl),Ue.col=Nn.col,Ue.row=Nn.row,Ql&&he.trigger({shouldShowLoading:!1}),_o==null||_o();else throw new Error(Ie("msg.recordCouldNotBeFound"))}else throw new Error(Ie("msg.pageSizeChanged"))},args:[Le(A),Le(At),Le(Te),Le(s.value),Ln]},scope:Ne({view:U.value})}),(Qo(At)||Cl(At))&&await ot(Te,At),Ln&&he.trigger({shouldShowLoading:!1});return}if(At.title)switch(At.uidt){case pe.Checkbox:Te.row[At.title]=!1;break;case pe.Rating:Te.row[At.title]=0;break;default:Te.row[At.title]=null;break}N||await(w==null?void 0:w(Te,At.title))}function Kt(A,N){if(!(!qe.value||ze.value||dx||G.value||ra(N)||N.readonly)){if(!ke.value&&!A.rowMeta.new){tn.info(Ie("msg.info.updateNotAllowedWithoutPK"));return}if(N.ai){tn.info(Ie("msg.info.autoIncFieldNotEditable"));return}if(N.pk&&!A.rowMeta.new){tn.info(Ie("msg.info.editingPKnotSupported"));return}if(![pe.SingleSelect,pe.MultiSelect].includes(N.uidt))return ze.value=!0}}const nn=le(()=>qe.value&&!Y.value&&!ve.value),pt=le(()=>{var A;return(A=L.value)==null?void 0:A.length}),mn=le(()=>{const A=[];return c.value!==!0?Ge.value||A.push("nc-scrollbar-x-lg !overflow-auto"):A.push("overflow-visible"),ie.value&&A.push("!overflow-hidden"),A.join(" ")}),ln=le(()=>{var N;let A=((N=L.value)==null?void 0:N.length)??40;return A=A||40,Array.from({length:A+1}).map(()=>({}))}),so=le(()=>Array.from({length:40}).map(()=>({}))),Sn=le(()=>v.value!==!0&&(ie.value||H.value||ft.value)||!M.value),yn=le(()=>r.value.map(A=>L.value.map(N=>({isColumnRequiredAndNull:$s(N,A.row)})))),kn=le(()=>L.value.map(A=>({isVirtualCol:xo(A),isReadonly:Fu(A)})));function jt(A){ui("smooth"),setTimeout(()=>{Ke.value=!0,Pe.value=A},500)}const an=(A=!1)=>{be.value=null,Ke.value=!1,Pe.value={},A&&setTimeout(()=>{ui("smooth")},200)};async function rn(A){if(A&&A!==(_==null?void 0:_.key))return;const N=al(r.value.length,!0);N&&(x==null||x(N,void 0,!0,A))}const En=()=>{W.trigger(_==null?void 0:_.key)},Yn=()=>{Ht()||(Ye(!0),al())},ao=()=>{Ht()||(Ye(!1),En())},Zn=(A,N,Te)=>{var co,go;const At=N.getBoundingClientRect(),Fn=15,Vn=((co=N.querySelector("thead th:nth-child(1)"))==null?void 0:co.getBoundingClientRect().width)??0,zo=((go=N.querySelector("thead th:nth-child(2)"))==null?void 0:go.getBoundingClientRect().width)??0,Ln=Vn+zo,Nn={right:A.right+Vn-At.width-N.scrollLeft,left:A.left+Vn-N.scrollLeft-Ln,bottom:A.bottom-At.height-N.scrollTop,top:A.top-N.scrollTop},Oo={top:0,left:0};return Oo.left=Nn.right+(Te==null?void 0:Te.right)>0?N.scrollLeft+Nn.right+(Te==null?void 0:Te.right)+Fn:Nn.left-((Te==null?void 0:Te.left)||0)<0?N.scrollLeft+Nn.left-((Te==null?void 0:Te.left)||0)-Fn:N.scrollLeft,Oo.top=Nn.bottom+((Te==null?void 0:Te.bottom)||0)>0?N.scrollTop+Nn.bottom+((Te==null?void 0:Te.bottom)||0)+Fn:Nn.top-(Te==null?void 0:Te.top)<0?N.scrollTop+Nn.top-(Te==null?void 0:Te.top)-Fn:N.scrollTop,Oo},{selectRangeMap:So,fillRangeMap:To,activeCell:Ue,handleMouseDown:Mo,handleMouseOver:qn,handleCellClick:eo,clearSelectedRange:to,copyValue:Zo,isCellActive:ul,resetSelectedRange:ai,makeActive:Ma,selectedRange:Cn,isFillMode:Ta}=gv(M,L,r,void 0,ze,ke,Re,on,Kl,Kt,_o,void 0,async A=>{var Fn,Vn,zo,Ln,Nn,Oo,co,go,Ql,Nl,Pl;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return A.preventDefault(),!0;if(Wl())return;if(sa()||Vi())return!0;const Te=Va()?A.metaKey:A.ctrlKey,At=A.altKey;if(A.key===" "&&!A.shiftKey){const ol=Wl();if(!ze.value&&ul.value&&Ue.row!==null&&!ol){A.preventDefault();const bl=r.value[Ue.row];return bl&&(x==null||x(bl)),!0}}else if(A.key==="Escape"){if(ze.value)return ze.value=!1,!0}else if(A.key==="Enter"){if(A.shiftKey)return!0;if(ze.value)return ze.value=!1,!0}else if(A.key==="Tab"){if(A.shiftKey&&Ue.row===0&&Ue.col===0&&!((Fn=s.value)!=null&&Fn.isFirstPage))return A.preventDefault(),await Dl((((Vn=s.value)==null?void 0:Vn.pageSize)??25)-1,((zo=L.value)==null?void 0:zo.length)-1,-1),!0;if(!A.shiftKey&&Ue.row===r.value.length-1&&Ue.col===((Ln=L.value)==null?void 0:Ln.length)-1){if(A.preventDefault(),(Nn=s.value)!=null&&Nn.isLastPage&&nn.value)return Ze.value=!0,!0;if(!((Oo=s.value)!=null&&Oo.isLastPage))return await Dl(0,0,1),!0}}else if(!Te&&!A.shiftKey&&A.key==="ArrowUp"){if(Ue.row===0&&!((co=s.value)!=null&&co.isFirstPage))return A.preventDefault(),await Dl((((go=s.value)==null?void 0:go.pageSize)??25)-1,Ue.col,-1),!0}else if(!Te&&!A.shiftKey&&A.key==="ArrowDown"&&Ue.row===r.value.length-1){if(A.preventDefault(),(Ql=s.value)!=null&&Ql.isLastPage&&nn.value)return Ze.value=!0,!0;if(!((Nl=s.value)!=null&&Nl.isLastPage))return await Dl(0,Ue.col,1),!0}if(Te){if(!ul.value||A.shiftKey)return;switch(A.key){case"ArrowUp":return A.preventDefault(),to(),Ue.row=0,Ue.col=Ue.col??0,_o==null||_o(),ze.value=!1,!0;case"ArrowDown":return A.preventDefault(),to(),Ue.row=r.value.length-1,Ue.col=Ue.col??0,_o==null||_o(),ze.value=!1,!0;case"ArrowRight":return A.preventDefault(),to(),Ue.row=Ue.row??0,Ue.col=((Pl=L.value)==null?void 0:Pl.length)-1,_o==null||_o(),ze.value=!1,!0;case"ArrowLeft":return A.preventDefault(),to(),Ue.row=Ue.row??0,Ue.col=0,_o==null||_o(),ze.value=!1,!0}}if(At)switch(A.keyCode){case 82:{nn.value&&(Ae("c:shortcut",{key:"ALT + R"}),al(),Ue.row=r.value.length-1,Ue.col=0,ai(),tl(()=>{var ol;(ol=document.querySelector("td.cell.active"))==null||ol.scrollIntoView({behavior:"smooth"})}));break}case 67:{u.value&&(Ae("c:shortcut",{key:"ALT + C"}),ui(void 0),setTimeout(()=>{Ke.value=!0},250));break}}},async A=>{var At;const N=r.value[A.row],Te=A.col!==void 0?L.value[A.col]:null;if(!(!N||!Te)){if(!A.updatedColumnTitle&&xo(Te)){Te.fk_model_id===((At=Te.colOptions)==null?void 0:At.fk_related_model_id)&&(he==null||he.trigger({shouldShowLoading:!1}));return}r.value[A.row].rowMeta.isUpdatedFromCopyNPaste={...r.value[A.row].rowMeta.isUpdatedFromCopyNPaste,[A.updatedColumnTitle||Te.title]:!0},await(w==null?void 0:w(N,A.updatedColumnTitle||Te.title))}},E,void 0,xt,U,s,g,void 0,void 0,void 0,!1);function Ka(A){to(),Ma(A??r.value.length-1,0),Cn.startRange({row:Ue.row,col:Ue.col}),_o==null||_o()}async function Mi(A){await(w==null?void 0:w(A))}function al(A,N=!1){if(Ht({focusBtn:null}))return;const Te=C==null?void 0:C(A);return!N&&Te&&Mi(Te),tl().then(()=>{Ka(A??r.value.length-1)}),Te}const fa=A=>{try{S==null||S(A),Cn.isRowInRange(A)&&to(),Ue.row===A&&(Ue.row=null,Ue.col=null)}catch(N){tn.error(N.message)}},$a=A=>{try{_e.value=!0;const N=r.value[A];x&&x(N),Ue.row=null,Ue.col=null,Cn.clear()}catch(N){tn.error(N.message)}},Ja=()=>{I==null||I(Cn).then(()=>{to(),Ue.row=null,Ue.col=null})},Xl=le(()=>{var A;if(Cn.start.col===Cn.end.col){const N=L.value[Cn.start.col];return{enabled:_a(N)||is(N),disabled:!((A=N==null?void 0:N.colOptions)!=null&&A.fk_integration_id)}}return{enabled:!1,disabled:!1}}),Oa=async()=>{var Vn,zo;if(!Xl.value.enabled||!((Vn=M==null?void 0:M.value)!=null&&Vn.id)||!M.value.columns)return;const A=L.value[Cn.start.col];if(!A.id)return;const N=r.value.slice(Cn.start.row,Cn.end.row+1);if(!N||N.length===0)return;let Te=[A.id];is(A)&&(Te=Ci((zo=A.colOptions)==null?void 0:zo.output_column_ids)&&A.colOptions.output_column_ids.split(",").length>0?A.colOptions.output_column_ids.split(","):[]);const At=N.map(Ln=>qt(Ln.row,M.value.columns)).filter(Ln=>Ln!==null);Xe.value.push(...At),nt.value.push(A.id),et.value.push(...Te);const Fn=await We(M.value.id,A.id,At);if(Fn)for(const Ln of Fn){const Nn=r.value.find(Oo=>qt(Oo.row,M.value.columns)===qt(Ln,M.value.columns));Nn&&(Nn.row={...Nn.row,...Ln})}Xe.value=Xe.value.filter(Ln=>!At.includes(Ln)),nt.value=nt.value.filter(Ln=>Ln!==A.id),et.value=et.value.filter(Ln=>!(Te!=null&&Te.includes(Ln)))},Qa=A=>{if(Be.value){Be.value=!1;return}const N=L.value.findIndex(Te=>Te.id===A);N!==-1&&(Ma(0,N),Cn.startRange({row:0,col:N}),Cn.endRange({row:r.value.length-1,col:N}))};Xs(bt,A=>{if(Se.value||Be.value||Re.value||Ue.row===null||Ue.col===null||Wl())return;const Te=L.value[Ue.col];if(ze.value&&(xo(Te)||Te.uidt===pe.JSON)||Ta.value)return;const At=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active,.nc-link-dropdown-root");A.target&&At&&(At===A.target||At!=null&&At.contains(A.target))||sa()||(to(),Ue.row=null,Ue.col=null)});const it=A=>{if(!(Ue.row===null||Ue.col===null)){switch(ze.value=!1,to(),A){case Gl.NEXT:Ue.row<r.value.length-1||al(),Ue.row++;break;case Gl.PREV:Ue.row>0&&Ue.row--;break}tl(()=>{_o()})}};async function Kl(){if(!qe.value||st.value)return;const A=Cn.start,N=Cn.end,Te=Math.min(A.row,N.row),At=Math.max(A.row,N.row),Fn=Math.min(A.col,N.col),Vn=Math.max(A.col,N.col),zo=L.value.slice(Fn,Vn+1),Ln=r.value.slice(Te,At+1),Nn=[];let Oo=!1;for(const co of Ln)for(const go of zo)if(!(!co||!go||!go.title)){if(xo(go)){(Qo(go)||Cl(go)||Yo(go))&&!Oo&&(tn.info(Ie("msg.info.groupClearIsNotSupportedOnLinksColumn")),Oo=!0);continue}Fu(go)||go.readonly||(co.row[go.title]=null,Nn.push(go.title))}await(E==null?void 0:E(Ln,Nn))}const No=le(()=>L.value.filter(A=>A.id&&He.value[A.id]&&He.value[A.id].width&&He.value[A.id].show).map(A=>+He.value[A.id].width.replace("px","")||180).reduce((A,N,Te)=>(A.push(A[Te]+N),A),[0])),Io=le(()=>Ge.value||Xt.value),Po=V();function _o(A,N,Te="instant"){if(A=A??Ue.row,N=N??Ue.col,A!==null&&N!==null&&Io.value){const At={top:A*at.value,left:No.value[N],right:N===L.value.length-1?No.value[No.value.length-1]+180:No.value[N+1],bottom:(A+1)*at.value},Fn=Zn(At,Io.value,{top:9,bottom:(ct.value||40)+9,right:9});if(xe.value&&(Fn.top=Io.value.scrollTop),N===0&&(Fn.left=0),A===r.value.length-1){requestAnimationFrame(()=>{Io.value.scrollTo({top:xe.value?Io.value.scrollTop:Io.value.scrollHeight,left:N===L.value.length-1?Io.value.scrollWidth:Fn.left,behavior:"instant"})});return}if(N===L.value.length-1){requestAnimationFrame(()=>{Io.value.scrollTo({top:Fn.top,left:Io.value.scrollWidth,behavior:"instant"})});return}requestAnimationFrame(()=>{Io.value.scrollTo({top:Fn.top,left:Fn.left,behavior:"instant"})})}}async function Dl(A,N,Te){var At;to(),Te!==void 0&&((At=s.value)!=null&&At.page)?(await(g==null?void 0:g(s.value.page+Te)),await tl(),Ma(A,N)):(Ma(A,N),await tl()),_o==null||_o()}const Ko=V([]),Da=async(A={})=>{var N;for(const Te of A.data||r.value)if(!Te.rowMeta.fromExpandedForm){if(Te.rowMeta.new){const At=Le(Te);await(w==null?void 0:w(Te,"",Te.rowMeta.ltarState||{},A))?Te.rowMeta.changed=!1:A.keepNewRecords&&At.rowMeta.new&&Object.keys(At.row).length&&Ko.value.push(At);continue}if(Te.rowMeta.changed){Te.rowMeta.changed=!1;for(const At of((N=A.metaValue||M.value)==null?void 0:N.columns)??[])xo(At)||At.uidt===pe.Attachment||At.title in Te.row&&Te.row[At.title]!==Te.oldRow[At.title]&&await(w==null?void 0:w(Te,At.title,{},A))}}},sn={[pe.Attachment]:{minWidth:80,maxWidth:Number.POSITIVE_INFINITY},[pe.Button]:{minWidth:100,maxWidth:320}},wl=(A,N)=>{if(A.uidt in sn){const{minWidth:Te,maxWidth:At}=sn[A.uidt];if(Te<N&&N<At)return N;if(N<Te)return Te;if(N>At)return At}return N},Mn=(A,N)=>{if(!A||!Ci(N==null?void 0:N.detail))return;const Te=N.detail.split("px")[0];je(A,{width:`${wl(Q.value[A],Te)}px`})},Ve=(A,N)=>{if(!A||!Ci(N==null?void 0:N.detail))return;const Te=N.detail.split("px")[0];He.value[A].width=`${wl(Q.value[A],Te)}px`,el()},Ut=(A,N)=>{A&&(Mt.value=N.detail,Be.value=!0)},St=(A,N,Te)=>{Pe.value={title:A,uidt:N,...Te},ht.value=!1},Ct=V(),dn=()=>{var A;Ke.value=!0,(A=Ct.value)!=null&&A.shouldKeepModalOpen()||(Ke.value=!1,ht.value=Qe.value)},_n=le(()=>No.value[No.value.length-1]+64),In=le(()=>r.value.length*at.value),Ot=V({start:0,end:0}),xn=V({start:0,end:0}),Qn=()=>{if(!Io.value||!Xt.value){Ot.value={start:0,end:0},xn.value={start:0,end:0},setTimeout(Qn,100);return}let A=0;if(h.value!==!0){let N=0,Te=No.value.length-1;for(;Te!==N;){const Vn=Math.floor((Te-N)/2+N);if(No.value[Vn]<=Io.value.scrollLeft&&No.value[Vn+1]>Io.value.scrollLeft){A=Vn;break}if(Vn===N){A=Te;break}else No.value[Vn]<=Io.value.scrollLeft?N=Vn:Te=Vn}let At=0,Fn=!1;for(let Vn=A;Vn<No.value.length;Vn++)if(No.value[Vn]>Xt.value.clientWidth+Io.value.scrollLeft){At=Vn,Fn=!0;break}Ot.value={start:Math.max(0,A-_s),end:Fn?Math.min(L.value.length,At+_s):L.value.length}}if(y.value!==!0){const N=Math.max(0,Math.floor(Io.value.scrollTop/at.value)-_s),Te=Math.min(r.value.length,N+Math.ceil(Xt.value.clientHeight/at.value)+_s);xn.value={start:N,end:Te}}},Jo=le(()=>h.value?L.value.map((N,Te)=>({field:N,index:Te})).filter(N=>N.index!==0):L.value.slice(Ot.value.start,Ot.value.end).map((N,Te)=>({field:N,index:Te+Ot.value.start})).filter(N=>N.index!==0)),Un=le(()=>{const A={length:0,width:0};return h.value||(A.length=Ot.value.start>0?Ot.value.start-1:0,A.width=A.length?No.value[Ot.value.start]-No.value[1]:0),A}),mo=le(()=>{const A={length:0,width:0};return h.value||(A.length=Ot.value.end<L.value.length-1?L.value.length-Ot.value.end:0,A.width=A.length?No.value[L.value.length]-No.value[Ot.value.end]:0),A}),Vl=le(()=>2+Jo.value.length+Un.value.length+mo.value.length),Eo=le(()=>y.value?r.value.map((A,N)=>({row:A,index:N})):r.value.slice(xn.value.start,xn.value.end).map((A,N)=>({row:A,index:N+xn.value.start}))),yl=le(()=>{var A;return!Xt.value||xn.value.start<=1?0:parseInt(`${((A=Xt.value)==null?void 0:A.clientHeight)/at.value}`)}),il=le(()=>{const A={length:xn.value.start>1?Math.min(xn.value.start-1,yl.value):0,rowHeight:at.value,totalRowHeight:0};return A.totalRowHeight=A.length*A.rowHeight,A}),io=le(()=>{var N,Te;const A={length:xn.value.end<(((N=s.value)==null?void 0:N.pageSize)??25)-1?Math.min((((Te=s.value)==null?void 0:Te.pageSize)??25)-1-xn.value.end,yl.value):0,rowHeight:at.value,totalRowHeight:0};return A.totalRowHeight=A.length*A.rowHeight,A}),Fl=le(()=>at.value*(xn.value.start-il.value.length)),va=V(),La=V();function el(){tl(()=>{const A=isNaN(Cn.end.row)?Ue.row:Cn.end.row,N=isNaN(Cn.end.col)?Ue.col:Cn.end.col;if(A!==null&&N!==null){if(!Io.value||!Xt.value)return;va.value=(A+1)*at.value+(f.value?0:32),La.value=64+No.value[N+1]+(N===0?Math.max(0,Io.value.scrollLeft-Xt.value.offsetLeft):0)}})}const no=le(()=>Cn.isEmpty()&&Ue.col&&kn.value[Ue.col].isReadonly||!Cn.isEmpty()&&Array.from({length:Cn.end.col-Cn.start.col+1}).every((A,N)=>kn.value[Cn.start.col+N].isReadonly)),Ll=le(()=>{var A,N;return!st.value&&!G.value&&!ze.value&&(!Cn.isEmpty()||Ue.row!==null&&Ue.col!==null)&&!((N=(A=r.value[(isNaN(Cn.end.row)?Ue.row:Cn.end.row)??-1])==null?void 0:A.rowMeta)!=null&&N.new)&&Ue.col!==null&&L.value[Ue.col]&&!ie.value&&!H.value&&r.value.length&&!no.value&&!Y.value});Hn([()=>Cn.end.row,()=>Cn.end.col,()=>Ue.row,()=>Ue.col],([A,N,Te,At],[Fn,Vn,zo,Ln])=>{(A!==Fn||N!==Vn||Te!==zo||At!==Ln)&&(Qn(),el())}),ti(()=>{const A=new ResizeObserver(()=>{var N;el(),Ue.row!==null&&!((N=r.value)!=null&&N[Ue.row])&&(to(),Ue.row=null,Ue.col=null)});Yt.value&&A.observe(Yt.value),ka(Io).toBeTruthy().then(()=>Qn())}),we.on(async(A,N)=>{A===Xo.FIELD_ADD&&(be.value=N,Ke.value=!0),A===Xo.CLEAR_NEW_ROW&&(to(),Ue.row=null,Ue.col=null,F==null||F(N))}),Hn(Ue,A=>{var zo,Ln,Nn;const N=A.row!==null?(zo=r.value[A.row])==null?void 0:zo.row:void 0,Te=N&&A.col!==null?L.value[A.col]:void 0,At=N&&Te?N[Te.title]:void 0,Fn=qt(N,(Ln=M.value)==null?void 0:Ln.columns),Vn=(Nn=U.value)==null?void 0:Nn.id;we.emit(Xo.CELL_SELECTED,{rowId:Fn,colId:Te==null?void 0:Te.id,val:At,viewId:Vn})});async function ii(A){var N,Te,At;if(A!=null&&A.shouldShowLoading&&(ie.value=!0),(N=It.value)!=null&&N.length){const Fn=(At=(Te=M.value)==null?void 0:Te.columns)==null?void 0:At.map(Vn=>Vn.title);It.value=It.value.filter(Vn=>!(Fn!=null&&Fn.includes(Vn.title)))}await Da({keepNewRecords:!0}),await(m==null?void 0:m({...(A==null?void 0:A.offset)!==void 0?{offset:A.offset}:{}},A==null?void 0:A.shouldShowLoading)),Ko.value.length&&(r.value.push(...Ko.value),Ko.value=[]),Qn(),ie.value=!1}let Jl=null;Ml(Io,"scroll",A=>{Po.value=A.target.scrollLeft,Jl&&cancelAnimationFrame(Jl),Jl=requestAnimationFrame(()=>{Qn(),el()})}),Ml(document,"mousedown",A=>{var N,Te;(A.offsetX>((N=A.target)==null?void 0:N.clientWidth)||A.offsetY>((Te=A.target)==null?void 0:Te.clientHeight))&&(Se.value=!0),A.target.closest(".nc-grid-cell:not(.caption)")&&(wt.value=!0)}),Ml(document,"mouseup",()=>{wt.value=!1,setTimeout(()=>{Se.value=!1},100)}),Ml(document,"keydown",async A=>{const N=Wl();A.key==="Alt"&&!N&&(Qe.value=!0)}),Ml(document,"keyup",async A=>{var Fn,Vn;const N=Wl();A.key==="Alt"&&!N&&(Qe.value=!1,Vt.value=!1);const Te=document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"),At=Va()?A.metaKey:A.ctrlKey;Ze.value&&!N&&!Te&&!sa()&&!At&&!A.shiftKey&&!A.altKey&&(A.key==="Tab"&&Ue.row===r.value.length-1&&Ue.col===((Fn=L.value)==null?void 0:Fn.length)-1||A.key==="ArrowDown"&&Ue.row===r.value.length-1&&((Vn=s.value)!=null&&Vn.isLastPage)&&nn.value)&&(al(),await Dl(r.value.length-1,0),Ze.value=!1)}),Ml(document,"keydown",async A=>{const N=Va()?A.metaKey:A.ctrlKey;if(A.altKey&&!A.shiftKey&&!N)switch(A.keyCode){case 78:{nn.value&&al();break}}}),Ga(async()=>{const A=U.value,N=r.value;A&&ce(A.fk_model_id,!1,!0).then(Te=>{const At=Te;At&&Da({metaValue:At,viewMetaValue:A,data:N})}),he==null||he.off(ii),W==null||W.off(rn)}),he==null||he.on(ii),W==null||W.on(rn),Hn(Re,()=>{Re.value?q.value=!1:(q.value=!0,Fe.value=null)}),Hn(()=>ne.params.viewId,()=>{ie.value=!0}),Hn(U,async(A,N)=>{try{if(A&&A.id!==(N==null?void 0:N.id)&&(A.fk_model_id===ne.params.viewId||ve.value)){if($t.value=!0,N!=null&&N.id){const Te=await ce(N.fk_model_id,!1,!0);Te&&await Da({viewMetaValue:N,metaValue:Te,data:r.value})}ie.value=!0;try{xe.value?await(m==null?void 0:m()):await Promise.allSettled([m==null?void 0:m(),zt()]),Qn()}catch(Te){ed.isCancel(Te)||(console.log(Te),tn.error(Ie("msg.errorLoadingData")))}finally{ie.value=!1}}}catch(Te){console.log(Te)}finally{$t.value=!1}},{immediate:!0}),Hn([()=>L.value.length,()=>r.value.length],()=>{Qn()}),yo(Wf,Vt),n({scrollToRow:Ka,openColumnCreate:jt});const ri=(A,N)=>{x&&x(A,N),Ue.row=null,Ue.col=null,Cn.clear()},si=(A,N,Te)=>{const At=r.value[N];if(j.value)return ri(At,L.value[Te]);eo(A,N,Te)},qi=le(()=>{var A,N,Te,At;if(H.value)return(A=s.value)!=null&&A.totalRows&&((N=s.value)!=null&&N.pageSize)?`Loading page<br/>${s.value.page} of ${Math.ceil(((Te=s.value)==null?void 0:Te.totalRows)/((At=s.value)==null?void 0:At.pageSize))}`:Ie("general.loading")});function ui(A){var N;Io.value&&((N=Io.value)==null||N.scrollTo({top:Io.value.scrollTop,left:Io.value.scrollWidth,behavior:A}))}const di=A=>{var Te;const N=oe(A);if(N){const At=(Te=ye[N])==null?void 0:Te.cellBgClass;if(At)return{[At]:!0}}return{}},ci=A=>{var Te;const N=oe(A,!0);if(N){const At=(Te=ye[N])==null?void 0:Te.headerBgClass;if(At)return{[At]:!0}}return{}};return Zr("ArrowLeft",Z),Zr("ArrowRight",ge),Zr("ArrowUp",ee),Zr("ArrowDown",Me),(A,N)=>{var Wn,zn,Tn,An,k,T;const Te=Ys,At=uv,Fn=Df,Vn=Ub,zo=Gb,Ln=$l,Nn=Vb,Oo=Bb,co=Ya,go=Lb,Ql=Rm,Nl=$b,Pl=qa,ol=Hb,bl=Lf,pa=Yb,Zl=Nf,dl=qb,Na=Xb,_l=hv,de=Kb,Ce=Aa,Oe=br,Ft=dd,rt=Gi,Rt=ca,Qt=_p,Zt=Jb,Bt=Qb,Lt=Yl("xc-ver-resize"),vn=Yl("e");return p(),B("div",{class:Dt(["flex flex-col",`${e(c)!==!0?"h-full w-full":""}`])},[N[51]||(N[51]=z("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),z("div",{ref_key:"dragColPlaceholderDomRef",ref:K,class:Dt([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(fe)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(fe)?(p(),B("div",{key:0,style:Xn({"min-width":((Wn=e(He)[e(fe).id])==null?void 0:Wn.width)||"180px","max-width":((zn=e(He)[e(fe).id])==null?void 0:zn.width)||"180px",width:((Tn=e(He)[e(fe).id])==null?void 0:Tn.width)||"180px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):me("",!0)],2),z("div",{ref_key:"gridWrapper",ref:Xt,class:Dt(["nc-grid-wrapper min-h-0 flex-1 relative",e(mn)])},[Nt(z("div",Zb,[z("div",e_,[ue(Te,{size:"xlarge"}),z("span",{class:"text-center",innerHTML:e(qi)},null,8,t_)])],512),[[ba,e(H)&&!e(c)]]),ue(rt,{visible:e(Re),"onUpdate:visible":N[35]||(N[35]=re=>bo(Re)?Re.value=re:null),trigger:e(Y)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:J(()=>[ue(Pl,{class:"!rounded !py-0",variant:"small",onClick:N[34]||(N[34]=re=>Re.value=!1)},{default:J(()=>{var re;return[("isEeUI"in A?A.isEeUI:e(Bi))&&!e(q)&&!e(Fe)&&A.data.some(De=>De.rowMeta.selected)&&!e(st)?(p(),X(co,{key:0,onClick:N[28]||(N[28]=De=>a("bulkUpdateDlg"))},{default:J(()=>[Nt((p(),B("div",P_,[(p(),X(po(("iconMap"in A?A.iconMap:e(Bo)).ncEdit))),tt(" "+se(A.$t("title.updateSelectedRows")),1)])),[[vn,["a:row:update-bulk"]]])]),_:1})):me("",!0),!e(q)&&!e(Fe)&&A.data.some(De=>De.rowMeta.selected)&&!e(st)?(p(),X(co,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50","data-testid":"nc-delete-row",onClick:e($)},{default:J(()=>[A.data.filter(De=>De.rowMeta.selected).length===1?Nt((p(),B("div",B_,[(p(),X(po(("iconMap"in A?A.iconMap:e(Bo)).delete))),tt(" "+se(A.$t("activity.deleteSelectedRow")),1)])),[[vn,["a:row:delete"]]]):Nt((p(),B("div",W_,[(p(),X(po(("iconMap"in A?A.iconMap:e(Bo)).delete))),tt(" "+se(A.$t("activity.deleteSelectedRow")),1)])),[[vn,["a:row:delete-bulk"]]])]),_:1},8,["onClick"])):me("",!0),e(Fe)&&e(qe)&&!e(st)&&e(Xl).enabled?(p(),X(Ce,{key:2,disabled:!e(Xl).disabled},{title:J(()=>[tt(se(e(ut).length?A.$t("tooltip.aiIntegrationReConfigure"):A.$t("tooltip.aiIntegrationAddAndReConfigure")),1)]),default:J(()=>[ue(co,{class:"nc-base-menu-item","data-testid":"context-menu-item-bulk",disabled:e(Xl).disabled,onClick:Oa},{default:J(()=>[z("div",z_,[ue(Ln,{icon:"ncAutoAwesome",class:"h-4 w-4"}),tt(" Generate "+se(e(Cn).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):me("",!0),e(Fe)?(p(),X(co,{key:3,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:N[29]||(N[29]=De=>e(Zo)(e(Fe)))},{default:J(()=>[Nt((p(),B("div",V_,[ue(Ln,{icon:"copy"}),tt(" "+se(A.$t("general.copy"))+" "+se(A.$t("objects.cell").toLowerCase()),1)])),[[vn,["a:row:copy"]]])]),_:1})):me("",!0),e(Fe)&&e(qe)&&!e(st)?(p(),X(co,{key:4,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(no)&&(!e(Cn).isSingleCell()||!("isMm"in A?A.isMm:e(Yo))(e(L)[e(Fe).col])&&!("isBt"in A?A.isBt:e(Qo))(e(L)[e(Fe).col])),onClick:e(Et)},{default:J(()=>[Nt((p(),B("div",j_,[ue(Ln,{icon:"paste"}),tt(" "+se(A.$t("general.paste"))+" "+se(A.$t("objects.cell").toLowerCase()),1)])),[[vn,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):me("",!0),e(Fe)&&e(qe)&&e(Cn).isSingleCell()&&(e(hl)(e(L)[e(Fe).col])||!((re=e(yn)[0])!=null&&re[e(Fe).col].isVirtualCol))&&!e(st)?(p(),X(co,{key:5,class:"nc-base-menu-item",disabled:e(no)&&!e(hl)(e(L)[e(Fe).col]),"data-testid":"context-menu-item-clear",onClick:N[30]||(N[30]=De=>on(e(Fe)))},{default:J(()=>[Nt((p(),B("div",U_,[ue(Ln,{icon:"close"}),tt(" "+se(A.$t("general.clear"))+" "+se(A.$t("objects.cell").toLowerCase()),1)])),[[vn,["a:row:clear"]]])]),_:1},8,["disabled"])):e(Fe)&&e(qe)&&!e(st)?(p(),X(co,{key:6,class:"nc-base-menu-item",disabled:e(no),"data-testid":"context-menu-item-clear",onClick:N[31]||(N[31]=De=>Kl())},{default:J(()=>[Nt((p(),B("div",G_,[ue(Ln,{icon:"closeBox",class:"text-gray-500"}),tt(" "+se(A.$t("general.clear"))+" "+se(A.$t("objects.cell").toLowerCase()),1)])),[[vn,["a:row:clear-range"]]])]),_:1},8,["disabled"])):me("",!0),e(Fe)&&e(Cn).isSingleCell()&&e(kt)("commentEdit")&&!e(j)?(p(),B(en,{key:7},[ue(Oe),ue(co,{class:"nc-base-menu-item",onClick:N[32]||(N[32]=De=>$a(e(Fe).row))},{default:J(()=>[Nt((p(),B("div",H_,[ue(Ft,{class:"h-4 w-4"}),tt(" "+se(A.$t("general.add"))+" "+se(A.$t("general.comment").toLowerCase()),1)])),[[vn,["a:row:comment"]]])]),_:1})],64)):me("",!0),e(qe)&&!e(st)?(p(),B(en,{key:8},[!e(q)&&!e(Fe)&&A.data.some(De=>De.rowMeta.selected)?me("",!0):(p(),X(Oe,{key:0})),e(Fe)&&(e(Cn).isSingleCell()||e(Cn).isSingleRow())?(p(),X(co,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:N[33]||(N[33]=De=>fa(e(Fe).row))},{default:J(()=>[Nt((p(),B("div",Y_,[ue(Ln,{icon:"delete"}),tt(" "+se(A.$t("activity.deleteRow")),1)])),[[vn,["a:row:delete"]]])]),_:1})):e(Fe)&&e(I)?(p(),X(co,{key:2,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:Ja},{default:J(()=>[Nt((p(),B("div",q_,[ue(Ln,{icon:"delete",class:"text-gray-500 text-red-600"}),tt(" "+se(A.$t("activity.deleteRows")),1)])),[[vn,["a:row:delete"]]])]),_:1})):me("",!0)],64)):me("",!0)]}),_:1})]),default:J(()=>{var re,De,Wt,Jt,pn,bn,$n,fo;return[z("div",null,[z("table",{class:Dt(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white sticky top-0 z-5 bg-white",{mobile:e(j),desktop:!e(j)}])},[Nt(z("thead",{ref_key:"tableHeadEl",ref:un},[e(ft)?(p(),B("tr",n_,[(p(!0),B(en,null,ho(e(ln),(dt,Gt)=>(p(),B("td",{key:Gt,class:Dt(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-45":Gt!==0,"min-w-16":Gt===0}])},[ue(At,{active:!0,title:!0,paragraph:!1,class:Dt(["ml-2 -mt-2",{"max-w-32":Gt!==0,"max-w-5 !ml-3.5":Gt===0}])},null,8,["class"])],2))),128))])):me("",!0),Nt(z("tr",o_,[z("th",l_,[z("div",a_,[!e(G)&&!A.hideCheckbox?(p(),B(en,{key:0},[z("div",{class:Dt(["nc-no-label text-gray-500",{hidden:e(i)}])},"#",2),z("div",{class:Dt([{hidden:!e(i),flex:e(i)},"nc-check-all w-full items-center"])},[ue(Fn,{checked:e(i),"onUpdate:checked":N[0]||(N[0]=dt=>bo(i)?i.value=dt:null)},null,8,["checked"]),N[43]||(N[43]=z("span",{class:"flex-1"},null,-1))],2)],64)):(p(),B("div",i_,"#"))])]),(De=(re=e(L))==null?void 0:re[0])!=null&&De.id?Nt((p(),B("th",{key:0,"data-col":e(L)[0].id,"data-title":e(L)[0].title,style:Xn({"min-width":((Wt=e(He)[e(L)[0].id])==null?void 0:Wt.width)||"180px","max-width":((Jt=e(He)[e(L)[0].id])==null?void 0:Jt.width)||"180px",width:((pn=e(He)[e(L)[0].id])==null?void 0:pn.width)||"180px"}),class:Dt(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(O)===e(L)[0].id,"no-resize":e(ae),...ci(($n=(bn=e(L))==null?void 0:bn[0])==null?void 0:$n.id)}]),onXcstartresizing:N[4]||(N[4]=dt=>Ut(e(L)[0].id,dt)),onXcresize:N[5]||(N[5]=dt=>Mn(e(L)[0].id,dt)),onXcresizing:N[6]||(N[6]=dt=>Ve(e(L)[0].id,dt)),onClick:N[7]||(N[7]=dt=>Qa(e(L)[0].id))},[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:"false",onDragstart:N[1]||(N[1]=ro(dt=>e(P)(e(L)[0].id,dt),["stop"])),onDrag:N[2]||(N[2]=ro(dt=>e(R)(dt),["stop"])),onDragend:N[3]||(N[3]=ro(dt=>e(D)(dt),["stop"]))},[e(L)[0]&&e(kn)[0].isVirtualCol?(p(),X(Vn,{key:0,column:e(L)[0],"hide-menu":e(G)||!!e(j)},null,8,["column","hide-menu"])):(p(),X(zo,{key:1,column:e(L)[0],"hide-menu":e(G)||!!e(j)},null,8,["column","hide-menu"]))],32)],46,r_)),[[Lt]]):me("",!0),e(Un).length?(p(),B("th",{key:1,colspan:e(Un).length,style:Xn({minWidth:`${e(Un).width}px`,maxWidth:`${e(Un).width}px`,width:`${e(Un).width}px`}),class:"nc-grid-column-header"},null,12,s_)):me("",!0),(p(!0),B(en,null,ho(e(Jo),({field:dt,index:Gt})=>{var oo,gn,wo;return Nt((p(),B("th",{key:dt.id,"data-col":dt.id,"data-title":dt.title,style:Xn({"min-width":((oo=e(He)[dt.id])==null?void 0:oo.width)||"180px","max-width":((gn=e(He)[dt.id])==null?void 0:gn.width)||"180px",width:((wo=e(He)[dt.id])==null?void 0:wo.width)||"180px"}),class:Dt(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(O)===dt.id,"no-resize":e(ae),...ci(dt.id)}]),onXcstartresizing:On=>Ut(dt.id,On),onXcresize:On=>Mn(dt.id,On),onXcresizing:On=>Ve(dt.id,On),onClick:On=>Qa(dt.id)},[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:e(j)||Gt===0||e(G)||!e(qe)||e(ae)?"false":"true",onDragstart:ro(On=>e(P)(dt.id,On),["stop"]),onDrag:N[8]||(N[8]=ro(On=>e(R)(On),["stop"])),onDragend:N[9]||(N[9]=ro(On=>e(D)(On),["stop"]))},[e(kn)[Gt].isVirtualCol?(p(),X(Vn,{key:0,column:dt,"hide-menu":e(G)||!!e(j)},null,8,["column","hide-menu"])):(p(),X(zo,{key:1,column:dt,"hide-menu":e(G)||!!e(j)},null,8,["column","hide-menu"]))],40,d_)],46,u_)),[[Lt]])}),128)),e(mo).length?(p(),B("th",{key:2,colspan:e(mo).length,style:Xn({minWidth:`${e(mo).width}px`,maxWidth:`${e(mo).width}px`,width:`${e(mo).width}px`}),class:"nc-grid-column-header"},null,12,c_)):me("",!0),e(u)?Nt((p(),B("th",{key:3,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:N[20]||(N[20]=ro(dt=>Ke.value=!0,["stop"]))},[z("div",f_,[ue(bl,{visible:e(Ke),"onUpdate:visible":N[19]||(N[19]=dt=>bo(Ke)?Ke.value=dt:null),trigger:["click"],"overlay-class-name":"nc-dropdown-add-column",onVisibleChange:dn},oc({default:J(()=>[z("div",v_,[("isEeUI"in A?A.isEeUI:e(Bi))&&(e(Qe)||e(ht))?(p(),X(Ln,{key:0,icon:"magic",class:"text-sm text-orange-400"})):me("",!0),(p(),X(po(("iconMap"in A?A.iconMap:e(Bo)).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:2},[("isEeUI"in A?A.isEeUI:e(Bi))&&e(ht)&&((fo=e(M))!=null&&fo.id)?{name:"overlay",fn:J(()=>[ue(Pl,{class:"predict-menu",variant:"small"},{default:J(()=>{var dt,Gt;return[(dt=e(It))!=null&&dt.length?(p(),X(Ql,{key:"predict-column",class:"py-0 px-0 w-full"},{title:J(()=>[z("div",p_,[ue(Nn,{class:"flex h-[1rem] text-gray-500"}),z("div",h_,se(A.$t("activity.predictColumns")),1),ue(Oo,{class:"text-gray-500"})])]),expandIcon:J(()=>N[44]||(N[44]=[])),default:J(()=>[(p(!0),B(en,null,ho(e(It),oo=>(p(),X(co,{key:`predict-${oo.title}-${oo.type}`,class:"w-full flex items-center",onClick:gn=>St(oo.title,oo.type)},{default:J(()=>[z("div",m_,se(oo.title),1)]),_:2},1032,["onClick"]))),128)),ue(co,{class:"flex flex-row items-center",onClick:N[10]||(N[10]=oo=>e(cn)(e(M).id))},{default:J(()=>[z("div",g_,[ue(go),N[45]||(N[45]=tt(" Generate Again "))])]),_:1})]),_:1})):(p(),X(co,{key:1,class:"flex flex-row items-center py-3",onClick:N[11]||(N[11]=oo=>e(cn)(e(M).id))},{default:J(()=>[e(wn)?(p(),X(go,{key:0,class:"animate-infinite animate-spin"})):(p(),X(Nn,{key:1,class:"flex h-[1rem] text-gray-500"})),z("div",w_,se(A.$t("activity.predictColumns")),1)]),_:1})),(Gt=e(Je))!=null&&Gt.length?(p(),X(Ql,{key:"predict-formula",class:"py-0 px-0 w-full"},{title:J(()=>[z("div",y_,[ue(Nl,{class:"flex h-[1rem] text-gray-500"}),z("div",b_,se(A.$t("activity.predictFormulas")),1),ue(Oo,{class:"text-gray-500"})])]),expandIcon:J(()=>N[46]||(N[46]=[])),default:J(()=>[(p(!0),B(en,null,ho(e(Je),oo=>(p(),X(co,{key:`predict-${oo.title}-formula`,class:"flex flex-row items-center",onClick:gn=>St(oo.title,"Formula",{formula_raw:oo.formula})},{default:J(()=>[z("div",__,se(oo.title),1)]),_:2},1032,["onClick"]))),128)),ue(co,{class:"flex flex-row items-center",onClick:N[12]||(N[12]=oo=>e(Pn)(e(M).id))},{default:J(()=>[z("div",x_,[ue(go),N[47]||(N[47]=tt(" Generate Again "))])]),_:1})]),_:1})):(p(),X(co,{key:3,class:"flex flex-row items-center py-3",onClick:N[13]||(N[13]=oo=>e(Pn)(e(M).id))},{default:J(()=>[e(Tt)?(p(),X(go,{key:0,class:"animate-infinite animate-spin"})):(p(),X(Nl,{key:1,class:"flex h-[1rem] text-gray-500"})),z("div",k_,se(A.$t("activity.predictFormulas")),1)]),_:1}))]}),_:1})]),key:"0"}:{name:"overlay",fn:J(()=>[z("div",C_,[e(Ke)?(p(),X(ol,{key:0,ref_key:"editOrAddProviderRef",ref:Ct,preload:e(Pe),"column-position":e(be),class:Dt({hidden:e(_t)}),onSubmit:N[14]||(N[14]=dt=>an(!0)),onCancel:N[15]||(N[15]=dt=>an()),onClick:N[16]||(N[16]=ro(()=>{},["stop"])),onKeydown:N[17]||(N[17]=ro(()=>{},["stop"])),onMounted:N[18]||(N[18]=dt=>Pe.value=void 0)},null,8,["preload","column-position","class"])):me("",!0)])]),key:"1"}]),1032,["visible"])])])),[[vn,["c:column:add"]]]):me("",!0),z("th",R_,[z("div",{class:Dt(["absolute top-0 w-45",{"left-[60px]":e(u),"left-0":!e(u)}])},"  ",2)])],512),[[ba,!e(ft)]])],512),[[ba,e(f)!==!0]])],2),e(Sn)?me("",!0):(p(),B("div",{key:0,class:Dt(["table-overlay",{"nc-grid-skeleton-loader":e(Sn)}]),style:Xn({height:`${e(In)}px`,width:`${e(_n)}px`})},[z("table",{ref_key:"smartTable",ref:Yt,class:Dt(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(j),desktop:!e(j),"w-full":e(r).length===0,"pb-12":!e(c)&&!e(xe)}]),style:Xn({transform:`translateY(${e(Fl)}px)`}),onContextmenu:yt},[e(c)!==!0?(p(),B("tbody",{key:0,ref_key:"tableBodyEl",ref:bt},[e(Sn)?(p(!0),B(en,{key:0},ho(e(so),(dt,Gt)=>(p(),B("tr",{key:Gt},[(p(!0),B(en,null,ho(e(ln),(oo,gn)=>(p(),B("td",{key:gn,class:Dt(["border-b-1 border-r-1",{"min-w-45":gn!==0,"min-w-16":gn===0}])},null,2))),128))]))),128)):me("",!0),!e(Sn)&&e(il).length?(p(),X(pa,{key:1,"row-count":e(il).length,"row-height":e(il).rowHeight,"total-row-height":e(il).totalRowHeight,"col-count":e(Vl)},null,8,["row-count","row-height","total-row-height","col-count"])):me("",!0),(p(!0),B(en,null,ho(e(Eo),({row:dt,index:Gt})=>(p(),X(de,{key:Gt,row:dt},{default:J(({state:oo})=>{var gn,wo,On,Fo,ea,fi,Vo,Pa,Ti,Za,$i,Xi,Oi,Ho,Fr,Ar,Er,Mr;return[Nt(z("tr",{class:Dt(["nc-grid-row !xs:h-14",{"active-row":e(Ue).row===Gt||((gn=e(Cn)._start)==null?void 0:gn.row)===Gt,"mouse-down":e(wt)||e(Ta),"selected-row":dt.rowMeta.selected}]),style:Xn({height:e(at)?`${e(at)}px`:`${("rowHeightInPx"in A?A.rowHeightInPx:e(Wo))[1]}px`}),"data-testid":`grid-row-${Gt}`},[z("td",{key:"row-index",class:"caption nc-grid-cell w-[64px] min-w-[64px]","data-testid":`cell-Id-${Gt}`,onContextmenu:N[21]||(N[21]=Gn=>Fe.value=null)},[z("div",F_,[z("div",{class:Dt(["nc-row-no sm:min-w-4 text-gray-500 flex items-center justify-between h-4 w-full",{toggle:!e(G),hidden:dt.rowMeta.selected,"text-[10px]":((((wo=e(s))==null?void 0:wo.page)??1)-1)*(((On=e(s))==null?void 0:On.pageSize)??25)+Gt+1>=1e4,"text-xs":((((Fo=e(s))==null?void 0:Fo.page)??1)-1)*(((ea=e(s))==null?void 0:ea.pageSize)??25)+Gt+1>=1e3,"text-small":((((fi=e(s))==null?void 0:fi.page)??1)-1)*(((Vo=e(s))==null?void 0:Vo.pageSize)??25)+Gt+1<1e3}])},[z("span",null,se(((((Pa=e(s))==null?void 0:Pa.page)??1)-1)*(((Ti=e(s))==null?void 0:Ti.pageSize)??25)+Gt+1),1),N[48]||(N[48]=z("div",{class:"inline-block min-w-[4px] h-full rounded-full"},null,-1))],2),e(G)?me("",!0):(p(),B("div",{key:0,class:Dt([{hidden:!dt.rowMeta.selected,flex:dt.rowMeta.selected},"nc-row-expand-and-checkbox"])},[ue(Fn,{checked:dt.rowMeta.selected,"onUpdate:checked":Gn=>dt.rowMeta.selected=Gn},null,8,["checked","onUpdate:checked"])],2)),N[49]||(N[49]=z("span",{class:"flex-1"},null,-1)),z("div",{class:Dt(["nc-expand flex-1 flex items-center justify-end",{"nc-comment":(Za=dt.rowMeta)==null?void 0:Za.commentCount}]),"data-testid":`nc-expand-${Gt}`},[dt.rowMeta.saving?(p(),X(Zl,{key:0,class:"!flex items-center","data-testid":`row-save-spinner-${Gt}`},null,8,["data-testid"])):(p(),B(en,{key:1},[($i=dt.rowMeta)!=null&&$i.commentCount&&e(x)?Nt((p(),B("span",{key:0,class:Dt(["px-1 rounded-md rounded-bl-none transition-all border-1 border-brand-200 cursor-pointer font-sembold select-none hover:bg-brand-100 !min-h-4.5 !min-w-5 !leading-[18px] inline-block text-brand-500 bg-brand-50",{"text-[10px] font-600 px-0.5":dt.rowMeta.commentCount>99,"text-small font-500 px-0.8":dt.rowMeta.commentCount<=99}]),onClick:Gn=>ri(dt,oo)},[tt(se(dt.rowMeta.commentCount>99?"99+":dt.rowMeta.commentCount),1)],10,E_)),[[vn,["c:expanded-form:open"]]]):(p(),B("div",M_,[e(x)?Nt((p(),X(po(("iconMap"in A?A.iconMap:e(Bo)).maximize),{key:0,class:"select-none nc-row-expand opacity-90 w-3.5 h-3.5",onClick:Gn=>ri(dt,oo)},null,8,["onClick"])),[[vn,["c:row-expand:open"]]]):me("",!0)]))],64))],10,A_)])],40,I_),e(L)[0]?(p(),X(_l,{key:e(L)[0].id,active:e(Ue).row===Gt&&e(Ue).col===0||((Xi=e(Cn)._start)==null?void 0:Xi.row)===Gt&&((Oi=e(Cn)._start)==null?void 0:Oi.col)===0,class:Dt(["cell relative nc-grid-cell cursor-pointer",{active:e(So)[`${Gt}-0`],"active-cell":e(Ue).row===Gt&&e(Ue).col===0||((Ho=e(Cn)._start)==null?void 0:Ho.row)===Gt&&((Fr=e(Cn)._start)==null?void 0:Fr.col)===0,"nc-required-cell":e(yn)[Gt][0].isColumnRequiredAndNull&&!e(ve),"align-middle":!A.rowHeightEnum||A.rowHeightEnum===1,"align-top":A.rowHeightEnum&&A.rowHeightEnum!==1,filling:e(To)[`${Gt}-0`],readonly:e(kn)[0].isReadonly&&e(qe)&&e(So)[`${Gt}-0`],"!border-r-blue-400 !border-r-3":e(O)===e(L)[0].id,...di(e(L)[0].id)}]),style:Xn({"min-width":((Ar=e(He)[e(L)[0].id])==null?void 0:Ar.width)||"180px","max-width":((Er=e(He)[e(L)[0].id])==null?void 0:Er.width)||"180px",width:((Mr=e(He)[e(L)[0].id])==null?void 0:Mr.width)||"180px"}),"data-testid":`cell-${e(L)[0].title}-${Gt}`,"data-key":`data-key-${Gt}-${e(L)[0].id}`,"data-col":e(L)[0].id,"data-title":e(L)[0].title,"data-row-index":Gt,"data-col-index":0,onMousedown:Gn=>e(Mo)(Gn,Gt,0),onMouseover:Gn=>e(qn)(Gn,Gt,0),onClick:Gn=>si(Gn,Gt,0),onDblclick:Gn=>Kt(dt,e(L)[0]),onContextmenu:Gn=>yt(Gn,{row:Gt,col:0})},{default:J(()=>[e($t)?me("",!0):(p(),B("div",T_,[e(L)[0]&&e(kn)[0].isVirtualCol&&e(L)[0].title?(p(),X(dl,{key:0,modelValue:dt.row[e(L)[0].title],"onUpdate:modelValue":Gn=>dt.row[e(L)[0].title]=Gn,column:e(L)[0],active:e(Ue).col===0&&e(Ue).row===Gt,row:dt,"read-only":!e(qe),onNavigate:it,onSave:Gn=>{var Kn;return(Kn=e(w))==null?void 0:Kn(dt,"",oo)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):e(L)[0]&&e(L)[0].title?(p(),X(Na,{key:1,modelValue:dt.row[e(L)[0].title],"onUpdate:modelValue":Gn=>dt.row[e(L)[0].title]=Gn,column:e(L)[0],"edit-enabled":!!e(qe)&&!!e(ze)&&e(Ue).col===0&&e(Ue).row===Gt,"row-index":Gt,active:e(Ue).col===0&&e(Ue).row===Gt,"read-only":!e(qe),"onUpdate:editEnabled":N[22]||(N[22]=Gn=>ze.value=Gn),onSave:Gn=>{var Kn;return(Kn=e(w))==null?void 0:Kn(dt,e(L)[0].title,oo)},onNavigate:it,onCancel:N[23]||(N[23]=Gn=>ze.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):me("",!0)]))]),_:2},1032,["active","class","style","data-testid","data-key","data-col","data-title","data-row-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])):me("",!0),e(Un).length?(p(),B("td",{key:1,colspan:e(Un).length,style:Xn({minWidth:`${e(Un).width}px`,maxWidth:`${e(Un).width}px`,width:`${e(Un).width}px`}),class:"nc-grid-cell"},null,12,$_)):me("",!0),(p(!0),B(en,null,ho(e(Jo),({field:Gn,index:Kn})=>{var Bl,Tr,$r,Or,Dr,Lr,Nr;return p(),X(_l,{key:`cell-${Kn}-${Gt}`,active:e(Ue).row===Gt&&e(Ue).col===Kn||((Bl=e(Cn)._start)==null?void 0:Bl.row)===Gt&&((Tr=e(Cn)._start)==null?void 0:Tr.col)===Kn,class:Dt(["cell relative nc-grid-cell cursor-pointer",{active:e(So)[`${Gt}-${Kn}`],"active-cell":e(Ue).row===Gt&&e(Ue).col===Kn||(($r=e(Cn)._start)==null?void 0:$r.row)===Gt&&((Or=e(Cn)._start)==null?void 0:Or.col)===Kn,"nc-required-cell":e(yn)[Gt][Kn].isColumnRequiredAndNull&&!e(ve),"align-middle":!A.rowHeightEnum||A.rowHeightEnum===1,"align-top":A.rowHeightEnum&&A.rowHeightEnum!==1,filling:e(To)[`${Gt}-${Kn}`],readonly:e(kn)[Kn].isReadonly&&e(qe)&&e(So)[`${Gt}-${Kn}`],"!border-r-blue-400 !border-r-3":e(O)===Gn.id,...di(Gn.id)}]),style:Xn({"min-width":((Dr=e(He)[Gn.id])==null?void 0:Dr.width)||"180px","max-width":((Lr=e(He)[Gn.id])==null?void 0:Lr.width)||"180px",width:((Nr=e(He)[Gn.id])==null?void 0:Nr.width)||"180px"}),"data-testid":`cell-${Gn.title}-${Gt}`,"data-key":`data-key-${Gt}-${Gn.id}`,"data-col":Gn.id,"data-title":Gn.title,"data-row-index":Gt,"data-col-index":Kn,onMousedown:$e=>e(Mo)($e,Gt,Kn),onMouseover:$e=>e(qn)($e,Gt,Kn),onClick:$e=>si($e,Gt,Kn),onDblclick:$e=>Kt(dt,Gn),onContextmenu:$e=>yt($e,{row:Gt,col:Kn})},{default:J(()=>[e($t)?me("",!0):(p(),B("div",O_,[e(kn)[Kn].isVirtualCol&&Gn.title?(p(),X(dl,{key:0,modelValue:dt.row[Gn.title],"onUpdate:modelValue":$e=>dt.row[Gn.title]=$e,column:Gn,active:e(Ue).col===Kn&&e(Ue).row===Gt,row:dt,"read-only":!e(qe),onNavigate:it,onSave:$e=>{var Do;return(Do=e(w))==null?void 0:Do(dt,"",oo)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):Gn.title?(p(),X(Na,{key:1,modelValue:dt.row[Gn.title],"onUpdate:modelValue":$e=>dt.row[Gn.title]=$e,column:Gn,"edit-enabled":!!e(qe)&&!!e(ze)&&e(Ue).col===Kn&&e(Ue).row===Gt,"row-index":Gt,active:e(Ue).col===Kn&&e(Ue).row===Gt,"read-only":!e(qe),"onUpdate:editEnabled":N[24]||(N[24]=$e=>ze.value=$e),onSave:$e=>{var Do;return(Do=e(w))==null?void 0:Do(dt,Gn.title,oo)},onNavigate:it,onCancel:N[25]||(N[25]=$e=>ze.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):me("",!0)]))]),_:2},1032,["active","class","style","data-testid","data-key","data-col","data-title","data-row-index","data-col-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128)),e(mo).length?(p(),B("td",{key:2,colspan:e(mo).length,style:Xn({minWidth:`${e(mo).width}px`,maxWidth:`${e(mo).width}px`,width:`${e(mo).width}px`}),class:"nc-grid-cell"},null,12,D_)):me("",!0)],14,S_),[[ba,!e(Sn)]])]}),_:2},1032,["row"]))),128)),!e(Sn)&&e(io).length?(p(),X(pa,{key:2,"row-count":e(io).length,"row-height":e(io).rowHeight,"total-row-height":e(io).totalRowHeight,"col-count":e(Vl)},null,8,["row-count","row-height","total-row-height","col-count"])):me("",!0),e(nn)&&!e(xe)?Nt((p(),B("tr",{key:3,class:Dt(["text-left nc-grid-add-new-cell cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(pt)===1}]),onMouseup:N[26]||(N[26]=ro(()=>{},["stop"])),onClick:N[27]||(N[27]=dt=>al())},[z("td",L_,[e(ft)?me("",!0):(p(),X(po(("iconMap"in A?A.iconMap:e(Bo)).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))]),z("td",{class:"!border-gray-100",colspan:e(pt)},null,8,N_)],34)),[[vn,["c:row:add:grid-bottom"]]]):me("",!0)],512)):me("",!0)],38),Nt(z("div",{ref_key:"fillHandle",ref:xt,class:Dt(["nc-fill-handle",!e(Cn).isEmpty()&&e(Cn).end.col!==0||e(Cn).isEmpty()&&e(Ue).col!==0?"z-3":"z-4"]),style:Xn({top:`${e(va)}px`,left:`${e(La)}px`,cursor:"crosshair"})},null,6),[[ba,e(Ll)]])],6))])]}),_:1},8,["visible","trigger"])],2),z("div",X_,[e(c)!==!0&&e(s)&&e(xe)?(p(),X(Zt,{key:`nc-pagination-${e(j)}`,"pagination-data":e(s),"onUpdate:paginationData":N[38]||(N[38]=re=>bo(s)?s.value=re:null),"show-api-timing":!e(xe),"align-count-on-right":"","align-left":e(xe),"change-page":e(g),"hide-sidebars":((An=e(d))==null?void 0:An.hideSidebars)===!0,"fixed-size":(k=e(d))==null?void 0:k.fixedSize,"extra-style":(T=e(d))==null?void 0:T.extraStyle,"show-size-changer":!e(xe),"is-add-new-record-grid-mode":e(Ee)},oc({_:2},[e(nn)&&!e(Sn)?{name:"add-record",fn:J(()=>[z("div",K_,[e(j)?Nt((p(),X(Rt,{key:0,class:"nc-grid-add-new-row",type:"secondary",disabled:e(H),onClick:N[36]||(N[36]=ro(re=>ao(),["stop"]))},{default:J(()=>[tt(se(A.$t("activity.newRecord")),1)]),_:1},8,["disabled"])),[[vn,[e(Ee)?"c:row:add:grid":"c:row:add:form"]]]):Nt((p(),X(Qt,{key:1,class:"nc-grid-add-new-row",placement:"top",disabled:e(H),onClick:N[37]||(N[37]=ro(re=>e(Ee)?al():ao(),["stop"]))},{overlay:J(()=>{var re,De;return[z("div",Q_,[z("div",{class:Dt(["absolute -top-21 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",{"-left-32.5":!e(Ee),"-left-21.5":e(Ee)}]),style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},[Nt((p(),B("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:Yn},[z("div",Z_,[z("div",ex,[(p(),X(po((re=("viewIcons"in A?A.viewIcons:e(_i))[e(Ul).GRID])==null?void 0:re.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(A.$t("activity.newRecord"))+" - "+se(A.$t("objects.viewType.grid")),1)]),e(Ee)?(p(),X(Ln,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):me("",!0)]),z("div",tx,se(A.$t("labels.addRowGrid")),1)])),[[vn,["c:row:add:grid"]]]),Nt((p(),B("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",onClick:ao},[z("div",nx,[z("div",ox,[(p(),X(po((De=("viewIcons"in A?A.viewIcons:e(_i))[e(Ul).FORM])==null?void 0:De.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(A.$t("activity.newRecord"))+" - "+se(A.$t("objects.viewType.form")),1)]),e(Ee)?me("",!0):(p(),X(Ln,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),z("div",lx,se(A.$t("labels.addRowForm")),1)])),[[vn,["c:row:add:form"]]])],2)])]}),icon:J(()=>[(p(),X(po(("iconMap"in A?A.iconMap:e(Bo)).arrowUp),{class:"text-gray-600 h-4 w-4"}))]),default:J(()=>[z("div",J_,[z("span",null,[e(Ee)?(p(),B(en,{key:0},[tt(se(A.$t("activity.newRecord")),1)],64)):(p(),B(en,{key:1},[tt(se(A.$t("activity.newRecord"))+" - "+se(A.$t("objects.viewType.form")),1)],64))])])]),_:1},8,["disabled"])),[[vn,[e(Ee)?"c:row:add:grid:toggle":"c:row:add:form:toggle"]]])])]),key:"0"}:void 0]),1032,["pagination-data","show-api-timing","align-left","change-page","hide-sidebars","fixed-size","extra-style","show-size-changer","is-add-new-record-grid-mode"])):e(s)?(p(),X(Bt,{key:1,"pagination-data":e(s),"onUpdate:paginationData":N[39]||(N[39]=re=>bo(s)?s.value=re:null),"change-page":e(g),"show-size-changer":!e(xe),"scroll-left":e(Po)},null,8,["pagination-data","change-page","show-size-changer","scroll-left"])):me("",!0)]),e(c)!==!0&&e(s)&&!e(xe)?(p(),B("div",{key:0,class:"absolute bottom-12 left-2",onClick:N[42]||(N[42]=ro(()=>{},["stop"]))},[e(nn)&&!e(Sn)?(p(),X(rt,{key:0},{overlay:J(()=>[ue(Pl,{variant:"small"},{default:J(()=>[Nt((p(),X(co,{class:"nc-new-record-with-grid group",onClick:Yn},{default:J(()=>{var re;return[z("div",sx,[(p(),X(po((re=("viewIcons"in A?A.viewIcons:e(_i))[e(Ul).GRID])==null?void 0:re.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(A.$t("activity.newRecord"))+" - "+se(A.$t("objects.viewType.grid")),1)]),e(Ee)?(p(),X(Ln,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):me("",!0)]}),_:1})),[[vn,["c:row:add:grid"]]]),Nt((p(),X(co,{class:"nc-new-record-with-form group",onClick:ao},{default:J(()=>{var re;return[z("div",ux,[(p(),X(po((re=("viewIcons"in A?A.viewIcons:e(_i))[e(Ul).FORM])==null?void 0:re.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(A.$t("activity.newRecord"))+" - "+se(A.$t("objects.viewType.form")),1)]),e(Ee)?me("",!0):(p(),X(Ln,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]}),_:1})),[[vn,["c:row:add:form"]]])]),_:1})]),default:J(()=>[z("div",ax,[e(j)?Nt((p(),X(Rt,{key:0,disabled:e(H),class:"nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:N[40]||(N[40]=ro(re=>ao(),["stop"]))},{default:J(()=>[z("div",ix,[ue(Ln,{icon:"plus"}),N[50]||(N[50]=tt(" New Record "))])]),_:1},8,["disabled"])),[[vn,[e(Ee)?"c:row:add:grid":"c:row:add:form"]]]):Nt((p(),X(Rt,{key:1,disabled:e(H),class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:N[41]||(N[41]=ro(re=>e(Ee)?al():ao(),["stop"]))},{default:J(()=>[z("div",rx,[ue(Ln,{icon:"plus"}),e(Ee)?(p(),B(en,{key:0},[tt(se(A.$t("activity.newRecord")),1)],64)):(p(),B(en,{key:1},[tt(se(A.$t("activity.newRecord"))+" - "+se(A.$t("objects.viewType.form")),1)],64))])]),_:1},8,["disabled"])),[[vn,[e(Ee)?"c:row:add:grid":"c:row:add:form"]]]),e(j)?me("",!0):(p(),X(Rt,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary",shadow:!1},{default:J(()=>[ue(Ln,{icon:"arrowUp"})]),_:1}))])]),_:1})):me("",!0)])):me("",!0)],2)}}}),fd=Object.assign(Ol(cx,[["__scopeId","data-v-3b39087a"]]),{__name:"SmartsheetGridTable"}),fx={class:"flex gap-2 items-center"},vx={key:0,class:"flex gap-2 items-center"},px={key:1,class:"flex gap-2 items-center"},hx={class:"flex gap-2 items-center"},mx={class:"flex gap-2 items-center"},gx={class:"flex gap-2 items-center"},wx={class:"flex gap-2 items-center"},yx={class:"flex gap-2 items-center"},bx={class:"flex gap-2 items-center"},_x={class:"flex gap-2 items-center"},xx={class:"flex gap-2 items-center"},kx={class:"flex gap-2 items-center"},Cx={class:"flex gap-2 items-center"},Rx={class:"flex gap-2 items-center"},Sx={class:"flex gap-2 items-center"},Ix=ko({__name:"Cell",props:{selectedAllRecords:{type:Boolean},contextMenuTarget:{},selection:{},columns:{},activeCell:{},isGroupBy:{type:Boolean},isPrimaryKeyAvailable:{type:Boolean},isSelectionReadOnly:{type:Boolean},isSelectionOnlyAI:{},isSelectionOnlyScript:{},actionManager:{},isInsertBelowDisabled:{type:Boolean},isOrderColumnExists:{type:Boolean},deleteRow:{type:Function},deleteRangeOfRows:{type:Function},deleteSelectedRows:{type:Function},bulkDeleteAll:{type:Function},callAddNewRow:{type:Function},copyValue:{type:Function},bulkUpdateRows:{type:Function},expandForm:{type:Function},clearCell:{type:Function},clearSelectedRangeOfCells:{type:Function},getRows:{type:Function},getDataCache:{type:Function}},emits:["bulkUpdateDlg","update:selectedAllRecords"],setup(t,{emit:n}){const o=t,l=n,{bulkDeleteAll:a,deleteRow:i,deleteSelectedRows:s,deleteRangeOfRows:r,expandForm:d,clearCell:c,clearSelectedRangeOfCells:f,getRows:v,getDataCache:h}=o,y=Ra(o,"contextMenuTarget",l),b=Ra(o,"selectedAllRecords",l),_=Bn(o,"isGroupBy"),m=Bn(o,"selection"),g=Bn(o,"actionManager"),C=Bn(o,"columns"),w=Bn(o,"isSelectionOnlyAI"),S=Bn(o,"isSelectionOnlyScript"),x=Bn(o,"activeCell"),$=Bn(o,"isOrderColumnExists"),{isExpandedFormCommentMode:I}=Go(Sr()),F=V(!1),{isDataReadOnly:E,isUIAllowed:M}=gl(),{aiIntegrations:U}=xr(),{isMobileMode:L}=nl(),{paste:G}=cd(),{meta:ae}=Il(),ve=le(()=>M("dataEdit")),xe=le(()=>{var oe,ye;return((oe=y.value)==null?void 0:oe.row)!==-1?(ye=y.value)==null?void 0:ye.row:null}),ne=le(()=>{var oe,ye;return((oe=y.value)==null?void 0:oe.col)!==-1?(ye=y.value)==null?void 0:ye.col:null}),he=le(()=>{var oe,ye,ie,H;return _.value?(ye=(oe=y.value)==null?void 0:oe.path)!=null&&ye.length?(ie=y.value)==null?void 0:ie.path:null:(H=y.value)==null?void 0:H.path}),W=le(()=>he.value?h(he.value).selectedRows.value:[]),j=le(()=>{var oe,ye;return o.isSelectionReadOnly&&(!m.value.isSingleCell()||!ne.value||!he.value||!Yo((oe=C.value[ne.value])==null?void 0:oe.columnObj)&&!Qo((ye=C.value[ne.value])==null?void 0:ye.columnObj))}),Ee=le(()=>{var oe;return o.isSelectionReadOnly&&(!m.value.isSingleCell()||!he.value||!ne.value||!hl((oe=C.value[ne.value])==null?void 0:oe.columnObj))});async function Ye(){F.value=!0;const{totalRows:oe}=h([]),{close:ye}=ss(vv,{modelValue:F,rows:oe.value,"onUpdate:modelValue":ie,onDeleteAll:async()=>{await(a==null?void 0:a([])),ie(),b.value=!1}});function ie(){F.value=!1,ye(200)}await ka(F).toBe(!1)}const Ge=(oe,ye)=>{try{i==null||i(oe,!1,ye),m.value.isRowInRange(oe)&&m.value.clear(),x.value&&x.value.row===oe&&(x.value.row=-1,x.value.column=-1)}catch(ie){tn.error(ie.message)}},ke=oe=>{r==null||r(m.value,oe).then(()=>{m.value.clear(),x.value.row=-1,x.value.column=-1,x.value.path=oe})},Y=(oe,ye)=>{try{I.value=!0;const H=h(ye).cachedRows.value.get(oe);if(!H)return;d(H,{},!1,ye),x.value.row=-1,x.value.column=-1,x.value.path=ye,m.value.clear()}catch(ie){tn.error(ie.message)}},we=async oe=>{const ye=C.value[m.value.start.col],ie=ye==null?void 0:ye.columnObj;if(!ie||!ie.id)return;const H=await v(m.value.start.row,m.value.end.row+1,oe);if(!H||H.length===0)return;const Ae=H.map(Ie=>{var ce;return{pk:qt(Ie.row,(ce=ae.value)==null?void 0:ce.columns),row:Ie}}).filter(Ie=>Ie.pk!==null);await g.value.executeButtonAction(Ae.map(Ie=>Ie.pk),ye,{row:Ae.map(Ie=>Ie.row),isAiPromptCol:_a(ye==null?void 0:ye.columnObj),path:he.value})};return(oe,ye)=>{const ie=$l,H=Ya,Ae=Rr,Ie=br,ce=Aa,te=dd,Le=qa,Ne=Yl("e");return p(),X(Le,{class:"!rounded !py-0",variant:"small"},{default:J(()=>{var lt,je,He,Q,Mt,_e,wn,It,Tt;return[e(b)?me("",!0):(p(),B(en,{key:0},[("isEeUI"in oe?oe.isEeUI:e(Bi))&&e(ne)==null&&e(he)!==null&&!e(E)&&e(W).length?(p(),X(H,{key:"update-selected-rows",onClick:ye[0]||(ye[0]=Je=>l("bulkUpdateDlg",e(he)))},{default:J(()=>[Nt((p(),B("div",fx,[ue(ie,{icon:"ncEdit"}),tt(" "+se(oe.$t("title.updateSelectedRows")),1)])),[[Ne,["a:row:update-bulk"]]])]),_:1})):me("",!0),e(ne)==null&&!e(E)&&e(he)!==null&&e(W).length?(p(),X(Ae,{key:1,entity:e(vl).TABLE,"entity-id":(lt=e(ae))==null?void 0:lt.id,permission:e(fl).TABLE_RECORD_DELETE,placement:"right"},{default:J(({isAllowed:Je})=>[ue(H,{key:"selete-selected-rows",class:Dt(["nc-base-menu-item",{"!text-red-600 !hover:bg-red-50":Je}]),"data-testid":"nc-delete-row",disabled:!Je,onClick:ye[1]||(ye[1]=cn=>e(s)(e(he)))},{default:J(()=>[e(W).length===1?Nt((p(),B("div",vx,[ue(ie,{icon:"delete"}),tt(" "+se(oe.$t("activity.deleteSelectedRow")),1)])),[[Ne,["a:row:delete"]]]):Nt((p(),B("div",px,[ue(ie,{icon:"delete"}),tt(" "+se(oe.$t("activity.deleteSelectedRow")),1)])),[[Ne,["a:row:delete-bulk"]]])]),_:2},1032,["class","disabled"])]),_:1},8,["entity","entity-id","permission"])):me("",!0)],64)),e(b)&&!e(_)?(p(),X(Ae,{key:1,entity:e(vl).TABLE,"entity-id":(je=e(ae))==null?void 0:je.id,permission:e(fl).TABLE_RECORD_DELETE,placement:"right"},{default:J(({isAllowed:Je})=>[ue(H,{key:"delete-all-rows",class:Dt(["nc-base-menu-item",{"!text-red-600 !hover:bg-red-50":Je}]),"data-testid":"nc-delete-all-row",disabled:!Je,onClick:ye[2]||(ye[2]=cn=>Ye(e(he)))},{default:J(()=>[Nt((p(),B("div",hx,[ue(ie,{icon:"delete"}),tt(" "+se(oe.$t("activity.deleteAllRecords")),1)])),[[Ne,["a:row:delete-all"]]])]),_:2},1032,["class","disabled"])]),_:1},8,["entity","entity-id","permission"])):me("",!0),e($)&&e(ve)&&!e(E)&&oe.isPrimaryKeyAvailable&&e(m).isSingleCell()?(p(),B(en,{key:2},[e(ne)!==null&&e(xe)!==null&&e(he)!==null?(p(),X(Ae,{key:0,entity:e(vl).TABLE,"entity-id":(He=e(ae))==null?void 0:He.id,permission:e(fl).TABLE_RECORD_ADD,placement:"right"},{default:J(({isAllowed:Je})=>[ue(H,{key:"insert-above",class:"nc-base-menu-item","data-testid":"context-menu-item-add-above",disabled:!Je,onClick:ye[3]||(ye[3]=cn=>oe.callAddNewRow(e(y),"above"))},{default:J(()=>[Nt((p(),B("div",mx,[ue(ie,{icon:"ncChevronUp"}),tt(" "+se(oe.$t("general.insertAbove")),1)])),[[Ne,["a:row:insert:above"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):me("",!0),e(ne)!==null&&e(xe)!==null&&e(he)!==null&&!oe.isInsertBelowDisabled?(p(),X(Ae,{key:1,entity:e(vl).TABLE,"entity-id":(Q=e(ae))==null?void 0:Q.id,permission:e(fl).TABLE_RECORD_ADD,placement:"right"},{default:J(({isAllowed:Je})=>[ue(H,{key:"insert-below",class:"nc-base-menu-item","data-testid":"context-menu-item-add-below",disabled:!Je,onClick:ye[4]||(ye[4]=cn=>oe.callAddNewRow(e(y),"below"))},{default:J(()=>[Nt((p(),B("div",gx,[ue(ie,{icon:"ncChevronDown"}),tt(" "+se(oe.$t("general.insertBelow")),1)])),[[Ne,["a:row:insert:below"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):me("",!0),e(ne)!==null&&e(xe)!==null?(p(),X(Ie,{key:2})):me("",!0)],64)):me("",!0),e(ne)!==null&&e(he)!==null&&e(xe)!==null&&e(ve)&&!e(E)&&e(w).enabled?(p(),X(ce,{key:3,disabled:!e(w).disabled},{title:J(()=>[tt(se(e(U).length?oe.$t("tooltip.aiIntegrationReConfigure"):oe.$t("tooltip.aiIntegrationAddAndReConfigure")),1)]),default:J(()=>[ue(H,{key:"generate-ai",class:"nc-base-menu-item","data-testid":"context-menu-item-bulk",disabled:e(w).disabled,onClick:ye[5]||(ye[5]=Je=>we(e(he)||[]))},{default:J(()=>[z("div",wx,[ue(ie,{icon:"ncAutoAwesome",class:"h-4 w-4"}),tt(" Generate "+se(e(m).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):me("",!0),e(S).enabled?(p(),X(H,{key:"execute-script",class:"nc-base-menu-item","data-testid":"context-menu-item-bulk-script",disabled:e(S).disabled,onClick:ye[6]||(ye[6]=Je=>we(e(he)||[]))},{default:J(()=>[z("div",yx,[ue(ie,{icon:"ncScript",class:"h-4 w-4"}),tt(" Execute "+se(e(m).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])):me("",!0),e(ne)!==null&&e(xe)!==null&&e(he)!==null?(p(),X(H,{key:"cell-copy",class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:ye[7]||(ye[7]=Je=>oe.copyValue(e(y),e(he)))},{default:J(()=>[Nt((p(),B("div",bx,[ue(ie,{icon:"copy"}),tt(" "+se(oe.$t("general.copy"))+" "+se(oe.$t("objects.cell").toLowerCase()),1)])),[[Ne,["a:row:copy"]]])]),_:1})):me("",!0),e(ne)!==null&&e(he)&&e(xe)!==null&&e(ve)&&!e(E)?(p(),X(Ae,{key:6,entity:e(vl).FIELD,"entity-id":(_e=(Mt=e(C)[e(ne)])==null?void 0:Mt.columnObj)==null?void 0:_e.id,permission:e(fl).RECORD_FIELD_EDIT,placement:"right"},{default:J(({isAllowed:Je})=>[ue(H,{key:"cell-paste",class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(j)||!Je,onClick:e(G)},{default:J(()=>[Nt((p(),B("div",_x,[ue(ie,{icon:"paste"}),tt(" "+se(oe.$t("general.paste"))+" "+se(oe.$t("objects.cell").toLowerCase()),1)])),[[Ne,["a:row:paste"]]])]),_:2},1032,["disabled","onClick"])]),_:1},8,["entity","entity-id","permission"])):me("",!0),e(ne)!==null&&e(xe)!==null&&e(he)!==null&&e(ve)&&!e(E)?(p(),X(Ae,{key:7,entity:e(vl).FIELD,"entity-id":(It=(wn=e(C)[e(ne)])==null?void 0:wn.columnObj)==null?void 0:It.id,permission:e(fl).RECORD_FIELD_EDIT,placement:"right"},{default:J(({isAllowed:Je})=>{var cn;return[e(m).isSingleCell()&&(e(hl)((cn=e(C)[e(ne)])==null?void 0:cn.columnObj)||!e(C)[e(ne)].virtual)?(p(),X(H,{key:"cell-clear",class:"nc-base-menu-item",disabled:e(Ee)||!Je,"data-testid":"context-menu-item-clear",onClick:ye[8]||(ye[8]=Pn=>e(c)(e(y)))},{default:J(()=>[Nt((p(),B("div",xx,[ue(ie,{icon:"close"}),tt(" "+se(oe.$t("general.clear"))+" "+se(oe.$t("objects.cell").toLowerCase()),1)])),[[Ne,["a:row:clear"]]])]),_:2},1032,["disabled"])):(p(),X(H,{key:"cells-clear",class:"nc-base-menu-item",disabled:oe.isSelectionReadOnly||!Je,"data-testid":"context-menu-item-clear",onClick:ye[9]||(ye[9]=Pn=>e(f)(e(he)))},{default:J(()=>[Nt((p(),B("div",kx,[ue(ie,{icon:"closeBox",class:"text-gray-500"}),tt(" "+se(oe.$t("general.clear"))+" "+se(oe.$t("objects.cell").toLowerCase()),1)])),[[Ne,["a:row:clear-range"]]])]),_:2},1032,["disabled"]))]}),_:1},8,["entity","entity-id","permission"])):me("",!0),e(he)!==null&&e(ne)!==null&&e(xe)!=null&&e(m).isSingleCell()&&e(M)("commentEdit")&&!e(L)?(p(),B(en,{key:8},[ue(Ie),ue(H,{key:"add-comment",class:"nc-base-menu-item",onClick:ye[10]||(ye[10]=Je=>Y(e(xe),e(he)))},{default:J(()=>[Nt((p(),B("div",Cx,[ue(te,{class:"h-4 w-4"}),tt(" "+se(oe.$t("general.add"))+" "+se(oe.$t("general.comment").toLowerCase()),1)])),[[Ne,["a:row:comment"]]])]),_:1})],64)):me("",!0),e(ve)&&!e(E)?(p(),B(en,{key:9},[!e(ne)!==null&&(e(W).length||e(b))?me("",!0):(p(),X(Ie,{key:0})),e(he)!==null&&e(ne)!==null&&e(xe)!=null?(p(),X(Ae,{key:1,entity:e(vl).TABLE,"entity-id":(Tt=e(ae))==null?void 0:Tt.id,permission:e(fl).TABLE_RECORD_DELETE,placement:"right"},{default:J(({isAllowed:Je})=>[e(m).isSingleCell()||e(m).isSingleRow()?(p(),X(H,{key:"delete-row",class:Dt(["nc-base-menu-item",{"!text-red-600 !hover:bg-red-50":Je}]),disabled:!Je,onClick:ye[11]||(ye[11]=cn=>Ge(e(xe),e(he)))},{default:J(()=>[Nt((p(),B("div",Rx,[ue(ie,{icon:"delete"}),tt(" "+se(oe.$t("activity.deleteRow")),1)])),[[Ne,["a:row:delete"]]])]),_:2},1032,["class","disabled"])):(p(),X(H,{key:"delete-selected-row",class:Dt(["nc-base-menu-item",{"!text-red-600 !hover:bg-red-50":Je}]),disabled:!Je,onClick:ye[12]||(ye[12]=cn=>ke(e(he)))},{default:J(()=>[Nt((p(),B("div",Sx,[ue(ie,{icon:"delete"}),tt(" "+se(oe.$t("activity.deleteRows")),1)])),[[Ne,["a:row:delete"]]])]),_:2},1032,["class","disabled"]))]),_:1},8,["entity","entity-id","permission"])):me("",!0)],64)):me("",!0)]}),_:1})}}}),Fx=Object.assign(Ix,{__name:"SmartsheetGridCanvasContextCell"}),Ax=ko({__name:"Row",props:{row:{}},setup(t){const o=Bn(t,"row"),{isNew:l,state:a,loadRow:i,pk:s}=Zf(o),r=fn(Ea),d=Uo();d.on(f=>{l.value||r==null||r.trigger({...f,shouldShowLoading:(f==null?void 0:f.shouldShowLoading)??!1})});const{eventBus:c}=Ps();return c.on(async(f,v)=>{f===Cs.RELOAD_ROW&&v.rowId==s.value&&await i()}),yo(ir,d),(f,v)=>qu(f.$slots,"default",{state:e(a)})}}),wv=Object.assign(Ax,{__name:"SmartsheetRow"}),vd=Object.freeze(Object.defineProperty({__proto__:null,default:wv},Symbol.toStringTag,{value:"Module"})),Nu=Math.min,cr=Math.max,Vs=Math.round,ja=t=>({x:t,y:t}),Ex={left:"right",right:"left",bottom:"top",top:"bottom"},Mx={start:"end",end:"start"};function Ic(t,n,o){return cr(t,Nu(n,o))}function ou(t,n){return typeof t=="function"?t(n):t}function Ui(t){return t.split("-")[0]}function lu(t){return t.split("-")[1]}function yv(t){return t==="x"?"y":"x"}function bv(t){return t==="y"?"height":"width"}function zi(t){return["top","bottom"].includes(Ui(t))?"y":"x"}function _v(t){return yv(zi(t))}function Tx(t,n,o){o===void 0&&(o=!1);const l=lu(t),a=_v(t),i=bv(a);let s=a==="x"?l===(o?"end":"start")?"right":"left":l==="start"?"bottom":"top";return n.reference[i]>n.floating[i]&&(s=js(s)),[s,js(s)]}function $x(t){const n=js(t);return[Pu(t),n,Pu(n)]}function Pu(t){return t.replace(/start|end/g,n=>Mx[n])}function Ox(t,n,o){const l=["left","right"],a=["right","left"],i=["top","bottom"],s=["bottom","top"];switch(t){case"top":case"bottom":return o?n?a:l:n?l:a;case"left":case"right":return n?i:s;default:return[]}}function Dx(t,n,o,l){const a=lu(t);let i=Ox(Ui(t),o==="start",l);return a&&(i=i.map(s=>s+"-"+a),n&&(i=i.concat(i.map(Pu)))),i}function js(t){return t.replace(/left|right|bottom|top/g,n=>Ex[n])}function Lx(t){return{top:0,right:0,bottom:0,left:0,...t}}function Nx(t){return typeof t!="number"?Lx(t):{top:t,right:t,bottom:t,left:t}}function Us(t){const{x:n,y:o,width:l,height:a}=t;return{width:l,height:a,top:o,left:n,right:n+l,bottom:o+a,x:n,y:o}}function Fc(t,n,o){let{reference:l,floating:a}=t;const i=zi(n),s=_v(n),r=bv(s),d=Ui(n),c=i==="y",f=l.x+l.width/2-a.width/2,v=l.y+l.height/2-a.height/2,h=l[r]/2-a[r]/2;let y;switch(d){case"top":y={x:f,y:l.y-a.height};break;case"bottom":y={x:f,y:l.y+l.height};break;case"right":y={x:l.x+l.width,y:v};break;case"left":y={x:l.x-a.width,y:v};break;default:y={x:l.x,y:l.y}}switch(lu(n)){case"start":y[s]-=h*(o&&c?-1:1);break;case"end":y[s]+=h*(o&&c?-1:1);break}return y}const Px=async(t,n,o)=>{const{placement:l="bottom",strategy:a="absolute",middleware:i=[],platform:s}=o,r=i.filter(Boolean),d=await(s.isRTL==null?void 0:s.isRTL(n));let c=await s.getElementRects({reference:t,floating:n,strategy:a}),{x:f,y:v}=Fc(c,l,d),h=l,y={},b=0;for(let _=0;_<r.length;_++){const{name:m,fn:g}=r[_],{x:C,y:w,data:S,reset:x}=await g({x:f,y:v,initialPlacement:l,placement:h,strategy:a,middlewareData:y,rects:c,platform:s,elements:{reference:t,floating:n}});f=C??f,v=w??v,y={...y,[m]:{...y[m],...S}},x&&b<=50&&(b++,typeof x=="object"&&(x.placement&&(h=x.placement),x.rects&&(c=x.rects===!0?await s.getElementRects({reference:t,floating:n,strategy:a}):x.rects),{x:f,y:v}=Fc(c,h,d)),_=-1)}return{x:f,y:v,placement:h,strategy:a,middlewareData:y}};async function xv(t,n){var o;n===void 0&&(n={});const{x:l,y:a,platform:i,rects:s,elements:r,strategy:d}=t,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:v="floating",altBoundary:h=!1,padding:y=0}=ou(n,t),b=Nx(y),m=r[h?v==="floating"?"reference":"floating":v],g=Us(await i.getClippingRect({element:(o=await(i.isElement==null?void 0:i.isElement(m)))==null||o?m:m.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(r.floating)),boundary:c,rootBoundary:f,strategy:d})),C=v==="floating"?{x:l,y:a,width:s.floating.width,height:s.floating.height}:s.reference,w=await(i.getOffsetParent==null?void 0:i.getOffsetParent(r.floating)),S=await(i.isElement==null?void 0:i.isElement(w))?await(i.getScale==null?void 0:i.getScale(w))||{x:1,y:1}:{x:1,y:1},x=Us(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:C,offsetParent:w,strategy:d}):C);return{top:(g.top-x.top+b.top)/S.y,bottom:(x.bottom-g.bottom+b.bottom)/S.y,left:(g.left-x.left+b.left)/S.x,right:(x.right-g.right+b.right)/S.x}}const Bx=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(n){var o,l;const{placement:a,middlewareData:i,rects:s,initialPlacement:r,platform:d,elements:c}=n,{mainAxis:f=!0,crossAxis:v=!0,fallbackPlacements:h,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:_=!0,...m}=ou(t,n);if((o=i.arrow)!=null&&o.alignmentOffset)return{};const g=Ui(a),C=zi(r),w=Ui(r)===r,S=await(d.isRTL==null?void 0:d.isRTL(c.floating)),x=h||(w||!_?[js(r)]:$x(r)),$=b!=="none";!h&&$&&x.push(...Dx(r,_,b,S));const I=[r,...x],F=await xv(n,m),E=[];let M=((l=i.flip)==null?void 0:l.overflows)||[];if(f&&E.push(F[g]),v){const ve=Tx(a,s,S);E.push(F[ve[0]],F[ve[1]])}if(M=[...M,{placement:a,overflows:E}],!E.every(ve=>ve<=0)){var U,L;const ve=(((U=i.flip)==null?void 0:U.index)||0)+1,xe=I[ve];if(xe){var G;const he=v==="alignment"?C!==zi(xe):!1,W=((G=M[0])==null?void 0:G.overflows[0])>0;if(!he||W)return{data:{index:ve,overflows:M},reset:{placement:xe}}}let ne=(L=M.filter(he=>he.overflows[0]<=0).sort((he,W)=>he.overflows[1]-W.overflows[1])[0])==null?void 0:L.placement;if(!ne)switch(y){case"bestFit":{var ae;const he=(ae=M.filter(W=>{if($){const j=zi(W.placement);return j===C||j==="y"}return!0}).map(W=>[W.placement,W.overflows.filter(j=>j>0).reduce((j,Ee)=>j+Ee,0)]).sort((W,j)=>W[1]-j[1])[0])==null?void 0:ae[0];he&&(ne=he);break}case"initialPlacement":ne=r;break}if(a!==ne)return{reset:{placement:ne}}}return{}}}};async function Wx(t,n){const{placement:o,platform:l,elements:a}=t,i=await(l.isRTL==null?void 0:l.isRTL(a.floating)),s=Ui(o),r=lu(o),d=zi(o)==="y",c=["left","top"].includes(s)?-1:1,f=i&&d?-1:1,v=ou(n,t);let{mainAxis:h,crossAxis:y,alignmentAxis:b}=typeof v=="number"?{mainAxis:v,crossAxis:0,alignmentAxis:null}:{mainAxis:v.mainAxis||0,crossAxis:v.crossAxis||0,alignmentAxis:v.alignmentAxis};return r&&typeof b=="number"&&(y=r==="end"?b*-1:b),d?{x:y*f,y:h*c}:{x:h*c,y:y*f}}const zx=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(n){var o,l;const{x:a,y:i,placement:s,middlewareData:r}=n,d=await Wx(n,t);return s===((o=r.offset)==null?void 0:o.placement)&&(l=r.arrow)!=null&&l.alignmentOffset?{}:{x:a+d.x,y:i+d.y,data:{...d,placement:s}}}}},Vx=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(n){const{x:o,y:l,placement:a}=n,{mainAxis:i=!0,crossAxis:s=!1,limiter:r={fn:m=>{let{x:g,y:C}=m;return{x:g,y:C}}},...d}=ou(t,n),c={x:o,y:l},f=await xv(n,d),v=zi(Ui(a)),h=yv(v);let y=c[h],b=c[v];if(i){const m=h==="y"?"top":"left",g=h==="y"?"bottom":"right",C=y+f[m],w=y-f[g];y=Ic(C,y,w)}if(s){const m=v==="y"?"top":"left",g=v==="y"?"bottom":"right",C=b+f[m],w=b-f[g];b=Ic(C,b,w)}const _=r.fn({...n,[h]:y,[v]:b});return{..._,data:{x:_.x-o,y:_.y-l,enabled:{[h]:i,[v]:s}}}}}};function au(){return typeof window<"u"}function Yi(t){return pd(t)?(t.nodeName||"").toLowerCase():"#document"}function ta(t){var n;return(t==null||(n=t.ownerDocument)==null?void 0:n.defaultView)||window}function li(t){var n;return(n=(pd(t)?t.ownerDocument:t.document)||window.document)==null?void 0:n.documentElement}function pd(t){return au()?t instanceof Node||t instanceof ta(t).Node:!1}function Ia(t){return au()?t instanceof Element||t instanceof ta(t).Element:!1}function Ua(t){return au()?t instanceof HTMLElement||t instanceof ta(t).HTMLElement:!1}function Ac(t){return!au()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof ta(t).ShadowRoot}function ms(t){const{overflow:n,overflowX:o,overflowY:l,display:a}=Fa(t);return/auto|scroll|overlay|hidden|clip/.test(n+l+o)&&!["inline","contents"].includes(a)}function jx(t){return["table","td","th"].includes(Yi(t))}function iu(t){return[":popover-open",":modal"].some(n=>{try{return t.matches(n)}catch{return!1}})}function hd(t){const n=md(),o=Ia(t)?Fa(t):t;return["transform","translate","scale","rotate","perspective"].some(l=>o[l]?o[l]!=="none":!1)||(o.containerType?o.containerType!=="normal":!1)||!n&&(o.backdropFilter?o.backdropFilter!=="none":!1)||!n&&(o.filter?o.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(l=>(o.willChange||"").includes(l))||["paint","layout","strict","content"].some(l=>(o.contain||"").includes(l))}function Ux(t){let n=Ii(t);for(;Ua(n)&&!hr(n);){if(hd(n))return n;if(iu(n))return null;n=Ii(n)}return null}function md(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function hr(t){return["html","body","#document"].includes(Yi(t))}function Fa(t){return ta(t).getComputedStyle(t)}function ru(t){return Ia(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Ii(t){if(Yi(t)==="html")return t;const n=t.assignedSlot||t.parentNode||Ac(t)&&t.host||li(t);return Ac(n)?n.host:n}function kv(t){const n=Ii(t);return hr(n)?t.ownerDocument?t.ownerDocument.body:t.body:Ua(n)&&ms(n)?n:kv(n)}function Cv(t,n,o){var l;n===void 0&&(n=[]);const a=kv(t),i=a===((l=t.ownerDocument)==null?void 0:l.body),s=ta(a);return i?(Bu(s),n.concat(s,s.visualViewport||[],ms(a)?a:[],[])):n.concat(a,Cv(a,[]))}function Bu(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Rv(t){const n=Fa(t);let o=parseFloat(n.width)||0,l=parseFloat(n.height)||0;const a=Ua(t),i=a?t.offsetWidth:o,s=a?t.offsetHeight:l,r=Vs(o)!==i||Vs(l)!==s;return r&&(o=i,l=s),{width:o,height:l,$:r}}function Sv(t){return Ia(t)?t:t.contextElement}function fr(t){const n=Sv(t);if(!Ua(n))return ja(1);const o=n.getBoundingClientRect(),{width:l,height:a,$:i}=Rv(n);let s=(i?Vs(o.width):o.width)/l,r=(i?Vs(o.height):o.height)/a;return(!s||!Number.isFinite(s))&&(s=1),(!r||!Number.isFinite(r))&&(r=1),{x:s,y:r}}const Gx=ja(0);function Iv(t){const n=ta(t);return!md()||!n.visualViewport?Gx:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function Hx(t,n,o){return n===void 0&&(n=!1),!o||n&&o!==ta(t)?!1:n}function ds(t,n,o,l){n===void 0&&(n=!1),o===void 0&&(o=!1);const a=t.getBoundingClientRect(),i=Sv(t);let s=ja(1);n&&(l?Ia(l)&&(s=fr(l)):s=fr(t));const r=Hx(i,o,l)?Iv(i):ja(0);let d=(a.left+r.x)/s.x,c=(a.top+r.y)/s.y,f=a.width/s.x,v=a.height/s.y;if(i){const h=ta(i),y=l&&Ia(l)?ta(l):l;let b=h,_=Bu(b);for(;_&&l&&y!==b;){const m=fr(_),g=_.getBoundingClientRect(),C=Fa(_),w=g.left+(_.clientLeft+parseFloat(C.paddingLeft))*m.x,S=g.top+(_.clientTop+parseFloat(C.paddingTop))*m.y;d*=m.x,c*=m.y,f*=m.x,v*=m.y,d+=w,c+=S,b=ta(_),_=Bu(b)}}return Us({width:f,height:v,x:d,y:c})}function gd(t,n){const o=ru(t).scrollLeft;return n?n.left+o:ds(li(t)).left+o}function Fv(t,n,o){o===void 0&&(o=!1);const l=t.getBoundingClientRect(),a=l.left+n.scrollLeft-(o?0:gd(t,l)),i=l.top+n.scrollTop;return{x:a,y:i}}function Yx(t){let{elements:n,rect:o,offsetParent:l,strategy:a}=t;const i=a==="fixed",s=li(l),r=n?iu(n.floating):!1;if(l===s||r&&i)return o;let d={scrollLeft:0,scrollTop:0},c=ja(1);const f=ja(0),v=Ua(l);if((v||!v&&!i)&&((Yi(l)!=="body"||ms(s))&&(d=ru(l)),Ua(l))){const y=ds(l);c=fr(l),f.x=y.x+l.clientLeft,f.y=y.y+l.clientTop}const h=s&&!v&&!i?Fv(s,d,!0):ja(0);return{width:o.width*c.x,height:o.height*c.y,x:o.x*c.x-d.scrollLeft*c.x+f.x+h.x,y:o.y*c.y-d.scrollTop*c.y+f.y+h.y}}function qx(t){return Array.from(t.getClientRects())}function Xx(t){const n=li(t),o=ru(t),l=t.ownerDocument.body,a=cr(n.scrollWidth,n.clientWidth,l.scrollWidth,l.clientWidth),i=cr(n.scrollHeight,n.clientHeight,l.scrollHeight,l.clientHeight);let s=-o.scrollLeft+gd(t);const r=-o.scrollTop;return Fa(l).direction==="rtl"&&(s+=cr(n.clientWidth,l.clientWidth)-a),{width:a,height:i,x:s,y:r}}function Kx(t,n){const o=ta(t),l=li(t),a=o.visualViewport;let i=l.clientWidth,s=l.clientHeight,r=0,d=0;if(a){i=a.width,s=a.height;const c=md();(!c||c&&n==="fixed")&&(r=a.offsetLeft,d=a.offsetTop)}return{width:i,height:s,x:r,y:d}}function Jx(t,n){const o=ds(t,!0,n==="fixed"),l=o.top+t.clientTop,a=o.left+t.clientLeft,i=Ua(t)?fr(t):ja(1),s=t.clientWidth*i.x,r=t.clientHeight*i.y,d=a*i.x,c=l*i.y;return{width:s,height:r,x:d,y:c}}function Ec(t,n,o){let l;if(n==="viewport")l=Kx(t,o);else if(n==="document")l=Xx(li(t));else if(Ia(n))l=Jx(n,o);else{const a=Iv(t);l={x:n.x-a.x,y:n.y-a.y,width:n.width,height:n.height}}return Us(l)}function Av(t,n){const o=Ii(t);return o===n||!Ia(o)||hr(o)?!1:Fa(o).position==="fixed"||Av(o,n)}function Qx(t,n){const o=n.get(t);if(o)return o;let l=Cv(t,[]).filter(r=>Ia(r)&&Yi(r)!=="body"),a=null;const i=Fa(t).position==="fixed";let s=i?Ii(t):t;for(;Ia(s)&&!hr(s);){const r=Fa(s),d=hd(s);!d&&r.position==="fixed"&&(a=null),(i?!d&&!a:!d&&r.position==="static"&&!!a&&["absolute","fixed"].includes(a.position)||ms(s)&&!d&&Av(t,s))?l=l.filter(f=>f!==s):a=r,s=Ii(s)}return n.set(t,l),l}function Zx(t){let{element:n,boundary:o,rootBoundary:l,strategy:a}=t;const s=[...o==="clippingAncestors"?iu(n)?[]:Qx(n,this._c):[].concat(o),l],r=s[0],d=s.reduce((c,f)=>{const v=Ec(n,f,a);return c.top=cr(v.top,c.top),c.right=Nu(v.right,c.right),c.bottom=Nu(v.bottom,c.bottom),c.left=cr(v.left,c.left),c},Ec(n,r,a));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function ek(t){const{width:n,height:o}=Rv(t);return{width:n,height:o}}function tk(t,n,o){const l=Ua(n),a=li(n),i=o==="fixed",s=ds(t,!0,i,n);let r={scrollLeft:0,scrollTop:0};const d=ja(0);function c(){d.x=gd(a)}if(l||!l&&!i)if((Yi(n)!=="body"||ms(a))&&(r=ru(n)),l){const y=ds(n,!0,i,n);d.x=y.x+n.clientLeft,d.y=y.y+n.clientTop}else a&&c();i&&!l&&a&&c();const f=a&&!l&&!i?Fv(a,r):ja(0),v=s.left+r.scrollLeft-d.x-f.x,h=s.top+r.scrollTop-d.y-f.y;return{x:v,y:h,width:s.width,height:s.height}}function hu(t){return Fa(t).position==="static"}function Mc(t,n){if(!Ua(t)||Fa(t).position==="fixed")return null;if(n)return n(t);let o=t.offsetParent;return li(t)===o&&(o=o.ownerDocument.body),o}function Ev(t,n){const o=ta(t);if(iu(t))return o;if(!Ua(t)){let a=Ii(t);for(;a&&!hr(a);){if(Ia(a)&&!hu(a))return a;a=Ii(a)}return o}let l=Mc(t,n);for(;l&&jx(l)&&hu(l);)l=Mc(l,n);return l&&hr(l)&&hu(l)&&!hd(l)?o:l||Ux(t)||o}const nk=async function(t){const n=this.getOffsetParent||Ev,o=this.getDimensions,l=await o(t.floating);return{reference:tk(t.reference,await n(t.floating),t.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function ok(t){return Fa(t).direction==="rtl"}const lk={convertOffsetParentRelativeRectToViewportRelativeRect:Yx,getDocumentElement:li,getClippingRect:Zx,getOffsetParent:Ev,getElementRects:nk,getClientRects:qx,getDimensions:ek,getScale:fr,isElement:Ia,isRTL:ok},ak=zx,ik=Vx,rk=Bx,sk=(t,n,o)=>{const l=new Map,a={platform:lk,...o},i={...a.platform,_c:l};return Px(t,n,{...a,platform:i})};function uk(t){return t!=null&&typeof t=="object"&&"$el"in t}function Tc(t){if(uk(t)){const n=t.$el;return pd(n)&&Yi(n)==="#comment"?null:n}return t}function Hr(t){return typeof t=="function"?t():e(t)}function Mv(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function $c(t,n){const o=Mv(t);return Math.round(n*o)/o}function dk(t,n,o){o===void 0&&(o={});const l=o.whileElementsMounted,a=le(()=>{var I;return(I=Hr(o.open))!=null?I:!0}),i=le(()=>Hr(o.middleware)),s=le(()=>{var I;return(I=Hr(o.placement))!=null?I:"bottom"}),r=le(()=>{var I;return(I=Hr(o.strategy))!=null?I:"absolute"}),d=le(()=>{var I;return(I=Hr(o.transform))!=null?I:!0}),c=le(()=>Tc(t.value)),f=le(()=>Tc(n.value)),v=V(0),h=V(0),y=V(r.value),b=V(s.value),_=xp({}),m=V(!1),g=le(()=>{const I={position:y.value,left:"0",top:"0"};if(!f.value)return I;const F=$c(f.value,v.value),E=$c(f.value,h.value);return d.value?{...I,transform:"translate("+F+"px, "+E+"px)",...Mv(f.value)>=1.5&&{willChange:"transform"}}:{position:y.value,left:F+"px",top:E+"px"}});let C;function w(){if(c.value==null||f.value==null)return;const I=a.value;sk(c.value,f.value,{middleware:i.value,placement:s.value,strategy:r.value}).then(F=>{v.value=F.x,h.value=F.y,y.value=F.strategy,b.value=F.placement,_.value=F.middlewareData,m.value=I!==!1})}function S(){typeof C=="function"&&(C(),C=void 0)}function x(){if(S(),l===void 0){w();return}if(c.value!=null&&f.value!=null){C=l(c.value,f.value,w);return}}function $(){a.value||(m.value=!1)}return Hn([i,s,r,a],w,{flush:"sync"}),Hn([c,f],x,{flush:"sync"}),Hn(a,$,{flush:"sync"}),kp()&&Cp(S),{x:Ji(v),y:Ji(h),strategy:Ji(y),placement:Ji(b),middlewareData:Ji(_),isPositioned:Ji(m),floatingStyles:g,update:w}}/**
* @vue/server-renderer v3.5.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const ck=$p(",key,ref,innerHTML,textContent,ref_key,ref_for");function fk(t,n){let o="";for(const l in t){if(ck(l)||Op(l)||n==="textarea"&&l==="value")continue;const a=t[l];l==="class"?o+=` class="${pk(a)}"`:l==="style"?o+=` style="${hk(a)}"`:l==="className"?o+=` class="${String(a)}"`:o+=vk(l,a,n)}return o}function vk(t,n,o){if(!Lp(n))return"";const l=o&&(o.indexOf("-")>0||Np(o))?t:Pp[t]||t.toLowerCase();return Bp(l)?Wp(n)?` ${l}`:"":zp(l)?n===""?` ${l}`:` ${l}="${Ri(n)}"`:(console.warn(`[@vue/server-renderer] Skipped rendering unsafe attribute name: ${l}`),"")}function pk(t){return Ri(Dt(t))}function hk(t){if(!t)return"";if(kr(t))return Ri(t);const n=Xn(t);return Ri(Dp(n))}const{ensureValidVNode:bR}=Qs;function mk(t,n,o,l,a){t("<!--teleport start-->");const i=a.appContext.provides[jf],s=i.__teleportBuffers||(i.__teleportBuffers={}),r=s[o]||(s[o]=[]),d=r.length;let c;if(l)n(t),c="<!--teleport start anchor--><!--teleport anchor-->";else{const{getBuffer:f,push:v}=Tv();v("<!--teleport start anchor-->"),n(v),v("<!--teleport anchor-->"),c=f()}r.splice(d,0,c),t("<!--teleport end-->")}{const t=Vp(),n=(o,l)=>{let a;return(a=t[o])||(a=t[o]=[]),a.push(l),i=>{a.length>1?a.forEach(s=>s(i)):a[0](i)}};n("__VUE_INSTANCE_SETTERS__",o=>o),n("__VUE_SSR_SETTERS__",o=>o)}function gk(t,n){throw new Error("On-the-fly template compilation is not supported in the ESM build of @vue/server-renderer. All templates must be pre-compiled into render functions.")}const{createComponentInstance:wk,setCurrentRenderingInstance:Oc,setupComponent:yk,renderComponentRoot:Dc,normalizeVNode:bk,pushWarningContext:_R,popWarningContext:xR}=Qs;function Tv(){let t=!1;const n=[];return{getBuffer(){return n},push(o){const l=kr(o);if(t&&l){n[n.length-1]+=o;return}n.push(o),t=l,(Ds(o)||Mp(o)&&o.hasAsync)&&(n.hasAsync=!0)}}}function $v(t,n=null,o){const l=t.component=wk(t,n,null),a=yk(l,!0),i=Ds(a);let s=l.sp;return i||s?Promise.resolve(a).then(()=>{if(i&&(s=l.sp),s)return Promise.all(s.map(d=>d.call(l.proxy)))}).catch(Au).then(()=>Lc(l,o)):Lc(l,o)}function Lc(t,n){const o=t.type,{getBuffer:l,push:a}=Tv();if(Sp(o)){let i=Dc(t);if(!o.props)for(const s in t.attrs)s.startsWith("data-v-")&&((i.props||(i.props={}))[s]="");Gs(a,t.subTree=i,t,n)}else{(!t.render||t.render===Au)&&!t.ssrRender&&!o.ssrRender&&kr(o.template)&&(o.ssrRender=gk(o.template));const i=t.ssrRender||o.ssrRender;if(i){let s=t.inheritAttrs!==!1?t.attrs:void 0,r=!1,d=t;for(;;){const f=d.vnode.scopeId;f&&(r||(s={...s},r=!0),s[f]="");const v=d.parent;if(v&&v.subTree&&v.subTree===d.vnode)d=v;else break}if(n){r||(s={...s});const f=n.trim().split(" ");for(let v=0;v<f.length;v++)s[f[v]]=""}const c=Oc(t);try{i(t.proxy,a,t,s,t.props,t.setupState,t.data,t.ctx)}finally{Oc(c)}}else t.render&&t.render!==Au?Gs(a,t.subTree=Dc(t),t,n):(o.name||o.__file,a("<!---->"))}return l()}function Gs(t,n,o,l){const{type:a,shapeFlag:i,children:s,dirs:r,props:d}=n;switch(r&&(n.props=xk(n,d,r)),a){case Ep:t(Ri(s));break;case Fp:t(s?`<!--${Ap(s)}-->`:"<!---->");break;case Ip:t(s);break;case en:n.slotScopeIds&&(l=(l?l+" ":"")+n.slotScopeIds.join(" ")),t("<!--[-->"),wd(t,s,o,l),t("<!--]-->");break;default:i&1?_k(t,n,o,l):i&6?t($v(n,o,l)):i&64?kk(t,n,o,l):i&128&&Gs(t,n.ssContent,o,l)}}function wd(t,n,o,l){for(let a=0;a<n.length;a++)Gs(t,bk(n[a]),o,l)}function _k(t,n,o,l){const a=n.type;let{props:i,children:s,shapeFlag:r,scopeId:d}=n,c=`<${a}`;i&&(c+=fk(i,a)),d&&(c+=` ${d}`);let f=o,v=n;for(;f&&v===f.subTree;)v=f.vnode,v.scopeId&&(c+=` ${v.scopeId}`),f=f.parent;if(l&&(c+=` ${l}`),t(c+">"),!Tp(a)){let h=!1;i&&(i.innerHTML?(h=!0,t(i.innerHTML)):i.textContent?(h=!0,t(Ri(i.textContent))):a==="textarea"&&i.value&&(h=!0,t(Ri(i.value)))),h||(r&8?t(Ri(s)):r&16&&wd(t,s,o,l)),t(`</${a}>`)}}function xk(t,n,o){const l=[];for(let a=0;a<o.length;a++){const i=o[a],{dir:{getSSRProps:s}}=i;if(s){const r=s(i,t);r&&l.push(r)}}return lr(n||{},...l)}function kk(t,n,o,l){const a=n.props&&n.props.to,i=n.props&&n.props.disabled;if(!a)return[];if(!kr(a))return[];mk(t,s=>{wd(s,n.children,o,l)},a,i||i==="",o)}const{isVNode:Ck}=Qs;function Is(t,n,o){if(!t.hasAsync)return n+Dv(t);let l=n;for(let a=o;a<t.length;a+=1){const i=t[a];if(kr(i)){l+=i;continue}if(Ds(i))return i.then(r=>(t[a]=r,Is(t,l,a)));const s=Is(i,l,0);if(Ds(s))return s.then(r=>(t[a]=r,Is(t,"",a)));l=s}return l}function Ov(t){return Is(t,"",0)}function Dv(t){let n="";for(let o=0;o<t.length;o++){let l=t[o];kr(l)?n+=l:n+=Dv(l)}return n}async function Lv(t,n={}){if(Ck(t))return Lv(Rp({render:()=>t}),n);const o=ue(t._component,t._props);o.appContext=t._context,t.provide(jf,n);const l=await $v(o),a=await Ov(l);if(await Rk(n),n.__watcherHandles)for(const i of n.__watcherHandles)i();return a}async function Rk(t){if(t.__teleportBuffers){t.teleports=t.teleports||{};for(const n in t.__teleportBuffers)t.teleports[n]=await Ov(await Promise.all([t.__teleportBuffers[n]]))}}const{isVNode:kR}=Qs;jp();class Sk{constructor(n){vo(this,"svgCache",new Map);vo(this,"spriteCache",new Map);vo(this,"pendingSprites",0);this.onSettled=n}getCacheKey(n,o,l){return`${typeof n=="string"?n:JSON.stringify(n)}-${o}-${l}`}async loadSvg(n){const o=typeof n=="string"?n:JSON.stringify(n),l=this.svgCache.get(o);if(l)return l;const a=typeof n=="string"?Bo[n]:n,i=Up(a),s=await Lv(i);return this.svgCache.set(o,s),s}async renderIcon(n,{icon:o,size:l,color:a,x:i,y:s,alpha:r=1}){var y;const d=window.devicePixelRatio||1,c=this.getCacheKey(o,l,a),f=this.spriteCache.get(c);if(f){r<1&&(n.globalAlpha=r),n.drawImage(f,i,s,l,l),r<1&&(n.globalAlpha=1);return}const v=document.createElement("canvas");v.width=l*d,v.height=l*d;const h=v.getContext("2d");h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.scale(d,d),this.spriteCache.set(c,v),this.pendingSprites++;try{const b=await this.loadSvg(o),_=new Image,m=new Blob([b.replaceAll("currentColor",a)],{type:"image/svg+xml"}),g=URL.createObjectURL(m);try{await new Promise(C=>{_.onload=()=>{var w;h.drawImage(_,0,0,l,l),(w=this.onSettled)==null||w.call(this),C()},_.src=g})}finally{URL.revokeObjectURL(g)}}finally{this.pendingSprites--,this.pendingSprites===0&&((y=this.onSettled)==null||y.call(this))}}get isLoading(){return this.pendingSprites>0}clearCaches(){this.svgCache.clear(),this.spriteCache.clear()}}class Ik{constructor(n){vo(this,"cache",new Map);vo(this,"qrCache",new Map);vo(this,"loadingImages",new Map);vo(this,"loadingQRs",new Map);vo(this,"failedUrls",new Set);vo(this,"pendingSprites",0);this.onSettled=n}getQRCacheKey(n,o,l,a){return`qr-${n}-${o}-${l}-${a}`}loadOrGetImage(n){n=Array.isArray(n)?n:[n];for(const i of n){const s=this.cache.get(i);if(s)return s}if(n.some(i=>this.loadingImages.has(i)))return;const l=n.find(i=>!this.failedUrls.has(i));if(!l)return;const a=(async()=>{try{const i=await this.loadImage(l);if(i)return i;this.failedUrls.add(l)}catch{this.failedUrls.add(l)}for(const i of n.slice(n.indexOf(l)+1))if(!this.failedUrls.has(i))try{const s=await this.loadImage(i);if(s)return s}catch{this.failedUrls.add(i)}})().finally(()=>{for(const i of n)this.loadingImages.delete(i)});this.loadingImages.set(l,a)}loadOrGetQR(n,o,l={}){const{dark:a="#000000",light:i="#ffffff"}=l,s=this.getQRCacheKey(n,o,a,i),r=this.qrCache.get(s);if(r)return r;if(!this.loadingQRs.has(s)){const d=this.generateQR(n,o,a,i,s);this.loadingQRs.set(s,d),d.finally(()=>{this.loadingQRs.delete(s)})}}async generateQR(n,o,l,a,i){var s;this.pendingSprites++;try{const r=document.createElement("canvas");return await Mm.toCanvas(r,n,{margin:1,scale:4,width:o,color:{dark:l,light:a}}),this.qrCache.set(i,r),r}catch{return}finally{this.pendingSprites--,(s=this.onSettled)==null||s.call(this)}}renderQRCode(n,o,l,a,i){n.drawImage(o,l,a,i,i)}async loadImage(n){var l;const o=new Image;this.pendingSprites++;try{return await new Promise((a,i)=>{o.onload=()=>{a()},o.onerror=()=>{i(new Error("Failed to load image"))},o.src=n}),this.cache.set(n,o),o}catch{o.src="";return}finally{this.pendingSprites--,(l=this.onSettled)==null||l.call(this)}}renderImage(n,o,l,a,i,s,r=4,d,c="cover"){const{border:f=!1,borderColor:v="#e5e7eb",borderWidth:h=1}=d;n.save(),f&&(n.beginPath(),n.roundRect(l,a,i,s,r),n.strokeStyle=v,n.lineWidth=h,n.stroke()),r>0&&(n.beginPath(),n.roundRect(l,a,i,s,r),n.clip()),n.beginPath(),n.roundRect(l+(f?h/2:0),a+(f?h/2:0),i-(f?h:0),s-(f?h:0),Math.max(0,r-(f?h/2:0))),n.clip();const y=i-(f?h:0),b=s-(f?h:0);let _=y/o.width,m=b/o.height,g,C=0,w=0;c==="contain"?(g=Math.min(_,m),C=(y-o.width*g)/2,w=(b-o.height*g)/2):c==="cover"?(g=Math.max(_,m),C=(y-o.width*g)/2,w=(b-o.height*g)/2):(_=y/o.width,m=b/o.height,g=1),n.drawImage(o,l+C+(f?h/2:0),a+w+(f?h/2:0),o.width*(c==="fill"?_:g),o.height*(c==="fill"?m:g)),n.restore()}renderPlaceholder(n,o,l,a,i){n.fillStyle="#f3f4f6",n.beginPath(),n.roundRect(o,l,a,a,4),n.fill(),n.fillStyle="#6b7280",n.font="12px Material Icons",n.textBaseline="middle",n.textAlign="center",n.fillText(i,o+a/2,l+a/2)}clearCache(){this.cache.forEach(n=>{n.onload=null,n.onerror=null,n.src=""}),this.cache.clear(),this.loadingImages.clear(),this.qrCache.clear(),this.loadingQRs.clear()}get isLoading(){return this.pendingSprites>0}renderError(n,o,l,a,i,s,r=10){n.font="500 13px Inter",n.textBaseline="middle",n.textAlign="left",n.fillStyle="#e65100",ml(n,{text:o,x:l+r,y:a+s/2,maxWidth:i-r*2,lineHeight:16})}}const Nc={[ur[0]]:"hh:mm A",[ur[1]]:"hh:mm:ss A",[ur[2]]:"hh:mm:ss.SSS A"},Pc={[ur[0]]:{12:85,24:65},[ur[1]]:{12:100,24:80},[ur[2]]:{12:130,24:110}},hn=t=>typeof t=="number"?t:t?parseInt(t.replace("px",""),10):180,Nv=t=>{const n={options:[],optionsMap:{}},o=t.colOptions;return!o||!Rl(o.options)||(n.options=o.options.filter(l=>l.title!=="").map(l=>{var a;return l.order!==null&&(l.title=(a=l.title)==null?void 0:a.replace(/^'/,"").replace(/'$/,"")),l.value=l.title,l}),n.optionsMap=n.options.reduce((l,a)=>(a.title&&(l[a.title.trim()]=a),l),{})),n},Pv=(t,n)=>{const o={options:[],optionsMap:{}};let l=1;return o.options.push(...(n||[]).map(a=>({id:a.id,email:a.email,display_name:a.display_name,deleted:a.deleted,order:l++,meta:a.meta})).sort((a,i)=>a.order-i.order)),o.optionsMap=o.options.reduce((a,i)=>(i.id&&(a[i.id]=i),i.email&&(a[i.email.trim()]=i),a),{}),o},Bv=[pe.Rating,pe.Checkbox,pe.ID,pe.Rollup,pe.CreatedBy,pe.LastModifiedBy,pe.LastModifiedTime,pe.CreatedTime,pe.Formula],gs=[pe.SingleSelect,pe.MultiSelect,pe.User,pe.CreatedBy,pe.LastModifiedBy,pe.Checkbox,pe.Attachment,pe.Rating,pe.QrCode,pe.Barcode,pe.Lookup,pe.LinkToAnotherRecord,pe.Links],cl={SINGLE_CLICK:1,DOUBLE_CLICK:2,RIGHT_CLICK:"right"};function Bc(t){return t.button===2||t.ctrlKey&&t.button===0&&t.detail===1?cl.RIGHT_CLICK:t.button===0?t.detail===1?cl.SINGLE_CLICK:cl.DOUBLE_CLICK:null}const Wc=()=>{const{t}=Yp().global;tn.toast(t("msg.info.computedFieldEditWarning"))},mu=new Gp({max:500,ttl:1e3*60*60}),gu=(t,n)=>{if(!t)return{isValid:!1,format:""};const l=jn(n==null?void 0:n.meta).barcodeFormat||"CODE128",a=`${t}-${l}`,i=mu.get(a);if(i!==void 0)return i;try{const s=document.createElement("canvas");Hp(s,t.toString(),{format:l,displayValue:!1,lineColor:"#000000",margin:0});const r={isValid:!0,format:l};return mu.set(a,r),r}catch{const r={isValid:!1,format:l};return mu.set(a,r),r}},Ao=32,Fk=1,Wu=100,or=60,yd=[pe.SingleSelect,pe.MultiSelect,pe.User,pe.Links],zc=80,Vc=4,$o=48,aa=0,ni=12,Dn=36;class Ak{constructor(n,o,l,a,i,s){vo(this,"api");vo(this,"loadAutomation");vo(this,"generateRows");vo(this,"triggerRefreshCanvas");vo(this,"meta");vo(this,"getDataCache");vo(this,"loadingColumns",new Map);vo(this,"afterActionStatus",new Map);vo(this,"rafId",null);this.api=n,this.loadAutomation=o,this.generateRows=l,this.meta=a,this.triggerRefreshCanvas=i,this.getDataCache=s}getKey(n,o){return`${n}-${o}`}async executeAction(n,o,l=[],a){const i=Date.now(),s=Array.isArray(n)?n:[n];s.forEach(d=>{this.loadingColumns.set(this.getKey(d,o),i),this.afterActionStatus.delete(this.getKey(d,o)),l.forEach(c=>{this.loadingColumns.set(this.getKey(d,c),i),this.afterActionStatus.delete(this.getKey(d,o))})}),this.startAnimationLoop();let r=!1;try{const d=await a();return s.forEach(c=>{this.afterActionStatus.set(this.getKey(c,o),{status:"success"}),l.forEach(f=>{this.afterActionStatus.set(this.getKey(c,f),{status:"success"})})}),d}catch(d){r=!0;const c=await pl(d);throw s.forEach(f=>{this.afterActionStatus.set(this.getKey(f,o),{status:"error",tooltip:c??"Something went wrong"}),l.forEach(v=>{this.afterActionStatus.set(this.getKey(f,v),{status:"error",tooltip:c??"Something went wrong"})})}),d}finally{s.forEach(d=>{this.loadingColumns.delete(this.getKey(d,o)),l.forEach(c=>{this.loadingColumns.delete(this.getKey(d,c))})}),Cf(r?3e3:2e3).then(()=>{s.forEach(d=>{this.afterActionStatus.delete(this.getKey(d,o)),l.forEach(c=>{this.afterActionStatus.delete(this.getKey(d,c))})})})}}startAnimationLoop(){if(this.rafId===null&&(this.loadingColumns.size>0||this.afterActionStatus.size>0)){let n=null,o=!1;const l=()=>{(this.loadingColumns.size>0||this.afterActionStatus.size>0)&&n&&(clearTimeout(n),n=null,o=!1),this.loadingColumns.size>0||this.afterActionStatus.size>0?(this.triggerRefreshCanvas(),this.rafId=requestAnimationFrame(l)):o||(o=!0,this.triggerRefreshCanvas(),n=window.setTimeout(()=>{this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),n=null,o=!1},1e3),this.rafId=requestAnimationFrame(()=>{this.triggerRefreshCanvas()}))};this.rafId=requestAnimationFrame(l)}}handleUrl(n,o,l){o=ts(o);try{o=decodeURI(o)===o?encodeURI(o):o}catch{o=encodeURI(o)}o&&Zs(o,"_blank",l)}async executeButtonAction(n,o,l){var r,d,c,f,v,h;const a=o==null?void 0:o.columnObj.colOptions;if(!a)return;l.path||(l.path=[]);const{cachedRows:i}=this.getDataCache(l.path);if((r=o.isInvalidColumn)!=null&&r.isInvalid)return;l!=null&&l.isAiPromptCol&&(a.type="ai");const{runScript:s}=Ps();try{switch(a.type){case"url":{const y=(f=(c=(d=l==null?void 0:l.row)==null?void 0:d[0])==null?void 0:c.row)==null?void 0:f[o.columnObj.title];this.handleUrl(a,((v=y==null?void 0:y.url)==null?void 0:v.toString())??"",l.allowLocalUrl);break}case"webhook":{const y=a.fk_webhook_id;if(!y)throw new Error("No webhook configured");for(const b of n)await this.executeAction(b,o.id,[],async()=>{await this.api.dbTableWebhook.trigger(y,b)});break}case"script":{const y=await this.loadAutomation(a.fk_script_id);for(let b=0;b<n.length;b++)this.executeAction(n[b],o.id,[],async()=>{var _;await s(y,(_=l==null?void 0:l.row)==null?void 0:_[b],{pk:n[b],fieldId:o.columnObj.id})});break}case"ai":{const y=l!=null&&l.isAiPromptCol?[o.id]:((h=a.output_column_ids)==null?void 0:h.split(",").filter(Boolean))||[],b=y.map(_=>{var m;return(m=this.meta.value)==null?void 0:m.columnsById[_]});await this.executeAction(n,o.id,y,async()=>{var m,g,C,w,S,x;const _=await this.generateRows(o.id,n);if(_!=null&&_.length)for(let $=0;$<_.length;$++){const I=i.value.get((C=(g=(m=l==null?void 0:l.row)==null?void 0:m[$])==null?void 0:g.rowMeta)==null?void 0:C.rowIndex);if(I){const F=_[$];for(const E of b)I.row[E.title]=F[E.title];i.value.set((x=(S=(w=l==null?void 0:l.row)==null?void 0:w[$])==null?void 0:S.rowMeta)==null?void 0:x.rowIndex,I)}}});break}}}catch(y){console.error("Error executing button action",y)}}isLoading(n,o){return this.loadingColumns.has(this.getKey(n,o))}getLoadingStartTime(n,o){return this.loadingColumns.get(this.getKey(n,o))??null}getAfterActionStatus(n,o){return this.afterActionStatus.get(this.getKey(n,o))}clear(){this.loadingColumns.clear()}}const Wv={render:(t,n)=>{var b;const{value:o,x:l,y:a,width:i,height:s,selected:r,pv:d,padding:c,textColor:f="#4a5268",setCursor:v}=n,h=(o==null?void 0:o.toString())??"";if(!h)return{x:l,y:a};const y=h&&lc(h);if((b=n.tag)!=null&&b.renderAsTag)return Sl(t,{...n,text:h});{const{x:_,y:m}=ml(t,{x:l+c,y:a,text:h,maxWidth:i-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:y&&r||d?"#3366FF":f,underline:y,height:s}),g=Pt({x:l+c,y:a+c,width:_-l-c,height:m-a},n.mousePosition);return r&&g&&y&&v("pointer"),{x:_,y:m}}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1},async handleClick({value:t,row:n,column:o,selected:l,isDoubleClick:a,getCellPosition:i,mousePosition:s}){if(!n||!o||!l&&!a)return!1;const{x:r,y:d,width:c,height:f}=i(o,n.rowMeta.rowIndex),v=10,h=(t==null?void 0:t.toString())??"";if(!(h&&lc(h)))return!1;const b=o.pv,_=Tl,{x:m,y:g}=ml(_,{x:r+v,y:d+v,text:h,maxWidth:c-v*2,fontFamily:`${b?600:500} 13px Inter`,height:f,render:!1});return Pt({x:r,y:d,width:m-r,height:g-d},s)?(window.open(`mailto:${h}`,"_blank"),!0):!1}},vr={render:(t,n)=>{var v;const{value:o,x:l,y:a,width:i,height:s,pv:r,padding:d,textColor:c="#4a5268"}=n,f=(Array.isArray(o)?o.join(","):o==null?void 0:o.toString())??"";if(!f)return{x:l,y:a};if((v=n.tag)!=null&&v.renderAsTag)return Sl(t,{...n,text:f});{const{x:h,y}=ml(t,{x:l+d,y:a,text:f,maxWidth:i-d*2,fontFamily:`${r?600:500} 13px Inter`,fillStyle:r?"#3366FF":c,height:s});return{x:h,y}}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},sl=qp("tooltip",()=>{const t=V("top"),n=V(""),o=V({x:0,y:0,top:0,left:0,bottom:0,right:0,width:0,height:0}),l=()=>{n.value=""},a=le(()=>{const r=o.value;return{getBoundingClientRect(){return r}}});function i({text:r,rect:d,placement:c="top"}){var y;if(!r)return;let f=0,v=0;const h=(y=document.querySelector("canvas"))==null?void 0:y.getBoundingClientRect();h&&(f=h.x,v=h.y),d.x+=f,d.y+=v,n.value=r,t.value=c,o.value={x:d.x,y:d.y,left:d.x,top:d.y,right:d.x+(d.targetWidth||d.width),bottom:d.y+d.height,width:d.targetWidth||d.width,height:d.height}}function s({text:r,description:d,rect:c,mousePosition:f,placement:v}){if(!c||!Pt(c,f)||!r)return!1;const h=Ci(r)&&d?ia("div",{class:"flex flex-col gap-1"},[ia("div",{class:"text-captionBold"},r),ia("div",{class:"text-captionSm"},d)]):r;return i({text:h,rect:c,placement:v}),!0}return{targetReference:a,tooltipText:n,placement:t,tryShowTooltip:s,showTooltip:i,hideTooltip:l}}),zv=({ctx:t,width:n,label:o="Generate",hasIcon:l})=>{t||(t=Tl);const a=12,i=24,s=32,r=14,d=6,c=n-8;let f=0;t.font="500 13px Inter";const v=c-a*2-(r+d),h=Hl(t,o,v,!0),y=h.text,b=h.width;return f+=b,f+=r,f+=d,{buttonWidth:Math.min(c,Math.max(s,f+a*2)),buttonHeight:i,contentWidth:f,truncatedLabel:y,iconSize:r,iconSpacing:d,horizontalPadding:a}},Ek=(t,{x:n,y:o,width:l,disabled:a,mousePosition:i,spriteLoader:s,loadingStartTime:r,isLoading:d,setCursor:c})=>{const f=zv({ctx:t,width:l,hasIcon:!0}),v=n+(l-f.buttonWidth)/2,h=o+4;a=a||d;const y=!a&&i&&i.x>=v&&i.x<=v+f.buttonWidth&&i.y>=h&&i.y<=h+f.buttonHeight;y&&c("pointer");const b={background:a?"#F4F4F5":y?"#E5D4F5":"#F3ECFA",text:a?"#9AA2AF":"#7D26CD",loader:"#7D26CD"};t.beginPath(),t.roundRect(v,h,f.buttonWidth,f.buttonHeight,6),t.fillStyle=b.background,t.fill();let _=v+(f.buttonWidth-f.contentWidth)/2;const m=h+(f.buttonHeight-f.iconSize)/2;return d&&r?(td(t,_,m,f.iconSize,b.loader,r,1.5),_+=f.iconSize+f.iconSpacing):s&&(s.renderIcon(t,{icon:"ncAutoAwesome",size:f.iconSize,x:_,y:m,color:b.text}),_+=f.iconSize+f.iconSpacing),t.fillStyle=b.text,t.textBaseline="middle",t.fillText(f.truncatedLabel,_,h+13),{buttonBounds:{x:v,y:h,width:f.buttonWidth,height:f.buttonHeight}}},pi={render:(t,n)=>{const{value:o,x:l,y:a,width:i,height:s,spriteLoader:r,disabled:d,padding:c,mousePosition:f,actionManager:v,pk:h,column:y}=n,b=Pt({x:l,y:a,width:i,height:s},f),_=12;if(!o){const m=d==null?void 0:d.isInvalid,g=i-_*2,C=v.isLoading(h,y.id),w=v.getLoadingStartTime(h,y.id),{buttonBounds:S}=Ek(t,{x:l+(i-g)/2,y:a,width:g,disabled:m,mousePosition:f,spriteLoader:r,isLoading:C,loadingStartTime:w,setCursor:n.setCursor});return{x:S.x+S.width,y:S.y+S.height}}if(o!=null&&o.value){const{x:m,y:g}=ml(t,{x:l+c,y:a,text:o.value,maxWidth:i-c*2,fillStyle:"#4a5268",height:s});return b&&(na(t,{buttonX:l+i-28,buttonY:a+7,buttonSize:18,borderRadius:3,iconData:{size:13,xOffset:5/2,yOffset:5/2},mousePosition:f,spriteLoader:r,icon:"maximize"}),na(t,{buttonX:l+i-52,buttonY:a+7,buttonSize:18,borderRadius:3,iconData:{size:13,xOffset:5/2,yOffset:5/2},mousePosition:f,spriteLoader:r,icon:"refresh"})),{x:m,y:g}}return{x:l,y:a}},async handleClick({mousePosition:t,column:n,row:o,value:l,pk:a,actionManager:i,getCellPosition:s,makeCellEditable:r,path:d}){var h,y;if(!o||!(n!=null&&n.id)||!t)return!1;const{x:c,y:f,width:v}=s(n,o.rowMeta.rowIndex)||((h=n==null?void 0:n.isInvalidColumn)==null?void 0:h.isInvalid);if((y=n==null?void 0:n.isInvalidColumn)!=null&&y.isInvalid&&Pt({x:c+v-52,y:f+7,width:18,height:18},t))return!0;if(Pt({x:c+v-28,y:f+7,width:18,height:18},t)||Pt({x:c+v-52,y:f+7,width:18,height:18},t))return r(o,n),!0;if(!l||!(l!=null&&l.value)){const{buttonWidth:b}=zv({width:v,hasIcon:!0}),_={x:c+(v-b)/2,y:f+4,width:b,height:24};return Pt(_,t)?(await i.executeButtonAction([a],n,{row:[o],isAiPromptCol:!0,path:d}),!0):!1}return!1},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,t:a}){var h;const{tryShowTooltip:i,hideTooltip:s}=sl();if(s(),!t||!(n!=null&&n.id)||!o||(h=n==null?void 0:n.isInvalidColumn)!=null&&h.isInvalid)return;const{x:r,y:d,width:c}=l(n,t.rowMeta.rowIndex),f={x:r+c-28,y:d+7,width:18,height:18},v={x:r+c-52,y:d+7,width:18,height:18};i({text:a("title.expand"),rect:f,mousePosition:o}),i({text:"Re-generate",rect:v,mousePosition:o})},async handleKeyDown(t){var c;const{e:n,row:o,column:l,makeCellEditable:a,value:i,pk:s,actionManager:r,path:d}=t;return l.readonly||(c=l.columnObj)!=null&&c.readonly?!1:!(i!=null&&i.value)&&n.key==="Enter"?(r.executeButtonAction([s],l,{row:[o],isAiPromptCol:!0,path:d}),!0):n.key.length===1?(a(o,l),!0):!1}},Mk={render:(t,n)=>{var w,S,x,$,I,F;if(_a(n.column)){pi.render(t,n);return}const o=(S=(w=n.column)==null?void 0:w.meta)==null?void 0:S.richMode,{value:l,x:a,y:i,width:s,height:r,pv:d,padding:c,textColor:f="#4a5268",mousePosition:v,spriteLoader:h,setCursor:y,selected:b,baseUsers:_,user:m}=n,g=(l==null?void 0:l.toString())??"",C=()=>{na(t,{buttonX:a+s-28,buttonY:i+7,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:v,spriteLoader:h,icon:"maximize",background:"white",setCursor:y})};if(!g)return!((x=n.tag)!=null&&x.renderAsTag)&&b&&C(),{x:a,y:i};if(($=n.tag)!=null&&$.renderAsTag)return Sl(t,{...n,text:g,renderAsMarkdown:o});if(o){t.save(),t.beginPath(),t.rect(a,i,s-c,r),t.clip();const{x:E,y:M}=Xp(t,{x:a+c,y:i,text:g,maxWidth:s-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:d?"#3366FF":f,height:r,mousePosition:v,cellRenderStore:n.cellRenderStore,selected:b,baseUsers:_,user:m});return t.restore(),!((I=n.tag)!=null&&I.renderAsTag)&&b&&C(),{x:E,y:M}}else{const{x:E,y:M}=ml(t,{x:a+c,y:i,text:g,maxWidth:s-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:d?"#3366FF":f,height:r,cellRenderStore:n.cellRenderStore});return!((F=n.tag)!=null&&F.renderAsTag)&&b&&C(),{x:E,y:M}}},handleClick:async t=>{var f,v;const{column:n,getCellPosition:o,row:l,mousePosition:a,makeCellEditable:i,cellRenderStore:s,isDoubleClick:r,selected:d}=t;if(!d&&!r)return!1;if((v=(f=n.columnObj)==null?void 0:f.meta)==null?void 0:v.richMode){const h=(s==null?void 0:s.links)||[];for(const y of h)if(Pt(y,a))return Zs(y.url,"_blank"),!0}if(_a(n==null?void 0:n.columnObj))return pi.handleClick(t);{const{x:h,y,width:b,height:_}=o(n,l.rowMeta.rowIndex);return Pt({x:h+b-28,y:y+7,width:18,height:18},a)?(i(l,n),!0):(r&&Pt({x:h,y,width:b,height:_},a)&&i(l,n),!1)}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t,i=l==null?void 0:l.columnObj;if(_a(i))return(s=pi.handleKeyDown)==null?void 0:s.call(pi,t);if(Cr(n))return a(o,l),!0;if(!(l.readonly||i!=null&&i.readonly))return n.key.length===1&&i.title?(o.row[i.title]==="<br />"||o.row[i.title]==="<br>"?o.row[i.title]=n.key:jn(i.meta).richMode&&(o.row[i.title]=o.row[i.title]?o.row[i.title]+n.key:n.key),a(o,l),!0):!1},handleHover:async t=>{var v,h,y;const{row:n,column:o,value:l,mousePosition:a,getCellPosition:i,cellRenderStore:s,setCursor:r,selected:d,t:c}=t;if(!d&&!_a(o==null?void 0:o.columnObj))return;if((h=(v=o.columnObj)==null?void 0:v.meta)==null?void 0:h.richMode){const b=(s==null?void 0:s.links)||[];let _=!1;for(const m of b)if(Pt(m,a)){_=!0;break}if(_){r("pointer");return}}if(_a(o==null?void 0:o.columnObj))(y=pi.handleHover)==null||y.call(pi,t);else{const{tryShowTooltip:b,hideTooltip:_}=sl();_();const m=(l==null?void 0:l.toString())??"";if(!n||!(o!=null&&o.id)||!a||!m)return;const{x:g,y:C,width:w}=i(o,n.rowMeta.rowIndex),S={x:g+w-28,y:C+7,width:18,height:18};b({rect:S,mousePosition:a,text:c("tooltip.expandShiftSpace")})}}},Vv={render:(t,n)=>{var y;const{value:o,x:l,y:a,width:i,height:s,pv:r,padding:d,textColor:c="#4a5268",column:f}=n,v=Kp(o,f);if(!ua(v))return{x:l,y:a};const h=v.toString();if((y=n.tag)!=null&&y.renderAsTag)return Sl(t,{...n,text:h});{const{x:b,y:_}=Jn(t,{x:l+i-d,y:a,textAlign:"right",text:h,maxWidth:i-d*2,fontFamily:`${r?600:500} 13px Inter`,fillStyle:r?"#3366FF":c,height:s});return{x:b,y:_}}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},jv={render:(t,n)=>{var b;const{column:o,value:l,x:a,y:i,width:s,height:r,pv:d,padding:c,textColor:f="#4a5268"}=n;let v=null;const h=jn(o==null?void 0:o.meta);l!==null&&!isNaN(Number(l))&&(h.isLocaleString?v=Number(Eu(Number(l),h.precision??1)).toLocaleString(void 0,{minimumFractionDigits:h.precision??1,maximumFractionDigits:h.precision??1}):v=Eu(Number(l),h.precision??1));const y=(v==null?void 0:v.toString())??"";if(!ua(y))return{x:a,y:i};if((b=n.tag)!=null&&b.renderAsTag)return Sl(t,{...n,text:y});{const{x:_,y:m}=Jn(t,{x:a+s-c,y:i,text:y,textAlign:"right",maxWidth:s-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:d?"#3366FF":f,height:r});return{x:_,y:m}}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]=null,a(o,l),!0):!1}};function Tk(t,n){return Fs(t??"",n)?"ncFileTypeImage":pm(t??"",n)?"ncFileTypePdf":hm(t??"",n)?"ncFileTypeVideo":mm(t??"",n)?"ncFileTypeAudio":gm(t??"")?"ncFileTypeWord":wm(t??"")?"ncFileTypeCsv":ym(t??"")?"ncFileTypePresentation":bm(t??"")?"ncFileTypeZip":"ncFileTypeUnknown"}function wu(t){switch(t){case 1:case 2:return"tiny";case 4:case 6:return"small";default:return"tiny"}}function Fs(t,n){return(n==null?void 0:n.includes("image/"))||(t==null?void 0:t.match(/\.(jpg|jpeg|png|gif|webp)$/i))}function yu(t,{itemX:n,itemY:o,itemSize:l,spriteLoader:a,ctx:i}){const s=Tk(t.title,t.mimetype||t.type);i.beginPath(),i.roundRect(n,o,l,l,4),i.strokeStyle="#D5D5D9",i.lineWidth=1,i.stroke(),a.renderIcon(i,{icon:s,x:n,y:o,size:l,color:"#6b7280"})}const $k={render:(t,{value:n,x:o,y:l,width:a,height:i,imageLoader:s,mousePosition:r,spriteLoader:d,selected:c,readonly:f,setCursor:v,isUnderLookup:h,textAlign:y})=>{let b=[];const _=ns[i],m=_===1?4:8;try{b=(typeof n=="string"?JSON.parse(n):n)||[]}catch{b=[]}if(f&&!b.length)return;if(c&&b.length===0){const ae=o+(a-96)/2,ve=l+m,xe=Pt({x:ae,y:ve,width:96,height:24},r);xe&&v("pointer"),qo(t,ae,ve,96,24,8,{backgroundColor:xe?"#f4f4f5":"white",borderColor:"#E7E7E9",borderWidth:2}),d.renderIcon(t,{icon:"upload",x:ae+8,y:ve+10/2,size:14,color:"#6a7184"}),t.fillStyle="#374151",t.font="500 11px Inter",t.textBaseline="middle",t.fillText("Add File(s)",ae+28,ve+26/2);return}const{getPossibleAttachmentSrc:g}=xi(),C=10,w=_===1?24:_===2?32:64,S=8,x=Pt({x:o,y:l,width:a,height:i},r),$=Math.floor((a-C*2+S)/(w+S)),I=b.length,F=I%$||$,M=Math.floor((i-m*2+S)/(w+S))*$;let U=o;if(b.slice(0,M).forEach((L,G)=>{if(!L)return;const ae=Math.floor(G/$),ve=G%$,ne=ae===Math.floor((I-1)/$)?F:$,he=ne*w+(ne-1)*S,j=(h&&y!=="center"?o+C:o+C+Math.max(0,(a-C*2-he)/2))+ve*(w+S),Ee=l+m+ae*(w+S);if(Fs(L.title,L.mimetype||L.type)){const Ye=wu(_),Ge=g(L,Ye);if(!(Ge!=null&&Ge.length)){yu(L,{itemX:j,itemY:Ee,itemSize:w,spriteLoader:d,ctx:t});return}const ke=s.loadOrGetImage(Ge);ke?(t.strokeStyle="#D5D5D9",t.lineWidth=1,s.renderImage(t,ke,j,Ee,w,w,4,{border:!0,borderColor:"#D5D5D9",borderWidth:1},"contain")):yu(L,{itemX:j,itemY:Ee,itemSize:w,spriteLoader:d,ctx:t})}else yu(L,{itemX:j,itemY:Ee,itemSize:w,spriteLoader:d,ctx:t});U=j+w,!h&&c&&Pt({x:j,y:Ee,width:w,height:w},r)&&v("pointer")}),h)return{x:U,y:l+w};if(!h&&x&&c&&b.length>0){const L=l+6;if(na(t,{buttonX:o+a-30,buttonY:L,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:r,spriteLoader:d,icon:"maximize",setCursor:v}),f)return;na(t,{buttonX:o+11,buttonY:L,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:r,spriteLoader:d,icon:"ncPaperclip",setCursor:v})}},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,value:a,selected:i,imageLoader:s,t:r}){const{tryShowTooltip:d,hideTooltip:c}=sl();if(c(),!t||!(n!=null&&n.id)||!o||!i)return;const{x:f,y:v,width:h,height:y}=l(n,t.rowMeta.rowIndex);let b=[];try{b=(typeof a=="string"?JSON.parse(a):a)||[]}catch{b=[]}if(i&&b.length===0)return;if(b.length){const L=v+5,G={x:f+h-30,y:L,width:18,height:18},ae={x:f+11,y:L,width:18,height:18};if(d({rect:G,text:`${r("activity.viewAttachment")} '${r("tooltip.shiftSpace")}'`,mousePosition:o})||d({rect:ae,text:r("activity.addFiles"),mousePosition:o}))return}const _=ns[y]??1,{getPossibleAttachmentSrc:m}=xi(),g=10,C=_===1?4:8,w=_===1?24:_===2?32:64,S=8,x=Math.floor((h-g*2+S)/(w+S)),I=b.length%x||x,E=Math.floor((y-C*2+S)/(w+S))*x,M=[];b.slice(0,E).forEach((L,G)=>{var Ye;if(!L)return;const ae=Math.floor(G/x),ve=G%x,ne=ae===Math.floor((G+1)/x)?I:x,he=ne*w+(ne-1)*S,j=f+g+(h-g*2-he)/2+ve*(w+S),Ee=v+C+ae*(w+S);if(Fs(L.title,L.mimetype||L.type)){const Ge=wu(_),ke=(Ye=m(L,Ge))==null?void 0:Ye[0];if(!ke)return;s.loadOrGetImage(ke)&&M.push({x:j,y:Ee,width:w,height:w,title:L.title??ke,size:L.size??0,mimetype:L.mimetype??""})}else L.title&&M.push({x:j,y:Ee,width:w,height:w,title:L.title,size:L.size??0,mimetype:L.mimetype??""})});const U=M.find(L=>Pt(L,o));d({rect:U,text:ia("div",[(U==null?void 0:U.title)??"",ia("div",{class:"flex items-center justify-between mt-2 text-tiny text-gray-200"},[ia("div",Jp(U==null?void 0:U.mimetype)),ia("div",Qp(U==null?void 0:U.size))])]),mousePosition:o})},async handleKeyDown({row:t,column:n,e:o,makeCellEditable:l}){return o.key==="Enter"||Cr(o)?(l(t,n),!0):!1},async handleClick({row:t,column:n,mousePosition:o,getCellPosition:l,value:a,selected:i,imageLoader:s,makeCellEditable:r}){const{hideTooltip:d}=sl();if(d(),!i)return!1;const c=()=>r(t,n),{x:f,y:v,width:h,height:y}=l(n,t.rowMeta.rowIndex);let b=[];try{b=(typeof a=="string"?JSON.parse(a):a)||[]}catch{b=[]}if(i&&b.length===0){const ne=f+(h-84)/2,he=v+3;if(Pt({x:ne,y:he,width:84,height:24},o))return c(),!0}const _=ns[y]??1,{getPossibleAttachmentSrc:m}=xi(),g=10,C=_===1?4:8,w=_===1?24:_===2?32:64,S=8,x=Math.floor((h-g*2+S)/(w+S)),I=b.length%x||x,E=Math.floor((y-C*2+S)/(w+S))*x,M=[];if(b.slice(0,E).forEach((ve,xe)=>{var Y;if(!ve)return;const ne=Math.floor(xe/x),he=xe%x,j=ne===Math.floor((xe+1)/x)?I:x,Ee=j*w+(j-1)*S,Ge=f+g+(h-g*2-Ee)/2+he*(w+S),ke=v+C+ne*(w+S);if(Fs(ve.title,ve.mimetype||ve.type)){const we=wu(_),oe=(Y=m(ve,we))==null?void 0:Y[0];if(!oe)return;s.loadOrGetImage(oe)&&M.push({x:Ge,y:ke,width:w,height:w,title:ve.title??oe})}else ve.title&&M.push({x:Ge,y:ke,width:w,height:w,title:ve.title})}),M.find(ve=>Pt(ve,o)))return c(),!0;if(!b.length)return!1;const L=v+5,G={x:f+h-30,y:L,width:18,height:18},ae={x:f+11,y:L,width:18,height:18};return Pt(G,o)||Pt(ae,o)?(c(),!0):!1}},Uv={render:(t,{value:n,x:o,y:l,width:a,height:i,readonly:s,column:r,spriteLoader:d,tag:c={},mousePosition:f,setCursor:v,isUnderLookup:h,selected:y,isRowHovered:b})=>{const _=Pt({x:o,y:l,width:a,height:i},f);i=Wo[1];const{renderAsTag:m,tagPaddingX:g=6,tagHeight:C=20,tagRadius:w=6,tagBgColor:S="#f4f4f0",tagSpacing:x=4,tagBorderColor:$,tagBorderWidth:I}=c,F=nv(n),E={color:"primary",...jn(r.meta),icon:Zp((r==null?void 0:r.meta)??{})};if(!(!b&&!y&&!F&&!m)&&!((b||y)&&!F&&s&&!m))if(m){const M=14+g*2,U=l+i/2-C/2;return wa(t,{x:o+x,y:U,width:M,height:C,radius:w,fillStyle:S,borderColor:$,borderWidth:I}),(F||h)&&d.renderIcon(t,{icon:F?E.icon.checked:E.icon.unchecked,size:14,x:o+M/2-4,y:U+3,color:E.color}),{x:o+M+8,y:l+C}}else{const M=Pt({x:o+a/2-7,y:l+i/2-7,width:14,height:14},f);(M||y&&_)&&!s&&v("pointer"),d.renderIcon(t,{icon:F?E.icon.checked:E.icon.unchecked,size:14,x:o+a/2-7,y:l+i/2-7,color:E.color,alpha:F?1:M?.7:.3})}},async handleKeyDown(t){const{e:n,row:o,column:l,updateOrSaveRow:a,readonly:i}=t,s=l.columnObj;if(!(l.readonly||i||!(l!=null&&l.isCellEditable)))return n.key==="Enter"?(o.row[s.title]=!o.row[s.title],await a(o,s.title,void 0,void 0,void 0,t.path),!0):!1},async handleClick(t){const{row:n,column:o,updateOrSaveRow:l,getCellPosition:a,mousePosition:i,selected:s,readonly:r,formula:d}=t;if(o.readonly||r||d||!(o!=null&&o.isCellEditable))return!1;if(s)return n.row[o.title]=!n.row[o.title],await l(n,o.title,void 0,void 0,void 0,t.path),!0;const c=a(o,n.rowMeta.rowIndex);c.height=Wo[1];const f={x:c.x+c.width/2-7,y:c.y+c.height/2-8,width:14,height:14};return Pt(f,i)?(n.row[o.title]=!n.row[o.title],await l(n,o.title,void 0,void 0,void 0,t.path),!0):!1}},jc="YYYY-MM-DD",Gv={render:(t,n)=>{var _,m;const{column:o,value:l,x:a,y:i,width:s,height:r,pv:d,padding:c,textColor:f="#4a5268",selected:v,readonly:h}=n,y=((_=jn(o==null?void 0:o.meta))==null?void 0:_.date_format)??jc;let b="";if(!l&&v&&!h){t.fillStyle="#989FB1",t.font="400 13px Inter";const g=Math.max(i,36),C=Hl(t,y,s-c*2);return t.fillText(C,a+c,g+16),{x:a,y:g}}if(l){const g=rl(/^\d+$/.test(l)?+l:l,jc);if(g.isValid())b=g.format(y);else{const C=eh(l);C&&(b=C.format(y))}}if(!b)return{x:a,y:i};if((m=n.tag)!=null&&m.renderAsTag)return Sl(t,{...n,text:b});{const{x:g,y:C}=Jn(t,{x:a+c,y:i,text:b,maxWidth:s-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:d?"#3366FF":f,height:r});return{x:g,y:C}}},async handleClick(t){var y,b;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:s,selected:r}=t;if(!r)return!1;const d=a(o,n.rowMeta.rowIndex),c=8,f=Tl,v=((b=jn((y=o==null?void 0:o.columnObj)==null?void 0:y.meta))==null?void 0:b.date_format)??"YYYY-MM-DD";let h="";if(s){const _=rl(/^\d+$/.test(s)?+s:s,v);_.isValid()&&(h=_.format(v))}else h=v,f.font="400 13px Inter";if(h){f.font=s?"500 13px Inter":"400 13px Inter";const _=f.measureText(h).width,m={x:d.x+c,y:d.y,width:Math.min(_,d.width-c*2),height:33};if(Pt(m,i))return l(n,o),!0}return!1},async handleKeyDown(t){var i;const{e:n,row:o,column:l,makeCellEditable:a}=t;return l.readonly||(i=l.columnObj)!=null&&i.readonly?!1:n.key.length===1?(a(o,l),!0):!1}};rl.extend(nh);const As={render:(t,{value:n,x:o,y:l,width:a,selected:i,pv:s,column:r,padding:d,readonly:c})=>{var L,G,ae;t.font=`${s?600:500} 13px Inter`,t.textBaseline="middle",t.textAlign="left";const f=jn(r==null?void 0:r.meta),v=(f==null?void 0:f.date_format)??"YYYY-MM-DD",h=(f==null?void 0:f.time_format)??"HH:mm",y=(L=r==null?void 0:r.extra)==null?void 0:L.timezone,b=(G=r==null?void 0:r.extra)==null?void 0:G.isDisplayTimezone,_=f==null?void 0:f.is12hrFormat,m=n&&rl(n).isValid(),g=m&&b?t.measureText(y.abbreviation).width+8:0,w=a-d*3-g,S=Math.min(w*.6,110),x=Math.min(((ae=Pc[h])==null?void 0:ae[_?12:24])??80,w-S),$=l+16;if(!n&&i&&!c){t.fillStyle="#989FB1",t.font="400 13px Inter";const ve=Hl(t,v,S-d);t.fillText(ve,o+d,$);const xe=Hl(t,h,x),ne=o+S+d;t.fillText(xe,ne,$);return}let I;if(m)if(y){const{timezonize:ve}=th(y.name);I=ve(rl(n))}else I=rl(n).utc().local();const F=(I==null?void 0:I.format(v))??"",E=Hl(t,F,S-4*2);t.fillStyle=s?"#3366FF":"#4a5268",t.fillText(E,o+d,$);const M=(I==null?void 0:I.format(_?Nc[h]:h))??"",U=Hl(t,M,x);if(t.fillText(U,o+S+d*2,$),g&&g>0){const ve="#6A7184",xe=t.fillStyle,ne=t.font;t.font=t.font="500 11px Inter",t.fillStyle=ve,t.fillText(y.abbreviation,o+w+d*3.5,$),t.font=ne,t.fillStyle=xe}},async handleClick(t){var w,S;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:s,selected:r}=t,d=a(o,n.rowMeta.rowIndex),c=8;if(!r||o.readonly||Os(o.uidt))return!1;const f=Tl;f.font="500 13px Inter";const v=jn((w=o==null?void 0:o.columnObj)==null?void 0:w.meta),h=(v==null?void 0:v.date_format)??"YYYY-MM-DD",y=(v==null?void 0:v.time_format)??"HH:mm",b=v==null?void 0:v.is12hrFormat,_=Math.min(d.width*.6,110),m=((S=Pc[y])==null?void 0:S[b?12:24])??80;let g,C;if(s&&rl(s).isValid()){const x=rl(s).utc().local();g=x.format(h),C=x.format(b?Nc[y]:y)}else g=h,C=y,f.font="400 13px Inter";if(g){const x={x:d.x+c,y:d.y,width:Math.min(f.measureText(g).width,_-c*2),height:33};if(Pt(x,i))return l(n,o),!0}if(C){const x={x:d.x+_+c,y:d.y,width:Math.min(f.measureText(C).width,m-c*2),height:33};if(Pt(x,i))return l(n,o),!0}return!1},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;if(!(l.readonly||!(l!=null&&l.isCellEditable)||Os(l.uidt)))return n.key.length===1?(a(o,l),!0):!1}},Ok={render:(t,n)=>{var y;const{selected:o,value:l,x:a,y:i,width:s,height:r,pv:d,padding:c,readonly:f,textColor:v="#4a5268"}=n;let h="";if(l){const b=rl(l.toString(),"YYYY");b.isValid()&&(h=b.format("YYYY"))}if(!l&&o&&!f){t.fillStyle="#989FB1",t.font="400 13px Inter";const b=Math.max(i,36),_=Hl(t,"YYYY",s-c*2,!0);return t.fillText(_.text,a+c,b+16),{x:a,y:b}}if(!h)return{x:a,y:i};if((y=n.tag)!=null&&y.renderAsTag)return Sl(t,{...n,text:h});{const{x:b,y:_}=Jn(t,{x:a+c,y:i,text:h,maxWidth:s-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:d?"#3366FF":v,height:r});return{x:b,y:_}}},async handleClick(t){var y;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:s,selected:r}=t;if(!r||!((y=n==null?void 0:n.rowMeta)!=null&&y.rowIndex))return!1;const d=a(o,n.rowMeta.rowIndex),c=8,f=Tl;let v=0;if(s){const b=rl(s.toString(),"YYYY");if(b.isValid()){const _=b.format("YYYY");f.font="500 13px Inter",v=f.measureText(_).width}}else f.font="400 13px Inter",v=f.measureText("YYYY").width;const h={x:d.x+c,y:d.y,width:v,height:33};return Pt(h,i)?(l(n,o),!0):!1},async handleKeyDown(t){var i;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(!(l.readonly||(i=l.columnObj)!=null&&i.readonly))return n.key.length===1?(a(o,l),!0):!1}},Hv={render:(t,n)=>{var _,m;const{column:o,selected:l,value:a,x:i,y:s,width:r,height:d,pv:c,padding:f,textColor:v="#4a5268",readonly:h}=n,y=(_=jn(o==null?void 0:o.meta))!=null&&_.is12hrFormat?"hh:mm A":"HH:mm";if(!a&&l&&!h){t.fillStyle="#989FB1",t.font="400 13px Inter";const g=Hl(t,y,r-f*2);return t.fillText(g,i+f,s+16),{x:i,y:s}}if(!a)return{x:i,y:s};const b=um(a,o);if((m=n.tag)!=null&&m.renderAsTag)return Sl(t,{...n,text:b});{const{x:g,y:C}=Jn(t,{x:i+f,y:s,text:b,maxWidth:r-f*2,fontFamily:`${c?600:500} 13px Inter`,fillStyle:c?"#3366FF":v,height:d});return{x:g,y:C}}},async handleClick(t){var y,b,_;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:s,selected:r}=t;if(!r||!((y=n==null?void 0:n.rowMeta)!=null&&y.rowIndex))return!1;const d=a(o,n.rowMeta.rowIndex),c=8,f=Tl,v=(_=jn((b=o==null?void 0:o.columnObj)==null?void 0:b.meta))!=null&&_.is12hrFormat?"hh:mm A":"HH:mm";let h="";if(s){f.font="500 13px Inter";let m=rl(s);m.isValid()||(m=rl(s,"HH:mm:ss")),m.isValid()||(m=rl(`1999-01-01 ${s}`)),m.isValid()&&(h=m.format(v))}else h=v,f.font="400 13px Inter";if(h){const m=f.measureText(h).width,g={x:d.x+c,y:d.y,width:Math.min(m,d.width-c*2),height:33};if(Pt(g,i))return l(n,o),!0}return!1},async handleKeyDown(t){var i;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(!(l.readonly||(i=l.columnObj)!=null&&i.readonly))return n.key.length===1?(a(o,l),!0):!1}},Yv={render:(t,n)=>{var y;const{column:o,value:l,x:a,y:i,width:s,height:r,pv:d,padding:c,textColor:f="#4a5268"}=n;if(!ua(l)||isNaN(l))return{x:a,y:i};const v={currency_locale:"en-US",currency_code:"USD",precision:2,...jn(o==null?void 0:o.meta)||{}};let h="";try{const b=Eu(Number(l),v.precision??2);h=new Intl.NumberFormat(v.currency_locale||"en-US",{style:"currency",currency:v.currency_code||"USD",minimumFractionDigits:v.precision??2,maximumFractionDigits:v.precision??2}).format(b)}catch{h=l.toString()}if(Si(l)||eu(l))return{x:a,y:i};if((y=n.tag)!=null&&y.renderAsTag)return Sl(t,{...n,text:h});{const{x:b,y:_}=Jn(t,{x:a+s-c,y:i,textAlign:"right",text:h,maxWidth:s-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:d?"#3366FF":f,height:r});return{x:b,y:_}}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return!1;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},qv={render:(t,{value:n,x:o,y:l,width:a,height:i,pv:s,column:r,padding:d})=>{if(t.font=`${s?600:500} 13px Inter`,t.textBaseline="middle",t.textAlign="left",{is_progress:!1,...jn(r==null?void 0:r.meta)}.is_progress&&n!==null&&n!==void 0){const f=Math.min(100,Math.max(0,n)),v=4,h=l+14,y=(a-d*2)*(f/100);if(qo(t,o+d,h,a-d*2,v,v/2,{backgroundColor:"#E5E5E5"}),f===0)return;qo(t,o+d,h,y,v,v/2,{backgroundColor:"#3366FF"});return}t.fillStyle=s?"#3366FF":"#4a5268",Jn(t,{x:o+a-d,y:l,text:n!==null&&typeof n<"u"&&n!==""?`${n}%`:"",textAlign:"right",maxWidth:a-d*2,fontFamily:`${s?600:500} 13px Inter`,fillStyle:s?"#3366FF":"#4a5268",height:i})},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},Xv={render:(t,n)=>{var m;const{value:o,x:l,y:a,column:i,width:s,height:r,selected:d,pv:c,padding:f,textColor:v="#4a5268",spriteLoader:h,setCursor:y}=n,b=ts((o==null?void 0:o.toString())??"");if(!b)return{x:l,y:a};const _=b&&Rs(b);if((m=n.tag)!=null&&m.renderAsTag)return Sl(t,{...n,text:b});{const C=jn(i==null?void 0:i.meta).validate,w=s-f*2-(C&&!_?20:0),{x:S,y:x}=ml(t,{x:l+f,y:a,text:b,maxWidth:w,fontFamily:`${c?600:500} 13px Inter`,fillStyle:_&&d||c?"#3366FF":v,underline:_,height:r}),$=Pt({x:l+f,y:a+f,width:S-l-f,height:x-a},n.mousePosition);if(d&&$&&_&&y("pointer"),C&&!_){const I=l+s-16-f;h.renderIcon(t,{icon:"ncInfo",size:16,color:lo.red[400],x:I,y:a+(x-a)/2})}return{x:S&&S+(C&&!_?20:0),y:x}}},async handleHover({column:t,row:n,getCellPosition:o,value:l,mousePosition:a,selected:i,t:s}){const{x:r,y:d,width:c,height:f}=o(t,n.rowMeta.rowIndex),{tryShowTooltip:v,hideTooltip:h}=sl();if(h(),!i)return;const y=ts((l==null?void 0:l.toString())??"");if(y&&Rs(y)||!(y!=null&&y.length))return;const _=t.pv,m=Tl,g=16,C=10,w=r+c-g-C,{y:S}=ml(m,{x:r+C,y:d,text:y,maxWidth:c-C*2,fontFamily:`${_?600:500} 13px Inter`,height:f,render:!1});if(jn(t.columnObj.meta).validate){const $={x:w,y:d+(S-d)/2,width:g,height:g};v({rect:$,text:s("msg.error.invalidURL"),mousePosition:a})}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1},async handleClick({value:t,row:n,column:o,selected:l,isDoubleClick:a,getCellPosition:i,mousePosition:s}){if(!l&&!a)return!1;const{x:r,y:d,width:c,height:f}=i(o,n.rowMeta.rowIndex),v=10,h=ts((t==null?void 0:t.toString())??"");if(!(h&&Rs(h)))return!1;const b=o.pv,_=Tl,{x:m,y:g}=ml(_,{x:r+v,y:d+v,text:h,maxWidth:c-v*2,fontFamily:`${b?600:500} 13px Inter`,height:f,render:!1});return Pt({x:r,y:d,width:m-r,height:g-d},s)?(Zs(h,"_blank"),!0):!1}},Dk={render:(t,{value:n,x:o,y:l,width:a,height:i,spriteLoader:s,pv:r,readonly:d,padding:c,mousePosition:f,selected:v,setCursor:h})=>{t.font=`${r?600:500} 13px Inter`,t.textBaseline="middle",t.textAlign="left";const[y,b]=(n||"").split(";"),_=!!(y&&b),m=_?`${y}; ${b}`:"Set location",C=ns[i]===1?4:8;if(!_&&!d&&v){const x=o+(a-100)/2,$=l+C,I=Pt({x,y:$,width:100,height:24},f);I&&h("pointer"),qo(t,x,$,100,24,6,{backgroundColor:I?"#f4f4f5":"white",borderColor:"#E7E7E9",borderWidth:2}),s.renderIcon(t,{icon:"ncMapPin",x:x+8,y:$+8/2,size:14,color:"#6a7184"}),t.fillStyle="#374151",t.font="10px Inter",t.textBaseline="middle",t.fillText("Set location",x+28,$+26/2)}else if(_){const w=a-c*2;ml(t,{x:o+c,height:i,y:l,text:m,maxWidth:w,lineHeight:16,fillStyle:r?"#3366FF":"#4a5268"})}},async handleClick({row:t,column:n,mousePosition:o,getCellPosition:l,value:a,selected:i,makeCellEditable:s}){const{hideTooltip:r}=sl();r();const d=()=>s(t,n),{x:c,y:f,width:v}=l(n,t.rowMeta.rowIndex),[h,y]=(a||"").split(";");if(i&&!!!(h&&y)){const g=c+(v-84)/2,C=f+3;if(Pt({x:g,y:C,width:84,height:24},o))return d(),!0}return!1}},Kv={render:(t,n)=>{var b;const{value:o,x:l,y:a,width:i,height:s,pv:r,padding:d,textColor:c="#4a5268",selected:f,setCursor:v}=n,h=(o==null?void 0:o.toString())??"";if(!h)return{x:l,y:a};const y=h&&ac(h);if((b=n.tag)!=null&&b.renderAsTag)return Sl(t,{...n,text:h});{const{x:_,y:m}=ml(t,{x:l+d,y:a,text:h,maxWidth:i-d*2,fontFamily:`${r?600:500} 13px Inter`,fillStyle:y&&f||r?"#3366FF":c,height:s,underline:y}),g=Pt({x:l+d,y:a+d,width:_-l-d,height:m-a},n.mousePosition);return f&&g&&y&&v("pointer"),{x:_,y:m}}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1},async handleClick({value:t,row:n,column:o,selected:l,isDoubleClick:a,getCellPosition:i,mousePosition:s}){if(!n||!o||!l&&!a)return!1;const{x:r,y:d,width:c,height:f}=i(o,n.rowMeta.rowIndex),v=10,h=(t==null?void 0:t.toString())??"";if(!(h&&ac(h)))return!1;const b=o.pv,{x:_,y:m}=ml(Tl,{x:r+v,y:d+v,text:h,maxWidth:c-v*2,fontFamily:`${b?600:500} 13px Inter`,height:f,render:!1});return Pt({x:r,y:d,width:_-r,height:m-d},s)?(window.open(`tel:${h}`,"_blank"),!0):!1}},Lk={render:(t,n)=>{var y,b;const{column:o,value:l,x:a,y:i,width:s,height:r,pv:d,padding:c,textColor:f="#4a5268"}=n;if(!ua(l))return{x:a,y:i};const v=((y=jn(o==null?void 0:o.meta))==null?void 0:y.duration)||0,h=oh(l,v);if((b=n.tag)!=null&&b.renderAsTag)return Sl(t,{...n,text:h});{const{x:_,y:m}=Jn(t,{x:a+s-c,y:i,textAlign:"right",text:h,maxWidth:s-c*2,fontFamily:`${d?600:500} 13px Inter`,fillStyle:d?"#3366FF":f,height:r});return{x:_,y:m}}},async handleKeyDown(t){var s;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(s=l.columnObj)!=null&&s.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},Nk={render:(t,n)=>{var m;const{value:o,x:l,y:a,width:i,height:s,pv:r,padding:d,textColor:c="#4a5268",mousePosition:f,spriteLoader:v,selected:h,setCursor:y}=n,b=()=>{h&&(na(t,{buttonX:l+i-28,buttonY:a+7,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:f,spriteLoader:v,icon:"maximize",background:"white",setCursor:y}),Pt({x:l+i-28,y:a+7,width:20,height:20},f)&&y("pointer"))};if(Si(o)||eu(o))return b(),{x:l,y:a};let _=typeof o=="string"?o:JSON.stringify(o);if(typeof _=="string")try{JSON.parse(_)}catch{_=JSON.stringify(_)}if((m=n.tag)!=null&&m.renderAsTag)return Sl(t,{...n,text:_});{const{x:g,y:C}=ml(t,{x:l+d,y:a,text:_,maxWidth:i-d*2,fontFamily:`${r?600:500} 13px Inter`,fillStyle:r?"#3366FF":c,height:s});return b(),{x:g,y:C}}},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;return l.columnObj.title&&(n.key.length===1||Cr(n))?(a(o,l),!0):!1},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,selected:i}){var f;const s=(f=t==null?void 0:t.rowMeta)==null?void 0:f.rowIndex;if(typeof s!="number"||!i)return!1;const{x:r,y:d,width:c}=o(n,s);return Pt({x:r+c-28,y:d+7,height:20,width:20},l)?(a(t,n),!0):!1},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,selected:a,t:i}){var h;const{tryShowTooltip:s,hideTooltip:r}=sl();if(r(),!t||!(n!=null&&n.id)||!o||(h=n==null?void 0:n.isInvalidColumn)!=null&&h.isInvalid||!a)return;const{x:d,y:c,width:f}=l(n,t.rowMeta.rowIndex),v={x:d+f-28,y:c+7,width:18,height:18};s({text:i("tooltip.expandShiftSpace"),rect:v,mousePosition:o})}},Pk={render:(t,n)=>{const{value:o,x:l,y:a,width:i,height:s,column:r,tag:d={},spriteLoader:c,cellRenderStore:f}=n,{renderAsTag:v}=d,h=lh(t,{x:l,y:a,width:i,height:s,column:r,value:(o??"").toString(),renderAsTag:v,spriteLoader:c});return h!=null&&h.startX&&Object.assign(f,{x:h.startX,y:h.startY,width:h.width,height:h.height}),h?{x:h.x,y:h.y}:void 0},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a,value:i}=t;return n.key==="Enter"?(gu(i,l.columnObj).isValid&&a(o,l),!0):!1},async handleHover({column:t,row:n,getCellPosition:o,value:l,mousePosition:a,t:i}){const{x:s,y:r,width:d}=o(t,n.rowMeta.rowIndex),{tryShowTooltip:c}=sl();if(!gu(l,t.columnObj).isValid){const v={x:s+d-23,y:r+9,width:16,height:16};c({rect:v,text:i("msg.warning.barcode.renderError"),mousePosition:a})}},async handleClick(t){const{row:n,column:o,makeCellEditable:l,value:a,isDoubleClick:i,selected:s,cellRenderStore:r,mousePosition:d}=t,{x:c,y:f,width:v,height:h}=r;let y=!1;return c&&f&&v&&h&&(y=s&&Pt({x:c,y:f,width:v,height:h},d)),i||y?(gu(a,o.columnObj).isValid&&l(n,o),!0):!1}},Bk={render:(t,{value:n,x:o,y:l,width:a,height:i,column:s,imageLoader:r,padding:d,tag:c={},cellRenderStore:f})=>{const{renderAsTag:v}=c;if(d=4,!n||n==="ERR!"){n==="ERR!"&&ml(t,{x:o+d,y:l,text:"ERR!",maxWidth:a-d*2,fontFamily:"500 13px Inter",fillStyle:"#e65100",height:i});return}const h=String(n);if(h.length>2e3){ml(t,{x:o+d,y:l,text:"Too many characters for a QR Code",maxWidth:a-d*2,fontFamily:"500 13px Inter",fillStyle:"#e65100",height:i});return}const b=jn(s==null?void 0:s.meta);let _;ns[i]===1?_=i-4:_=i-20;const m=Math.min(a-d*2,_),g=r.loadOrGetQR(h,m,{dark:b.dark,light:b.light});if(g){const C=v?o+d:o+(a-m)/2,w=l+(i-m)/2;return r.renderQRCode(t,g,C,w,m),v||Object.assign(f,{x:C,y:w,width:m,height:m}),{x:o+d+m,y:w*2}}else return r.renderPlaceholder(t,o+d,l+d,m,"qr_code"),{x:o+d+m,y:l+d+m}},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;return n.key==="Enter"?(a(o,l),!0):!1},async handleClick({row:t,column:n,mousePosition:o,makeCellEditable:l,cellRenderStore:a,selected:i,isDoubleClick:s}){if(!i||s)return!1;const{x:r,y:d,width:c,height:f}=a;return!r||!d||!c||!f?!1:Pt({x:r,y:d,width:c,height:f},o)?(l(t,n),!0):!1}};function Uc({width:t,height:n,padding:o=10,x:l,y:a,column:i,value:s,selected:r,isRowHovered:d,readonly:c}){var E;const f=jn(i==null?void 0:i.meta).max??((E=as.getColumnDefaultMeta(pe.Rating))==null?void 0:E.max)??5,v=Math.min(Math.max(0,Number(s)||0),f),h={color:"#fcb401",...jn(i==null?void 0:i.meta),max:(Si(r)&&Si(d)||r||d)&&(Si(c)||!c)?f:v,icon:ah(jn(i==null?void 0:i.meta))},y=14,b=1.5,_=2,m=t-o*2,g=l+o,C=a+o,w=y+b,S=Math.floor(m/w);if(S<1)return;const x=Math.floor((n-o)/(y+_)),$=S*x,I=Math.min($,h.max),F=[];for(let M=0;M<I;M++){const U=Math.floor(M/S),L=M%S,G=g+L*w,ae=C+U*(y+_);F.push({iconX:G,iconY:ae})}return{iconPositions:F,iconSize:y,ratingMeta:h,startX:g,startY:C,rowSpacing:_,iconWidthWithSpacing:w,maxRows:x,iconsPerRow:S,iconsToShow:I,rating:v}}const Gc="#d9d9d9",Jv={render(t,n){const{value:o,x:l,y:a,width:i,height:s,column:r,spriteLoader:d,padding:c,mousePosition:f,readonly:v,tag:h={},setCursor:y,cellRenderStore:b,selected:_,isRowHovered:m}=n,{renderAsTag:g,tagPaddingX:C=6,tagHeight:w=20,tagRadius:S=6,tagBgColor:x="#f4f4f0",tagSpacing:$=4,tagBorderColor:I,tagBorderWidth:F}=h,E=Uc({height:s,width:i,x:l,y:a,column:r,padding:c,selected:_,isRowHovered:m,value:o,readonly:v});if(!E)return;const{ratingMeta:M,startX:U,startY:L,iconSize:G,rowSpacing:ae,iconWidthWithSpacing:ve,maxRows:xe,iconsPerRow:ne,iconsToShow:he,rating:W}=E;if(!m&&!_&&!W&&!g)return;if((m||_)&&!W&&v&&!g)return;const j=he<M.max;let Ee=-1;if(f&&!v){const{x:Ge,y:ke}=f,Y=Ge-U,we=ke-L,oe=Math.floor(we/(G+ae)),ye=Math.floor(Y/ve);oe>=0&&oe<xe&&ye>=0&&ye<ne&&Y>=0&&we>=0&&Ge<l+i&&ke<a+s&&(Ee=oe*ne+ye,Ee>=he&&(Ee=-1))}const Ye=ve*he+C*2+(j?15:0);if(g){const Ge=a+s/2-w/2;wa(t,{x:l+$,y:Ge,width:Ye,height:w,radius:S,fillStyle:x,borderColor:I,borderWidth:F})}for(let Ge=0;Ge<he;Ge++){const ke=Math.floor(Ge/ne),Y=Ge%ne,we=Ge<W;let oe=Ee>=0&&Ge<=Ee;if(b&&b.ratingChanged){const{value:ie,hoverValue:H}=b.ratingChanged;Ee===H-1?oe=Ge+1<=ie:b.ratingChanged=void 0}let ye;if(oe?(ye=M.color,v||y("pointer")):ye=Gc,Ee===-1&&(ye=we?M.color:Gc),ke<xe){const ie=U+Y*ve,H=L+ke*(G+ae);d.renderIcon(t,{icon:we||oe?M.icon.full:M.icon.empty,size:G,x:ie,y:H,color:ye})}}if(j&&xe>0){const Ge=Math.min(Math.floor((he-1)/ne),xe-1),ke=(he-1)%ne;t.font="500 13px Inter",t.fillStyle="#4a5268",t.textBaseline="middle",t.fillText("...",U+(ke+1)*ve,L+Ge*(G+ae)+G/2)}if(g)return{x:l+Ye+$,y:a+w+$}},async handleClick({mousePosition:t,column:n,row:o,getCellPosition:l,updateOrSaveRow:a,value:i,cellRenderStore:s,readonly:r,path:d,formula:c}){if(!o||!n||r||c||!n.isCellEditable)return!1;const{x:f,y:v,width:h,height:y}=l(n,o.rowMeta.rowIndex),b=Uc({x:f,y:v,width:h,height:y,column:n.columnObj,padding:10});if(!b)return!1;const{iconSize:_,iconPositions:m}=b,{x:g,y:C}=t,w=m.findIndex(({iconX:S,iconY:x})=>g>=S&&g<=S+_&&C>=x&&C<=x+_);return w===-1?!1:w+1===i?(o.row[n.title]=0,await(a==null?void 0:a(o,n.title,void 0,void 0,void 0,d)),s.ratingChanged={value:0,hoverValue:w+1},!0):(o.row[n.title]=w+1,await(a==null?void 0:a(o,n.title,void 0,void 0,void 0,d)),s.ratingChanged={value:w+1,hoverValue:w+1},!0)},async handleKeyDown(t){const{e:n,row:o,column:l,updateOrSaveRow:a,readonly:i,path:s}=t;if(l.readonly||i||!l.isCellEditable)return;const r=l.columnObj;return/^[0-9]$/.test(n.key)?(o.row[r.title]=Number(n.key),await a(o,r.title,void 0,void 0,void 0,s),!0):!1}},er=8,Yr=4,xs=8,hi=20,Li=14,Hc=15,Wk=t=>{const{getPossibleAttachmentSrc:n}=xi();if(!t)return{icon:"",iconType:""};const o=jn(t).icon||"",l=jn(t).iconType||"";return{icon:l===Wi.IMAGE&&Sa(o)?n(o)||"":o,iconType:l}},zk=(t,n)=>{var l,a,i,s;const o=t.split(" ").filter(r=>r)??[];return o.length>0?o.length>1?(((l=o[0])==null?void 0:l[0])??"")+(((a=o[1])==null?void 0:a[0])??""):t.slice(0,2):((s=(i=n.split("@"))==null?void 0:i[0])==null?void 0:s.slice(0,2))??""},Vk=(t,n,o)=>{const l=t?ic(t):n?ic(n):"#FFFFFF",a="#F4F4F5";if(o.icon)switch(o.iconType){case Wi.IMAGE:return"";case Wi.EMOJI:case Wi.ICON:return a;default:return l||"#FFFFFF"}return l||"#FFFFFF"},bu={render:(t,n)=>{var w,S;const{value:o,x:l,y:a,width:i,height:s,column:r,spriteLoader:d,padding:c,imageLoader:f}=n;let v=l+c,h=a,y=i-c*2;y=y-c*2;const b=jn(r==null?void 0:r.meta),_=(b==null?void 0:b.is_multi)??!1,m=gc(((w=r==null?void 0:r.extra)==null?void 0:w.optionsMap)||{},o);if(!m.length)return;let g=0,C=1;for(const x of m){const $=((S=x.display_name)==null?void 0:S.trim())??"",I=x.email??"",F=$||I,E=x.deleted,{text:M,width:U}=Jn(t,{text:F,maxWidth:y-er*2-Li-8,render:!1}),L=Li+8+U+er*2;if(v+L>l+i-c*2){if(h+hi*2+Yr>a+s||C>=ji(s,!0)){Jn(t,{x:v+c+xs,y:h,text:"...",maxWidth:Hc,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:E?"#4a5268":"#0b1d05",height:s}),v=v+c+xs+Hc,h=h+hi+Yr;break}v=l+c,h+=hi+Yr,C+=1}wa(t,{x:v,y:h+6,width:L,height:hi,radius:12,fillStyle:"#e7e7e9"});const G=Wk(x.meta),ae=G.icon&&G.iconType===Wi.IMAGE&&!!G.icon[0],ve=zk($,I),xe=19,ne=xe/2,he=E?!0:!ae,W=ae?"transparent":Vk($,I,G),j=ih(W)?"white":"black",Ee=G.icon;he&&qo(t,v,h+6.5,xe,xe,ne,{backgroundColor:E?"#BBBBBB":W});let Ye=!0;if(ae){const Ge=f.loadOrGetImage(Ee);Ge&&(f.renderImage(t,Ge,v,h+6,xe,xe,ne,{border:!1}),Ye=!1)}else G.icon&&G.iconType===Wi.EMOJI?rh(Ee)?(Jn(t,{x:v+3.5,y:h+1,text:Ee}),Ye=!1):Ye=!0:G.icon&&G.iconType===Wi.ICON?(d.renderIcon(t,{color:"black",icon:Ee,size:12,x:v+4,y:h+9.5}),Ye=!1):E?Ye=!1:ve&&(Jn(t,{x:v+ne,y:h,text:ve.toLocaleUpperCase(),fontFamily:"600 10px Inter",textAlign:"center",verticalAlign:"middle",fillStyle:j}),Ye=!1);if(Ye&&d.renderIcon(t,{icon:"user",size:Li,x:v+2.5,y:h+6+(hi-Li)/2,color:j}),Jn(t,{x:v+er+Li+4,y:h,text:M,maxWidth:y-er*2,textAlign:"left",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:"#0b1d05",height:s}),v=v+L+xs,g++,!_)break}return{x:v,y:h,nextLine:g<m.length}},async handleHover({column:t,getCellPosition:n,row:o,mousePosition:l,value:a,selected:i,baseUsers:s}){var E,M,U;const{hideTooltip:r,tryShowTooltip:d}=sl();if(r(),!i)return;const c=L=>{const G=(s||[]).find(ae=>ae.email===L);return G?G.roles??(G.workspace_roles?sh[G.workspace_roles]??su.NO_ACCESS:su.NO_ACCESS):su.NO_ACCESS},{x:f,y:v,width:h,height:y}=n(t,o.rowMeta.rowIndex),b=10;let _=f+b,m=v,g=h-b*2;g=g-b*2;const C=jn(t==null?void 0:t.columnObj.meta),w=(C==null?void 0:C.is_multi)??!1,S=gc(((E=t==null?void 0:t.extra)==null?void 0:E.optionsMap)||{},a);if(!S.length)return;const x=[],$=Tl;let I=1;for(const L of S){const G=((M=L.display_name)==null?void 0:M.trim())||L.email,{width:ae}=Jn($,{text:G,maxWidth:g-er*2-Li-8,render:!1}),ve=Li+8+ae+er*2;if(_+ve>f+h-b*2){if(m+hi*2+Yr>v+y||I>=ji(y,!0))break;_=f+b,m+=hi+Yr,I+=1}if(x.push({x:_,y:m+6,width:ve,height:hi,display_name:(U=L.display_name)==null?void 0:U.trim(),email:L.email}),_=_+ve+xs,!w)break}if(!x.length)return;const F=x.find(L=>Pt(L,l));F&&d({rect:F,text:ia("div",{class:"flex flex-col gap-2"},[ia("div",{class:"flex flex-col"},[ia("div",{class:F.display_name?"text-small":"hidden"},F.display_name),ia("div",{class:` ${F.display_name?"text-tiny text-gray-200":"text-small"}`},F.email)]),ia("div",{class:"text-tiny text-gray-200"},`Has ${c(F.email)} role in base`)]),mousePosition:l})},async handleClick({row:t,column:n,mousePosition:o,getCellPosition:l,makeCellEditable:a,selected:i}){if(n.readonly||!(n!=null&&n.isCellEditable)||rs(n.uidt)||!i)return!1;const{x:s,y:r,width:d}=l(n,t.rowMeta.rowIndex),c=10,f=s+c,v=r,h=d-c*2;return Pt({x:f,y:v,width:h,height:20},o)?(a(t,n),!0):!1},async handleKeyDown({e:t,row:n,column:o,makeCellEditable:l}){return o.readonly||!(o!=null&&o.isCellEditable)||rs(o.uidt)?!1:t.key.length===1?(l(n,o),!0):!1}},mi=8,Yc=22,qc=4,jk={render:(t,{column:n,value:o,x:l,y:a,width:i,pv:s,padding:r})=>{var h,y,b,_;const d=((h=o==null?void 0:o.toString())==null?void 0:h.trim())??"";if(!d)return;const{text:c,width:f}=Jn(t,{x:l+r+mi,y:a,text:d,maxWidth:i-r*2-mi*2,textAlign:"left",verticalAlign:"middle",fontFamily:`${s?600:500} 13px Inter`,render:!1}),v=((_=(b=(y=n.extra)==null?void 0:y.optionsMap)==null?void 0:b[d])==null?void 0:_.color)??"#e7e7e9";return wa(t,{x:l+r,y:a+qc,width:f+mi*2,height:Yc,radius:12,fillStyle:v}),Jn(t,{x:l+r+mi,y:a,text:c,maxWidth:i-r*2-mi*2,textAlign:"left",verticalAlign:"middle",fontFamily:`${s?600:500} 13px Inter`,fillStyle:Uf(v)}),{x:l+r+f+mi*2,y:a}},async handleHover({getCellPosition:t,column:n,row:o,value:l,mousePosition:a}){var m;const{x:i,y:s,width:r}=t(n,o.rowMeta.rowIndex),{tryShowTooltip:d,hideTooltip:c}=sl();c();const f=10,v=r-f*2-mi*2,h=document.createElement("canvas").getContext("2d");if(!h)return;h.font=`${n.pv?600:500} 13px Inter`;const y=((m=l==null?void 0:l.toString())==null?void 0:m.trim())??"";if(!y)return;const b=Hl(h,y,v,!0);if(y===b.text)return;const _={x:i+f,y:s+qc,width:b.width+mi*2,height:Yc};d({rect:_,mousePosition:a,text:y})},async handleClick({row:t,column:n,makeCellEditable:o,selected:l}){var a;return n.readonly||(a=n.columnObj)!=null&&a.readonly||!(n!=null&&n.isCellEditable)||!l?!1:(o(t,n),!0)},async handleKeyDown({e:t,row:n,column:o,makeCellEditable:l}){var a;return o.readonly||(a=o.columnObj)!=null&&a.readonly||!(o!=null&&o.isCellEditable)?!1:t.key.length===1||t.key==="Enter"?(l(n,o),!0):!1}},zu={render:(t,n)=>{var I,F,E;const{column:o,x:l,y:a,width:i,height:s,pv:r,padding:d}=n;let c=l+d,f=a,v=i-d*2;const h=8,y=4,b=8,_=22,m=4,g="#666",C=15;v=v-d*2;const w=zu.getSelectedOptions(n);if(!w.length)return;const S=(I=o.extra)==null?void 0:I.optionsMap;let x=0,$=1;for(const M of w){const U=(M==null?void 0:M.trim())??"",{text:L,width:G}=Jn(t,{text:U,maxWidth:v-h*2,render:!1});if(c+G+h*2>l+i-d*2){if(f+_*2+y>a+s||x===0||$>=ji(s,!0)){Jn(t,{x:c+d+b,y:f,text:"...",maxWidth:C,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:g,height:s}),c=c+d+b+C,f=f+_+y;break}c=l+d,f+=_+y,$+=1}wa(t,{x:c,y:f+m,width:G+h*2,height:_,radius:12,fillStyle:((F=S[U])==null?void 0:F.color)??g}),Jn(t,{x:c+h,y:f,text:L,maxWidth:v-h*2,textAlign:"left",verticalAlign:"middle",fontFamily:`${r?600:500} 13px Inter`,fillStyle:Uf(((E=S[U])==null?void 0:E.color)??g),height:s}),c=c+G+h*2+b,x++}return{x:c,y:f,nextLine:x<w.length}},getSelectedOptions:t=>{var a;const{column:n,value:o,isMysql:l}=t;if(!n||!o)return[];if(Rl(o))return o;if(l!=null&&l(n==null?void 0:n.source_id)){const i=(a=n.extra)==null?void 0:a.optionsMap;return o.toString().split(",").sort((s,r)=>{const d=i[s==null?void 0:s.trim()],c=i[r==null?void 0:r.trim()];return d&&c?d.order-c.order:0})}else return o.toString().split(",")},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,value:a}){const{tryShowTooltip:i,hideTooltip:s}=sl();if(s(),!t||!(n!=null&&n.id)||!o)return;const{x:r,y:d,width:c,height:f}=l(n,t.rowMeta.rowIndex),v=10;let h=r+v,y=d,b=c-v*2;const _=8,m=4,g=8,C=20,w=6;b=b-v*2;const S=zu.getSelectedOptions({column:n.columnObj,value:a});if(!S.length)return;const x=[];let $=0,I=1;const F=Tl;for(const M of S){const U=(M==null?void 0:M.trim())??"",{text:L,width:G}=Jn(F,{text:U,maxWidth:b-_*2,render:!1});if(h+G+_*2>r+c-v*2){if(y+C*2+m>d+f||$===0||I>=ji(f,!0))break;h=r+v,y+=C+m,I+=1}U!==L&&x.push({x:h,y:y+w,width:G+_*2,height:C,text:U}),h=h+G+_*2+g,$++}if(!x.length)return;const E=x.find(M=>Pt(M,o));E&&i({rect:E,mousePosition:o,text:E.text})},async handleClick({row:t,column:n,makeCellEditable:o,selected:l}){var a;return(a=n.columnObj)!=null&&a.readonly||!(n!=null&&n.isCellEditable)||!l?!1:(o(t,n),!0)},async handleKeyDown({e:t,row:n,column:o,makeCellEditable:l}){var a;return o.readonly||(a=o.columnObj)!=null&&a.readonly||!(o!=null&&o.isCellEditable)?!1:t.key.length===1||t.key==="Enter"?(l(n,o),!0):!1}},Uk=uh(),Gk={render:(t,n)=>{var h,y,b,_;const{column:o,value:l,metas:a,renderCell:i}=n;if(!ua(l))return;const s=o.colOptions,r=(y=(h=a==null?void 0:a[o.fk_model_id])==null?void 0:h.columns)==null?void 0:y.find(m=>m.id===(s==null?void 0:s.fk_relation_column_id));if(!r)return;const d=a==null?void 0:a[(b=r.colOptions)==null?void 0:b.fk_related_model_id],c=Uk(((d==null?void 0:d.columns)||[]).find(m=>m.id===(s==null?void 0:s.fk_rollup_column_id)));if(!c)return;let f;if(c.uidt===pe.Formula){const m=jn(c.meta);m!=null&&m.display_type&&(f={...n,column:{...c,uidt:m==null?void 0:m.display_type,...m.display_column_meta,meta:{...jn(m.display_column_meta),...jn(o==null?void 0:o.meta)}},readonly:!0,formula:!0})}f||(f={...n,column:c,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0});const v=dh(((_=f.column)==null?void 0:_.uidt)||pe.SingleLineText);f.column.meta={...jn(c==null?void 0:c.meta),...jn(o==null?void 0:o.meta)},s!=null&&s.rollup_function&&v.includes(s==null?void 0:s.rollup_function)&&(f.column.uidt=pe.Decimal),i(t,f.column,f)}},Hk={render:(t,n)=>{var g,C,w;const{column:o,value:l,x:a,y:i,width:s,height:r,padding:d,t:c,spriteLoader:f,mousePosition:v,readonly:h,setCursor:y,selected:b}=n,_=+l||0;let m="";if(_?_===1?m=`1 ${((g=o==null?void 0:o.meta)==null?void 0:g.singular)||c("general.link")}`:m=`${_} ${((C=o==null?void 0:o.meta)==null?void 0:C.plural)||c("general.links")}`:m=c("msg.noRecordsLinked"),(w=n.tag)!=null&&w.renderAsTag)return Sl(t,{...n,text:m});{const{y:S,width:x}=Jn(t,{x:a+d,y:i,text:m,maxWidth:s-d*2-20,fontFamily:"500 13px Inter",fillStyle:"rgb(67, 81, 232)",height:r}),$=Pt({x:a+d,y:i,width:x,height:S-i},v),{x:I,y:F}=Jn(t,{x:a+d,y:i,text:m,maxWidth:s-d*2-20,fontFamily:"500 13px Inter",fillStyle:"rgb(67, 81, 232)",height:r,underline:b&&$});return b&&$&&y("pointer"),b&&!h&&(f.renderIcon(t,{icon:"ncPlus",x:a+s-16-d,y:i+7,size:16,color:"#374151"}),Pt({x:a+s-16-d,y:i+7,width:16,height:16},v)&&y("pointer")),{x:I,y:F}}},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,selected:i,isDoubleClick:s}){if(!i&&!s)return!1;const r=t.rowMeta.rowIndex,{x:d,y:c,width:f,height:v}=o(n,r),h=10,y=16;return Pt({x:d+f-16-h,y:c+7,height:y,width:y},l)||Pt({x:d+h,y:c,height:v,width:f-h*2},l)?(a(t,n),!0):!1},async handleKeyDown({row:t,column:n,e:o,makeCellEditable:l}){return Cr(o)?(l(t,n),!0):!1}},Ir={render:(t,n)=>{var S;const{column:o,value:l,x:a,y:i,width:s,height:r,padding:d,textColor:c="#4a5268",fontFamily:f="500 13px Inter",meta:v,metas:h,sqlUis:y,isMysql:b,isXcdbBase:_,t:m,isUnderLookup:g}=n;if(!v||!h)return;const C=Gf(o,y),w=dm(l,{col:o,abstractType:C,meta:v,metas:h,isMysql:b,isXcdbBase:_,t:m,isUnderLookup:g});if((S=n.tag)!=null&&S.renderAsTag)return Sl(t,{...n,text:w});if(w){const{x,y:$}=Jn(t,{x:a+d,y:i,text:w,maxWidth:s-d*2,fontFamily:f,fillStyle:c,height:r});return{x,y:$}}else return{x:a,y:i}}},Ni=[pe.QrCode,pe.Barcode,pe.Attachment,pe.LinkToAnotherRecord,pe.Links],qr=15,Yk={render:(t,n)=>{var ne,he,W,j,Ee,Ye,Ge;const{column:o,x:l,y:a,value:i,renderCell:s,metas:r,height:d,width:c,padding:f=10,tableMetaLoader:v,row:h}=n;let y=l,b=a,_=c-qr;if(!r)return;const m=o.colOptions,g=(he=(ne=r==null?void 0:r[o.fk_model_id])==null?void 0:ne.columns)==null?void 0:he.find(ke=>{var Y;return ke.id===((Y=o==null?void 0:o.colOptions)==null?void 0:Y.fk_relation_column_id)});if(!g)return;const C=r==null?void 0:r[(W=g.colOptions)==null?void 0:W.fk_related_model_id];if(!C){if(v.isLoading((j=g.colOptions)==null?void 0:j.fk_related_model_id))return;v.getTableMeta((Ee=g.colOptions)==null?void 0:Ee.fk_related_model_id);return}const w=((C==null?void 0:C.columns)||[]).find(ke=>ke.id===(m==null?void 0:m.fk_lookup_column_id));if(!w||(w==null?void 0:w.uidt)===pe.Button)return;b=b+(Ni.includes(w.uidt)&&w.uidt!==pe.Attachment?Math.floor(d/2-Wo[1]/2):0),[pe.SingleSelect,pe.MultiSelect].includes(w.uidt)?w.extra=Nv(w):[pe.User,pe.CreatedBy,pe.LastModifiedBy].includes(w.uidt)&&(w.extra=Pv(w,n.baseUsers||[]));const x=(()=>{var ke,Y;if(w.uidt===pe.Checkbox&&[Qi.BELONGS_TO,Qi.ONE_TO_ONE].includes((ke=g==null?void 0:g.colOptions)==null?void 0:ke.type)){const we=!!(h&&h[g==null?void 0:g.title]);return!i&&!we?[]:(Rl(i)?i:[i]).map(nv)}if(!i)return[];if(w.uidt===pe.Attachment){if([Qi.BELONGS_TO,Qi.ONE_TO_ONE].includes((Y=g==null?void 0:g.colOptions)==null?void 0:Y.type))return Rl(i)?i:[i];if(Rl(i)&&i.every(we=>eu(we)?!0:Rl(we)?!we.length||Sa(we[0]):!1))return i.filter(we=>we!==null).reduce((we,oe)=>(we.push(...oe),we),[])}return Rl(i)?i.filter(we=>we!==null):[i]})();if(!x.length)return;t.save(),t.beginPath(),t.rect(l,a,c-f,d),t.clip();let $;const I=(Ye=w.colOptions)==null?void 0:Ye.fk_related_model_id;if(hl(w)&&I&&($=r==null?void 0:r[I],!$)){if(v.isLoading(I))return;v.getTableMeta(I);return}const F={...n,column:w,relatedColObj:void 0,relatedTableMeta:$,isUnderLookup:!0,readonly:!0,value:x,height:uu(w)?d:Wo[1],padding:10,tag:{renderAsTag:!0,tagBgColor:lo.base.white,tagHeight:20,tagBorderColor:lo.gray[200],tagBorderWidth:1},meta:C,textAlign:uu(w)?"center":n.textAlign},E=ke=>gs.includes(w.uidt)||ch(w)?s(t,w,ke):Ir.render(t,ke),M=ji(d,!0);let U=1,L=!1,G=1;const ae=()=>{y!==l&&Jn(t,{x:y+f,y:b,text:"...",maxWidth:qr,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:"#666",height:d})},ve=()=>{for(const ke of x){const Y=E({...F,value:ke,x:y,y:b,width:_,tag:{...F.tag,renderAsTag:Ni.includes(w.uidt)}});if(Ni.includes(w.uidt))Y!=null&&Y.x&&(y=Y==null?void 0:Y.x);else if(Y!=null&&Y.x)if((Y==null?void 0:Y.x)>=l+c-f*2-(G<x.length?50-qr:0)){if(U+1>M||Ni.includes(w.uidt)){L=!0;break}y=l,_=c-qr,b=Y!=null&&Y.y&&b!==(Y==null?void 0:Y.y)&&(Y==null?void 0:Y.y)-b>=24?Y==null?void 0:Y.y:b+24,U+=1}else _=y+_-((Y==null?void 0:Y.x)-2*4)-f*2-qr,y=Y==null?void 0:Y.x;else{if(U+1>M||Ni.includes(w.uidt))break;y=l,b+=24,_=c,U+=1}G+=1}L&&G<x.length&&ae()},xe=()=>{for(const ke of x){const Y=E({...F,value:ke,x:y,y:b,width:_});if(Y!=null&&Y.x&&!(Y!=null&&Y.nextLine))if((Y==null?void 0:Y.x)>=l+c-f*2-50){if(y=l,_=c,b=Y!=null&&Y.y&&b!==(Y==null?void 0:Y.y)&&(Y==null?void 0:Y.y)-b>=24?Y==null?void 0:Y.y:b+24,U+=1,Ni.includes(w.uidt))break}else _=l+c-((Y==null?void 0:Y.x)-2*4)-f*2,y=Y==null?void 0:Y.x;else if(y=l,b+=24,_=c,U+=1,Ni.includes(w.uidt))break;if(U>M)break;G++}};xo(w)&&![pe.Rollup,pe.Formula].includes(w.uidt)?w.uidt!==pe.LinkToAnotherRecord||w.uidt===pe.LinkToAnotherRecord&&[Qi.BELONGS_TO,Qi.ONE_TO_ONE].includes((Ge=w.colOptions)==null?void 0:Ge.type)?ve():E({...F,tag:{...F.tag,renderAsTag:!1}}):uu(w)&&Sa(x[0])?s(t,w,{...F,tag:{...F.tag,renderAsTag:!1}}):xe(),t.restore()},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;return n.key==="Enter"||Cr(n)?(a(o,l),!0):!1}},qk={solid:{brand:{base:{background:"#3366FF",text:"#FFFFFF"},hover:{background:"#2952CC",text:"#FFFFFF"},loader:"#3366FF",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},red:{base:{background:"#FF4A3F",text:"#FFFFFF"},hover:{background:"#CB3F36",text:"#FFFFFF"},loader:"#FF4A3F",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},green:{base:{background:"#27D665",text:"#FFFFFF"},hover:{background:"#1FAB51",text:"#FFFFFF"},loader:"#27D665",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},maroon:{base:{background:"#B33771",text:"#FFFFFF"},hover:{background:"#9D255D",text:"#FFFFFF"},loader:"#B33771",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},blue:{base:{background:"#36BFFF",text:"#FFFFFF"},hover:{background:"#2B99CC",text:"#FFFFFF"},loader:"#36BFFF",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},orange:{base:{background:"#FA8231",text:"#FFFFFF"},hover:{background:"#E1752C",text:"#FFFFFF"},loader:"#FA8231",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},pink:{base:{background:"#FC3AC6",text:"#FFFFFF"},hover:{background:"#CA2E9E",text:"#FFFFFF"},loader:"#FC3AC6",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},purple:{base:{background:"#7D26CD",text:"#FFFFFF"},hover:{background:"#641EA4",text:"#FFFFFF"},loader:"#7D26CD",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},yellow:{base:{background:"#fcbe3a",text:"#FFFFFF"},hover:{background:"#ca982e",text:"#FFFFFF"},loader:"#fcbe3a",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},gray:{base:{background:"#6A7184",text:"#FFFFFF"},hover:{background:"#4A5268",text:"#FFFFFF"},loader:"#6A7184",disabled:{background:"#F4F4F5",text:"#9AA2AF"}}},light:{brand:{base:{background:"#EBF0FF",text:"#2952CC"},hover:{background:"#D6E0FF",text:"#2952CC"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#2952CC"},red:{base:{background:"#FFF2F1",text:"#E8463C"},hover:{background:"#FFDBD9",text:"#E8463C"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#E8463C"},green:{base:{background:"#ECFFF2",text:"#1FAB51"},hover:{background:"#D4F7E0",text:"#1FAB51"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#1FAB51"},maroon:{base:{background:"#FFF0F7",text:"#9D255D"},hover:{background:"#FFCFE6",text:"#9D255D"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#9D255D"},blue:{base:{background:"#EDF9FF",text:"#2B99CC"},hover:{background:"#D7F2FF",text:"#2B99CC"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#2B99CC"},orange:{base:{background:"#FFF5EF",text:"#E1752C"},hover:{background:"#FEE6D6",text:"#E1752C"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#E1752C"},pink:{base:{background:"#FFEEFB",text:"#CA2E9E"},hover:{background:"#FED8F4",text:"#CA2E9E"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#CA2E9E"},purple:{base:{background:"#F3ECFA",text:"#641EA4"},hover:{background:"#E5D4F5",text:"#641EA4"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#641EA4"},yellow:{base:{background:"#fffbf2",text:"#ca982e"},hover:{background:"#fff0d1",text:"#ca982e"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#ca982e"},gray:{base:{background:"#F9F9FA",text:"#4A5268"},hover:{background:"#F4F4F5",text:"#4A5268"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#4A5268"}},text:{brand:{base:{background:"transparent",text:"#3366FF"},hover:{background:"#F4F4F5",text:"#3366FF"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#3366FF"},red:{base:{background:"transparent",text:"#FF4A3F"},hover:{background:"#F4F4F5",text:"#FF4A3F"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#FF4A3F"},green:{base:{background:"transparent",text:"#27D665"},hover:{background:"#F4F4F5",text:"#27D665"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#27D665"},maroon:{base:{background:"transparent",text:"#B33771"},hover:{background:"#F4F4F5",text:"#B33771"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#B33771"},blue:{base:{background:"transparent",text:"#36BFFF"},hover:{background:"#F4F4F5",text:"#36BFFF"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#36BFFF"},orange:{base:{background:"transparent",text:"#FA8231"},hover:{background:"#F4F4F5",text:"#FA8231"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#FA8231"},pink:{base:{background:"transparent",text:"#FC3AC6"},hover:{background:"#F4F4F5",text:"#FC3AC6"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#FC3AC6"},purple:{base:{background:"transparent",text:"#7D26CD"},hover:{background:"#F4F4F5",text:"#7D26CD"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#7D26CD"},yellow:{base:{background:"transparent",text:"#fcbe3a"},hover:{background:"#F4F4F5",text:"#fcbe3a"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#fcbe3a"},gray:{base:{background:"transparent",text:"#6A7184"},hover:{background:"#F4F4F5",text:"#6A7184"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#6A7184"}}},Xk=(t,n,o,l)=>{var r;const a=(r=qk[t])==null?void 0:r[n];return a?{...a[o&&!l?"hover":"base"],loader:a.loader}:o&&!l?{background:"#2952CC",text:"#FFFFFF",loader:"#3366FF"}:{background:"#3366FF",text:"#FFFFFF",loader:"#3366FF"}},tr=12,Xr=24,_u=32,la=14,gi=6,Kk={render:(t,n)=>{var ne;const{x:o,y:l,width:a,column:i,spriteLoader:s,mousePosition:r,actionManager:d,pk:c,disabled:f,value:v,allowLocalUrl:h,cellRenderStore:y,t:b}=n,_=d.isLoading(c,i.id),m=d.getAfterActionStatus(c,i.id);m!=null&&m.tooltip?Object.assign(y,{invalidUrlTooltip:m.tooltip}):Object.assign(y,{invalidUrlTooltip:""});let g=_||(f==null?void 0:f.isInvalid);t.textAlign="left";const C=i.colOptions;if(!C)return;const w={label:C.label||"",icon:C.icon,theme:C.theme||"solid",color:C.color||"brand",type:C.type};if(w.type===fh.Url){let he=ts(((ne=v==null?void 0:v.url)==null?void 0:ne.toString())??"");try{he=decodeURI(he)===he?encodeURI(he):he}catch{he=encodeURI(he)}g=!(he&&Rs(he,{require_tld:!h})),Object.assign(y,{invalidUrlTooltip:g?b("msg.error.invalidURL"):""})}const S=!!w.icon||_||m,x=!!w.label,$=a-8;let I=0,F=0,E=w.label;if(x){t.font="550 13px Inter";const he=$-tr*2-(S?la+gi:0),W=Hl(t,w.label,he,!0);E=W.text,F=W.width,I+=F}S&&(I+=la,x&&(I+=gi));const M=Math.min($,Math.max(_u,I+tr*2)),U=o+(a-M)/2,L=l+4,G=!g&&r&&r.x>=U&&r.x<=U+M&&r.y>=L&&r.y<=L+Xr,ae=Xk(w.theme,w.color,G,!!g);G&&n.setCursor("pointer"),g&&(t.globalAlpha=w.theme==="solid"?.3:.5),t.beginPath(),t.roundRect(U,L,M,Xr,6),t.fillStyle=ae.background,t.fill();let ve=U+(M-I)/2;const xe=L+(Xr-la)/2;if(g&&ae.text==="#FFFFFF"&&(t.globalAlpha=1),_){const he=d.getLoadingStartTime(c,i.id);he&&(td(t,ve,xe,la,ae.loader,he,1.5),ve+=la+(x?gi:0))}else m?(s.renderIcon(t,{icon:m.status==="success"?"ncCheck":"ncInfo",size:la,x:ve,y:xe,color:ae.text}),ve+=la+(x?gi:0)):S&&(s.renderIcon(t,{icon:w.icon,size:la,x:ve,y:xe,color:ae.text}),ve+=la+(x?gi:0));x&&(t.fillStyle=ae.text,t.textBaseline="middle",t.fillText(E,ve,L+13)),g&&(t.globalAlpha=1)},async handleClick({mousePosition:t,column:n,row:o,pk:l,actionManager:a,getCellPosition:i,path:s,allowLocalUrl:r}){var I,F;const d=a.isLoading(l,n.id);if(!o||!(n!=null&&n.id)||!t||(I=n==null?void 0:n.isInvalidColumn)!=null&&I.isInvalid||d)return!1;const{x:c,y:f,width:v}=i(n,o.rowMeta.rowIndex),h=(F=n==null?void 0:n.columnObj)==null?void 0:F.colOptions;if(!h)return!1;const y={label:(h==null?void 0:h.label)||"",icon:h==null?void 0:h.icon,theme:(h==null?void 0:h.theme)||"solid",color:(h==null?void 0:h.color)||"brand",type:h==null?void 0:h.type},b=!!y.icon,_=!!y.label,m=v-8;let g=0,C=0;if(_){const E=Tl;E.font="550 13px Inter";const M=m-tr*2-(b?la+gi:0);C=Hl(E,y.label,M,!0).width,g+=C}b&&(g+=la,_&&(g+=gi));const w=Math.min(m,Math.max(_u,g+tr*2)),S=c+(v-w)/2,x=f+4;return t&&t.x>=S&&t.x<=S+w&&t.y>=x&&t.y<=x+Xr?(await a.executeButtonAction([l],n,{row:[o],path:s,allowLocalUrl:r}),!0):!1},async handleHover({column:t,getCellPosition:n,row:o,mousePosition:l,t:a,cellRenderStore:i}){var M,U,L;const{tryShowTooltip:s,hideTooltip:r}=sl();r();const{x:d,y:c,width:f}=n(t,o.rowMeta.rowIndex),v=(M=t==null?void 0:t.isInvalidColumn)==null?void 0:M.isInvalid,h=(U=t==null?void 0:t.isInvalidColumn)==null?void 0:U.ignoreTooltip;if(!i.invalidUrlTooltip&&(!v||h))return;const{aiIntegrations:y}=xr(),b=(L=t.columnObj)==null?void 0:L.colOptions;if(!b)return;const _={label:(b==null?void 0:b.label)||"",icon:b==null?void 0:b.icon,theme:(b==null?void 0:b.theme)||"solid",color:(b==null?void 0:b.color)||"brand",type:b==null?void 0:b.type},m=!!_.icon,g=!!_.label;if(!g)return;let C=0,w=0;const S=f-8;if(g){const G=Tl;G.font="550 13px Inter";const ae=S-tr*2-(m?la+gi:0);w=Hl(G,_.label,ae,!0).width,C+=w}const x=i.invalidUrlTooltip?i.invalidUrlTooltip:y.value.length?a("tooltip.aiIntegrationReConfigure"):a("tooltip.aiIntegrationAddAndReConfigure"),$=Math.min(S,Math.max(_u,C+tr*2)),I=d+(f-$)/2,F=c+4;s({rect:{x:I,y:F,height:Xr,width:$},mousePosition:l,text:x})},async handleKeyDown(t){var r;const{e:n,row:o,column:l,actionManager:a,pk:i,path:s}=t;if(n.key==="Enter"){const d=a.isLoading(i,l.id);return l.readonly||(r=l.columnObj)!=null&&r.readonly||d?!1:(await a.executeButtonAction([i],l,{row:[o],path:s,allowLocalUrl}),!0)}return!1}},Jk={render:(t,n)=>{var w,S,x,$,I,F,E;const{value:o,x:l,y:a,width:i,height:s,spriteLoader:r,mousePosition:d,relatedTableMeta:c,renderCell:f,readonly:v,setCursor:h,selected:y,cellRenderStore:b}=n,_=((x=((w=c==null?void 0:c.columns)==null?void 0:w.find(M=>M.pv))||((S=c==null?void 0:c.columns)==null?void 0:S[0]))==null?void 0:x.title)||"",m=((F=(($=c==null?void 0:c.columns)==null?void 0:$.find(M=>M.pv))||((I=c==null?void 0:c.columns)==null?void 0:I[0]))==null?void 0:F.id)||"",g=(E=c==null?void 0:c.columns)==null?void 0:E.find(M=>M.title===_);if(!g)return;let C;if(ua(o)){const M=i-(Pt({x:l,y:a,width:i,height:s},d)?26:0),U=o&&!Array.isArray(o)&&typeof o=="object"?o[_]??o[m]:o;if(C=(G=>gs.includes(g.uidt)?f(t,g,G):Ir.render(t,G))({...n,value:U,column:g,width:M,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Wo[1],padding:10,textColor:lo.brand[500],tag:{renderAsTag:!0,tagBgColor:lo.brand[50],tagHeight:24},meta:c,x:l+4,y:a+(Wo[1]===s?0:2)}),!(C!=null&&C.x)||!(C!=null&&C.y))return;Object.assign(C,{width:C.x-l+4,height:C.y-(a+(Wo[1]===s?0:2))}),Object.assign(b,C),!v&&y&&Pt({x:l+4,y:a+(Wo[1]===s?0:2),height:b.height,width:b.width},d)&&h("pointer"),y&&!v&&(r.renderIcon(t,{x:C.x+2,y:a+(Wo[1]===s?8:10),icon:"ncXCircle",size:16,color:"#AFB3C2"}),Pt({x:C.x+2,y:a+(Wo[1]===s?8:10),height:16,width:16},d)&&h("pointer"))}return y&&!v&&(r.renderIcon(t,{x:l+i-26,y:a+7,icon:"ncPlus",size:16,color:"#374151"}),Pt({x:l+i-26,y:a+7,width:16,height:16},d)&&h("pointer")),C},async handleClick({row:t,value:n,column:o,getCellPosition:l,mousePosition:a,makeCellEditable:i,cellRenderStore:s,selected:r,isPublic:d,readonly:c,isDoubleClick:f,openDetachedExpandedForm:v}){var S;if(!r&&!f)return!1;const h=t.rowMeta.rowIndex,{x:y,y:b,width:_,height:m}=l(o,h),g=16,C=Pt({x:y+_-26,y:b+8,height:g,width:g},a),w=(s==null?void 0:s.x)&&r&&Pt({x:s.x+2,y:b+7,height:g,width:g},a);if(C||w)return i(t,o),!0;if((r||f)&&Sa(n)&&(s!=null&&s.height)&&(s!=null&&s.width)&&Pt({x:y+4,y:b+(Wo[1]===m?0:2),height:s.height,width:s.width},a)){if(d)return!0;const x=qt(n,((S=o.relatedTableMeta)==null?void 0:S.columns)||[]);return x&&v({isOpen:!0,row:{row:n,rowMeta:{},oldRow:{...n}},meta:o.relatedTableMeta||{},rowId:x,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!d}),!0}return(r||f)&&!c&&Pt({x:y,y:b,width:_,height:m},a)?(i(t,o),!0):!1}},Xc=15,wi=24,Qk={render:(t,n)=>{var ve,xe,ne,he;const{value:o,x:l,y:a,width:i,height:s,spriteLoader:r,mousePosition:d,relatedTableMeta:c,padding:f,renderCell:v,readonly:h,setCursor:y,cellRenderStore:b,selected:_}=n,m=((ne=((ve=c==null?void 0:c.columns)==null?void 0:ve.find(W=>W.pv))||((xe=c==null?void 0:c.columns)==null?void 0:xe[0]))==null?void 0:ne.title)||"",g=(he=c==null?void 0:c.columns)==null?void 0:he.find(W=>W.title===m);if(!g)return;const C=(Rl(o)?o:[]).reduce((W,j)=>{if(!m)return W;const Ee=j[m];return W.push({value:Ee,item:j}),W},[]),w=l+4,S=i-8;let x=w,$=a+(Wo[1]===s?0:2),I=S;const F=[],E={...n,column:g,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Wo[1],padding:10,textColor:lo.brand[500],tag:{renderAsTag:!0,tagBgColor:lo.brand[50],tagHeight:24},meta:c},M=W=>gs.includes(g.uidt)?v(t,g,W):Ir.render(t,W),U=ji(s,!0);let L=1,G=!1;const ae=1;for(const W of C){const j=M({...E,value:W.value,x,y:$,width:I});if(j!=null&&j.x)if(F.push({oldX:x+4,oldY:$+4,x:j.x,y:j.y,width:j.x-(x+4),height:j.y?j.y-($+4):24,value:W.item}),!h&&_&&Pt({x,y:$,width:j.x-x,height:j.y?j.y-$:24},d)&&y("pointer"),(j==null?void 0:j.x)>=l+S-f*2-(ae<C.length?50-Xc:0)){if(L+1>U){x=j==null?void 0:j.x,G=!0;break}x=w,I=S,$=j!=null&&j.y&&a!==(j==null?void 0:j.y)&&(j==null?void 0:j.y)-a>=28?j==null?void 0:j.y:$+28,L+=1}else I=x+I-(j==null?void 0:j.x),x=j==null?void 0:j.x;else{if(F.push({oldX:x+4,oldY:$+4,x:x+I,y:$+24,width:I,height:24,value:W.item}),!h&&_&&Pt({x,y:$,width:I,height:24},d)&&y("pointer"),L+1>U)break;x=w,$=$+28,I=S,L+=1}if(L>U)break}Object.assign(b,{ltar:F}),G&&ae<C.length&&Jn(t,{x:x+12,y:a,text:"...",maxWidth:Xc,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:"#666",height:s}),Pt({x:l,y:a,width:i,height:s},d)&&(h||na(t,{buttonX:l+i-57,buttonY:a+4,borderRadius:6,buttonSize:wi,spriteLoader:r,mousePosition:d,icon:"ncPlus",iconData:{size:14,xOffset:5,yOffset:5},setCursor:y}),na(t,{buttonX:l+i-30,buttonY:a+4,borderRadius:6,buttonSize:wi,spriteLoader:r,mousePosition:d,icon:"maximize",setCursor:y}))},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,cellRenderStore:i,selected:s,isPublic:r,isDoubleClick:d,openDetachedExpandedForm:c}){var _;const f=t.rowMeta.rowIndex,{x:v,y:h,width:y,height:b}=o(n,f);if(Pt({x:v+y-57,y:h+4,height:wi,width:wi},l)||Pt({x:v+y-30,y:h+4,height:wi,width:wi},l))return a(t,n),!0;if((s||d)&&Rl(i==null?void 0:i.ltar)){for(const m of i.ltar)if(Sa(m.value)&&m.width&&m.height&&Pt({x:m.oldX,y:m.oldY,height:m.height,width:m.width},l)){if(r)return!0;const g=qt(m.value,((_=n.relatedTableMeta)==null?void 0:_.columns)||[]);return g&&c({isOpen:!0,row:{row:m.value,rowMeta:{},oldRow:{...m.value}},meta:n.relatedTableMeta||{},rowId:g,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!r}),!0}}return(s||d)&&Pt({x:v,y:h,width:y,height:b},l)?(a(t,n),!0):!1},handleHover:async t=>{const{row:n,column:o,mousePosition:l,getCellPosition:a,t:i}=t,{tryShowTooltip:s,hideTooltip:r}=sl();r();const d=n.rowMeta.rowIndex,{x:c,y:f,width:v}=a(o,d),h={x:c+v-30,y:f+4,width:wi,height:wi};s({rect:h,mousePosition:l,text:i("tooltip.expandShiftSpace")})}},Kc=15,yi=20,Zk={render:(t,n)=>{var ve,xe,ne,he;const{value:o,x:l,y:a,width:i,height:s,readonly:r,spriteLoader:d,mousePosition:c,relatedTableMeta:f,padding:v,renderCell:h,setCursor:y,cellRenderStore:b,selected:_}=n,m=((ne=((ve=f==null?void 0:f.columns)==null?void 0:ve.find(W=>W.pv))||((xe=f==null?void 0:f.columns)==null?void 0:xe[0]))==null?void 0:ne.title)||"",g=(he=f==null?void 0:f.columns)==null?void 0:he.find(W=>W.title===m);if(!g)return;const C=(Rl(o)?o:[]).reduce((W,j)=>{if(!m)return W;const Ee=j[m];return W.push({value:Ee,item:j}),W},[]),w=l+4,S=i-8;let x=w,$=a+(Wo[1]===s?0:2),I=S;const F=[],E={...n,column:g,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Wo[1],padding:10,textColor:lo.brand[500],tag:{renderAsTag:!0,tagBgColor:lo.brand[50],tagHeight:24},meta:f},M=W=>gs.includes(g.uidt)?h(t,g,W):Ir.render(t,W),U=ji(s,!0);let L=1,G=!1,ae=1;for(const W of C){const j=M({...E,value:W.value,x,y:$,width:I});if(j!=null&&j.x)if(F.push({oldX:x+4,oldY:$+4,x:j.x,y:j.y,width:j.x-(x+4),height:j.y?j.y-($+4):24,value:W.item}),!r&&_&&Pt({x,y:$,width:j.x-x,height:j.y?j.y-$:24},c)&&y("pointer"),(j==null?void 0:j.x)>=l+S-v*2-(ae<C.length?50-Kc:0)){if(L+1>U){x=j==null?void 0:j.x,G=!0;break}x=w,I=S,$=j!=null&&j.y&&a!==(j==null?void 0:j.y)&&(j==null?void 0:j.y)-a>=28?j==null?void 0:j.y:$+28,L+=1}else I=x+I-(j==null?void 0:j.x),x=j==null?void 0:j.x;else{if(F.push({oldX:x,oldY:$,x:x+I,y:$+24,width:I,height:24,value:W.item}),!r&&_&&Pt({x,y:$,width:I,height:24},c)&&y("pointer"),L+1>U)break;x=w,$=$+28,I=S,L+=1}ae++}G&&ae<C.length&&Jn(t,{x:x+12,y:a,text:"...",maxWidth:Kc,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:"#666",height:s}),Object.assign(b,{ltar:F}),_&&(r||na(t,{buttonX:l+i-57,buttonY:a+6,borderRadius:6,buttonSize:yi,spriteLoader:d,mousePosition:c,icon:"ncPlus",iconData:{size:14,xOffset:3,yOffset:3},setCursor:y}),na(t,{buttonX:l+i-30,buttonY:a+6,borderRadius:6,buttonSize:yi,spriteLoader:d,mousePosition:c,icon:"maximize",setCursor:y,iconData:{size:12,xOffset:4,yOffset:4}}))},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,cellRenderStore:i,selected:s,isPublic:r,isDoubleClick:d,openDetachedExpandedForm:c}){var _;if(!s&&!d)return!1;const f=t.rowMeta.rowIndex,{x:v,y:h,width:y,height:b}=o(n,f);if(Pt({x:v+y-57,y:h+7,height:yi,width:yi},l)||Pt({x:v+y-30,y:h+7,height:yi,width:yi},l))return a(t,n),!0;if((s||d)&&Rl(i==null?void 0:i.ltar)){for(const m of i.ltar)if(Sa(m.value)&&m.width&&m.height&&Pt({x:m.oldX,y:m.oldY,height:m.height,width:m.width},l)){if(r)return!0;const g=qt(m.value,((_=n.relatedTableMeta)==null?void 0:_.columns)||[]);return g&&c({isOpen:!0,row:{row:m.value,rowMeta:{},oldRow:{...m.value}},meta:n.relatedTableMeta||{},rowId:g,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!r}),!0}}return(s||d)&&Pt({x:v,y:h,width:y,height:b},l)?(a(t,n),!0):!1},handleHover:async t=>{const{row:n,column:o,mousePosition:l,getCellPosition:a,selected:i,t:s}=t;if(!i)return;const{tryShowTooltip:r,hideTooltip:d}=sl();d();const c=n.rowMeta.rowIndex,{x:f,y:v,width:h}=a(o,c),y={x:f+h-30,y:v+4,width:yi,height:yi};r({rect:y,mousePosition:l,text:s("tooltip.expandShiftSpace")})}},eC={render:(t,n)=>{var $,I,F,E,M,U,L;const{value:o,x:l,y:a,width:i,height:s,spriteLoader:r,mousePosition:d,row:c,column:f,relatedTableMeta:v,renderCell:h,readonly:y,setCursor:b,selected:_,cellRenderStore:m}=n,g=!!c[f.title],C=((F=(($=v==null?void 0:v.columns)==null?void 0:$.find(G=>G.pv))||((I=v==null?void 0:v.columns)==null?void 0:I[0]))==null?void 0:F.title)||"",w=((U=((E=v==null?void 0:v.columns)==null?void 0:E.find(G=>G.pv))||((M=v==null?void 0:v.columns)==null?void 0:M[0]))==null?void 0:U.id)||"",S=(L=v==null?void 0:v.columns)==null?void 0:L.find(G=>G.title===C);if(!S)return;let x;if(ua(o)){const G=i-(Pt({x:l,y:a,width:i,height:s},d)?16:0),ae=o&&!Array.isArray(o)&&typeof o=="object"?o[C]??o[w]:o;if(x=(xe=>gs.includes(S.uidt)?h(t,S,xe):Ir.render(t,xe))({...n,value:ae,column:S,width:G,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Wo[1],padding:10,textColor:lo.brand[500],tag:{renderAsTag:!0,tagBgColor:lo.brand[50],tagHeight:24},meta:v,x:l+4,y:a+(Wo[1]===s?0:2)}),!(x!=null&&x.x)||!(x!=null&&x.y))return;Object.assign(x,{width:x.x-l+4,height:x.y-(a+(Wo[1]===s?0:2))}),Object.assign(m,x),!y&&_&&Pt({x:l+4,y:a+(Wo[1]===s?0:2),height:m.height,width:m.width},d)&&b("pointer"),_&&!y&&(r.renderIcon(t,{x:x.x+2,y:a+(Wo[1]===s?8:10),icon:"ncXCircle",size:14,color:"#AFB3C2"}),Pt({x:x.x+2,y:a+(Wo[1]===s?8:10),height:14,width:14},d)&&b("pointer"))}return _&&!y&&(r.renderIcon(t,{x:l+i-27,y:a+7,icon:g?"maximize":"ncPlus",size:16,color:"#374151"}),Pt({x:l+i-27,y:a+7,height:16,width:16},d)&&b("pointer")),x},async handleClick({row:t,value:n,column:o,getCellPosition:l,mousePosition:a,makeCellEditable:i,cellRenderStore:s,selected:r,isPublic:d,readonly:c,isDoubleClick:f,openDetachedExpandedForm:v}){var S;if(!r&&!f)return!1;const h=t.rowMeta.rowIndex,{x:y,y:b,width:_,height:m}=l(o,h),g=16,C=Pt({x:y+_-27,y:b+7,height:g,width:g},a),w=(s==null?void 0:s.x)&&r&&Pt({x:s.x+2,y:b+8,height:g,width:g},a);if(C||w)return i(t,o),!0;if((r||f)&&Sa(n)&&(s!=null&&s.height)&&(s!=null&&s.width)&&Pt({x:y+4,y:b+(Wo[1]===m?0:2),height:s.height,width:s.width},a)){if(d)return!0;const x=qt(n,((S=o.relatedTableMeta)==null?void 0:S.columns)||[]);return x&&v({isOpen:!0,row:{row:n,rowMeta:{},oldRow:{...n}},meta:o.relatedTableMeta||{},rowId:x,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!d}),!0}return(r||f)&&!c&&Pt({x:y,y:b,width:_,height:m},a)?(i(t,o),!0):!1}},xu=t=>{if(vh(t))return Qk;if(Yo(t))return Zk;if(Qo(t))return Jk;if(Cl(t))return eC},tC={render:(t,n)=>{const o=xu(n.column);if(o)return o.render(t,n)},handleClick:async t=>{var a,i,s,r;let n=t;const o=(i=(a=n.column)==null?void 0:a.columnObj)==null?void 0:i.colOptions;if(o!=null&&o.fk_related_base_id&&o.fk_related_base_id!==o.base_id){const d=o==null?void 0:o.fk_related_base_id,{isUIAllowed:c}=gl(),f=(s=n.baseRoles)==null?void 0:s[d];if(!f){if(n.baseRoleLoader.isLoading(d))return;n.baseRoleLoader.loadBaseRole(d);return}n={...n,readonly:n.readonly||!c("dataEdit",f)}}const l=xu(n.column.columnObj);if(l)return(r=l==null?void 0:l.handleClick)==null?void 0:r.call(l,n)},handleKeyDown:async t=>{const{row:n,column:o,e:l,makeCellEditable:a}=t;return Cr(l)?(a(n,o),!0):!1},handleHover:async t=>{var o;const n=xu(t.column.columnObj);if(n)return(o=n==null?void 0:n.handleHover)==null?void 0:o.call(n,t)}};function ks(t){const n=jn(t.meta),o={uidt:n==null?void 0:n.display_type,...n==null?void 0:n.display_column_meta};return ph(o)?Uv:hh(o)?Yv:mh(o)?jv:gh(o)?qv:wh(o)?Jv:yh(o,"")?Gv:bh(o,"")?As:_h(o,"")?Hv:xh(o)?Wv:kh(o)?Xv:Ch(o)?Kv:vr}const nC={render:(t,n)=>{var C,w,S,x,$;const{column:o,x:l,y:a,padding:i,isPg:s,value:r,width:d,pv:c,height:f,textColor:v="#4a5268",mousePosition:h,setCursor:y,spriteLoader:b,selected:_}=n,m=jn(o.meta);if((C=jn(o.colOptions))!=null&&C.error){Jn(t,{text:"ERR!",x:l+i,y:a});return}if(m!=null&&m.display_type){ks(o).render(t,{...n,column:{...o,uidt:(m==null?void 0:m.display_type)||pe.LongText,...m.display_column_meta},readonly:!0,formula:!0});return}const g=s(o.source_id)?ys(rc(r)):ys(r);if(((S=(w=o==null?void 0:o.colOptions)==null?void 0:w.parsed_tree)==null?void 0:S.dataType)===nr.NUMERIC){Vv.render(t,{...n,value:g,formula:!0});return}if((($=(x=o==null?void 0:o.colOptions)==null?void 0:x.parsed_tree)==null?void 0:$.dataType)===nr.STRING){const I=sc(g),F=d-i*2;typeof I=="string"?(t.font=`${c?600:500} 13px Inter`,t.fillStyle=c?"#3366FF":v,uc(t,{htmlText:I,height:f,maxWidth:F,x:l+i,y:a+3,lineHeight:16}).find(U=>Pt(U,h))&&_&&y("pointer")):vr.render(t,{...n,value:g,formula:!0}),_&&na(t,{buttonX:l+d-28,buttonY:a+7,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:h,spriteLoader:b,icon:"maximize",background:"white",setCursor:y})}else vr.render(t,{...n,value:g,formula:!0})},handleClick:async t=>{var C,w,S,x,$,I,F;const{column:n,getCellPosition:o,value:l,openDetachedLongText:a,selected:i,isDoubleClick:s,mousePosition:r}=t;if(!i&&!s)return!1;const d=n.columnObj,c=jn(d.meta),f=((C=jn(d.colOptions))==null?void 0:C.error)??"",{x:v,y:h,width:y,height:b}=o(n,t.row.rowMeta.rowIndex),_=Ca(),{isPg:m}=_;if((c!=null&&c.display_type||!f)&&(w=ks(d))!=null&&w.handleClick)return ks(d).handleClick({...t,column:{...n,columnObj:{...d,uidt:c==null?void 0:c.display_type,...c.display_column_meta}},formula:!0});const g=m(n.columnObj.source_id)?ys(rc(t.value)):ys(t.value);if((($=(x=(S=n.columnObj)==null?void 0:S.colOptions)==null?void 0:x.parsed_tree)==null?void 0:$.dataType)===nr.STRING){const E=sc(g),M=10,U=y-M*2,L=n.pv;if(Pt({x:v+y-28,y:h+7,width:18,height:18},r))return a({column:d,vModel:l}),!0;if(typeof E=="string"){const G=Tl;G.font=`${L?600:500} 13px Inter`;const ve=uc(G,{htmlText:E,height:b,maxWidth:U,x:v+M,y:h+3,lineHeight:16}).find(xe=>Pt(xe,t.mousePosition));ve?Zs(ve.url,"_blank"):i&&a({column:d,vModel:l})}if(((I=t.event)==null?void 0:I.detail)===2)return a({column:d,vModel:l}),!0}return((F=t.event)==null?void 0:F.detail)===2?(Wc(),!0):!1},handleKeyDown:async t=>{var i,s;const{column:n,value:o,openDetachedLongText:l}=t,a=n.columnObj;if(t.e.key==="Enter"||t.e.key===" "&&t.e.shiftKey){if(!sa()&&((s=(i=a==null?void 0:a.colOptions)==null?void 0:i.parsed_tree)==null?void 0:s.dataType)===nr.STRING){l({column:a,vModel:o});return}return t.e.key===" "&&t.e.shiftKey?void 0:(Wc(),!0)}},async handleHover(t){var _,m,g,C,w;const{mousePosition:n,getCellPosition:o,column:l,row:a,selected:i,t:s}=t,r=l.columnObj,d=jn(r.meta),c=((_=jn(r.colOptions))==null?void 0:_.error)??"",{tryShowTooltip:f,hideTooltip:v}=sl();if(v(),d!=null&&d.display_type)return(g=(m=ks(r))==null?void 0:m.handleHover)==null?void 0:g.call(m,{...t,column:{...l,columnObj:{...r,uidt:(d==null?void 0:d.display_type)||pe.LongText,...d.display_column_meta}}});const{x:h,y,width:b}=o(l,a.rowMeta.rowIndex);i&&((w=(C=r==null?void 0:r.colOptions)==null?void 0:C.parsed_tree)==null?void 0:w.dataType)===nr.STRING&&f({rect:{x:h+b-28,y:y+7,width:18,height:18},mousePosition:n,text:s("tooltip.expandShiftSpace")}),f({rect:{x:h+10,y,height:25,width:45},mousePosition:n,text:c})}},Jc={render:(t,n)=>{var v;const{value:o,x:l,y:a,width:i,height:s,pv:r,padding:d,textColor:c="#4a5268"}=n,f=(o==null?void 0:o.toString())??"";if(!f)return{x:l,y:a};if((v=n.tag)!=null&&v.renderAsTag)return Sl(t,{...n,text:f});{const{x:h,y}=ml(t,{x:l+d,y:a,text:f,maxWidth:i-d*2,fontFamily:`${r?600:500} 13px Inter`,fillStyle:r?"#3366FF":c,height:s});return{x:h,y}}}},Qc={render:(t,n)=>{var y,b;const{column:o,sqlUis:l,x:a,y:i,width:s,height:r,padding:d,textColor:c="#d5d5d9"}=n,f=Rh(o,Gf(o,l))||o.uidt===pe.Formula&&((b=(y=o.colOptions)==null?void 0:y.parsed_tree)==null?void 0:b.dataType)===nr.NUMERIC,{x:v,y:h}=Jn(t,{x:f?a+s-d:a+d,y:i,textAlign:f?"right":"left",text:"NULL",maxWidth:s-d*2,fontFamily:"500 13px Inter",fillStyle:c,height:r});return{x:v,y:h}}},ku=1e3;function oC(t){const n=fn(zl,V(!1)),{t:o}=oa(),{metas:l}=oi(),{user:a}=nl(),i=ki({});yo(Fh,i);const{isColumnSortedOrFiltered:s,appearanceConfig:r}=tu(),{isRowColouringEnabled:d}=ld(),c=Ca(),{showNull:f,appInfo:v}=nl(),{isMysql:h,isXcdbBase:y,isPg:b}=c,{sqlUis:_}=Go(c),{basesUser:m,baseRoles:g}=Go(Es()),{open:C}=$m(),{open:w}=Tm(),S=le(()=>{var ne,he,W;return(he=(ne=t.meta)==null?void 0:ne.value)!=null&&he.base_id?m.value.get((W=t.meta)==null?void 0:W.value.base_id)||[]:[]}),x=t.actionManager,$=t.makeCellEditable,I=t.setCursor,F=new Map,E=new Map,M=new Map;M.set(pe.Email,Wv),M.set(pe.SingleLineText,vr),M.set(pe.LongText,Mk),M.set(pe.Number,Vv),M.set(pe.Decimal,jv),M.set(pe.Attachment,$k),M.set(pe.Checkbox,Uv),M.set(pe.Date,Gv),M.set(pe.DateTime,As),M.set(pe.Year,Ok),M.set(pe.Time,Hv),M.set(pe.Currency,Yv),M.set(pe.Percent,qv),M.set(pe.URL,Xv),M.set(pe.GeoData,Dk),M.set(pe.PhoneNumber,Kv),M.set(pe.Duration,Lk),M.set(pe.CreatedTime,As),M.set(pe.LastModifiedTime,As),M.set(pe.JSON,Nk),M.set(pe.Barcode,Pk),M.set(pe.QrCode,Bk),M.set(pe.Rating,Jv),M.set(pe.User,bu),M.set(pe.CreatedBy,bu),M.set(pe.LastModifiedBy,bu),M.set(pe.SingleSelect,jk),M.set(pe.MultiSelect,zu),M.set(pe.Rollup,Gk),M.set(pe.Links,Hk),M.set(pe.Lookup,Yk),M.set(pe.Button,Kk),M.set(pe.LinkToAnotherRecord,tC),M.set(pe.Formula,nC),M.set(pe.Geometry,vr),M.set(pe.SpecificDBType,vr),M.set(pe.ForeignKey,Jc),M.set(pe.ID,Jc);const U=ne=>(F.has(ne)||F.set(ne,{}),E.set(ne,Date.now()+ku),F.get(ne)),L=(ne,he,{value:W,row:j,x:Ee,y:Ye,width:Ge,height:ke,selected:Y=!1,pv:we=!1,readonly:oe=!1,spriteLoader:ye,imageLoader:ie,tableMetaLoader:H,padding:Ae=10,relatedColObj:Ie,relatedTableMeta:ce,tag:te={},fontSize:Le=13,textAlign:Ne="center",textColor:lt,disabled:je,mousePosition:He,pk:Q,meta:Mt=(gt=>(gt=t.meta)==null?void 0:gt.value)(),skipRender:_e=!1,renderAsPlainCell:wn=!1,isUnderLookup:It=!1,path:Tt=[],fontFamily:Je,isRowHovered:cn=!1,isRowChecked:Pn=!1,isCellInSelectionRange:Et=!1,isGroupHeader:Rn=!1,rowMeta:mt={},isRootCell:ot=!1})=>{var un;if(_e)return;if(!Rn){const bt=s(he.id);if(!d.value&&bt!==void 0&&!(mt!=null&&mt.isValidationFailed)){let xt="cellBgColor",ct="cellBorderColor";Y||Pn||Et?(xt="cellBgColor.selected",ct="cellBorderColor.selected"):cn&&(xt="cellBgColor.hovered",ct="cellBorderColor.hovered"),qo(ne,Ee,Ye,Ge,ke,0,{backgroundColor:r[bt][xt],borderColor:r[bt][ct],borderWidth:.4,borders:{top:mt.rowIndex!==0,right:!0,bottom:!0,left:!0}})}else if(!(mt!=null&&mt.isValidationFailed)&&ot){const xt=mt!=null&&mt.is_set_as_background&&(Y||cn||Pn||Et)?mt==null?void 0:mt.rowHoverColor:mt==null?void 0:mt.rowBgColor;xt&&qo(ne,Ee,Ye,Ge,ke,0,{backgroundColor:xt,borderColor:lo.gray[200],borderWidth:.4,borders:{top:mt.rowIndex!==0,right:!0,bottom:!0,left:!0}})}}const zt=M.get(he.uidt);if(x!=null&&x.isLoading(Q,he.id)&&!_a(he)&&!Pf(he)){const bt=x==null?void 0:x.getLoadingStartTime(Q,he.id);if(bt){td(ne,Ee+Ge/2,Ye+8,16,"#3366FF",bt,1.5);return}}const Ht=U(`${he.id}-${Q}`);ne.textAlign="left";let Yt;const Xt=f.value&&Ih(he)&&(Si(W)||eu(W));return wn?Yt=Ir.render:zt?Xt?zt.renderEmpty?Yt=zt.renderEmpty:Yt=Qc.render:Yt=zt.render:Xt&&(Yt=Qc.render),Yt?Yt(ne,{value:W,row:j,column:he,x:Ee,y:Ye,width:Ge,height:ke,selected:Y,pv:we,readonly:oe||!t.hasEditPermission.value,spriteLoader:ye,imageLoader:ie,actionManager:x,tableMetaLoader:H,isMysql:h,isPg:b,isXcdbBase:y,t:o,padding:Ae,relatedColObj:Ie,relatedTableMeta:ce,renderCell:L,meta:Mt,metas:l.value,tag:te,fontSize:Le,textAlign:Ne,mousePosition:He,textColor:lt,pk:Q,disabled:je,sqlUis:_.value,setCursor:I,cellRenderStore:Ht,baseUsers:S.value,user:a.value,isUnderLookup:It,isPublic:n.value,path:Tt,fontFamily:Je,isRowHovered:cn,isRowChecked:Pn,rowMeta:mt,allowLocalUrl:(un=v.value)==null?void 0:un.allowLocalUrl}):Jn(ne,{x:Ee+Ae,y:Ye,text:(W==null?void 0:W.toString())??"",fontFamily:`${we?600:500} 13px Inter`,fillStyle:we?"#3366FF":lt,height:ke,py:Ae})},G=async ne=>{var j,Ee,Ye;if(!((Ee=(j=ne.column)==null?void 0:j.columnObj)!=null&&Ee.uidt))return;const he=M.get(ne.column.columnObj.uidt),W=U(`${ne.column.id}-${ne.pk}`);return i.keyboardKey="",i.event=void 0,he!=null&&he.handleClick?await he.handleClick({...ne,cellRenderStore:W,isDoubleClick:ne.event.detail===2,getCellPosition:(...Ge)=>{var ke;return(ke=t==null?void 0:t.getCellPosition)==null?void 0:ke.call(t,...Ge,ne.path)},readonly:!t.hasEditPermission.value,updateOrSaveRow:t==null?void 0:t.updateOrSaveRow,actionManager:x,makeCellEditable:(Ge,ke,Y=ne.event.detail===2)=>$(Ge,ke,Y),isPublic:n.value,openDetachedExpandedForm:C,openDetachedLongText:w,path:ne.path??[],allowLocalUrl:(Ye=v.value)==null?void 0:Ye.allowLocalUrl,baseRoles:g.value,t:o}):!1},ae=async ne=>{var j;const he=M.get(ne.column.columnObj.uidt),W=U(`${ne.column.id}-${ne.pk}`);return i.keyboardKey=ne.e.key,i.event=ne.e,he!=null&&he.handleKeyDown?await he.handleKeyDown({...ne,cellRenderStore:W,readonly:!t.hasEditPermission.value,updateOrSaveRow:t==null?void 0:t.updateOrSaveRow,actionManager:x,makeCellEditable:$,openDetachedLongText:w,allowLocalUrl:(j=v.value)==null?void 0:j.allowLocalUrl,path:ne.path??[],t:o}):(console.log("No handler found for cell type",ne.column.columnObj.uidt),!1)},ve=async ne=>{var j,Ee;if(!((Ee=(j=ne.column)==null?void 0:j.columnObj)!=null&&Ee.uidt))return;const he=M.get(ne.column.columnObj.uidt),W=U(`${ne.column.id}-${ne.pk}`);if(i.keyboardKey="",he!=null&&he.handleHover)return await he.handleHover({...ne,cellRenderStore:W,getCellPosition:(...Ye)=>{var Ge;return(Ge=t==null?void 0:t.getCellPosition)==null?void 0:Ge.call(t,...Ye,ne.path)},updateOrSaveRow:t==null?void 0:t.updateOrSaveRow,actionManager:x,makeCellEditable:$,setCursor:I,path:ne.path??[],baseUsers:S.value,t:o})};let xe=null;return ti(()=>{xe=Sh(()=>{const ne=Date.now();for(const[he,W]of E.entries())ne>=W&&(F.delete(he),E.delete(he))},ku)}),Ku(()=>{xe&&clearInterval(xe)}),{cellTypesRegistry:M,renderCell:L,handleCellClick:G,handleCellKeyDown:ae,handleCellHover:ve}}class lC{constructor(n,o){vo(this,"loadingCache",new Map);this.getMeta=n,this.onSettled=o}async getTableMeta(n){var o;if(!this.loadingCache.get(n)){this.loadingCache.set(n,n);try{await this.getMeta(n,void 0,void 0,void 0,!0),(o=this.onSettled)==null||o.call(this)}finally{this.loadingCache.delete(n)}}}isLoading(n){return this.loadingCache.has(n)}clearCaches(){this.loadingCache.clear()}}var Lo=(t=>(t.ROW="ROW",t.GROUP="GROUP",t.ADD_NEW_ROW="ADD_NEW_ROW",t.EDIT_NEW_ROW_METHOD="EDIT_NEW_ROW_METHOD",t))(Lo||{});class Zc{constructor({groupPath:n,rowIndex:o,...l}){vo(this,"x");vo(this,"y");vo(this,"height");vo(this,"width");vo(this,"type");vo(this,"row");vo(this,"group");vo(this,"level");vo(this,"_groupPath");vo(this,"_rowIndex");Object.assign(this,l),this._groupPath=n,this._rowIndex=o}get isGroup(){return this.type==="GROUP"}get isRow(){return this.type==="ROW"}get isAddNewRow(){return this.type==="ADD_NEW_ROW"}get rowIndex(){var n,o;return this._rowIndex??((o=(n=this.row)==null?void 0:n.rowMeta)==null?void 0:o.rowIndex)}get groupPath(){var n,o;return this._groupPath??((o=(n=this.row)==null?void 0:n.rowMeta)==null?void 0:o.path)??[]}}class Qv{constructor(n=[]){vo(this,"elements");this.elements=n}findElementAt(n,o,l){const a=this.elements.filter(i=>{const s=o>=i.y&&o<=i.y+i.height,r=!l||(Array.isArray(l)?l.includes(i.type):i.type===l);return s&&r}).sort((i,s)=>(s.level||0)-(i.level||0));return a[0]?new Zc(a[0]):null}findElementAtWithX(n,o,l){const a=this.elements.filter(i=>{const s=o>=i.y&&o<=i.y+i.height,r=i.width!==void 0&&i.width!==null?n>=i.x&&n<=i.x+i.width:!0,d=!l||i.type===l;return s&&r&&d}).sort((i,s)=>(s.level||0)-(i.level||0));return a[0]?new Zc(a[0]):null}addElement(n){this.elements.push(n)}clear(){this.elements=[]}}function aC(t,n){if(t=t+1,n===1)return{border:"#E7E7E9",background:"#FFF",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}};if(n===2)switch(t){case 2:return{background:"#FFF",border:"#E7E7E9",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}};case 1:return{background:"#F9F9FA",border:"#d5d5d9",aggregation:{hover:"#F4F4F5",default:"#F9F9FA",border:"#E7E7E8"}}}if(n===3)switch(t){case 3:return{background:"#FFF",border:"#E7E7E9",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}};case 2:return{background:"#F9F9FA",border:"#d5d5d9",aggregation:{hover:"#F4F4F5",default:"#F9F9FA",border:"#E7E7E8"}};case 1:return{background:"#F4F4F5",border:"#9AA2AF",aggregation:{hover:"#E7E7E8",default:"#F4F4F5",border:"#E7E7E9"}}}return{background:"#FFF",border:"#E7E7E9",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}}}function mr(t,n,o){let l=$o+ni;if(t!=null&&t.isExpanded){if(t.path)l+=(t.count||0)*n,o&&(l+=Ao),l+=1;else if(t!=null&&t.groupCount){l+=aa;for(let a=0;a<(t==null?void 0:t.groupCount);a++){const i=t.groups.get(a);if(!i){l+=$o+ni;continue}l+=mr(i,n,o)}}}return l}function ef(t,n,o,l,a,i=!1,s){let r=ni,d=0,c=l-1,f=r;for(let h=0;h<l;h++){const y=t.get(h),b=mr(y,o,s);if(r+b>=n){d=h;const _=Ao-(n-r),m=n+a+$o+ni;for(let g=h;g<l;g++){const C=t.get(g),w=mr(C,o,s);if(r+w>m){c=g;break}r+=w,c=g}return{startIndex:d,endIndex:c,startGroupYOffset:_}}f=r,r+=b,d=h+1}const v=n-f;return{startIndex:d,endIndex:c,startGroupYOffset:v}}function ga(t){if(!t)return[];const n=[];return t.nestedIn&&t.nestedIn.length>0&&t.nestedIn.forEach(o=>n.push(o.groupIndex)),n}function Al(t,n){return!Rl(t)||!Rl(n)?(console.error("Path is not an array",t,n),!1):(Rl(t)?t:[]).join()===(Rl(n)?n:[]).join()}function pr(t,n,o,l,a){var r;let i=ni,s=t;if(!n||n.length===0)return o*l;for(let d=0;d<n.length;d++){const c=n[d],f=s.get(c);if(!f)return i;for(let v=0;v<c;v++){const h=s.get(v);h&&(i+=mr(h,l,a))}if(!f.isExpanded)return i;if(i+=$o,(r=f.path)!=null&&r.length&&d===n.length-1)return i+=o*l+1,i;if(f.groups)i+=aa,s=f.groups;else return i}return i}function iC(t){function n(o,l=[]){for(const[a,i]of o)if(i){if(i.isExpanded&&i.path)return{group:i,index:a,path:[...l,a]};if(i.isExpanded&&i.groups){const s=n(i.groups,[...l,a]);if(s.group!==null)return s}}return{group:null,index:-1,path:[]}}return n(t)}function xa(t,n){if(!n||n.length===0)return null;let o=t,l=null;for(let a=0;a<n.length;a++){const i=n[a];if(l=o.get(i),!l)return null;if(a===n.length-1)return l;if(!l.isExpanded||!l.groups)return null;o=l.groups}return l}function rC(t,n){const o=xa(t,n);return!!(o!=null&&o.isExpanded)}function es(t){return t?t.nestedIn.reduce((n,o)=>(o.key!=="__nc_null__"&&!hl(o.column_uidt)&&![pe.Rollup,pe.Lookup,pe.Formula,pe.Barcode,pe.QrCode].includes(o.column_uidt)&&(n[o.title]=o.key,o.column_uidt===pe.Checkbox&&(n[o.title]=n[o.title]===kl.TRUE?!0:n[o.title]===kl.FALSE?!1:!!n[o.title])),n),{}):{}}function tf(t){const n=t.nestedIn.map(l=>`${l.key}-${l.column_name}`).join("_")||"default";return`${typeof t.value=="object"&&t.value!==null?JSON.stringify(t.value):String(t.value)}__${n}`}class sC{constructor(n,o){vo(this,"loadingCache",new Map);this.getBaseRole=n,this.onSettled=o}async loadBaseRole(n){var o;if(!this.loadingCache.has(n)){this.loadingCache.set(n,n);try{await this.getBaseRole(n),(o=this.onSettled)==null||o.call(this)}finally{this.loadingCache.delete(n)}}}isLoading(n){return this.loadingCache.has(n)}clearCaches(){this.loadingCache.clear()}}const uC=100,dC=100,Ba=50,nf=100,of=50,cC=500;function fC({chunkStates:t,cachedRows:n,clearCache:o,loadData:l,rowSlice:a,totalRows:i,triggerRefreshCanvas:s,isAlreadyShownUpgradeModal:r,isExternalSource:d}){const{blockExternalSourceRecordVisibility:c,showUpgradeToSeeMoreRecordsModal:f}=ql(),v=V({start:a.value.start,end:a.value.end});let h;Ga(()=>{clearTimeout(h)});const y=async(w,S=!1)=>{if(t.value[w])return;const x=w*Ba,$=S?dC:Ba;if(!(x>=i.value)){if(!r.value&&x>=ll&&c(d.value)){r.value=!0,h&&clearTimeout(h),h=setTimeout(()=>{f({isExternalSource:d.value}),clearTimeout(h)},1e3);return}t.value[w]="loading",S&&(t.value[w+1]="loading");try{(await l({offset:x,limit:$},void 0,[])).forEach(F=>n.value.set(F.rowMeta.rowIndex,F)),t.value[w]="loaded",S&&(t.value[w+1]="loaded")}catch(I){console.error(`Error fetching chunk ${w}:`,I),t.value[w]=void 0,S&&(t.value[w+1]=void 0)}}},b=async w=>{if(w.length===0)return;const S=w[0],x=w[w.length-1],$=S*Ba,I=(x+1)*Ba-$;if(!($>=i.value)){w.forEach(F=>t.value[F]="loading");try{(await l({offset:$,limit:I},void 0,[])).forEach(E=>n.value.set(E.rowMeta.rowIndex,E)),w.forEach(E=>t.value[E]="loaded")}catch(F){console.error(`Error fetching chunks group from ${S} to ${x}:`,F),w.forEach(E=>t.value[E]=void 0)}}},_=Qu(async(w,S)=>{if(w.size>0){const x=Array.from(w).sort((E,M)=>E-M),$=[];let I=[x[0]];for(let E=1;E<x.length;E++)x[E]===x[E-1]+1?I.push(x[E]):($.push(I),I=[x[E]]);$.push(I);const F=Math.floor(uC/Ba);for(const E of $)if(E[0]===0&&S===0&&!t.value[0]){await y(0,!0);const M=E.filter(U=>U>1);if(M.length)for(let U=0;U<M.length;U+=F){const L=M.slice(U,U+F);await b(L)}}else if(E.length>F)for(let M=0;M<E.length;M+=F){const U=E.slice(M,M+F);await b(U)}else await b(E)}tl(s)},cC,!0),m=()=>{const{start:w,end:S}=a.value,x=Math.floor(w/Ba),$=Math.floor((S-1)/Ba);let I="none";w>v.value.start?I="down":w<v.value.start&&(I="up"),v.value={start:w,end:S};const F=new Set;for(let E=x;E<=$;E++)t.value[E]||F.add(E);if(I==="down"||I==="none"){const E=$+1;S%Ba>Ba-of&&!t.value[E]&&F.add(E)}else if(I==="up"){const E=x-1;E>=0&&w%Ba<of&&!t.value[E]&&F.add(E)}tl(s),o(Math.max(0,w-nf),Math.min(i.value,S+nf)),_(F,x)},g=V(null);return{fetchChunk:y,updateVisibleRows:()=>{g.value&&cancelAnimationFrame(g.value),g.value=requestAnimationFrame(()=>{m(),g.value=null})}}}function vC({width:t,height:n,columns:o,colSlice:l,cachedGroups:a,scrollLeft:i,scrollTop:s,rowSlice:r,rowHeight:d,activeCell:c,dragOver:f,hoverRow:v,selection:h,isAiFillMode:y,isFillMode:b,getFillHandlerPosition:_,spriteLoader:m,imageLoader:g,tableMetaLoader:C,partialRowHeight:w,vSelectedAllRecords:S,isRowDraggingEnabled:x,isAddingColumnAllowed:$,isAddingEmptyRowAllowed:I,isAddingEmptyRowPermitted:F,selectedRows:E,isDragging:M,draggedRowIndex:U,targetRowIndex:L,mousePosition:G,renderCell:ae,meta:ve,editEnabled:xe,totalWidth:ne,totalRows:he,actualTotalRows:W,t:j,readOnly:Ee,isFieldEditAllowed:Ye,setCursor:Ge,totalColumnsWidth:ke,groupByColumns:Y,totalGroups:we,isGroupBy:oe,baseColor:ye,fetchMissingGroupChunks:ie,elementMap:H,getDataCache:Ae,getRows:Ie,draggedRowGroupPath:ce,removeInlineAddRecord:te,upgradeModalInlineState:Le,rowMetaColumnWidth:Ne,rowColouringBorderWidth:lt}){const je=V(),He=V(new Set),{tryShowTooltip:Q}=sl(),{isMobileMode:Mt,isAddNewRecordGridMode:_e,appInfo:wn}=nl(),{isWsOwner:It}=ql(),{isColumnSortedOrFiltered:Tt,appearanceConfig:Je}=tu(),cn=fn(Hi,V(!1)),{isRowColouringEnabled:Pn}=ld(),Et=le(()=>o.value.filter(u=>u.fixed)),Rn=le(()=>Et.value.reduce((u,R)=>u+hn(R.width),1)),mt=(u,R,P,D,fe)=>{u.save(),D=Math.min(D,fe%2===0?124:144)-24,u.beginPath(),u.roundRect(R+12,P+7.5,D,16,10),u.fillStyle="#E7E7E9",u.fill(),u.clip(),u.restore()};function ot(u,R){var Me,We,Xe,nt,et,ut,Ke,Qe,ht,Vt,Pe,Se,$t,be,ze,wt;const P=t.value;u.textAlign="left";const D=or,fe=ke.value+(!$.value&&oe.value?((Me=Y==null?void 0:Y.value)==null?void 0:Me.length)*13+(((We=Y==null?void 0:Y.value)==null?void 0:We.length)-1)*13:0)+($.value&&!Mt.value?D:0)-i.value;u.fillStyle="#f4f4f5",u.fillRect(0,0,fe,32),u.strokeStyle="#e7e7e9",u.lineWidth=1,u.beginPath(),u.moveTo(0,32),u.lineTo(fe,32),u.stroke();const{start:K,end:O}=l.value,Z=o.value.slice(K,O);let ge=1;for(let q=0;q<K;q++)ge+=hn((Xe=o.value[q])==null?void 0:Xe.width);ge===1&&(ge=0),u.fillStyle="#6a7184",u.font="550 12px Inter",u.textBaseline="middle",u.imageSmoothingEnabled=!1;let ee=ge;for(const q of Z){const Fe=q.columnObj,vt=q.id===((et=(nt=o.value)==null?void 0:nt[o.value.length-1])==null?void 0:et.id),Re=hn(q.width)+(vt&&!$.value&&oe.value?(((ut=Y.value)==null?void 0:ut.length)-1)*13-1:0);if(q.fixed){ee+=Re,u.beginPath(),u.moveTo(ee-i.value,0),u.lineTo(ee-i.value,32),u.stroke();continue}if(Fe!=null&&Fe.id){const so=Tt(Fe.id,!0);so&&(wa(u,{height:31.5,width:Re,x:ee-i.value,y:0,radius:0,fillStyle:"#ffffff88"}),wa(u,{height:32,width:Re,x:ee-i.value,y:0,radius:0,fillStyle:Je[so].headerBgColor}))}u.fillStyle="#6a7184";const yt=8;let _t=yt;_t+=16,(Ke=q.isInvalidColumn)!=null&&Ke.isInvalid&&!((Qe=q.isInvalidColumn)!=null&&Qe.ignoreTooltip)&&(_t+=18),(Vt=(ht=q==null?void 0:q.columnObj)==null?void 0:ht.description)!=null&&Vt.length&&(_t+=18);const Ze=q!=null&&q.virtual?dc(q.columnObj,q.relatedColObj):cc(q.columnObj,q.abstractType);q.uidt&&m.renderIcon(u,{icon:q!=null&&q.virtual?Ze==null?void 0:Ze.icon:Ze,size:13,color:(Ze==null?void 0:Ze.hex)??"#6a7184",x:ee+8-i.value,y:8});const on=q.virtual?fc(Fe,((Pe=ve.value)==null?void 0:Pe.columns)||[]):(Fe==null?void 0:Fe.rqd)&&!(Fe!=null&&Fe.cdf),Kt=Re-(26+_t+(on?4:0)),nn=Hl(u,q.title,Kt);u.fillText(nn,ee+26-i.value,16),on&&(u.save(),u.fillStyle="#EF4444",u.fillText("*",ee+28-i.value+u.measureText(nn).width,16),u.restore());let pt=ee+Re-yt;Ye.value&&!(Fe!=null&&Fe.readonly)?(pt-=16,m.renderIcon(u,{icon:"chevronDown",size:14,color:"#6a7184",x:pt-i.value,y:9})):(Se=ve.value)!=null&&Se.synced&&(Fe!=null&&Fe.readonly)&&(pt-=16,m.renderIcon(u,{icon:"ncZap",size:14,color:"#6a7184",x:pt-i.value,y:9})),($t=q.isInvalidColumn)!=null&&$t.isInvalid&&!((be=q.isInvalidColumn)!=null&&be.ignoreTooltip)&&(pt-=18,m.renderIcon(u,{icon:"alertTriangle",size:14,color:"#FF928C",x:pt-i.value,y:9})),(wt=(ze=q==null?void 0:q.columnObj)==null?void 0:ze.description)!=null&&wt.length&&(pt-=18,m.renderIcon(u,{icon:"ncInfo",size:13,color:"#6B7280",x:pt-i.value,y:9})),ee+=Re,G&&Math.abs(ee-i.value-G.x)<=10&&G.y<=32&&!cn.value?(He.value.add(q.id),u.strokeStyle="#9CDAFA",u.lineWidth=2,u.beginPath(),u.moveTo(ee-i.value,0),u.lineTo(ee-i.value,32),u.stroke(),u.strokeStyle="#e7e7e9",u.lineWidth=1):(He.value.delete(q.id),u.beginPath(),u.moveTo(ee-i.value,0),u.lineTo(ee-i.value,32),u.stroke())}if($.value&&!Mt.value&&(u.fillStyle="#F9F9FA",u.fillRect(ee-i.value,0,D,32),m.renderIcon(u,{icon:"ncPlus",size:16,color:"#6a7184",x:ee+D/2-8-i.value,y:8}),u.beginPath(),u.moveTo(ee+D-i.value,0),u.lineTo(ee+D-i.value,32),u.stroke(),u.beginPath(),u.moveTo(ee-i.value,32),u.lineTo(ee+D-i.value,32),u.stroke()),!oe.value){const q=_();if(R&&ee-i.value>=R.x&&ee-i.value<=R.x+R.width||q&&ee-i.value+1>=q.x&&ee-i.value-1<=q.x)if(u.strokeStyle="#f4f4f5",q&&(R!=null&&R.y)&&(u.beginPath(),u.moveTo(ee-i.value,32),u.lineTo(ee-i.value,R.y),u.stroke()),q){if(!b.value&&!h.value.isSingleCell()){if(u.beginPath(),h.value.start.col!==h.value.end.col)u.moveTo(ee-i.value,R?R.y:32);else{let Fe=R?R.y+R.height:32;Fe===q.y&&(Fe-=q.size/2),u.moveTo(ee-i.value,Fe)}u.lineTo(ee-i.value,q.y-q.size/2),u.stroke()}u.beginPath(),u.moveTo(ee-i.value,q.y+q.size/2),u.lineTo(ee-i.value,(r.value.end-r.value.start+1)*d.value+32),u.stroke()}else R!=null&&R.y&&(R!=null&&R.height)&&(u.beginPath(),u.moveTo(ee-i.value,R.y+R.height),u.lineTo(ee-i.value,(r.value.end-r.value.start+1)*d.value+32),u.stroke());else if(Z.filter(Fe=>!Fe.fixed).length){const Fe=Math.max(Rn.value,ee-i.value);u.strokeStyle="#f4f4f5",u.beginPath(),u.moveTo(Fe,32),u.lineTo(Fe,(r.value.end-r.value.start+1)*d.value+33-w.value),u.stroke()}}Et.value.length&&(ee=.5,Et.value.forEach(q=>{var Sn,yn,kn,jt,an,rn,En,Yn,ao,Zn,So;const Fe=hn(q.width),vt=8;let Re=vt;const yt=q.columnObj;if(Re+=16,(Sn=q.isInvalidColumn)!=null&&Sn.isInvalid&&!((yn=q.isInvalidColumn)!=null&&yn.ignoreTooltip)&&(Re+=18),(jt=(kn=q==null?void 0:q.columnObj)==null?void 0:kn.description)!=null&&jt.length&&(Re+=18),u.fillStyle="#f4f4f5",u.fillRect(ee,0,Fe,32),(an=q.columnObj)!=null&&an.id){const To=Tt(q.columnObj.id,!0);To&&(wa(u,{height:31.5,width:Fe,x:ee,y:0,radius:0,fillStyle:"#ffffff88"}),wa(u,{height:32,width:Fe,x:ee,y:0,radius:0,fillStyle:Je[To].headerBgColor}))}u.fillStyle="#6a7184";const _t=q!=null&&q.virtual?dc(q.columnObj,q.relatedColObj):cc(q.columnObj,q.abstractType);q.uidt&&m.renderIcon(u,{icon:q!=null&&q.virtual?_t==null?void 0:_t.icon:_t,size:13,color:(_t==null?void 0:_t.hex)??"#6a7184",x:ee+8,y:8});const Ze=q.virtual?fc(yt,((rn=ve.value)==null?void 0:rn.columns)||[]):(yt==null?void 0:yt.rqd)&&!(yt!=null&&yt.cdf),on=Fe-(26+Re+(Ze?4:0)),Kt=Hl(u,q.title,on),nn=ee+(q.uidt?26:10),pt=16;if(q.id==="row_number")if(!Ee.value&&(S.value||Pt({x:0,y:0,width:P,height:32},G))&&!oe.value){const Ue=nn+(x.value?20:0),Mo=Pt({x:Ue,y:pt-8,width:16,height:16},G);vc(u,Ue,pt-8,S.value,!1,m,Mo?"#3366FF":"#D9D9D9")}else u.fillText(Kt,nn,pt);else u.fillText(Kt,nn,pt),Ze&&(u.save(),u.fillStyle="#EF4444",u.fillText("*",ee+28+u.measureText(Kt).width,16),u.restore());let mn=ee+Fe-vt;q.uidt&&Ye.value&&!(yt!=null&&yt.readonly)?(mn-=16,m.renderIcon(u,{icon:"chevronDown",size:14,color:"#6a7184",x:mn,y:9})):(En=ve.value)!=null&&En.synced&&(yt!=null&&yt.readonly)&&(mn-=16,m.renderIcon(u,{icon:"ncZap",size:14,color:"#6a7184",x:mn,y:9})),(Yn=q.isInvalidColumn)!=null&&Yn.isInvalid&&!((ao=q.isInvalidColumn)!=null&&ao.ignoreTooltip)&&(mn-=18,m.renderIcon(u,{icon:"alertTriangle",size:14,color:"#FF928C",x:mn,y:9})),(So=(Zn=q==null?void 0:q.columnObj)==null?void 0:Zn.description)!=null&&So.length&&(mn-=18,m.renderIcon(u,{icon:"ncInfo",size:13,color:"#6B7280",x:mn,y:9})),ee+=Fe;const so=G&&Math.abs(ee-G.x)<=10&&G.y<=32;q.id==="row_number"&&(u.strokeStyle="#e7e7e9",u.lineWidth=2,u.beginPath(),u.moveTo(ee,0),u.lineTo(ee,32),u.stroke()),so&&q.id!=="row_number"&&!cn.value?(He.value.add(q.id),u.strokeStyle="#9CDAFA",u.lineWidth=2,u.beginPath(),u.moveTo(ee,0),u.lineTo(ee,32),u.stroke(),u.strokeStyle="#e7e7e9",u.lineWidth=1):He.value.delete(q.id)}),i.value?(u.strokeStyle="#D5D5D9",u.beginPath(),u.lineWidth=1,u.moveTo(ee,0),u.lineTo(ee,oe.value?n.value:32),u.stroke(),u.fillStyle="rgba(0, 0, 0, 0.04)",u.rect(ee,0,4,oe.value?n.value:32),u.fill()):(u.strokeStyle="#E7E7E9",u.beginPath(),u.lineWidth=1,u.moveTo(ee,0),u.lineTo(ee,oe.value?n.value:32),u.stroke()),u.shadowColor="transparent",u.shadowBlur=0,u.shadowOffsetX=0,u.shadowOffsetY=0)}const gt=(u,R)=>{var K,O;if(!R)return;const P=o.value.filter(Z=>Z.fixed).reduce((Z,ge)=>Z+hn(ge.width),0),D=R.x<=P;let fe="#3366ff";if(!R.col.isCellEditable){fe="#9AA2AF";const Z={x:R.x,y:R.y,height:R.height,width:R.width};Pt(Z,G)&&R.col.id!==((O=(K=xe.value)==null?void 0:K.column)==null?void 0:O.id)&&Q({mousePosition:G,text:j("objects.permissions.editFieldTooltipTitle"),description:j("objects.permissions.editFieldTooltip"),rect:{...Z},placement:"bottom"})}if(R.col.fixed||!D){qo(u,R.x,R.y,R.width,R.height,2,{borderColor:fe,borderWidth:2}),u.lineWidth=1;return}if(D){if(R.x+R.width<=P)return;const Z={...R,x:P,width:R.width-(P-R.x)};qo(u,Z.x+1,Z.y,Z.width,Z.height,2,{borderColor:fe,borderWidth:2}),u.lineWidth=1}},zt=u=>{var P,D;let R=0;for(let fe=0;fe<u;fe++)R+=hn((P=o.value[fe])==null?void 0:P.width);return R+((D=o.value[u])!=null&&D.fixed?0:1)},Ht=(u,R)=>{var K;let P=0,D=!1,fe=!1;for(let O=u;O<=R;O++)P+=hn((K=o.value[O])==null?void 0:K.width),D=D||!o.value[O].fixed,fe=fe||o.value[O].fixed;return P+(D&&fe?1:0)},Yt=u=>{const R=_(),P=c==null?void 0:c.value.path;if(!R)return!0;let D=0;for(const O of o.value)O.fixed&&(D+=hn(O.width));if(R.x<=D&&!R.fixedCol)return!1;if(b.value){const O=pr(a.value,P,h.value.start.row,d.value,I.value)-s.value+Ao;u.setLineDash([2,2]),u.strokeStyle=y.value?"#9751d7":"#3366ff",u.strokeRect(zt(h.value.start.col)-i.value,O,Ht(h.value.start.col,h.value.end.col),(h.value.end.row-h.value.start.row+1)*d.value),u.setLineDash([])}return u.fillStyle=y.value?"#9751d7":"#ff4a3f",u.beginPath(),u.arc(R.x+(R.fixedCol?0:1),R.y,R.size/2,0,Math.PI*2),u.fill(),G&&G.x>=R.x-R.size/2&&G.x<=R.x+R.size/2&&G.y>=R.y-R.size/2&&G.y<=R.y+R.size/2&&Ge("crosshair"),!0},Xt=(u,R,{xOffset:P,yOffset:D,width:fe},K)=>{var Xe,nt,et,ut,Ke,Qe;const O=((Xe=v.value)==null?void 0:Xe.rowIndex)===R.rowMeta.rowIndex&&Al((nt=v.value)==null?void 0:nt.path,(et=R==null?void 0:R.rowMeta)==null?void 0:et.path),Z=((ut=R.rowMeta)==null?void 0:ut.selected)||S.value,ge=c.value.row===R.rowMeta.rowIndex&&Al(c.value.path,(Ke=R==null?void 0:R.rowMeta)==null?void 0:Ke.path),ee=!R.rowMeta.selected&&E.value.length>=Wu||S.value;K?u.fillStyle=K:(u.fillStyle=O||ge?"#F9F9FA":"#ffffff",R.rowMeta.selected&&(u.fillStyle="#F6F7FE")),u.fillRect(P,D,fe,d.value);let Me=P+4;const We=lt.value?lt.value+4:0;if(Ee.value||!(O||Z||ge)){let ht="13px";R.rowMeta.rowIndex+1>=1e3&&(ht="12px"),R.rowMeta.rowIndex+1>=1e4&&(ht="10px"),u.textBaseline="middle";const{width:Vt}=Jn(u,{x:Me+8,y:D,text:(R.rowMeta.rowIndex+1).toString(),maxWidth:Ne.value-28-We,fontFamily:`500 ${ht} Inter`,isTagLabel:!0,fillStyle:"#6B7280"});Me+=Math.max(24,Vt+16)}else if((O||Z||ge)&&x.value){const ht=Pt({x:Me,y:D+(d.value-16)/2,width:24,height:16},G);ht&&!E.value.length&&!S.value?qo(u,Me,D+(d.value-24)/2,24,24,4,{backgroundColor:ht?lo.gray[200]:"transparent"}):ht&&Ge("not-allowed"),m.renderIcon(u,{icon:"ncDrag",size:16,x:Me+4,y:D+(d.value-16)/2,color:ht&&!E.value.length&&!S.value?"#3265FF":E.value.length?lo.gray[400]:"#6B7280"}),Me+=26}else Me+=6;if(!Ee.value&&(Z||O||ge)){const ht=O&&G.x>=Me&&G.x<=Me+24&&!ee;vc(u,Me,D+(d.value-16)/2,Z,ee,m,ht?"#3366FF":"#D9D9D9"),Me+=24}if((Qe=R.rowMeta)!=null&&Qe.commentCount){const ht=R.rowMeta.commentCount>99,Vt=ht?"99+":R.rowMeta.commentCount.toString(),Pe=18,Se=D+(d.value-Pe)/2,$t=(Fe,vt=!1)=>Jn(u,{x:Fe,y:Se,render:vt,text:Vt,maxWidth:Ne.value/2-We,fontFamily:`${ht?"600 10px":"500 13px"} Inter`,textAlign:"center",isTagLabel:!0,fillStyle:"#3366FF",height:Pe+2}),{width:be}=$t(P+fe/2-4),ze=Math.max(20,be+(ht?6:8)),wt=P+fe-4-ze-We,q=Pt({x:wt,y:Se,width:ze,height:Pe},G);qo(u,wt,Se,ze,Pe,{topLeft:6,topRight:6,bottomLeft:0,bottomRight:6},{backgroundColor:q?lo.brand[100]:"#F0F3FF",borderColor:lo.brand[200]}),$t(wt+ze/2,!0),ht&&Q({mousePosition:G,text:`${R.rowMeta.commentCount} comments`,rect:{x:wt,y:Se,width:ze,height:Pe}})}else if(O||ge){const ht={x:P+fe-4-20-We,y:D+(d.value-20)/2,height:20,width:20},Vt=Pt(ht,G);na(u,{buttonX:ht.x,buttonY:ht.y,buttonSize:20,icon:"maximize",iconData:{size:14,xOffset:3,yOffset:3,color:Vt?lo.gray[600]:lo.gray[500]},borderRadius:6,spriteLoader:m,borderColor:Vt?void 0:"transparent",background:Vt?void 0:"transparent",setCursor:Ge})}if(Pn){const ht=d.value-8,Vt=R.rowMeta.rowLeftBorderColor??null;wa(u,{x:P+fe-8,radius:8,y:D+(d.value-ht)/2,height:ht,width:4,fillStyle:Vt??"transparent",borderColor:Vt??"transparent",borderWidth:0})}},un=(u,R)=>{if(!te.value)return;R=R+120;const{lines:P}=ml(u,{x:t.value/2,y:R,text:j("upgrade.upgradeToSeeMoreRecordInline"),maxWidth:Math.min(t.value,520),fillStyle:"#101015",fontFamily:"700 16px Inter",height:100,lineHeight:24,maxLines:2,textAlign:"center"});R=R+P.length*24+8;const D=Math.max(he.value,W.value??0),{lines:fe}=ml(u,{x:t.value/2,y:R,text:j("upgrade.upgradeToSeeMoreRecordInlineSubtitle",{plan:Iu.BUSINESS,limit:100,total:D,remaining:D-100}),maxWidth:Math.min(t.value,520),fillStyle:"#4A5268",fontFamily:"500 14px Inter",height:100,lineHeight:20,maxLines:4,textAlign:"center"});R=R+fe.length*20+20;const K=(et=!1,ut=t.value/2)=>Jn(u,{x:ut+10,y:R,text:j("msg.learnMore"),maxWidth:120,height:32,verticalAlign:"middle",fontFamily:"600 14px Inter",fillStyle:"#374151",isTagLabel:!0,render:et}),O=(et=!1,ut=t.value/2)=>Jn(u,{x:ut+10,y:R,text:It.value?j("general.upgrade"):j("general.requestUpgrade"),maxWidth:120,height:32,verticalAlign:"middle",fontFamily:"600 14px Inter",fillStyle:"white",isTagLabel:!0,render:et}),Z=K(!1),ge=O(!1),ee=Z.width+10*2+ge.width+10*2+12,Me=t.value/2-ee/2;R=R+20;const We=Pt({x:Me,y:R,width:Z.width+10*2,height:32},G),Xe=et=>{wa(u,{x:Me,radius:8,y:R,height:32,width:100,...et})};Xe({x:Me,width:Z.width+10*2,borderColor:"#E7E7E9",borderWidth:1,fillStyle:We?lo.gray[100]:"white"}),K(!0,Me);const nt=Pt({x:Me+Z.width+10*2+12,y:R,width:ge.width+10*2,height:32},G);Xe({x:Me+Z.width+10*2+12,width:ge.width+10*2,fillStyle:nt?lo.brand[600]:lo.brand[500]}),O(!0,Me+Z.width+10*2+12),Le.value.isHoveredLearnMore=We,Le.value.isHoveredUpgrade=nt,(We||nt)&&Ge("pointer")};function bt(u,{row:R,initialXOffset:P,visibleCols:D,startColIndex:fe,rowIdx:K,yOffset:O,group:Z}){var ut,Ke,Qe,ht,Vt,Pe,Se,$t,be;let ge=null;const ee=[],Me=ga(Z),We=((ut=v.value)==null?void 0:ut.rowIndex)===K&&Al((Ke=v.value)==null?void 0:Ke.path,((Qe=R==null?void 0:R.rowMeta)==null?void 0:Qe.path)??(Z==null?void 0:Z.path)),Xe=Al((ht=c.value)==null?void 0:ht.path,Me??(Z==null?void 0:Z.path)),nt=c.value.row===K&&Al(c.value.path,((Vt=R==null?void 0:R.rowMeta)==null?void 0:Vt.path)??(Z==null?void 0:Z.path)),et=R!=null&&R.row?(Pe=R.rowMeta)!=null&&Pe.is_set_as_background&&(We||R.rowMeta.selected||nt)?R.rowMeta.rowHoverColor:R.rowMeta.rowBgColor:null;if(R){const ze=qt(R.row,((Se=ve.value)==null?void 0:Se.columns)??[]);let wt=P;if(oe.value)for(let q=0;q<fe;q++){const Fe=o.value[q];(Fe==null?void 0:Fe.id)==="row_number"&&(wt-=(($t=Y.value)==null?void 0:$t.length)*13),wt+=hn(Fe==null?void 0:Fe.width)}D.forEach((q,Fe)=>{var pt,mn,ln,so,Sn,yn;let vt=hn(q.width);if(q.id==="row_number"&&(vt-=P),q.fixed){wt+=vt;return}const Re=(pt=q.columnObj)!=null&&pt.id?Tt((mn=q.columnObj)==null?void 0:mn.id):null,yt=Fe-1>=0&&D[Fe-1]&&((so=(ln=D[Fe-1])==null?void 0:ln.columnObj)!=null&&so.id)?Tt((yn=(Sn=D[Fe-1])==null?void 0:Sn.columnObj)==null?void 0:yn.id):null,_t=fe+Fe,Ze=xe.value&&c.value.row===K&&c.value.column===_t&&Xe;R.rowMeta.selected||h.value.isCellInRange({row:K,col:_t})&&Xe?(u.fillStyle=et?"#3366ff0d":"#F6F7FE",u.fillRect(wt-i.value,O,vt,d.value)):nt&&(u.fillStyle="red");const on=(h.value.isCellInRange({row:K,col:_t})||h.value.isCellInRange({row:K,col:_t-1}))&&Xe;u.strokeStyle=We||R.rowMeta.selected||on||nt||Re||yt?lo.gray[200]:lo.gray[100],u.beginPath(),u.moveTo(wt-i.value,O),u.lineTo(wt-i.value,O+d.value),u.stroke(),fe+Fe===c.value.column&&K===c.value.row&&Xe&&(u.fillStyle="#FFFFFF",u.fillRect(wt-i.value,O,vt,d.value));const Kt=c.value.row===K&&c.value.column===_t&&Xe;Kt&&(ge={col:q,x:wt-i.value,y:O,width:vt,height:d.value});const nn=R.row[q.title];$s(q.columnObj,R.row)&&ee.push({rowIndex:K,column:q}),u.save(),ae(u,q.columnObj,{value:nn,x:wt-i.value,y:O,width:vt,height:d.value,row:R.row,rowMeta:R.rowMeta,selected:Kt,pv:q.pv,spriteLoader:m,readonly:q.readonly,imageLoader:g,tableMetaLoader:C,relatedColObj:q.relatedColObj,relatedTableMeta:q.relatedTableMeta,disabled:q==null?void 0:q.isInvalidColumn,mousePosition:G,pk:ze,path:Me,skipRender:Ze,isRowHovered:We,isRowChecked:R.rowMeta.selected,isCellInSelectionRange:h.value.isCellInRange({row:K,col:_t})&&Xe,isRootCell:!0}),u.restore(),wt+=vt}),Et.value.length&&(wt=oe.value?P:0,Et.value.forEach((q,Fe)=>{let vt=hn(q.width);const Re=o.value.findIndex(Ze=>Ze.id===q.id),yt=xe.value&&c.value.row===K&&c.value.column===Re&&Xe;if(R.rowMeta.selected||h.value.isCellInRange({row:K,col:Re})&&Xe?(u.fillStyle=et?"#3366ff0d":"#F6F7FE",u.fillRect(wt,O,vt,d.value)):(u.fillStyle=We||nt?"#F9F9FA":"#ffffff",u.fillRect(wt,O,vt,d.value)),Re===c.value.column&&K===c.value.row&&Xe&&(u.fillStyle="#FFFFFF",u.fillRect(wt,O,vt,d.value)),q.id==="row_number")oe.value&&(vt-=P),Xt(u,R,{xOffset:wt,yOffset:O,width:vt},et);else{const Ze=R.row[q.title],on=c.value.row===K&&c.value.column===Re&&Xe;on&&(ge={col:q,x:wt,y:O,width:vt,height:d.value}),u.save(),$s(q.columnObj,R.row)&&ee.push({rowIndex:K,column:q}),ae(u,q.columnObj,{value:Ze,x:wt,y:O,width:vt,height:d.value,row:R.row,rowMeta:R.rowMeta,selected:on,pv:q.pv,readonly:q.readonly,spriteLoader:m,imageLoader:g,tableMetaLoader:C,relatedColObj:q.relatedColObj,relatedTableMeta:q.relatedTableMeta,mousePosition:G,disabled:q==null?void 0:q.isInvalidColumn,pk:ze,skipRender:yt,path:Me,isRowHovered:We,isRowChecked:R.rowMeta.selected,isCellInSelectionRange:h.value.isCellInRange({row:K,col:Re})&&Xe,isRootCell:!0}),u.restore()}const _t=(h.value.isCellInRange({row:K,col:Re})||h.value.isCellInRange({row:K,col:Re-1}))&&Xe;u.strokeStyle=Fe!==0&&(We||R.rowMeta.selected||_t||nt||et)?lo.gray[200]:lo.gray[100],u.lineWidth=1,u.beginPath(),u.moveTo(wt,O),u.lineTo(wt,O+d.value),u.stroke(),wt+=vt}),i.value&&!oe.value&&(u.fillStyle="rgba(0, 0, 0, 0.04)",u.rect(wt,O,4,d.value),u.fill(),u.strokeStyle="#D5D5D9",u.beginPath(),u.moveTo(wt,O),u.lineTo(wt,O+d.value),u.stroke()),D.filter(q=>!q.fixed).length||(u.strokeStyle="#f4f4f5",u.beginPath(),u.moveTo(wt,O),u.lineTo(wt,O+d.value),u.stroke()),u.fillStyle="transparent",u.strokeStyle="white",u.shadowColor="transparent",u.shadowBlur=0,u.shadowOffsetX=0,u.shadowOffsetY=0)}else{R={row:{},rowMeta:{rowIndex:K,selected:!1,commentCount:0,path:Z?Z.path:[]},oldRow:{}};let ze=P;if(oe.value)for(let wt=0;wt<fe;wt++){const q=o.value[wt];(q==null?void 0:q.id)==="row_number"&&(ze-=((be=Y.value)==null?void 0:be.length)*13),ze+=hn(q==null?void 0:q.width)}D.forEach((wt,q)=>{let Fe=hn(wt.width);const vt=fe+q;if(wt.id==="row_number"&&(Fe-=P),wt.fixed){ze+=Fe;return}h.value.isCellInRange({row:K,col:vt})&&(u.fillStyle="#F6F7FE",u.fillRect(ze-i.value,O,Fe,d.value)),u.strokeStyle="#f4f4f5",u.beginPath(),u.moveTo(ze-i.value,O),u.lineTo(ze-i.value,O+d.value),u.stroke(),c.value.row===K&&c.value.column===vt&&(ge={col:wt,x:ze-i.value,y:O,width:Fe,height:d.value}),ze+=Fe}),Et.value.length&&(ze=oe.value?P:0,Et.value.forEach(wt=>{let q=hn(wt.width);const Fe=o.value.findIndex(vt=>vt.id===wt.id);h.value.isCellInRange({row:K,col:Fe})?(u.fillStyle="#F6F7FE",u.fillRect(ze,O,q,d.value)):(u.fillStyle=We||nt?"#F9F9FA":"#ffffff",u.fillRect(ze,O,q,d.value)),wt.id==="row_number"?(oe.value&&(q-=P),Xt(u,R,{xOffset:ze,yOffset:O,width:q})):(c.value.row===K&&c.value.column===Fe&&(ge={col:wt,x:ze,y:O,width:q,height:d.value}),mt(u,ze,O,q,K)),u.strokeStyle="#f4f4f5",u.beginPath(),u.moveTo(ze,O),u.lineTo(ze,O+d.value),u.stroke(),ze+=q}),u.strokeStyle="#f4f4f5",u.beginPath(),u.moveTo(ze,O),u.lineTo(ze,O+d.value),u.stroke(),u.shadowColor="transparent",u.shadowBlur=0,u.shadowOffsetX=0,u.shadowOffsetY=0)}return{activeState:ge,renderRedBorders:ee}}function xt(u){var nt,et,ut,Ke,Qe,ht,Vt,Pe,Se,$t,be,ze,wt;const{end:R}=r.value,{start:P,end:D}=l.value,fe=Math.floor(s.value/d.value),K=o.value.slice(P,D);let O=-w.value+33,Z=null,ge=1;for(let q=0;q<P;q++)ge+=hn((nt=o.value[q])==null?void 0:nt.width);let ee=[];const Me=Math.max(Rn.value,ne.value-i.value-256<t.value?ne.value-i.value-256:t.value);let We=null;const Xe=Ae();for(let q=fe;q<R;q++)if(O+d.value>0&&O<n.value&&(!te.value||q<=Ah)){const Fe=Xe.cachedRows.value.get(q),vt=q+1<R?Xe.cachedRows.value.get(q+1):null;q===U.value&&(u.globalAlpha=.5);const Re=((et=v.value)==null?void 0:et.rowIndex)===q&&Al((ut=v.value)==null?void 0:ut.path,(Ke=Fe==null?void 0:Fe.rowMeta)==null?void 0:Ke.path),yt=c.value.row===q&&Al(c.value.path,(Qe=Fe==null?void 0:Fe.rowMeta)==null?void 0:Qe.path),_t=Fe!=null&&Fe.row?Fe.rowMeta.rowBgColor:null,Ze=((ht=v.value)==null?void 0:ht.rowIndex)===q+1&&Al((Vt=v.value)==null?void 0:Vt.path,(Pe=Fe==null?void 0:Fe.rowMeta)==null?void 0:Pe.path),on=c.value.row===q+1&&Al(c.value.path,(Se=Fe==null?void 0:Fe.rowMeta)==null?void 0:Se.path),Kt=vt&&vt.rowMeta.selected;u.fillStyle=Re||yt?"#F9F9FA":"#ffffff",u.fillRect(0,O,Me,d.value);const nn=bt(u,{row:Fe,initialXOffset:ge,visibleCols:K,rowIdx:q,startColIndex:P,yOffset:O});H.addElement({y:O,x:0,height:d.value,row:Fe,type:Lo.ROW}),Z=nn.activeState??Z,ee=[...ee,...nn.renderRedBorders],q===U.value&&(u.globalAlpha=1),u.strokeStyle=Re||($t=Fe==null?void 0:Fe.rowMeta)!=null&&$t.selected||yt||Ze||on||Kt||_t?lo.gray[300]:lo.gray[200],u.lineWidth=1,u.beginPath(),u.moveTo(0,O+d.value),u.lineTo(Me,O+d.value),u.stroke(),te.value&&q>=ll&&(u.fillStyle="rgba(231, 231, 233, 0.8)",u.fillRect(0,O,Me,d.value),u.fill()),(Fe!=null&&Fe.rowMeta.isValidationFailed||Fe!=null&&Fe.rowMeta.isRowOrderUpdated)&&(We={row:Fe,yOffset:O}),O+=d.value}if(I.value&&!Mt.value&&!te.value){const q=Pt({x:0,y:O,height:Ao,width:Me},G);u.fillStyle=q&&F.value?"#F9F9FA":"#ffffff",u.fillRect(0,O,Me,Ao),u.strokeStyle="#f4f4f5",u.beginPath(),u.moveTo(0,O+Ao),u.lineTo(Me,O+Ao),u.stroke(),m.renderIcon(u,{icon:"ncPlus",color:q&&F.value?"#000000":"#4a5268",x:16,y:O+9,size:14}),q&&!F.value&&Q({mousePosition:G,text:j("objects.permissions.addNewRecordTooltipTitle"),description:j("objects.permissions.addNewRecordTooltip"),rect:{x:0,y:O,width:Me,height:Ao,targetWidth:258}}),F.value&&H.addElement({y:O,x:0,height:Ao,path:[],type:Lo.ADD_NEW_ROW})}if(We){const q="#fcbe3a";u.strokeStyle="orange",u.beginPath(),u.moveTo(0,We.yOffset),u.lineTo(Me,We.yOffset),u.lineWidth=2,u.stroke(),u.strokeStyle="orange",u.beginPath(),u.moveTo(0,We.yOffset+d.value),u.lineTo(Me,We.yOffset+d.value),u.lineWidth=2,u.stroke(),qo(u,0,We.yOffset+d.value,90,25,{bottomRight:6},{backgroundColor:q}),Jn(u,{text:We.row.rowMeta.isValidationFailed?"Row filtered":"Row moved",x:10,y:We.yOffset+d.value,py:7,fillStyle:"#1f293a",fontSize:12,fontFamily:"600 12px Inter"})}gt(u,Z);for(const{rowIndex:q,column:Fe}of ee){if(((ze=(be=xe.value)==null?void 0:be.column)==null?void 0:ze.id)===Fe.id&&((wt=xe.value)==null?void 0:wt.rowIndex)===q)continue;const vt=-w.value+33+(q-r.value.start)*d.value,Re=zt(o.value.findIndex(on=>on.id===Fe.id)),yt=hn(Fe.width),_t=o.value.filter(on=>on.fixed).reduce((on,Kt)=>on+hn(Kt.width),1),Ze=Re-i.value<=_t;if(u.strokeStyle="#ff4a3f",u.lineWidth=2,Fe.fixed||!Ze)qo(u,Fe.fixed?Re:Re-i.value,vt,yt,d.value,2,{borderColor:"#ff4a3f",borderWidth:2});else if(Ze){if(Re+yt<=_t)continue;const on=_t,Kt=Re+yt-_t-i.value;qo(u,on+1,vt,Kt,d.value,2,{borderColor:"#ff4a3f",borderWidth:2})}u.lineWidth=1}return Yt(u),un(u,O),Z}const ct=u=>{var D,fe;if(!f.value)return;let R=0;for(let K=0;K<f.value.index;K++)R+=hn((D=o.value[K])==null?void 0:D.width);const P=hn((fe=o.value[f.value.index-1])==null?void 0:fe.width);u.fillStyle="#f4f4f5",u.globalAlpha=.6,u.fillRect(R-i.value,0,P,n.value),u.globalAlpha=1,u.strokeStyle="#3366ff",u.lineWidth=2,u.beginPath(),u.moveTo(R-i.value,0),u.lineTo(R-i.value,n.value),u.stroke()};function ft(u){var O,Z;const{start:R,end:P}=l.value;u.beginPath(),u.strokeStyle="#E7E7E9",u.moveTo(0,n.value-Dn-.5),u.lineTo(t.value,n.value-Dn-.5),u.stroke(),u.fillStyle="#F9F9FA",u.fillRect(0,n.value-Dn,t.value,Dn);let D=0;for(let ge=0;ge<R;ge++)D+=hn((O=o.value[ge])==null?void 0:O.width);const fe=o.value.slice(R,P);let K=D;if(fe.forEach(ge=>{var Xe;const ee=hn(ge.width);if(ge.fixed){K+=ee;return}const Me=(Xe=ge.aggregation)==null?void 0:Xe.toString(),We=Pt({x:K-i.value,y:n.value-Dn,width:ee,height:Dn},G);if(u.fillStyle=We?"#F4F4F5":"#F9F9FA",ge.agg_fn&&![du.None].includes(ge.agg_fn)){u.save(),u.beginPath(),u.rect(K-i.value,n.value-Dn,ee,Dn),u.fill(),u.clip(),u.textBaseline="middle",u.textAlign="right",u.font="600 12px Inter";const nt=u.measureText(Me??"").width;ge.agg_prefix&&(u.font="400 12px Inter",u.fillStyle="#6a7184",u.fillText(ge.agg_prefix,K+ee-nt-16-i.value,n.value-Dn/2)),u.font="600 12px Inter",u.fillStyle="#4a5268",u.fillText(Me??" - ",K+ee-8-i.value,n.value-Dn/2),cn.value&&We&&Q({mousePosition:G,text:"Unlock this view to edit aggregation",rect:{x:K-i.value,y:n.value-Dn,width:ee,height:Dn}}),u.restore()}else if(We){if(cn.value)Q({mousePosition:G,text:"Unlock this view to add aggregation",rect:{x:K-i.value,y:n.value-Dn,width:ee,height:Dn}});else{u.save(),u.beginPath(),u.rect(K-i.value,n.value-Dn,ee,Dn),u.fill(),u.clip(),u.font="600 10px Inter",u.fillStyle="#6a7184",u.textAlign="right",u.textBaseline="middle";const nt=K+ee-8-i.value,et=n.value-Dn/2;u.fillText("Summary",nt,et);const ut=u.measureText("Summary").width;m.renderIcon(u,{icon:"chevronDown",size:14,color:"#6a7184",x:nt-ut-18,y:et-7})}u.restore()}u.beginPath(),u.strokeStyle="#f4f4f5",u.moveTo(K-i.value,n.value-Dn),u.lineTo(K-i.value,n.value),u.stroke(),K+=ee}),Et.value.length){K=0;const ge=Et.value.find(Me=>Me.id==="row_number"),ee=Et.value.find(Me=>Me.id!=="row_number");if(ge&&ee){const Me=hn(ge.width)+hn(ee.width),We=Pt({x:K,y:n.value-Dn,width:Me,height:Dn},G);u.fillStyle=We?"#F4F4F5":"#F9F9FA",u.fillRect(K,n.value-Dn,Me,Dn),u.fillStyle="#6a7184",u.textBaseline="middle";let Xe=Me-16;if(ee.agg_fn&&![du.None].includes(ee.agg_fn)){u.save(),u.beginPath(),u.rect(K,n.value-Dn,Me,Dn),u.clip();const ut=(Z=ee.aggregation)==null?void 0:Z.toString();u.textAlign="right",u.font="600 12px Inter";const Ke=u.measureText(ut??"").width;if(ee.agg_prefix){u.font="400 12px Inter",u.fillStyle="#6a7184",u.fillText(ee.agg_prefix,Me-Ke-16,n.value-Dn/2);const ht=u.measureText(ee.agg_prefix).width;Xe-=ht}u.font="600 12px Inter",u.fillStyle="#4a5268",u.fillText(ut??" - ",Me-8,n.value-Dn/2),cn.value&&We&&Q({mousePosition:G,text:"Unlock this view to add aggregation.",rect:{x:K,y:n.value-Dn,width:Me,height:Dn}});const Qe=u.measureText(ut??"").width;Xe-=Qe,u.restore()}else if(We){if(cn.value)Q({mousePosition:G,text:"Unlock this view to add aggregation.",rect:{x:K,y:n.value-Dn,width:Me,height:Dn}});else{u.save(),u.beginPath(),u.rect(K,n.value-Dn,Me,Dn),u.clip(),u.font="600 10px Inter",u.textAlign="right";const ut=K+Me-8,Ke=n.value-Dn/2;u.fillText("Summary",ut,Ke);const Qe=u.measureText("Summary").width;Xe-=Qe,m.renderIcon(u,{icon:"chevronDown",size:14,color:"#6a7184",x:ut-Qe-18,y:Ke-7})}Xe-=18,u.restore()}const nt=oe.value?we.value:Math.max(he.value,W.value??0),et=oe.value?j(nt!==1?"objects.groups":"objects.group"):j(nt!==1?"objects.records":"objects.record");Jn(u,{text:`${Intl.NumberFormat("en",{notation:"compact"}).format(nt)} ${et}`,x:K+8,y:n.value-Dn+2,fillStyle:"#6a7184",textAlign:"left",fontSize:12,maxWidth:Xe-16,fontFamily:"500 12px Inter"}),n.value&&Q({mousePosition:G,text:`${nt} ${et}`,rect:{x:K,y:n.value-Dn,width:Xe-16,height:Dn}}),u.strokeStyle="#e7e7e9",u.beginPath(),u.moveTo(K,n.value-Dn),u.lineTo(K,n.value),u.stroke(),K+=Me,Et.value.slice(2).forEach(ut=>{var Vt;const Ke=hn(ut.width),Qe=Pt({x:K,y:n.value-Dn,width:Ke,height:Dn},G);u.fillStyle="#F9F9FA",u.fillRect(K,n.value-Dn,Ke,Dn);const ht=(Vt=ee.aggregation)==null?void 0:Vt.toString();if(ua(ht)){u.save(),u.beginPath(),u.rect(K,n.value-Dn,Ke,Dn),u.clip(),u.font="600 12px Inter";const Pe=u.measureText(ht).width;ut.agg_prefix&&(u.font="400 12px Inter",u.fillStyle="#6a7184",u.fillText(ut.agg_prefix,K+Ke-Pe-16,n.value-Dn/2)),u.font="600 12px Inter",u.fillStyle="#4a5268",u.fillText(ht,K+Ke-8,n.value-Dn/2),u.restore()}else if(Qe){u.save(),u.beginPath(),u.rect(K,n.value-Dn,Ke,Dn),u.clip(),u.font="600 10px Inter",u.fillStyle="#6a7184",u.textAlign="right",u.textBaseline="middle";const Pe=K+Ke-8,Se=n.value-Dn/2;u.fillText("Summary",Pe,Se);const $t=u.measureText("Summary").width;cn.value||m.renderIcon(u,{icon:"chevronDown",size:14,color:"#6a7184",x:Pe-$t-18,y:Se-7}),u.restore()}u.strokeStyle="#e7e7e9",u.beginPath(),u.moveTo(K,n.value-Dn),u.lineTo(K,n.value),u.stroke(),K+=Ke}),u.strokeStyle="#f4f4f5",u.beginPath(),u.moveTo(K,n.value-Dn),u.lineTo(K,n.value),u.stroke(),u.shadowColor="transparent",u.shadowBlur=0,u.shadowOffsetX=0,u.shadowOffsetY=0}}}const Be=(u,R=[])=>{if(!M.value||U.value===null||L.value===null)return;let P;oe.value?P=pr(a.value,R,L.value,d.value,I.value)-s.value+Ao:P=(L.value-r.value.start)*d.value-w.value+Ao,u.strokeStyle="#3366ff",u.lineWidth=2,u.beginPath(),u.moveTo(Y.value.length*13,P),u.lineTo(u.canvas.width,P),u.stroke(),u.save();const D=G.y,fe=500,K=G.x;u.translate(K+fe/2,D),u.rotate(.5*Math.PI/180),u.translate(-(K+fe/2),-D),u.beginPath(),u.roundRect(K,D-d.value/2,fe,d.value,6),u.clip(),u.shadowColor="rgba(0, 0, 0, 0.10)",u.shadowBlur=16,u.shadowOffsetY=12,u.shadowOffsetX=0,u.save(),u.shadowColor="rgba(0, 0, 0, 0.06)",u.shadowBlur=6,u.shadowOffsetY=4,u.fillStyle="#ffffff",u.fill(),u.restore(),u.strokeStyle="#D5D5D9",u.lineWidth=1,u.stroke();const Z=Ae(R).cachedRows.value.get(U.value);if(Z){let ge=K;o.value.forEach(ee=>{var We;const Me=hn(ee.width);ge-K<fe&&(u.save(),ae(u,ee.columnObj,{value:Z.row[ee.title],x:ge,y:D-d.value/2,width:Math.min(Me,fe-(ge-K)),height:d.value,row:Z.row,rowMeta:Z.rowMeta,selected:!1,readonly:!0,pv:ee.pv,spriteLoader:m,imageLoader:g,relatedColObj:ee.relatedColObj,relatedTableMeta:ee.relatedTableMeta,disabled:ee==null?void 0:ee.isInvalidColumn,mousePosition:{x:-1,y:-1},pk:qt(Z.row,((We=ve.value)==null?void 0:We.columns)??[])}),u.restore()),ge+=Me})}u.restore()};function at(u,R,P,D,fe,K){var Vt,Pe,Se;if(!R.path)return P;const Z=Ae(R.path).cachedRows.value,{start:ge,end:ee}=l.value,Me=o.value.slice(ge,ee),We=[];let Xe=null,nt=[],et=null;P+=1;const ut=D*13+1,Ke=Math.max(Rn.value-ut,ne.value-i.value-256<t.value?ne.value-i.value-256-2*ut:t.value),Qe=P;for(let $t=fe;$t<=K;$t++){const be=Z==null?void 0:Z.get($t);be||We.push($t);const ze=((Vt=v.value)==null?void 0:Vt.rowIndex)===$t&&Al((Pe=v.value)==null?void 0:Pe.path,((Se=be==null?void 0:be.rowMeta)==null?void 0:Se.path)??R.path);qo(u,ut,P,Ke,d.value,0,{backgroundColor:ze?"#F9F9FA":"#fff"}),u.save(),u.rect(ut,P,Ke,d.value),u.clip();const wt=bt(u,{row:be,initialXOffset:ut,visibleCols:Me,startColIndex:ge,rowIdx:$t,yOffset:P,group:R});u.restore(),H.addElement({y:P,x:ut,group:R,level:D,height:d.value,path:R.nestedIn,rowIndex:$t,row:be,type:Lo.ROW}),Xe=wt.activeState??Xe,nt=[...nt,...wt.renderRedBorders],u.strokeStyle="#e7e7e9",u.beginPath(),u.moveTo(ut,P+d.value),u.lineTo(Ke+ut,P+d.value),u.stroke(),(be!=null&&be.rowMeta.isValidationFailed||be!=null&&be.rowMeta.isRowOrderUpdated||be!=null&&be.rowMeta.isGroupChanged)&&(et={row:be,yOffset:P}),P+=d.value}if(I.value&&!Mt.value){const $t=Pt({x:0,y:P,height:Ao,width:Ke},G);qo(u,D*13,P,Ke+2,Ao,{bottomLeft:8,bottomRight:8,topRight:0,topLeft:0},{backgroundColor:$t&&F.value?"#F9F9FA":"#ffffff",borders:{bottom:!0},borderColor:"#e7e7e9",borderWidth:1}),m.renderIcon(u,{icon:_e.value?"ncPlus":"form",color:$t&&F.value?"#000000":"#4a5268",x:16+D*13,y:P+9,size:14});const{width:be}=Jn(u,{x:36+D*13,y:P+2,fontFamily:"600 13px Inter",height:Ao,fillStyle:"#374151",text:`${j("activity.newRecord")}`});m.renderIcon(u,{icon:"chevronDown",color:$t&&F.value?"#000000":"#4a5268",x:36+D*13+be+12,y:P+10,size:14}),$t&&!F.value&&Q({mousePosition:G,text:j("objects.permissions.addNewRecordTooltipTitle"),description:j("objects.permissions.addNewRecordTooltip"),rect:{x:D*13,y:P,height:Ao,width:Ke,targetWidth:258}}),H.addElement({x:36+D*13+be+12,y:P+9,width:16,group:R,level:D,height:Ao,path:R.nestedIn,groupPath:R==null?void 0:R.path,type:Lo.EDIT_NEW_ROW_METHOD}),F.value&&H.addElement({y:P,x:D*13,group:R,level:D,height:Ao,path:R.nestedIn,groupPath:R==null?void 0:R.path,type:Lo.ADD_NEW_ROW}),P+=Ao}if(et){const $t="#fcbe3a",be=D*13;u.strokeStyle="orange",u.beginPath(),u.moveTo(be,et.yOffset),u.lineTo(Ke+be+2,et.yOffset),u.lineWidth=2,u.stroke(),u.strokeStyle="orange",u.beginPath(),u.moveTo(be,et.yOffset+d.value),u.lineTo(Ke+be+2,et.yOffset+d.value),u.lineWidth=2,u.stroke(),qo(u,be,et.yOffset+d.value,90,25,{bottomRight:6},{backgroundColor:$t}),Jn(u,{text:et.row.rowMeta.isValidationFailed?"Row filtered":"Row moved",x:10+be,y:et.yOffset+d.value,py:7,fillStyle:"#1f293a",fontSize:12,fontFamily:"600 12px Inter"})}const ht=()=>{var $t,be,ze,wt;for(const{rowIndex:q,column:Fe}of nt){if(((be=($t=xe.value)==null?void 0:$t.column)==null?void 0:be.id)===Fe.id&&((ze=xe.value)==null?void 0:ze.rowIndex)===q&&!Al((wt=xe.value)==null?void 0:wt.path,R==null?void 0:R.path))continue;const vt=Qe+q*d.value,Re=zt(o.value.findIndex(on=>on.id===Fe.id)),yt=hn(Fe.width),_t=o.value.filter(on=>on.fixed).reduce((on,Kt)=>on+hn(Kt.width),1),Ze=Re-i.value<=_t;if(u.strokeStyle="#ff4a3f",u.lineWidth=2,Fe.fixed||!Ze)qo(u,Fe.fixed?Re:Re-i.value,vt,yt,d.value,2,{borderColor:"#ff4a3f",borderWidth:2});else if(Ze){if(Re+yt<=_t)continue;const on=_t,Kt=Re+yt-_t-i.value;qo(u,on+1,vt,Kt,d.value,2,{borderColor:"#ff4a3f",borderWidth:2})}u.lineWidth=1}gt(u,Xe),Yt(u)};if(We!=null&&We.length){const $t=Math.max(...We),be=Math.min(...We);Ie(be,$t,R.path)}return{yOffset:P,postRenderCbk:ht}}function kt(u,{level:R=0,yOffset:P,pGroup:D,startIndex:fe,endIndex:K,_isStartGroup:O}){var Ke,Qe,ht,Vt,Pe;const Z=(D==null?void 0:D.groups)??a.value,ge=[],ee=Et.value.find(Se=>Se.id==="row_number"),Me=Et.value.find(Se=>Se.id!=="row_number"),We=(R+1)*13,Xe=hn(ee==null?void 0:ee.width)+hn(Me==null?void 0:Me.width)-We,nt=Math.max(Rn.value-(R+1)*13,ne.value-i.value-256<t.value?ne.value-i.value-256-2*We:t.value);let et=P;const ut=[];for(let Se=fe;Se<=K;Se++){const $t=(O??!0)&&Se===fe,be=Z.get(Se);be||ge.push(Se);const ze=et,wt=mr(be,d.value,I.value);if(ze+wt<0||ze>n.value){et+=wt;continue}be&&H.addElement({y:ze,x:We,level:R,height:$o,path:be.nestedIn,groupIndex:Se,group:be,type:Lo.GROUP});const{background:Fe,border:vt,aggregation:{hover:Re,default:yt,border:_t}}=aC(R,Y.value.length);if(ze+wt>=0&&ze<n.value){let Ze=et+$o;if(be!=null&&be.isExpanded){const Sn=Ze,yn=Array.from({length:fe},(jt,an)=>{const rn=Z.get(an);return mr(rn,d.value,I.value)}).reduce((jt,an)=>jt+an,0),kn=$t?s.value-yn:0;if(qo(u,We,ze+$o,nt,wt-ni-$o,{bottomRight:8,bottomLeft:8},{backgroundColor:Fe,borderColor:vt,borders:{top:!1,right:!0,bottom:!0,left:!0}}),be.path){const jt=n.value-Ze,an=d.value,rn=Math.min(be.count,Math.max(0,Math.floor(-(ze+$o-Ao)/an))),En=Math.ceil(jt/an),Yn=Math.min(rn+En,be.count-1),{yOffset:ao,postRenderCbk:Zn}=at(u,be,Sn+rn*d.value,R+1,rn,Yn);Ze=ao,ut.push(Zn)}else{const{endIndex:jt}=ef(be.groups,kn,d.value,be.groupCount,n.value-ze-$o-aa,!0,I.value),{currentOffset:an,missingChunks:rn,postRenderCbk:En}=kt(u,{level:R+1,yOffset:Sn+aa,pGroup:be,startIndex:0,endIndex:Math.max(0,jt),_isStartGroup:$t});if(ut.push(En),Ze=an,rn.length){const Yn=Math.min(...rn),ao=Math.max(...rn);ie(Yn,ao,be)}}}if(qo(u,We,ze,nt,$o,be!=null&&be.isExpanded?{topLeft:8,topRight:8,bottomLeft:0,bottomRight:0}:8,{backgroundColor:Fe,borderColor:vt,borders:{bottom:!(be!=null&&be.isExpanded)||!!((Ke=be==null?void 0:be.path)!=null&&Ke.length),top:!0,left:!0,right:!0}}),(Qe=wn.value)!=null&&Qe.ee){const{start:Sn,end:yn}=l.value,kn=o.value.slice(Sn,yn);let jt=1;for(let an=0;an<Sn;an++)jt+=hn((ht=o.value[an])==null?void 0:ht.width);kn.forEach((an,rn)=>{const En=hn(an.width);if(an.fixed){jt+=En;return}const Yn=Pt({x:jt-i.value,y:Math.max(et,Ao)+1,width:En,height:$o-1+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0)},G);Yn&&Ge("pointer"),u.fillStyle=Yn?Re:yt;const ao=jt-i.value,Zn=Math.max(0,Rn.value-ao),To=rn===kn.length-1?1:0,Ue=Math.max(ao,Rn.value),Mo=Math.max(En-Zn-To,0);if(an.agg_fn&&![du.None].includes(an.agg_fn)){u.save(),u.beginPath(),qo(u,Ue,ze+1,Mo,$o-2+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0),{topLeft:0,bottomLeft:0,topRight:rn===kn.length-1?8:0,bottomRight:rn===kn.length-1?8:0},{backgroundColor:Yn?Re:yt}),u.fill(),u.clip(),u.textBaseline="middle",u.textAlign="right",u.font="600 12px Inter";const qn=u.measureText((be==null?void 0:be.aggregations[an.title])??" - ").width;an.agg_prefix&&(u.font="400 12px Inter",u.fillStyle="#6a7184",u.fillText(an.agg_prefix,jt+En-qn-16-i.value,ze+($o+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0))/2)),u.fillStyle="#374151",u.font="600 12px Inter",u.fillText((be==null?void 0:be.aggregations[an.title])??" - ",jt+En-8-i.value,ze+($o+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0))/2),u.restore()}else if(Yn&&!cn.value){u.save(),u.beginPath(),qo(u,Ue,ze+1,Mo,$o-2+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0),{topLeft:0,bottomLeft:0,topRight:rn===kn.length-1?8:0,bottomRight:rn===kn.length-1?8:0},{backgroundColor:Yn?Re:yt}),u.fill(),u.clip(),u.font="600 10px Inter",u.fillStyle="#6a7184",u.textAlign="right",u.textBaseline="middle";const qn=jt+En-8-i.value,eo=ze+($o+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0))/2;u.fillText("Summary",qn,eo);const to=u.measureText("Summary").width;m.renderIcon(u,{icon:"chevronDown",size:14,color:"#6a7184",x:qn-to-18,y:eo-7}),u.restore()}u.save(),u.rect(Math.max(jt-i.value,Rn.value),ze+1,En,$o-2+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0)),u.clip(),u.beginPath(),u.strokeStyle=_t,u.moveTo(jt-i.value,ze+1),u.lineTo(jt-i.value,ze+$o-2+(be!=null&&be.isExpanded&&!(be!=null&&be.path)?aa:0)),u.stroke(),u.restore(),jt+=En})}m.renderIcon(u,{icon:be!=null&&be.isExpanded?"ncChevronDown":"ncChevronRight",size:16,color:"#374150",x:We+12,y:ze+($o-16)/2});const on=Xe-(We+16+16),Kt=We+34,nn=ze+($o-30)/2,pt=Pt({x:We,y:ze,width:Xe,height:$o},G);let mn=0,ln=0;pt&&Ge("pointer"),!pt||!wn.value.isOnPrem?(ln=Jn(u,{text:`${(be==null?void 0:be.count)??"-"}`,x:We+Xe-12,y:nn-1,height:$o,verticalAlign:"middle",fontFamily:"600 12px Inter",fillStyle:"#374151",textAlign:"right"}).width,mn=Jn(u,{text:"Count",x:We+Xe-12-ln-8,y:nn-1,height:$o,verticalAlign:"middle",textAlign:"right",fontFamily:"400 12px Inter",fillStyle:"#6A7184"}).width):na(u,{buttonX:We+Xe-12-24,buttonY:nn+1,buttonSize:28,icon:"ncMoreVertical",iconData:{size:16,xOffset:6,yOffset:6,color:"#374151"},borderRadius:8,borderColor:"#ffffff",background:"#ffffff",hoveredBackground:"#f4f4f5",mousePosition:G,spriteLoader:m,setCursor:Ge}),u.save(),u.letterSpacing="1px";const{isTruncated:so}=Jn(u,{text:(((Vt=be==null?void 0:be.column)==null?void 0:Vt.title)??"").toUpperCase(),fillStyle:"#4A5268",x:Kt,maxWidth:on-20-ln,fontFamily:"600 10px Inter",y:ze,py:6});so&&Q({mousePosition:G,text:(((Pe=be==null?void 0:be.column)==null?void 0:Pe.title)??"").toUpperCase(),rect:{x:Kt,y:ze,height:16,width:on-20-ln}}),u.restore(),st(u,be,Kt,nn+22,on-mn-ln,Se),et=Ze}et+=ni}return{currentOffset:et,missingChunks:ge,postRenderCbk:()=>ut.map(Se=>Se==null?void 0:Se())}}function st(u,R,P,D,fe,K){var O,Z,ge,ee;if(!R){mt(u,P-11,D-$o/2+2,fe,K);return}if([pe.SingleSelect,pe.MultiSelect,pe.LinkToAnotherRecord].includes((O=R==null?void 0:R.column)==null?void 0:O.uidt)&&!(R.value in kl.VAR_TITLES)){const Me=((Z=R==null?void 0:R.column)==null?void 0:Z.uidt)===pe.LinkToAnotherRecord?Bs(R):R.value,We=Array.isArray(Me)?Me:Me.split(","),Xe=R.color.split(",");let nt=P,et=0;for(let ut=0;ut<We.length;ut++){const Ke=We[ut]||"",Qe=Xe[ut]||"#ccc",ht=Ke in kl.VAR_TITLES?kl.VAR_TITLES[Ke]:Ke,Vt=ar.isReadable(Qe,"#fff",{level:"AA",size:"large"})?"#fff":ar.mostReadable(Qe,["#1f293a","#fff"]).toHex8String();u.save(),u.font="700 13px Inter";const Pe=12,Se=0,$t=fe-(nt-P),ze=u.measureText(ht||"").width+Pe*2+Se;if(nt>P&&(ze>$t-30||$t<50)){u.fillStyle="#6a7184",u.font="400 12px Inter";const q=Math.min(nt,P+fe-24);u.fillText(`+${We.length-et}`,q,D),u.restore();break}const{x:wt}=Sl(u,{x:nt,y:D-7,height:22,width:$t,padding:0,textColor:Vt,text:ht||"",tag:{tagPaddingX:12,tagPaddingY:2,tagHeight:22,tagRadius:12,tagBgColor:Qe,tagSpacing:0,tagFontFamily:"700 13px Inter"}});if(u.restore(),nt=wt+8,et++,nt+30>=P+fe){if(ut<We.length-1){u.save(),u.fillStyle="#6a7184",u.font="400 12px Inter";const Fe=Math.max(24,P+fe-nt)<24?P+fe-24:nt;u.fillText(`+${We.length-et}`,Fe,D),u.restore()}break}}}else if(R.value in kl.VAR_TITLES){const Me=R.value in kl.VAR_TITLES?kl.VAR_TITLES[R.value]:(ge=Bs(R))==null?void 0:ge.join(", "),We=((ee=R.column)==null?void 0:ee.uidt)===pe.Checkbox;Jn(u,{text:Me,fillStyle:We?"#1f293a":"#6A7184",fontFamily:"700 13px Inter",x:P,y:D-$o/2+8,height:20,maxWidth:fe})}else if(Eh(R.column)||rs(R.column)){let Me=R.value;try{Me=JSON.parse(R.value)}catch{Me=R.value}ae(u,R.column,{value:Me,x:P-11,y:D-16,width:fe,height:d.value,row:{},selected:!1,pv:!1,spriteLoader:m,readonly:!0,textColor:"#1f293a",imageLoader:g,tableMetaLoader:C,relatedColObj:R.relatedColumn,relatedTableMeta:R.relatedTableMeta,mousePosition:G,skipRender:!1,renderCell:ae,fontFamily:"700 13px Inter",isGroupHeader:!0})}else{let Me=R.value;try{Me=JSON.parse(R.value)}catch{Me=R.value}ae(u,R.column,{value:Me,x:P-11,y:D-13,width:fe,height:d.value,row:{},selected:!1,pv:!1,spriteLoader:m,readonly:!0,textColor:"#1f293a",imageLoader:g,meta:ve,tableMetaLoader:C,relatedColObj:R.relatedColumn,relatedTableMeta:R.relatedTableMeta,mousePosition:G,skipRender:!1,renderAsPlainCell:!0,fontFamily:"700 13px Inter",isGroupHeader:!0})}}function qe(){var K;const u=je.value;if(!u)return;const R=u.getContext("2d");if(!R)return;const P=window.devicePixelRatio||1;u.width=t.value*P,u.height=n.value*P,u.style.width=`${t.value}px`,R.scale(P,P),R.clearRect(0,0,t.value,u.height);let D;H.clear();let fe;if(!((K=Y.value)!=null&&K.length))D=xt(R);else{R.save(),R.fillStyle=ye.value,R.fillRect(0,0,t.value,n.value),R.restore();const{startIndex:O,endIndex:Z,startGroupYOffset:ge}=ef(a.value,s.value,d.value,we.value,n.value,!1,I.value),{missingChunks:ee,postRenderCbk:Me}=kt(R,{level:0,yOffset:ge,startIndex:O,endIndex:Z});if(fe=Me,ee.length){const We=Math.min(...ee),Xe=Math.max(...ee);ie(We,Xe)}}ot(R,D),ct(R),Be(R,ce.value),ft(R),R.beginPath(),R.rect(0,Ao,ne.value,n.value-Ao-Dn),R.clip(),fe==null||fe(),R.restore()}return{canvasRef:je,renderActiveState:gt,renderCanvas:qe,colResizeHoveredColIds:He}}function pC(t,n,o,l,a,i,s){const r=fn(Hi,V(!1)),d=V(!1),c=V(null),f=_=>{var w,S;let m=0;const g=n.value.filter(x=>x.fixed);for(const x of g){const $=hn(x.width);if(_>=m&&_<m+$)return null;m+=$}let C=g.reduce((x,$)=>x+hn($.width),0);for(let x=0;x<o.value.start;x++)(w=n.value[x])!=null&&w.fixed||(C+=hn((S=n.value[x])==null?void 0:S.width));m=C-l.value;for(let x=o.value.start;x<o.value.end;x++){const $=n.value[x];if(!($!=null&&$.fixed)){const I=hn($==null?void 0:$.width);if(_>=m&&_<m+I)return $;m+=I}}return null},v=_=>{var w;if(!d.value||!c.value)return;const m=(w=t.value)==null?void 0:w.getBoundingClientRect();if(!m)return;const g=_.clientX-m.left,C=f(g);C&&C.id!==c.value.id&&(i.value={id:C.id,index:n.value.findIndex(S=>S.id===C.id)},requestAnimationFrame(a))},h=()=>{c.value&&i.value&&s("reorderColumns",c.value.index,i.value.index-1),y()};function y(){d.value=!1,c.value=null,i.value=null,window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",h),requestAnimationFrame(a)}const b=_=>{if(r.value)return;const m=f(_);m&&(d.value=!0,c.value={id:m.id,index:n.value.findIndex(g=>g.id===m.id),startX:_},window.addEventListener("mousemove",v),window.addEventListener("mouseup",h))};return Ga(y),{isDragging:d,dragStart:c,startDrag:b}}function hC(t,n,o,l,a,i){const r=V(!1),d=V(null),c=V(null),f=fn(Hi,V(!1)),v=le(()=>{var w;if(!c.value)return null;const m=n.value.filter(S=>S.fixed);let g=0;for(const S of m){const x=hn(S.width),$=g+x;if(Math.abs(c.value.x-$)<=8/2)return S.uidt?{id:S.id,width:x,x:g}:null;g=$}let C=0;for(let S=0;S<o.value.start;S++)n.value[S]&&(C+=hn((w=n.value[S])==null?void 0:w.width));g=C-l.value;for(let S=o.value.start;S<o.value.end;S++){const x=n.value[S],$=hn(x.width),I=g+$;if(Math.abs(c.value.x-I)<=8/2)return{id:x.id,width:$,x:g};g=I}return null}),h=m=>{var g;try{const C=(g=t.value)==null?void 0:g.getBoundingClientRect();if(!C)return;if(c.value={x:m.clientX-C.left,y:m.clientY-C.top},r.value&&d.value){const w=c.value.x-d.value.startX,S=Math.max(50,d.value.initialWidth+w);a==null||a(d.value.id,S)}}catch(C){console.error("Error in handleMouseMove:",C),y()}};function y(){r.value=!1,d.value=null,c.value=null,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",_)}const b=m=>{var w,S;const g=(w=t.value)==null?void 0:w.getBoundingClientRect();if(!g||f.value)return;c.value={x:m.clientX-g.left,y:m.clientY-g.top};const C=v.value;if(!C){c.value=null;return}r.value=!0,d.value={id:C.id,initialWidth:C.width,startX:((S=c.value)==null?void 0:S.x)||0},window.addEventListener("mousemove",h),window.addEventListener("mouseup",_)};function _(){if(r.value&&d.value&&c.value&&d.value&&c.value){const g=c.value.x-d.value.startX,C=Math.max(50,d.value.initialWidth+g);i==null||i(d.value.id,C)}y()}return Ga(()=>{y()}),{isResizing:r,activeColumn:d,resizeableColumn:v,handleMouseMove:h,handleMouseDown:b,RESIZE_HANDLE_WIDTH:8,cleanupResize:y}}const lf={[pe.Attachment]:{minWidth:100,maxWidth:Number.POSITIVE_INFINITY},[pe.Button]:{minWidth:100,maxWidth:320}},mC=t=>t in lf?lf[t]:{minWidth:50,maxWidth:Number.POSITIVE_INFINITY},gC=(t,n)=>{if(t.uidt){const{minWidth:o,maxWidth:l}=mC(t.uidt);return Math.min(Math.max(n,o),l)}return n},wC=[pe.SingleSelect,pe.MultiSelect,pe.User],af=100,Kr=1;function yC({activeCell:t,columns:n,triggerReRender:o,scrollToCell:l,selection:a,editEnabled:i,copyValue:s,clearCell:r,clearSelectedRangeOfCells:d,makeCellEditable:c,expandForm:f,cachedGroups:v,isAddingEmptyRowAllowed:h,isAddingEmptyRowPermitted:y,addEmptyRow:b,addNewColumn:_,onActiveCellChanged:m,handleCellKeyDown:g,isGroupBy:C,getDataCache:w,removeInlineAddRecord:S}){const{isDataReadOnly:x}=gl(),{$e:$}=da(),I=fn(Ai,V()),E=Qu(async M=>{var Y,we,oe,ye,ie,H,Ae,Ie,ce,te,Le,Ne,lt,je,He,Q,Mt,_e,wn;if(Hf()||Mh()||Yf())return;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return M.preventDefault(),!0;if(Wl()||nd()||qf()||Xf()||(sa()||Vi()||Kf())&&!Th())return;const L=Va()?M.metaKey:M.ctrlKey,G=M.altKey;let ae=[],ve,xe={};if(C.value){if((Y=t.value.path)!=null&&Y.length)ae=t.value.path;else{const It=iC(v.value);if((we=It.path)!=null&&we.length)ae=It.path;else return}ve=xa(v.value,ae),xe=es(ve)}L&&M.key==="f"&&i.value&&(i.value=null);const ne=w(ae),{cachedRows:he,totalRows:W}=ne;if(M.key===" "&&!M.shiftKey){const It=Wl();if(!i.value&&t.value.row!==-1&&!It){M.preventDefault();const Tt=he.value.get(t.value.row);if(!Tt||S.value&&Tt.rowMeta.rowIndex&&Tt.rowMeta.rowIndex>ll)return;f(Tt,void 0,!1,ae);return}}if(t.value.row!==-1&&t.value.column!==-1&&a.value.isSingleCell()&&!L){const It=n.value[t.value.column],Tt=he.value.get(t.value.row);if(Tt&&(It!=null&&It.columnObj)&&!i.value){if(S.value&&Tt.rowMeta.rowIndex&&Tt.rowMeta.rowIndex>=ll)return;const Je=Tt.row[It.columnObj.title],cn=qt(Tt.row,((oe=I.value)==null?void 0:oe.columns)??[]);if(await g({e:M,column:It,row:Tt,pk:cn,value:Je,path:ae}))return}}let j=!1,Ee=!1;if(L&&(!i.value||yd.includes((ie=(ye=i.value)==null?void 0:ye.column)==null?void 0:ie.uidt)))switch(M.key.toLowerCase()){case"c":M.preventDefault(),s({row:t.value.row,col:t.value.column},ae);return}M.shiftKey&&a.value.isEmpty()&&a.value.startRange({row:t.value.row,col:t.value.column});const Ye=L,Ge=W.value-1,ke=n.value.length-1;if(G)switch(M.keyCode){case 82:{h.value&&y.value&&!S.value&&y.value&&($("c:shortcut",{key:"ALT + R"}),b(void 0,void 0,void 0,xe,ae),t.value.row=W.value,t.value.column=1,t.value.path=ae,a.value.clear(),l(t.value.row,1,ae));return}case 67:{_();break}}switch(M.key){case"Delete":case"Backspace":if(x.value)return;if(!i.value||wC.includes((Ae=(H=n.value[t.value.column])==null?void 0:H.columnObj)==null?void 0:Ae.uidt)){if(M.preventDefault(),a.value.isSingleCell()){if(S.value&&t.value.row>=ll)return;await(r==null?void 0:r({row:t.value.row,col:t.value.column,path:ae}))}else await d(ae),a.value.clear();requestAnimationFrame(o)}return;case"Enter":if(M.shiftKey)return;if(i.value){const It=[pe.Attachment,pe.Barcode,pe.QrCode],Tt=(ce=n.value[t.value.column])==null?void 0:ce.columnObj;if(Tt&&It.includes(Tt.uidt))return;i.value=null,t.value.row++,m()}else{M.preventDefault();const It=n.value[t.value.column];if((Ie=It==null?void 0:It.columnObj)!=null&&Ie.uidt&&!Bv.includes(It.columnObj.uidt)&&!It.columnObj.readonly){if(S.value&&t.value.row&&t.value.row>=ll)return;const Tt=he.value.get(t.value.row);c(Tt,n.value[t.value.column],!0),a.value.clear()}}break;case"Escape":i.value&&(i.value=null,a.value.clear(),a.value.startRange({row:t.value.row,col:t.value.column}),a.value.endRange({row:t.value.row,col:t.value.column}),requestAnimationFrame(o));return;case"ArrowUp":{const It=((te=a.value._end)==null?void 0:te.row)??t.value.row;if(It>0){M.preventDefault();const Tt=Ye?0:It-1;if(M.shiftKey){const Je={row:Math.max((((Le=a.value._start)==null?void 0:Le.row)??0)-af-1,Tt),col:((Ne=a.value._end)==null?void 0:Ne.col)??t.value.column};a.value.endRange(Je),l(Je.row,Je.col,ae,!1),Ee=!0}else t.value.row=Tt,j=!0,m()}break}case"ArrowDown":{const It=((lt=a.value._end)==null?void 0:lt.row)??t.value.row;if(It<Ge){M.preventDefault();const Tt=Ye?Ge:It+1;if(M.shiftKey){const Je={row:Math.min((((je=a.value._start)==null?void 0:je.row)??0)+af-1,Tt),col:((He=a.value._end)==null?void 0:He.col)??t.value.column};a.value.endRange(Je),Ee=!0}else t.value.row=Tt,j=!0,m()}break}case"ArrowLeft":{const It=((Q=a.value._end)==null?void 0:Q.col)??t.value.column;if(It>Kr){M.preventDefault();const Tt=Ye?Kr:It-1;M.shiftKey?(a.value.endRange({row:((Mt=a.value._end)==null?void 0:Mt.row)??t.value.row,col:Tt}),Ee=!0):(t.value.column=Tt,j=!0)}break}case"ArrowRight":{const It=((_e=a.value._end)==null?void 0:_e.col)??t.value.column;if(It<ke){M.preventDefault();const Tt=Ye?ke:It+1;M.shiftKey?(a.value.endRange({row:((wn=a.value._end)==null?void 0:wn.row)??t.value.row,col:Tt}),Ee=!0):(t.value.column=Tt,j=!0)}break}case"Tab":{let It=!1;if(M.preventDefault(),!M.shiftKey&&t.value.row===Ge&&t.value.column===ke)h.value&&!S.value&&y.value&&(b(void 0,!1,void 0,xe,ae),It=!0);else if(M.shiftKey&&t.value.row===0&&t.value.column===Kr)return;M.shiftKey?t.value.column>Kr?t.value.column--:t.value.row>0&&(t.value.row--,t.value.column=ke):t.value.column<ke?t.value.column++:t.value.row<(It?Ge+1:Ge)&&(t.value.row++,t.value.column=Kr),j=!0;break}}if(j||Ee){i.value=null,(!M.shiftKey||M.key==="Tab")&&(a.value.clear(),a.value.startRange({row:t.value.row,col:t.value.column}),a.value.endRange({row:t.value.row,col:t.value.column}));const It=M.key!=="ArrowUp"&&M.key!=="ArrowDown";j?l(t.value.row,t.value.column,ae,It):Ee&&l(a.value._end.row,a.value._end.col,ae,It)}o()},50);Ml("keydown",E)}const rf=100;function bC({selection:t,activeCell:n,canvasRef:o,scrollLeft:l,columns:a,triggerReRender:i,scrollToCell:s,elementMap:r,getDataCache:d}){const c=V(!1),f=(b,_)=>{var I,F,E,M,U,L,G;const m=r.findElementAt(b,_,Lo.ROW),g=m==null?void 0:m.rowIndex,C=(F=(I=m==null?void 0:m.row)==null?void 0:I.rowMeta)==null?void 0:F.path;let w=0;const S=a.value.filter(ae=>ae.fixed);for(let ae=0;ae<S.length;ae++){if(!((E=S[ae])!=null&&E.width))continue;const ve=hn((M=S[ae])==null?void 0:M.width);if(b>=w&&b<w+ve)return{row:g,col:ae===0?-1:a.value.findIndex(xe=>xe.id===S[ae].id),path:C??[]};w+=ve}const x=b+l.value-w;let $=0;for(let ae=S.length;ae<a.value.length;ae++){if((L=(U=a.value)==null?void 0:U[ae])!=null&&L.fixed)continue;const ve=hn((G=a.value[ae])==null?void 0:G.width);if(x>=$&&x<$+ve)return{row:g,col:ae,path:C??[]};$+=ve}return{row:g,col:-1,path:C??[]}};return{handleMouseDown:b=>{var g;const _=(g=o.value)==null?void 0:g.getBoundingClientRect();if(!_||b.button!==0)return;const m=f(b.clientX-_.left,b.clientY-_.top);if(b.shiftKey){m.col!==-1&&(c.value=!0,t.value.endRange(m),i());return}m.col!==-1&&(c.value=!0,t.value.startRange(m),n.value={row:m.row,column:m.col,path:m.path},i())},handleMouseMove:b=>{var C,w,S,x,$;if(!c.value)return;const _=(C=o.value)==null?void 0:C.getBoundingClientRect();if(!_)return;const m=f(b.clientX-_.left,b.clientY-_.top);if(Ss(m.row))return;const g=d(m==null?void 0:m.path);if(m.col!==-1){m.row=Math.max(0,Math.min(m.row,g.totalRows.value-1));const I=Math.max(((w=t.value._start)==null?void 0:w.row)??0,m.row),F=Math.min(((S=t.value._start)==null?void 0:S.row)??0,m.row);if(I-F>=rf){const E=m.row>(((x=t.value._start)==null?void 0:x.row)??0)?1:-1,M=((($=t.value._start)==null?void 0:$.row)??0)+(rf-1)*E;m.row=Math.max(0,Math.min(M,g.totalRows.value-1))}t.value.endRange(m),s(m.row,m.col,m.path,t.value.isDifferentColSelection()),i()}},handleMouseUp:()=>{var b,_,m,g;if(c.value=!1,!t.value.isEmpty())return!(((b=t.value.end)==null?void 0:b.row)===((_=t.value.start)==null?void 0:_.row)&&((m=t.value.end)==null?void 0:m.col)===((g=t.value.start)==null?void 0:g.col))}}}const Zv=(t,n,o,l)=>{var c;const{isPg:a,isMysql:i,meta:s,metas:r}=o,d=(n.title&&t.row[n.title])??"";return(c=l==null?void 0:l.skipUidt)!=null&&c.includes(n.uidt)?d:as.parseValue(d,{col:n,isMysql:i,isPg:a,meta:s,metas:r,rowId:Yo(n)?qt(t.row,s==null?void 0:s.columns):null})},ep=(t,n,o,l)=>{let a="<table>",i="";const s=[];return t.forEach((r,d)=>{let c="<tr>";const f=[];n.forEach((v,h)=>{const y=Zv(r,v,o,l);c+=`<td>${y}</td>`,i=`${i}${y}${n.length-1!==h?"	":""}`,f.push(y)}),a+=`${c}</tr>`,t.length-1!==d&&(i=`${i}
`),s.push(f)}),a+="</table>",{html:a,text:i,json:s}};function _C({isFillMode:t,isAiFillMode:n,selection:o,canvasRef:l,getFillHandlerPosition:a,triggerReRender:i,columns:s,bulkUpdateRows:r,meta:d,activeCell:c,isPasteable:f,elementMap:v,getDataCache:h,getRows:y}){const{isMysql:b,isPg:_}=Ca(),{$api:m}=da(),{appInfo:g}=nl(),{maxAttachmentsAllowedInCell:C,showUpgradeToAddMoreAttachmentsInCell:w}=ql(),S=V(null),x=V(!1),$=le(()=>{const L={};if(L[`${c.value.row}-${c.value.column}`]=!0,o.value._start===null||o.value._end===null)return L;if(t.value&&S.value){const G=Math.min(S.value.start.row,o.value._start.row),ae=Math.max(S.value.end.row,o.value._start.row),ve=Math.min(S.value.start.col,o.value._start.col),xe=Math.max(S.value.end.col,o.value._start.col);for(let ne=G;ne<=ae;ne++)for(let he=ve;he<=xe;he++)L[`${ne}-${he}`]=!0}else for(let G=o.value.start.row;G<=o.value.end.row;G++)for(let ae=o.value.start.col;ae<=o.value.end.col;ae++)L[`${G}-${ae}`]=!0;return L}),I=(L,G)=>{const ae=a();if(!ae)return!1;const ve=ae.size/2,xe=L-ae.x,ne=G-ae.y;return xe*xe+ne*ne<=ve*ve},F=L=>{var xe;const G=(xe=l.value)==null?void 0:xe.getBoundingClientRect();if(!G)return;x.value=!1;const ae=L.clientX-G.left,ve=L.clientY-G.top;I(ae,ve)&&(t.value=!0,o.value.isSingleCell()&&o.value.startRange({row:c.value.row,col:c.value.column}),S.value=new zs,S.value.startRange({row:o.value.start.row,col:o.value.start.col}),S.value.endRange({row:o.value.end.row,col:o.value.end.col})),i()},E=L=>{var ve,xe;const G=(ve=l.value)==null?void 0:ve.getBoundingClientRect();if(!G||!t.value||x.value)return;const ae=v.findElementAt(0,L.clientY-G.top,Lo.ROW);ae&&(o.value.endRange({row:ae.rowIndex,col:o.value.end.col??((xe=S.value)==null?void 0:xe.end.col)}),i())},M=async({rawMatrix:L,cpCols:G,rowToPaste:ae})=>{var Y,we;if(L.length===0)return;const ve=ae.end-ae.start>0?1:-1,xe=ve===-1?L.reverse():L,ne=xe[0].map((oe,ye)=>xe.map(ie=>ie[ye])),he=[],W=Math.abs(ae.end-ae.start)+1;for(const[oe,ye]of ne.entries()){const ie=G[oe],H=as.populateFillHandle({column:ie,highlightedData:ye,numberOfRows:W});H&&he.push(H)}const j=[],Ee=(Y=c.value)==null?void 0:Y.path,{cachedRows:Ye}=h(Ee);let Ge=0;const ke={};for(let oe=ae.start+ve*L.length;ve===1?oe<=ae.end:oe>=ae.end;oe+=ve){const ye=e(Ye).get(oe);if(ye){for(const[ie,H]of G.entries()){const Ae=El({value:he[ie][Ge],to:H.uidt,column:H,appInfo:e(g),maxAttachmentsAllowedInCell:C.value,showUpgradeToAddMoreAttachmentsInCell:w,isInfoShown:ke[H.title],markInfoShown:()=>{ke[H.title]=!0}},b((we=d.value)==null?void 0:we.source_id),!0);ye.row[H.title]=Ae}j.push(ye)}Ge++}await(r==null?void 0:r(j,G.map(oe=>oe.title),void 0,void 0,Ee))};return{getFillHandlerPosition:a,handleFillStart:F,handleFillMove:E,handleFillEnd:async()=>{var L,G,ae,ve;if(t.value)try{x.value=!0;const xe=!!n.value,ne=(L=c.value)==null?void 0:L.path,{cachedRows:he}=h(ne);if(S.value===null)return;if(o.value._start!==null&&o.value._end!==null){const W={row:o.value._start.row,col:o.value._start.col};let j,Ee;const Ye=Math.min(S.value.start.col,S.value.end.col,o.value._start.col,o.value._end.col),Ge=Math.max(S.value.start.col,S.value.end.col,o.value._start.col,o.value._end.col);S.value?(j=Math.min(S.value.start.row,o.value._start.row),Ee=Math.max(S.value.end.row,o.value._start.row)):(j=o.value.start.row,Ee=o.value.end.row);const ke=await y(j,Ee,ne),we=e(s).slice(Ye,Ge+1).map(lt=>lt.columnObj),oe=ep(ke,we,{isPg:_,isMysql:b,meta:e(d)},{skipUidt:[pe.Percent,pe.Currency]}).json,ye=o.value._start.row<=o.value._end.row?1:-1,ie=Math.max(S.value.start.row,S.value.end.row),H=Math.min(S.value.start.row,S.value.end.row);if(!xe){await M({rawMatrix:oe,cpCols:we,rowToPaste:{start:ye===1?Math.min(H,o.value._start.row):Math.max(ie,o.value._start.row),end:ye===1?Math.max(ie,o.value._end.row):Math.min(H,o.value._end.row)}}),c.value.column=W.col,c.value.row=W.row,c.value.path=ne,S.value=null,t.value=!1;return}let Ae=ye===1?0:oe.length-1;const Ie=[],ce=[],te=[],Le=[],Ne={};for(let lt=o.value._start.row;ye===1?lt<=o.value._end.row:lt>=o.value._end.row;lt+=ye){const je=e(he).get(lt);if(!je)continue;let He=0;$.value[`${lt}-${o.value.start.col}`]||Ie.push(je);for(let Q=o.value.start.col;Q<=o.value.end.col;Q++){const Mt=e(s)[Q],_e=Mt==null?void 0:Mt.columnObj;if(!_e){He++;continue}if(!f(je,_e)){He++;continue}if(o.value._start&&o.value._end&&o.value._start.col<=Q&&Q<=o.value._end.col){we.findIndex(It=>It.id===_e.id)===-1&&(Le.includes(_e.title)||te.push(_e.title)),!te.includes(_e.title)&&!Le.includes(_e.title)&&te.push(_e.title);let wn;try{wn=El({value:(G=oe[Ae])==null?void 0:G[He],to:_e.uidt,column:_e,appInfo:e(g),maxAttachmentsAllowedInCell:C.value,showUpgradeToAddMoreAttachmentsInCell:w,isInfoShown:Ne[_e.title],markInfoShown:()=>{Ne[_e.title]=!0}},b((ae=d.value)==null?void 0:ae.source_id),!0)}catch(It){if(It instanceof bi)throw It;wn=null}wn!==void 0&&(xe||(je.row[_e.title]=wn))}else xe&&(Le.push(_e.title),ce.find(wn=>{var It,Tt;return qt(wn.row,(It=d.value)==null?void 0:It.columns)===qt(je.row,(Tt=d.value)==null?void 0:Tt.columns)})||ce.push(je));He++}ye===1?Ae=Ae<oe.length-1?Ae+1:0:Ae=Ae>=1?Ae-1:oe.length-1}if(xe){const lt=ke.map(He=>{var Mt;const Q={Id:qt(He.row,(Mt=d.value)==null?void 0:Mt.columns)};for(const _e of te)Q[_e]=He.row[_e];for(const _e of Le)Q[_e]="FILL";return Q}),je=Ie.map(He=>{var Q;return qt(He.row,(Q=d.value)==null?void 0:Q.columns)});m.ai.dataFill((ve=d.value)==null?void 0:ve.id,{rows:lt,generateIds:je,numRows:je.length}).then(He=>{if(!(o.value._start===null||o.value._end===null)){for(const Q of Ie.concat(ce)){const Mt=He.find(_e=>{var wn,It;return qt(Q.row,(wn=d.value)==null?void 0:wn.columns)===qt(_e,(It=d.value)==null?void 0:It.columns)});if(Mt)for(const _e of te.concat(Le))Q.row[_e]=Mt[_e]}r==null||r(Ie.concat(ce),te.concat(Le),void 0,void 0,ne).then(()=>{c.value.column=W.col,c.value.row=W.row,S.value=null,t.value=!1})}}).catch(He=>{o.value.clear(),S.value=null,t.value=!1});return}r==null||r(Ie,te,void 0,void 0,ne).then(()=>{c.value.column=W.col,c.value.row=W.row,c.value.path=ne,S.value=null,t.value=!1})}else S.value=null,t.value=!1}catch(xe){(!(xe instanceof za)||!xe.isErrorSuppressed)&&(console.error(xe,xe.isErrorSuppressed),tn.error((xe==null?void 0:xe.message)||"Something went wrong"))}}}}function xC({isDragging:t,draggedRowGroupPath:n,draggedRowIndex:o,targetRowIndex:l,canvasRef:a,rowHeight:i,updateRecordOrder:s,triggerRefreshCanvas:r,scrollToCell:d,elementMap:c,getDataCache:f}){const v=V(0),h=V(0),y=(C,w)=>{const S=w,x=c.findElementAt(C,S);if(x!=null&&x.isRow||x!=null&&x.isAddNewRow)return x},b=C=>{var F;const w=(F=a.value)==null?void 0:F.getBoundingClientRect();if(!w)return;const S=y(C.clientX-w.left,C.clientY-w.top);if(!S)return;const{cachedRows:x}=f(S.groupPath),$=S.rowIndex,I=x.value.get($);I&&(I.rowMeta.isDragging=!0,x.value.set($,I),t.value=!0,o.value=$,l.value=$+1,v.value=C.clientY,h.value=C.clientY,n.value=S.groupPath,window.addEventListener("mousemove",_),window.addEventListener("mouseup",m))};function _(C){var F;h.value=C.clientY;const w=(F=a.value)==null?void 0:F.getBoundingClientRect();if(!w)return;const S=y(C.clientX-w.left,C.clientY-w.top+i.value/2);if(!S||!Al(S.groupPath,n.value))return;const{totalRows:x}=f(S.groupPath);l.value=S.rowIndex??x.value,r();const $=100,I=C.clientY-w.top;I<$?d(Math.max(0,l.value-2),0):I>w.height-$&&d(Math.min(x.value-1,l.value+2),0)}async function m(){if(o.value!==null&&o.value+1!==l.value){const{totalRows:C}=f(n.value);await s(o.value,l.value===C.value?null:l.value,void 0,void 0,n.value)}g()}function g(){t.value=!1,o.value=null,l.value=null,n.value=null,window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",m),r()}return Ga(()=>{g()}),{handleDragStart:b}}const Cu=5e3;function kC({activeCell:t,columns:n,scrollToCell:o,selection:l,editEnabled:a,expandRows:i,view:s,meta:r,syncCellData:d,bulkUpsertRows:c,bulkUpdateRows:f,updateOrSaveRow:v,getRows:h,getDataCache:y}){const{$api:b}=da(),{isDataReadOnly:_}=gl(),{getMeta:m,metas:g}=oi(),{isMysql:C,isPg:w}=Ca(),{appInfo:S}=nl(),{addUndo:x,clone:$,defineViewScope:I}=Fi(),{t:F}=oa(),{isUIAllowed:E}=gl(),{copy:M}=qs(),{cleaMMCell:U,clearLTARCell:L,addLTARRef:G,syncLTARRefs:ae}=id(),{isSqlView:ve}=Il(),{isAllowed:xe}=od(),{maxAttachmentsAllowedInCell:ne,showUpgradeToAddMoreAttachmentsInCell:he}=ql(),{batchUploadFiles:W}=xi(),j=fn(Ea,Uo()),Ee=fn(zl,V(!1)),{base:Ye}=Go(Ca()),Ge=le(()=>(n.value??[]).map(ce=>ce.columnObj)),ke=le(()=>E("dataEdit")),Y=le(()=>{var ce;return ve.value||Ee.value||!ke.value?!1:!a.value||a.value&&yd.includes((ce=a.value.column)==null?void 0:ce.uidt)&&!(t.value.row===-1||t.value.column===-1)});function we(ce,te,Le=!1,Ne=!1){return!ce||!te?(Le&&tn.toast("Please select a cell to paste"),!1):(te.id&&xe(vl.FIELD,te.id,fl.RECORD_FIELD_EDIT),(xo(te)||ra(te)||te!=null&&te.readonly)&&(!Ne||!hl(te))?(Le&&tn.toast(F("msg.info.pasteNotSupported")),!1):te.ai?(Le&&tn.toast(F("msg.info.autoIncFieldNotEditable")),!1):te.pk&&!ce.rowMeta.new?(Le&&tn.toast(F("msg.info.editingPKnotSupported")),!1):!0)}const oe=async ce=>{var He,Q,Mt,_e,wn,It,Tt,Je,cn,Pn,Et,Rn,mt,ot,gt,zt,Ht,Yt,Xt,un,bt,xt,ct,ft,Be,at,kt,st,qe,u,R;if(!Y.value||!((He=r.value)!=null&&He.id)||sa()||Wl()||Vi()||Hf()||$h()||Yf()||qf()||Xf()||nd())return;ce.preventDefault();const te=t.value.path,Le=y(te),{totalRows:Ne,cachedRows:lt}=Le;let je=((Q=ce.clipboardData)==null?void 0:Q.getData("text/plain"))||"";je!=null&&je.endsWith(`
`)&&(je=je.replace(/\n$/,""));try{if(je!=null&&je.includes(`
`)||je!=null&&je.includes("	")){const P=sv.parse(je,{delimiter:"	",escapeChar:"\\"});if(P.errors.length>0)return tn.error((Mt=P.errors[0])==null?void 0:Mt.message);let D=P.data;D=D.map(ze=>ze.map(wt=>wt==="null"?"":wt));let fe=!1;D.length>Cu&&(D=D.slice(0,Cu),fe=!0);const K=Math.max(D.length,l.value.end.row-l.value.start.row+1),O=((_e=D[0])==null?void 0:_e.length)||0,Z=t.value.column,ee=e(Ge).length-Z,Me=Math.max(0,O-ee),We=Ne.value,Xe=l.value.start.row,nt=Math.max(0,We-Xe),et=Math.max(0,K-nt);let ut={continue:!1,expand:et>0||Me>0};if(ut.expand&&(ut=await(i==null?void 0:i({newRows:et,newColumns:Me,cellsOverwritten:Math.min(nt,K)*(O-Me),rowsUpdated:Math.min(nt,K)})),!ut.continue))return;let Ke;const Qe=[];if(ut.expand){if(Ke=Ge.value.slice(l.value.start.col,l.value.start.col+O),Me>0){const ze=(await b.dbTableColumn.hash((wn=r.value)==null?void 0:wn.id)).hash,wt=((Tt=(It=r.value)==null?void 0:It.columns)==null?void 0:Tt.length)||0;for(let q=0;q<Me;q++){const Fe={uidt:pe.SingleLineText,order:wt+q,column_order:{order:wt+q,view_id:(Je=s.value)==null?void 0:Je.id},view_id:(cn=s.value)==null?void 0:cn.id,table_name:(Pn=r.value)==null?void 0:Pn.table_name},vt=Mf({metaColumns:[...((Et=r.value)==null?void 0:Et.columns)??[],...Qe.map(({column:Re})=>Re)],formState:Fe});Qe.push({op:"add",column:{...Fe,title:vt}})}await b.dbTableColumn.bulk((Rn=r.value)==null?void 0:Rn.id,{hash:ze,ops:Qe}),await m((mt=r==null?void 0:r.value)==null?void 0:mt.id,!0),Ke=[...Ke,...Qe.map(({column:q})=>q)]}}else Ke=Ge.value.slice(l.value.start.col,l.value.start.col+O);await h(l.value.start.row,l.value.start.row+D.length,te);const ht=e(lt),Vt=[],Pe=[],Se=[];let $t=!1;const be={};for(let ze=0;ze<K;ze++){const wt=ze%D.length;let q;if(ze<nt){const Fe=Xe+ze;q=$(ht.get(Fe))||{row:{},oldRow:{},rowMeta:{isExistingRow:!0,rowIndex:Fe}},Vt.push(q)}else q={row:{},oldRow:{},rowMeta:{isExistingRow:!1}},Pe.push(q);if(D[wt])for(let Fe=0;Fe<D[wt].length;Fe++){const vt=Ke[Fe];if(vt)if(we(q,vt)){Se.push(vt.title);let Re;try{Re=El({value:D[wt][Fe],to:vt.uidt,column:vt,appInfo:e(S),oldValue:vt.uidt===pe.Attachment?q.row[vt.title]:void 0,maxAttachmentsAllowedInCell:ne.value,showUpgradeToAddMoreAttachmentsInCell:he,isInfoShown:be[vt.title],markInfoShown:()=>{be[vt.title]=!0}},C((ot=r.value)==null?void 0:ot.source_id),!0),rr(vt,Re)}catch(yt){if(yt instanceof bi)throw yt;if(yt instanceof sr)await dr({api:b,col:vt,addOptions:yt.missingOptions}),Re=yt.value.join(",");else if(yt instanceof za)Re=null;else throw yt}Re!==void 0&&(q.row[vt.title]=Re)}else(Qo(vt)||Cl(vt)||Yo(vt))&&!$t&&(tn.toast(F("msg.info.groupPasteIsNotSupportedOnLinksColumn")),$t=!0)}}ut.expand?(await(c==null?void 0:c(Pe,Vt,Se,void 0,Qe.map(({column:ze})=>ze),!1,te)),o==null||o(void 0,void 0,te)):await(f==null?void 0:f(Vt,Se,void 0,!1,te)),fe&&tn.warning(`Paste operation limited to ${Cu} rows. Additional rows were truncated.`)}else if(l.value.isSingleCell()){const P=e(lt).get(t.value.row),D=e(Ge)[t.value.column];if(!P||!D)return;if(Qo(D)&&!((gt=D.meta)!=null&&gt.custom)){if(!we(P,D,!0,!0))return;const K=El({value:je,to:D.uidt,column:D,appInfo:e(S)},C((zt=r.value)==null?void 0:zt.source_id));if(K===void 0||!Sa(K))return;const O=(Yt=(Ht=r.value)==null?void 0:Ht.columns)==null?void 0:Yt.find(ge=>{var ee;return ge.id===((ee=D.colOptions)==null?void 0:ee.fk_child_column_id)});if(!O)return;const Z=await m(D.colOptions.fk_related_model_id);return P.oldRow[D.title]=P.row[D.title],P.oldRow[O.title]=P.row[D.title]?qt(P.row[D.title],Z.columns):null,P.row[D.title]=K==null?void 0:K.value,P.row[O.title]=K!=null&&K.value?qt(K.value,Z.columns):null,await(d==null?void 0:d({...t.value,updatedColumnTitle:O.title},te))}if(Yo(D)){if(!we(P,D,!0,!0))return;const K=El({value:je,to:D.uidt,column:D,appInfo:e(S)},C((Xt=r.value)==null?void 0:Xt.source_id));if(K===void 0||!Sa(K))return;const O=qt(P.row,(un=r.value)==null?void 0:un.columns);if(!O)return;const Z=P.row[D.title];P.row[D.title]=K.value;let ge;try{ge=await b.dbDataTableRow.nestedListCopyPasteOrDeleteAll((bt=r.value)==null?void 0:bt.id,D.id,[{operation:"copy",rowId:K.rowId,columnId:K.columnId,fk_related_model_id:K.fk_related_model_id},{operation:"paste",rowId:O,columnId:D.id,fk_related_model_id:D.colOptions.fk_related_model_id||K.fk_related_model_id}],{viewId:(xt=s==null?void 0:s.value)==null?void 0:xt.id})}catch{P.row[D.title]=Z;return}if(ge&&(ge!=null&&ge.link)&&(ge!=null&&ge.unlink)&&Array.isArray(ge.link)&&Array.isArray(ge.unlink)){if(!ge.link.length&&!ge.unlink.length){P.row[D.title]=Z;return}x({redo:{fn:async(ee,Me,We,Xe,nt)=>{var Ke,Qe,ht,Vt,Pe,Se;const et=qt(We.row,(Ke=r.value)==null?void 0:Ke.columns),ut=e(lt).get(ee.row);!ut||!et||et===qt(ut.row,(Qe=r.value)==null?void 0:Qe.columns)&&D.id===Me.id&&(await Promise.all([nt.link.length&&b.dbDataTableRow.nestedLink((ht=r.value)==null?void 0:ht.id,D.id,encodeURIComponent(et),nt.link,{viewId:(Vt=s==null?void 0:s.value)==null?void 0:Vt.id}),nt.unlink.length&&b.dbDataTableRow.nestedUnlink((Pe=r.value)==null?void 0:Pe.id,D.id,encodeURIComponent(et),nt.unlink,{viewId:(Se=s==null?void 0:s.value)==null?void 0:Se.id})]),ut.row[D.title]=Xe,await(d==null?void 0:d(ee,ee==null?void 0:ee.path)))},args:[$(t.value),$(D),$(P),$(K.value),ge]},undo:{fn:async(ee,Me,We,Xe,nt)=>{var Ke,Qe,ht,Vt,Pe,Se;const et=qt(We.row,(Ke=r.value)==null?void 0:Ke.columns),ut=e(lt).get(ee.row);!ut||!et||et===qt(ut.row,(Qe=r.value)==null?void 0:Qe.columns)&&D.id===Me.id&&(await Promise.all([nt.unlink.length&&b.dbDataTableRow.nestedLink((ht=r.value)==null?void 0:ht.id,D.id,encodeURIComponent(et),nt.unlink),nt.link.length&&b.dbDataTableRow.nestedUnlink((Vt=r.value)==null?void 0:Vt.id,D.id,encodeURIComponent(et),nt.link)]),ut.row[D.title]=Xe,await(d==null?void 0:d((Se=(Pe=ee.activeCell)==null?void 0:Pe.value)==null?void 0:Se.path)))},args:[$(t.value),$(D),$(P),$(Z),ge]},scope:I({view:s==null?void 0:s.value})})}return await(d==null?void 0:d(t.value,te))}if(!we(P,D,!0))return;let fe;try{fe=El({value:je,to:D.uidt,column:D,appInfo:e(S),files:D.uidt===pe.Attachment&&((ft=(ct=ce.clipboardData)==null?void 0:ct.files)!=null&&ft.length)?(Be=ce.clipboardData)==null?void 0:Be.files:void 0,oldValue:P.row[D.title],maxAttachmentsAllowedInCell:ne.value,showUpgradeToAddMoreAttachmentsInCell:he},C((at=r.value)==null?void 0:at.source_id)),rr(D,fe)}catch(K){if(K instanceof bi)throw K;if(K instanceof sr)await dr({api:b,col:D,addOptions:K.missingOptions}),fe=K.value.join(",");else if(K instanceof za)fe=null;else throw K}if(D.uidt===pe.Attachment&&((st=(kt=ce.clipboardData)==null?void 0:kt.files)!=null&&st.length)&&(fe!=null&&fe.length)){const K=await ye(fe,D.id,P.row[D.title])||[],O=Rl(P.row[D.title])?P.row[D.title]:[];P.row[D.title]=K.length||O.length?JSON.stringify(O.concat(K)):null}else fe!==void 0&&(P.row[D.title]=fe);await(d==null?void 0:d(t.value,te))}else{const{start:P,end:D}=l.value,fe=Math.min(P.row,D.row),K=Math.max(P.row,D.row),O=Math.min(P.col,D.col),Z=Math.max(P.col,D.col),ge=await h(fe,K,te),ee=e(Ge).slice(O,Z+1),Me=[];let We,Xe=!1;const nt={},et=(qe=ce.clipboardData)==null?void 0:qe.files;for(const ut of ge)if(!(!ut||ut.rowMeta.new))for(const Ke of ee){if(!Ke.title||!we(ut,Ke)){(Qo(Ke)||Cl(Ke)||Yo(Ke))&&!Xe&&(tn.toast(F("msg.info.groupPasteIsNotSupportedOnLinksColumn")),Xe=!0);continue}if(et!=null&&et.length){if(Ke.uidt!==pe.Attachment)continue;if(We===void 0){const Qe=El({value:"",to:Ke.uidt,column:Ke,appInfo:e(S),files:et,oldValue:ut.row[Ke.title],maxAttachmentsAllowedInCell:ne.value,showUpgradeToAddMoreAttachmentsInCell:he,isInfoShown:nt[Ke.title],markInfoShown:()=>{nt[Ke.title]=!0}},C((u=r.value)==null?void 0:u.source_id),!0);if(Qe!=null&&Qe.length){const ht=await ye(Qe,Ke.id,ut.row[Ke.title]);We=ht?JSON.stringify(ht):null}}}else try{We=El({value:je,to:Ke.uidt,column:Ke,appInfo:e(S),oldValue:ut.row[Ke.title],maxAttachmentsAllowedInCell:ne.value,showUpgradeToAddMoreAttachmentsInCell:he,isInfoShown:nt[Ke.title],markInfoShown:()=>{nt[Ke.title]=!0}},C((R=r.value)==null?void 0:R.source_id),!0),rr(Ke,We)}catch(Qe){if(Qe instanceof bi)throw Qe;if(Qe instanceof sr)await dr({api:b,col:Ke,addOptions:Qe.missingOptions}),We=Qe.value.join(",");else if(Qe instanceof za)We=null;else throw Qe}Me.push(Ke.title),We!==void 0&&(ut.row[Ke.title]=We)}if(!Me.length)return;await(f==null?void 0:f(ge,Me,void 0,!1,te))}}catch(P){(!(P instanceof za)||!P.isErrorSuppressed)&&(console.error(P,P.isErrorSuppressed),tn.error(await pl(P)))}};async function ye(ce,te,Le){var lt;const Ne=[];try{const je=await W(ce,[ya,Ye.value.id,(lt=r.value)==null?void 0:lt.id,te].join("/"));for(const He of je)Ne.push({...He,title:Tf(He==null?void 0:He.title,[...Ie(Le),...Ne].map(Q=>(Q==null?void 0:Q.title)||(Q==null?void 0:Q.fileName)))});return Ne}catch(je){tn.error(await pl(je)||F("msg.error.internalError"))}}const ie=async(ce,te)=>{var He;const{html:Le,text:Ne}=ep(ce,te,{meta:r.value,isPg:w,isMysql:C}),lt=new Blob([Le],{type:"text/html"}),je=new Blob([Ne],{type:"text/plain"});return((He=navigator.clipboard)==null?void 0:He.write([new ClipboardItem({[lt.type]:lt,[je.type]:je})]))??M(Ne)};async function H(ce,te=!1){var Mt;if(!ce)return;const Le=ce==null?void 0:ce.path,Ne=y(Le),{cachedRows:lt}=Ne,je=n.value[ce.col],He=lt.value.get(ce.row);if(!je||!(je!=null&&je.columnObj)||!He||!je.isCellEditable)return;const Q=je.columnObj;if(!Q||_.value||!ce||!ke.value||Q.readonly||ra(Q)&&!hl(Q)||!hl(Q)&&xo(Q)){(Q.readonly||ra(Q)&&!hl(Q)||!hl(Q)&&xo(Q))&&tn.toast(F("msg.info.computedFieldClearWarning"));return}if(xo(Q)){let _e;const wn=He.row[Q.title],It=Q.fk_model_id===((Mt=Q.colOptions)==null?void 0:Mt.fk_related_model_id);Yo(Q)&&He&&(_e=await U(He,Q)),x({undo:{fn:async(Tt,Je,cn,Pn,Et,Rn)=>{var zt,Ht,Yt;const mt=qt(cn.row,(zt=r.value)==null?void 0:zt.columns),ot=lt.value.get(Tt.row),gt=Ge.value[Tt.col];if(ot&&gt&&gt.title&&mt===qt(ot.row,(Ht=r.value)==null?void 0:Ht.columns)&&gt.id===Je.id)Qo(gt)||Cl(gt)?(ot.row[gt.title]=cn.row[gt.title],await G(ot,ot.row[gt.title],gt),await ae(ot,ot.row)):Yo(gt)&&(await b.dbDataTableRow.nestedLink((Yt=r.value)==null?void 0:Yt.id,gt.id,encodeURIComponent(mt),Pn),ot.row[gt.title]=Et??null),t.value.column=Tt.col,t.value.row=Tt.row,t.value.path=Le,Rn&&j.trigger({shouldShowLoading:!1}),o==null||o(void 0,void 0,Le);else throw new Error(F("msg.recordCouldNotBeFound"))},args:[$(ce),$(Q),$(He),_e,wn,It]},redo:{fn:async(Tt,Je,cn,Pn)=>{var ot,gt;const Et=qt(cn.row,(ot=r.value)==null?void 0:ot.columns),Rn=lt.value.get(Tt.row),mt=Ge.value[Tt.col];if(Rn&&Et===qt(Rn.row,(gt=r.value)==null?void 0:gt.columns)&&mt&&mt.id===Je.id)Qo(mt)||Cl(mt)?await L(Rn,mt):Yo(mt)&&await U(Rn,mt),t.value.column=Tt.col,t.value.row=Tt.row,t.value.path=Le,Pn&&j.trigger({shouldShowLoading:!1}),o==null||o(void 0,void 0,Le);else throw new Error(F("msg.recordCouldNotBeFound"))},args:[$(ce),$(Q),$(He),It]},scope:I({view:s.value})}),(Qo(Q)||Cl(Q))&&await L(He,Q),It&&j.trigger({shouldShowLoading:!1});return}if(Q.title)switch(Q.uidt){case pe.Checkbox:He.row[Q.title]=!1;break;case pe.Rating:He.row[Q.title]=0;break;default:He.row[Q.title]=null;break}te||await(v==null?void 0:v(He,Q.title,void 0,void 0,void 0,Le))}async function Ae(ce,te=[]){try{if(l.value.start!==null&&l.value.end!==null&&!l.value.isSingleCell()){const Le=await h(l.value.start.row,l.value.end.row,te),Ne=e(Ge).slice(l.value.start.col,l.value.end.col+1);await ie(Le,Ne),tn.toast(F(`msg.toast.nCell${Le.length*Ne.length===1?"":"s"}Copied`,{n:Le.length*Ne.length}))}else{const Le=y(te),Ne=(ce==null?void 0:ce.row)??t.value.row,lt=(ce==null?void 0:ce.col)??t.value.column;if(Ne!=null&&lt!=null){const je=e(Le.cachedRows).get(Ne),He=e(Ge)[lt];if(!je||!He)return;const Q=Zv(je,He,{meta:r.value,metas:g.value,isPg:w,isMysql:C});await M(ua(Q)?Q:""),tn.toast(F("msg.toast.nCellCopied",{n:1}))}}}catch(Le){console.log(Le),tn.error(F("msg.error.copyToClipboardError"))}}function Ie(ce){const te=jn(ce);return te&&Array.isArray(te)?te:[]}return Ml(document,"paste",oe),{copyValue:Ae,clearCell:H,isPasteable:we}}const Vu=(t,n,o,l=[],a)=>{const i=`${o.id}-${o.uidt}-${t}-${n==null?void 0:n.toString()}-${l.join("-")}`,s=pc.get(i);if(!Si(s))return ua(s)?s:void 0;const r=Oh(t,n,o,a);return pc.set(i,r),ua(r)?r:void 0};function CC({rowHeightEnum:t,cachedRows:n,clearCache:o,chunkStates:l,totalRows:a,actualTotalRows:i,loadData:s,scrollLeft:r,scrollTop:d,width:c,height:f,scrollToCell:v,aggregations:h,vSelectedAllRecords:y,selectedRows:b,updateRecordOrder:_,expandRows:m,updateOrSaveRow:g,bulkUpdateRows:C,bulkUpsertRows:w,expandForm:S,addEmptyRow:x,onActiveCellChanged:$,addNewColumn:I,mousePosition:F,setCursor:E,getRows:M,cachedGroups:U,toggleExpand:L,totalGroups:G,groupSyncCount:ae,groupByColumns:ve,fetchMissingGroupChunks:xe,getDataCache:ne}){const{metas:he,getMeta:W,getPartialMeta:j}=oi(),{getBaseRoles:Ee}=Es(),{isAllowed:Ye}=od(),Ge=V({start:0,end:0}),ke=V({start:0,end:0}),Y=V({row:-1,column:-1,path:[]}),we=V(new zs),oe=V({path:[],rowIndex:-2}),ye=V(null),ie=V(!1),H=V(null),Ae=new Sk(()=>Mn()),Ie=new Ik(()=>Mn()),ce=new lC(W,()=>Mn),te=new sC(Ee,()=>Mn),Le=fn(Js,void 0),Ne=fn(Ea,Uo()),lt=new Qv([]),je=V(!1),He=V(-1),Q=V([]),Mt=V(-1),_e=V({isHoveredLearnMore:!1,isHoveredUpgrade:!1}),{isMobileMode:wn}=nl(),{$api:It}=da(),{t:Tt}=oa(),{gridViewCols:Je,metaColumnById:cn,updateGridViewColumn:Pn}=Ha(),{eventBus:Et,isDefaultView:Rn,meta:mt,allFilters:ot,sorts:gt,isPkAvail:zt,view:Ht,isSqlView:Yt,isExternalSource:Xt,isAlreadyShownUpgradeModal:un,gridEditEnabled:bt}=Il(),{addUndo:xt,defineViewScope:ct}=Fi(),{activeView:ft}=Go(wr()),{meta:Be,ctrl:at}=Ef(),{isDataReadOnly:kt,isUIAllowed:st}=gl(),{isAiFeaturesEnabled:qe,aiIntegrations:u,generateRows:R}=xr(),P=Pm(),D=sl(),{blockExternalSourceRecordVisibility:fe,blockRowColoring:K}=ql(),{isRowColouringEnabled:O}=ld(),Z=fn(gr,V([])),ge=Ca(),{isMysql:ee,isPg:Me}=ge,{sqlUis:We}=Go(ge),{basesUser:Xe}=Go(Es()),nt=le(()=>K.value?zc:zc+Vc+4),et=le(()=>O.value?Vc:0),ut=le(()=>{var Ve,Ut;return(Ve=mt.value)!=null&&Ve.base_id?Xe.value.get((Ut=mt.value)==null?void 0:Ut.base_id)||[]:[]}),{hideTooltip:Ke}=D,Qe=fn(zl,V(!1)),ht=fn(Ks,V(!1)),{loadAutomation:Vt}=P,Pe=new Ak(It,Vt,Da,mt,Mn,ne),Se=le(()=>{var Ve;return!!((Ve=ve.value)!=null&&Ve.length)}),$t=le(()=>!Se.value&&fe(Xt.value)&&a.value>=ll),be=le(()=>{var Ve;return(((Ve=mt.value)==null?void 0:Ve.columns)??[]).some(Ut=>$f(Ut))}),ze=le(()=>{var Ve,Ut;return!!((Ve=ot.value)!=null&&Ve.length)||!!((Ut=gt.value)!=null&&Ut.length)||Qe.value}),wt=le(()=>{var Ve;return((Ve=gt.value)==null?void 0:Ve.length)||Qe.value||!zt.value}),q=le(()=>st("dataEdit")&&!Yt.value&&!Qe.value),Fe=le(()=>st("fieldAdd")),vt=le(()=>be.value&&!wt.value),Re=le(()=>{var Ve;return q.value&&!((Ve=mt.value)!=null&&Ve.synced)}),yt=le(()=>{var Ve;return(Ve=mt.value)!=null&&Ve.id?Ye(vl.TABLE,mt.value.id,fl.TABLE_RECORD_ADD):!0}),_t=le(()=>!ht.value&&Fe.value&&!Yt.value),Ze=le(()=>wn.value?56:Wo[`${(t==null?void 0:t.value)??1}`]??32),on=le(()=>d.value%Ze.value),Kt=le(()=>(Va()?!!(Be!=null&&Be.value):!!(at!=null&&at.value))&&qe.value),nn=V([]),pt=le(()=>{var St;const Ve=[],Ut=Z.value.map(Ct=>{var Un,mo,Vl,Eo,yl,il,io,Fl,va,La,el;if(!Ct.id)return!1;const dn=Je.value[Ct.id];if(!dn)return!1;let _n,In;if(Ct.extra={},[pe.Lookup,pe.Rollup].includes(Ct.uidt)?(_n=(Vl=(mo=(Un=he.value)==null?void 0:Un[Ct.fk_model_id])==null?void 0:mo.columns)==null?void 0:Vl.find(no=>{var Ll;return no.id===((Ll=Ct==null?void 0:Ct.colOptions)==null?void 0:Ll.fk_relation_column_id)}),_n&&((Eo=_n.colOptions)!=null&&Eo.fk_related_model_id)&&((yl=he.value)!=null&&yl[_n.colOptions.fk_related_model_id]?In=(il=he.value)==null?void 0:il[_n.colOptions.fk_related_model_id]:Ve.push([_n.id,_n.colOptions.fk_related_model_id]))):Dh(Ct.uidt,Ct.colOptions)&&(io=Ct.colOptions)!=null&&io.fk_related_model_id&&((Fl=he.value)!=null&&Fl[Ct.colOptions.fk_related_model_id]?In=(va=he.value)==null?void 0:va[Ct.colOptions.fk_related_model_id]:Ve.push([Ct.id,Ct.colOptions.fk_related_model_id])),[pe.SingleSelect,pe.MultiSelect].includes(Ct.uidt)?Ct.extra=Nv(Ct):[pe.User,pe.CreatedBy,pe.LastModifiedBy].includes(Ct.uidt)&&(Ct.extra=Pv(Ct,ut.value)),[pe.DateTime].includes(Ct.uidt)&&(jn(Ct.meta),Ct.extra.timezone=void 0,Ct.extra.isDisplayTimezone=void 0),[pe.Formula].includes(Ct.uidt)&&[pe.DateTime].includes((La=Ct.meta)==null?void 0:La.display_type)){const no=(el=Ct.meta)==null?void 0:el.display_column_meta;if(no.meta){no.meta;const Ll={timezone:void 0};no.extra=Ll}}const Ot=Lh(Ct,u.value,Qe.value||!q.value||Yt.value),xn=We.value[Ct.source_id]??Object.values(We.value)[0],Qn=Qr(Ct)||!hf(Ct)||Ye(vl.FIELD,Ct.id,fl.RECORD_FIELD_EDIT),Jo=Vu(dn.aggregation,h.value[Ct.title],Ct,[],{col:Ct,meta:mt.value,metas:he.value,isMysql:ee,isPg:Me});return{id:Ct.id,grid_column_id:dn.id,title:Ct.title,uidt:Ct.uidt,width:dn.width,fixed:wn.value&&!Se.value?!1:Se.value?!!Ct.pv:hn(dn.width)>c.value*.75?!1:!!Ct.pv,readonly:Ct.readonly||kt.value||!q.value||Qe.value||!1,isCellEditable:Qn,pv:!!Ct.pv,virtual:xo(Ct),aggregation:Jo,agg_prefix:dn.aggregation?Tt(`aggregation.${dn.aggregation}`).replace("Percent ",""):"",agg_fn:dn.aggregation,columnObj:Ct,relatedColObj:_n,relatedTableMeta:In,isInvalidColumn:{...Ot,tooltip:Ot.ignoreTooltip?null:Ot.tooltip&&Tt(Ot.tooltip)},abstractType:xn==null?void 0:xn.getAbstractType(Ct)}}).filter(Ct=>!!Ct).sort((Ct,dn)=>!!dn.fixed-!!Ct.fixed);return nn.value.push(...Ve),Ut.splice(0,0,{id:"row_number",grid_column_id:"row_number",uidt:null,title:"#",width:`${nt.value+((St=ve.value)==null?void 0:St.length)*13}px`,fixed:!0,pv:!1,columnObj:{uidt:pe.AutoNumber}}),Ut}),mn=le(()=>pt.value.map(Ve=>{var Ut;return Ve.id==="row_number"?hn(Ve.width)-((Ut=ve.value)==null?void 0:Ut.length)*13:hn(Ve.width)})),ln=le(()=>mn.value.reduce((Ve,Ut)=>Ve+Ut,0)),so=le(()=>!Yt.value),Sn=le(()=>{var Ve;if(we.value.start.col===we.value.end.col){const Ut=pt.value[we.value.start.col],St=Ut==null?void 0:Ut.columnObj;return St?{enabled:_a(St)||is(St),disabled:!((Ve=St==null?void 0:St.colOptions)!=null&&Ve.fk_integration_id)}:{enabled:!1,disabled:!1}}return{enabled:!1,disabled:!1}}),yn=le(()=>{if(we.value.start.col===we.value.end.col){const Ve=pt.value[we.value.start.col],Ut=Ve==null?void 0:Ve.columnObj;return Ut?{enabled:Of(Ut),disabled:!1}:{enabled:!1,disabled:!1}}return{enabled:!1,disabled:!1}}),kn=le(()=>{var Ve;return we.value.isEmpty()&&Y.value.column&&((Ve=pt.value[Y.value.column])==null?void 0:Ve.virtual)||!we.value.isEmpty()&&Array.from({length:we.value.end.col-we.value.start.col+1}).every((Ut,St)=>{var Ct;return!((Ct=pt.value[we.value.start.col+St])!=null&&Ct.isCellEditable)})}),jt=le(()=>{var Ut,St,Ct,dn,_n;const Ve=ne((Ut=Y==null?void 0:Y.value)==null?void 0:Ut.path);return!(!kt.value&&!ht.value&&(!ye.value||yd.includes((Ct=(St=ye.value)==null?void 0:St.column)==null?void 0:Ct.uidt))&&(!we.value.isEmpty()||Y.value.row!==null&&Y.value.column!==null)&&!((_n=(dn=Ve.cachedRows.value.get((isNaN(we.value.end.row)?Y.value.row:we.value.end.row)??-1))==null?void 0:dn.rowMeta)!=null&&_n.new)&&Y.value.column!==null&&Z.value[Y.value.column-1]&&Ve.totalRows.value&&!kn.value&&!Yt.value)}),an=le(()=>{let Ve=0;return ve.value.length&&(Ve+=ve.value.length*13),pt.value.reduce((Ut,St)=>Ut+hn(St.width),Ve)+256}),rn=le(()=>{switch(ve.value.length){case 1:return"#F9F9FA";case 2:return"#F4F4F5";case 3:return"#E7E7E9";default:return"#F9F9FA"}}),En=(Ve,Ut=0,St=mn.value.length)=>{let Ct=0;for(let dn=0;dn<St;dn++){if(Ct>Ve)return Math.max(0,dn-1);Ct+=mn.value[dn]??0}return St-1};function Yn(Ve,Ut=0){let St=0;const Ct=pt.value.filter(Ot=>Ot.fixed);for(const Ot of Ct){const xn=mn.value[pt.value.indexOf(Ot)]??180;if(Ve>=St&&Ve<St+xn)return Ot.uidt||(St+=xn),{column:Ot,xOffset:St};St+=xn}const dn=ke.value.start,_n=ke.value.end;St=mn.value.slice(0,dn).reduce((Ot,xn)=>Ot+xn,0)-Ut,ve.value.length&&(St+=ve.value.length*13);for(let Ot=dn;Ot<_n;Ot++){const xn=mn.value[Ot]??180;if(Ve>=St&&Ve<St+xn)return{column:pt.value[Ot],xOffset:St};St+=xn}return{column:null,xOffset:St}}function ao(Ve,Ut=0){let St=0;const Ct=pt.value.filter(Ot=>Ot.fixed);for(const Ot of Ct){const xn=mn.value[pt.value.indexOf(Ot)]??180;if(Ve===Ot.id)return Ot.uidt||(St+=xn),{column:Ot,xOffset:St,width:Ot.width};St+=xn}const dn=ke.value.start,_n=ke.value.end;St=mn.value.slice(0,dn).reduce((Ot,xn)=>Ot+xn,0)-Ut,ve.value.length&&(St+=ve.value.length*13);for(let Ot=dn;Ot<_n;Ot++){const xn=mn.value[Ot]??180;if(pt.value[Ot]&&Ve===pt.value[Ot].id)return{column:pt.value[Ot],xOffset:St,width:pt.value[Ot].width};St+=xn}return{column:null,xOffset:St,width:"0px"}}function Zn(Ve,Ut,St=[]){const Ct=pr(U.value,St,Ut,Ze.value,Re.value)-d.value+Ao;if(Ve.fixed){let In=0;for(let Ot=0;Ot<pt.value.length;Ot++){const xn=pt.value[Ot];if((xn==null?void 0:xn.id)===Ve.id)break;xn!=null&&xn.fixed&&(In+=hn(xn==null?void 0:xn.width))}return{x:In,y:Ct,width:hn(Ve.width),height:Ze.value}}let dn=Fk;pt.value.forEach(In=>{In.fixed&&(dn+=hn(In.width))});const _n=dn;for(const In of pt.value){if(In.id===Ve.id)break;In.fixed||(dn+=hn(In.width))}return{x:_n+(dn-_n)-r.value,y:Ct,width:hn(Ve.width),height:Ze.value}}const So=()=>{var dn,_n,In;if(jt.value)return null;const Ve=Y==null?void 0:Y.value.path;if((we.value.end.row<Ge.value.start||we.value.end.row>=Ge.value.end)&&!Se.value||Se.value&&Ve&&!rC(U.value,Ve))return null;if(we.value.isSingleCell()){if($t.value&&we.value.start.row>=ll)return null;const Ot=pt.value[we.value.end.col];if(Ot!=null&&Ot.virtual||ra(Ot==null?void 0:Ot.columnObj)||Ot!=null&&Ot.columnObj&&_a(Ot==null?void 0:Ot.columnObj))return null}else if(pt.value.slice(we.value.start.col,we.value.end.col+1).every(Qn=>Qn==null?void 0:Qn.virtual))return null;let Ut=0;const St=pt.value.filter(Ot=>Ot.fixed);for(let Ot=0;Ot<=Math.min(we.value.end.col,St.length-1);Ot++)(dn=pt.value[Ot])!=null&&dn.fixed&&(Ut+=hn((_n=pt.value[Ot])==null?void 0:_n.width));for(let Ot=St.length;Ot<=we.value.end.col;Ot++)Ut+=hn((In=pt.value[Ot])==null?void 0:In.width);we.value.end.col>=St.length&&(Ut-=r.value);const Ct=pr(U.value,Ve,we.value.end.row,Ze.value,Re.value)-d.value+Ao+Ze.value;return{x:Ut,y:Ct,size:Kt.value?10:8,fixedCol:we.value.end.col<St.length}},{handleCellClick:To,renderCell:Ue,handleCellHover:Mo,handleCellKeyDown:qn}=oC({getCellPosition:Zn,actionManager:Pe,updateOrSaveRow:g,makeCellEditable:wl,meta:mt,hasEditPermission:q,setCursor:E}),{canvasRef:eo,renderCanvas:to,colResizeHoveredColIds:Zo}=vC({width:c,mousePosition:F,elementMap:lt,height:f,columns:pt,colSlice:ke,groupByColumns:ve,cachedGroups:U,scrollLeft:r,baseColor:rn,scrollTop:d,totalGroups:G,rowSlice:Ge,rowHeight:Ze,activeCell:Y,dragOver:H,hoverRow:oe,selection:we,getFillHandlerPosition:So,isAiFillMode:Kt,isFillMode:ie,imageLoader:Ie,spriteLoader:Ae,tableMetaLoader:ce,partialRowHeight:on,vSelectedAllRecords:y,isRowDraggingEnabled:vt,selectedRows:b,isDragging:je,draggedRowIndex:He,targetRowIndex:Mt,renderCell:Ue,meta:mt,editEnabled:ye,totalWidth:an,totalRows:a,actualTotalRows:i,t:Tt,isAddingColumnAllowed:_t,readOnly:ht,isFieldEditAllowed:Fe,setCursor:E,isGroupBy:Se,totalColumnsWidth:ln,getDataCache:ne,fetchMissingGroupChunks:xe,getRows:M,draggedRowGroupPath:Q,isAddingEmptyRowAllowed:Re,isAddingEmptyRowPermitted:yt,removeInlineAddRecord:$t,upgradeModalInlineState:_e,rowMetaColumnWidth:nt,rowColouringBorderWidth:et}),{handleDragStart:ul}=xC({canvasRef:eo,rowHeight:Ze,isDragging:je,draggedRowGroupPath:Q,draggedRowIndex:He,targetRowIndex:Mt,scrollToCell:v,triggerRefreshCanvas:Mn,updateRecordOrder:_,elementMap:lt,getDataCache:ne}),{fetchChunk:ai,updateVisibleRows:Ma}=fC({cachedRows:n,chunkStates:l,clearCache:o,totalRows:a,loadData:s,rowSlice:Ge,triggerRefreshCanvas:Mn,isAlreadyShownUpgradeModal:un,isExternalSource:Xt}),{clearCell:Cn,copyValue:Ta,isPasteable:Ka}=kC({activeCell:Y,selection:we,columns:pt,editEnabled:ye,scrollToCell:v,expandRows:m,view:Ht,meta:mt,syncCellData:async(Ve,Ut=[])=>{var In;const St=ne(Ut),Ct=St.cachedRows.value.get(Ve.row),dn=Ve.column!==void 0?Z.value[Ve.column-1]:null;if(!Ct||!dn){Mn();return}if(!Ve.updatedColumnTitle&&xo(dn)){dn.fk_model_id===((In=dn.colOptions)==null?void 0:In.fk_related_model_id)&&(Ne==null||Ne.trigger({shouldShowLoading:!1})),Mn();return}const _n=St.cachedRows.value.get(Ve.row);if(_n){const Ot={..._n,rowMeta:{..._n.rowMeta,isUpdatedFromCopyNPaste:{..._n.rowMeta.isUpdatedFromCopyNPaste||{},[Ve.updatedColumnTitle||dn.title]:!0}}};St.cachedRows.value.set(Ve.row,Ot),Mn()}await(g==null?void 0:g(Ct,Ve.updatedColumnTitle||dn.title,void 0,void 0,void 0,Ut)),Mn()},bulkUpdateRows:C,bulkUpsertRows:w,fetchChunk:ai,updateOrSaveRow:g,getRows:M,getDataCache:ne}),{handleFillEnd:Mi,handleFillMove:al,handleFillStart:fa}=_C({isFillMode:ie,isAiFillMode:Kt,selection:we,canvasRef:eo,getFillHandlerPosition:So,triggerReRender:Mn,getRows:M,meta:mt,columns:pt,bulkUpdateRows:C,isPasteable:Ka,activeCell:Y,elementMap:lt,getDataCache:ne}),$a=(Ve,Ut,St)=>{if(pt.value.findIndex(In=>In.id===Ve)===-1)return;const dn=cn.value[Ve];if(!dn)return;const _n=gC(dn,Ut);St(`${_n}px`),Le==null||Le.trigger()},Ja=(Ve,Ut)=>{var St,Ct,dn,_n;!((St=mt.value)!=null&&St.columns)||!((Ct=mt.value)!=null&&Ct.columnsById)||(mt.value.columns=(mt.value.columns||[]).map(In=>(In.id!==Ve||(In.meta={...jn(In.meta||{}),defaultViewColOrder:Ut}),In)),(_n=(dn=mt.value)==null?void 0:dn.columnsById)!=null&&_n[Ve]&&(mt.value.columnsById[Ve].meta={...jn(mt.value.columnsById[Ve].meta),defaultViewColOrder:Ut}))},{handleMouseMove:Xl,handleMouseDown:Oa,resizeableColumn:Qa,isResizing:it}=hC(eo,pt,ke,r,(Ve,Ut)=>$a(Ve,Ut,St=>Je.value[Ve].width=St),(Ve,Ut)=>$a(Ve,Ut,St=>Pn(Ve,{width:St}))),{isDragging:Kl,startDrag:No}=pC(eo,pt,ke,r,Mn,H,(Ve,Ut,St)=>{var Vl,Eo,yl,il,io;const Ct=pt.value[Ut],dn=pt.value[St];if(!Ct||!dn||!((Vl=mt.value)!=null&&Vl.columns))return;const _n=Je.value[Ct.id],In=Je.value[dn.id];if(!_n||!In)return;const Ot=St<pt.value.length-1?pt.value[St+1]:null,xn=Ot?Je.value[Ot.id]:null,Qn=pt.value[pt.value.length-1],Jo=Je.value[Qn.id];if(xn===null&&Jo===null)return;const Un=xn?In.order+(xn.order-In.order)/2:Jo.order+1,mo=_n.order;_n.order=Un,Rn.value&&_n.fk_column_id&&(mt.value.columns=(yl=((Eo=mt.value)==null?void 0:Eo.columns)??[])==null?void 0:yl.map(Fl=>(Fl.id!==_n.fk_column_id||(Fl.meta={...jn(Fl.meta||{}),defaultViewColOrder:Un}),Fl)),(io=(il=mt.value)==null?void 0:il.columnsById)!=null&&io[_n.fk_column_id]&&(mt.value.columnsById[_n.fk_column_id].meta={...jn(mt.value.columnsById[_n.fk_column_id].meta),defaultViewColOrder:Un})),xt({undo:{fn:async()=>{_n.order=mo,Rn.value&&Ja(_n.fk_column_id,mo),await Pn(Ct.id,{order:mo}),Et.emit(Xo.FIELD_RELOAD)},args:[]},redo:{fn:async()=>{_n.order=Un,Rn.value&&Ja(_n.fk_column_id,Un),await Pn(Ct.id,{order:Un}),Et.emit(Xo.FIELD_RELOAD)},args:[]},scope:ct({view:ft.value})}),Pn(Ct.id,{order:Un},!0),Et.emit(Xo.FIELD_RELOAD)});yC({activeCell:Y,triggerReRender:Mn,columns:pt,scrollToCell:v,selection:we,editEnabled:ye,isGroupBy:Se,cachedGroups:U,getDataCache:ne,copyValue:Ta,clearCell:Cn,clearSelectedRangeOfCells:Dl,makeCellEditable:wl,expandForm:S,isAddingEmptyRowAllowed:Re,isAddingEmptyRowPermitted:yt,addEmptyRow:x,onActiveCellChanged:$,addNewColumn:I,handleCellKeyDown:qn,removeInlineAddRecord:$t});const{handleMouseDown:Io,handleMouseMove:Po,handleMouseUp:_o}=bC({selection:we,activeCell:Y,canvasRef:eo,scrollLeft:r,columns:pt,triggerReRender:Mn,scrollToCell:v,elementMap:lt,getDataCache:ne});async function Dl(Ve){if(!q.value||kt.value)return;const Ut=we.value.start,St=we.value.end,Ct=Math.min(Ut.col,St.col),dn=Math.max(Ut.col,St.col),_n=pt.value.slice(Ct,dn+1),In=await M(Ut.row,St.row,Ve),Ot=[];let xn=!1;for(const Qn of In)for(const Jo of _n){const Un=Jo.columnObj;if(!(!Qn||!Un||!Un.title||!Jo.isCellEditable)){if(xo(Un)){(Qo(Un)||Cl(Un)||Yo(Un))&&!xn&&(tn.info(Tt("msg.info.groupClearIsNotSupportedOnLinksColumn")),xn=!0);continue}Fu(Un)||Un.readonly||(Qn.row[Un.title]=null,Ot.push(Un.title))}}await C(In,Ot,void 0,!1,Ve)}const Ko=V();Hn(()=>{var Ut;return Se.value&&!Y.value.path?null:ne(Y.value.path).cachedRows.value.get(((Ut=ye.value)==null?void 0:Ut.row.rowMeta.rowIndex)??1/0)},Ve=>{Ve!=null&&(Ko.value=Ve)},{deep:!0}),Hn(Ko,Ve=>{var Ut;(Ut=ye.value)!=null&&Ut.row&&(ye.value.row=Ve)},{deep:!0}),Hn(ye,Ve=>{bt.value=Ve});function Da(Ve,Ut){var St;return R((St=mt.value)==null?void 0:St.id,Ve,Ut)}function sn(Ve,Ut){var xn;const St=cn.value[Ut.id],Ct=Ve.rowMeta.rowIndex+1,dn=Ve.rowMeta.path;if(Se.value&&!dn&&!(dn!=null&&dn.legth))return;const _n=pr(U.value,dn,Ct,Ze.value,Re.value)+Ao;let In=(((xn=ve.value)==null?void 0:xn.length)??0)*13;const Ot=pt.value.findIndex(Qn=>Qn.id===Ut.id);if(Ut.fixed){const Qn=pt.value.filter(Jo=>Jo.fixed);for(const Jo of Qn){const Un=mn.value[pt.value.indexOf(Jo)]??10;if(Jo.id===Ut.id)break;In+=Un}}else{const Qn=ke.value.start,Jo=mn.value.slice(0,Qn).reduce((Un,mo)=>Un+mo,0);In+=Jo;for(let Un=Qn;Un<Ot;Un++)In+=mn.value[Un]??10}return ye.value={rowIndex:Ct,x:In+([pe.LongText,pe.Formula].includes(St.uidt)?-1:0),y:_n-1,column:St,row:Ve,minHeight:Ze.value,height:[pe.LongText,pe.Formula].includes(St.uidt)?"auto":Ze.value+2,width:hn(Ut.width)+([pe.LongText,pe.Formula].includes(St.uidt)?2:0)+2,fixed:Ut.fixed,path:dn,isCellEditable:Ut.isCellEditable},Ke(),!0}function wl(Ve,Ut,St=!0){const Ct=cn.value[Ut.id];if(Ve=typeof Ve=="number"?n.value.get(Ve):Ve,!Ve||!Ct)return null;if($t.value&&Ve.rowMeta.rowIndex&&Ve.rowMeta.rowIndex>=ll)return;const dn=Ct.id&&!Ye(vl.FIELD,Ct.id,fl.RECORD_FIELD_EDIT);if((!q.value||ht.value||Qe.value||!Re.value||dn)&&[pe.LongText,pe.Attachment,pe.JSON,pe.Links,pe.Lookup,pe.Barcode,pe.QrCode,pe.LinkToAnotherRecord,pe.Formula].includes(Ct.uidt)){sn(Ve,Ut);return}const _n=ra(Ct)&&!hl(Ct);if(!q.value||ye.value||ht.value||_n)return null;if(!zt.value&&!Ve.rowMeta.new)return tn.info(Tt("msg.info.updateNotAllowedWithoutPK")),null;if(Ct.ai)return tn.info(Tt("msg.info.autoIncFieldNotEditable")),null;if(Ct.pk&&!Ve.rowMeta.new)return tn.info(Tt("msg.info.editingPKnotSupported")),null;if(Ct.readonly)return tn.info(Tt("msg.info.fieldReadonly")),null;sn(Ve,Ut)}function Mn(){to()}return Hn(Ze,()=>{Jf(),Mn()}),Hn(Kt,()=>{Mn()}),Et.on(Ve=>{[Xo.TRIGGER_RE_RENDER,Xo.ON_ROW_COLOUR_INFO_UPDATE].includes(Ve)&&Nh(()=>{Ph(),Mn()})}),Hn(()=>nn.value.length,async()=>{nn.value.length&&(await Promise.all(nn.value.map(async([Ve,Ut])=>{try{await W(Ut,!1,!1,void 0,!0)}catch{}he.value[Ut]||await j(Ve,Ut)})),nn.value=[],Mn())}),{rowSlice:Ge,colSlice:ke,activeCell:Y,editEnabled:ye,rowHeight:Ze,totalWidth:an,columnWidths:mn,columns:pt,canvasRef:eo,isDragging:Kl,selection:we,hoverRow:oe,resizeableColumn:Qa,partialRowHeight:on,readOnly:ht,colResizeHoveredColIds:Zo,isResizing:it,fetchChunk:ai,updateVisibleRows:Ma,findColumnIndex:En,triggerRefreshCanvas:Mn,startDrag:No,findClickedColumn:Yn,findColumnPosition:ao,syncGroupCount:ae,totalGroups:G,isGroupBy:Se,fetchMissingGroupChunks:xe,groupByColumns:ve,cachedGroups:U,toggleExpand:L,elementMap:lt,makeCellEditable:wl,resizeMouseMove:Xl,startResize:Oa,onMouseUpSelectionHandler:_o,onMouseMoveSelectionHandler:Po,onMouseDownSelectionHandler:Io,onMouseDownFillHandlerStart:fa,onMouseMoveFillHandlerMove:al,onMouseUpFillHandlerEnd:Mi,isFillHandlerActive:ie,isFillHandleDisabled:jt,isRowReOrderEnabled:vt,onMouseDownRowReorderStart:ul,isRowReorderActive:je,isSelectedOnlyScript:yn,isSelectedOnlyAI:Sn,isSelectionReadOnly:kn,isInsertBelowDisabled:ze,isOrderColumnExists:be,isPrimaryKeyAvailable:zt,meta:mt,view:Ht,isAddingEmptyRowAllowed:Re,isAddingEmptyRowPermitted:yt,isAddingColumnAllowed:_t,getCellPosition:Zn,clearCell:Cn,copyValue:Ta,clearSelectedRangeOfCells:Dl,actionManager:Pe,imageLoader:Ie,baseRoleLoader:te,handleCellClick:To,handleCellHover:Mo,renderCell:Ue,totalColumnsWidth:ln,isFieldEditAllowed:Fe,isDataEditAllowed:q,isContextMenuAllowed:so,removeInlineAddRecord:$t,upgradeModalInlineState:_e,isRowDraggingEnabled:vt,rowMetaColumnWidth:nt,isRowColouringEnabled:O,rowColouringBorderWidth:et}}const RC={class:"flex !w-full text-[13px] text-gray-800 items-center justify-between"},SC=ko({__name:"Aggregation",props:{column:{}},emits:["update:column"],setup(t,{emit:n}){const a=Ra(t,"column",n),{updateAggregate:i,getAggregations:s}=nu(),{gridViewCols:r}=Ha(),d=fn(Hi,V(!1)),c=le(()=>r.value[a.value.id]),f=le(()=>s(a.value.columnObj)),v=h=>{i(a.value.id,h),a.value=null};return(h,y)=>{var g;const b=$l,_=Ya,m=qa;return(g=e(a))!=null&&g.uidt?(p(),X(m,{key:0,disabled:e(d),class:"!max-h-55 overflow-auto",variant:"small"},{default:J(()=>[(p(!0),B(en,null,ho(e(f),(C,w)=>(p(),X(_,{key:w,onClick:S=>v(C)},{default:J(()=>{var S;return[z("div",RC,[tt(se(h.$t(`aggregation_type.${C}`))+" ",1),((S=e(c))==null?void 0:S.aggregation)===C?(p(),X(b,{key:0,class:"text-brand-500",icon:"check"})):me("",!0)])]}),_:2},1032,["onClick"]))),128))]),_:1},8,["disabled"])):me("",!0)}}}),IC=Object.assign(Ol(SC,[["__scopeId","data-v-b0c35ac1"]]),{__name:"SmartsheetGridCanvasContextAggregation"}),FC=ko({__name:"Tooltip",props:{tooltipStyle:{},theme:{default:"dark"}},setup(t){const n=sl(),{tooltipText:o}=Go(n);return(l,a)=>(p(),B("div",{class:Dt(["tooltip",[`tooltip-${"theme"in l?l.theme:e(Bh)}`]]),style:Xn(l.tooltipStyle)},[("ncIsString"in l?l.ncIsString:e(Ci))(e(o))?(p(),B(en,{key:1},[tt(se(e(o)),1)],64)):(p(),X(po(e(o)),{key:0}))],6))}}),AC=Object.assign(FC,{__name:"SmartsheetGridCanvasComponentsTooltip"});function EC(){const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const n=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),n>0}const MC={class:"absolute inset-0 overflow-hidden"},Ru=1e3/60,sf=100,TC=180,$C=12,uf=.98,df=.01,OC=ko({__name:"Scroller",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},scrollWidth:{type:Number,default:0},scrollHeight:{type:Number,default:0}},emits:["scroll"],setup(t,{expose:n,emit:o}){const l=t,a=o,i=Bn(l,"scrollWidth"),s=Bn(l,"scrollHeight"),r=Bn(l,"height"),d=Bn(l,"width"),c=V(),f=V(),v=V(null),h=V(null),y=V(0),b=V(0),_=V(!1),m=V(0),g=V(0),C=V(null),w=V({startTime:0,startPosition:{x:0,y:0},currentPosition:{x:0,y:0},velocity:{x:0,y:0},touchHistory:[],animation:null}),S=V(!0),x=V(null),$=V(!1),I=()=>{S.value=!0,x.value&&clearTimeout(x.value),$.value||(x.value=setTimeout(()=>{S.value=!1},2e3))},F=le(()=>s.value>r.value),E=le(()=>i.value>d.value),M=le(()=>{const H=r.value/s.value;return Math.max(H*100,10)}),U=le(()=>{const H=d.value/i.value;return Math.max(H*100,10)}),L=le(()=>{const H=r.value-72-(r.value-72)*M.value/100;return y.value/(s.value-r.value)*H}),G=le(()=>{const H=d.value-12-(d.value-12)*U.value/100;return b.value/(i.value-d.value)*H}),ae=(H,Ae,Ie)=>{if(H<Ae){const ce=H-Ae;return Ae+ce*Math.exp(-12)}if(H>Ie){const ce=H-Ie;return Ie+ce*Math.exp(-12)}return H},ve=(H,Ae)=>{if(!f.value)return;let Ie=y.value,ce=b.value;if(H!==void 0){const te=f.value.scrollHeight-c.value.clientHeight;Ie=ae(H,0,te)}if(Ae!==void 0){const te=f.value.scrollWidth-c.value.clientWidth;ce=ae(Ae,0,te)}(Ie!==y.value||ce!==b.value)&&(y.value=Ie,b.value=ce,I(),a("scroll",{left:b.value,top:y.value}))},xe=V(!1),ne=H=>{H.preventDefault(),xe.value&&H.shiftKey?ve(y.value,b.value+H.deltaY):ve(y.value+H.deltaY,b.value+H.deltaX)},he=(H,Ae)=>{Ae.preventDefault(),Ae.stopPropagation(),_.value=!0,C.value=H,m.value=H==="vertical"?Ae.clientY:Ae.clientX,g.value=H==="vertical"?y.value:b.value,document.addEventListener("mousemove",W),document.addEventListener("mouseup",j)};function W(H){if(!_.value)return;const Ae=C.value==="vertical"?H.clientY-m.value:H.clientX-m.value,Ie=C.value==="vertical"?(f.value.scrollHeight-c.value.clientHeight)/(c.value.clientHeight-c.value.clientHeight*M.value/100):(f.value.scrollWidth-c.value.clientWidth)/(c.value.clientWidth-c.value.clientWidth*U.value/100),ce=g.value+Ae*Ie;C.value==="vertical"?ve(ce,void 0):ve(void 0,ce)}function j(){_.value=!1,C.value=null,document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",j)}const Ee=(H,Ae)=>{if(Ae.target===(H==="vertical"?v.value:h.value))return;const Ie=Ae.currentTarget.getBoundingClientRect(),ce=H==="vertical"?Ae.clientY-Ie.top:Ae.clientX-Ie.left,te=H==="vertical"?Ie.height:Ie.width,Le=ce/te,lt=(H==="vertical"?f.value.scrollHeight-c.value.clientHeight:f.value.scrollWidth-c.value.clientWidth)*Le;H==="vertical"?ve(lt,void 0):ve(void 0,lt)},Ye=()=>{const H=Date.now(),Ie=w.value.touchHistory.filter(Ne=>H-Ne.time<=sf);if(Ie.length<2)return{x:0,y:0};const ce=Ie[0],te=Ie[Ie.length-1],Le=te.time-ce.time;return Le===0?{x:0,y:0}:{x:(ce.position.x-te.position.x)/Le*1e3,y:(ce.position.y-te.position.y)/Le*1e3}},Ge=H=>{w.value.animation&&(cancelAnimationFrame(w.value.animation),w.value.animation=null);const Ae=H.touches[0],Ie=Date.now();w.value={startTime:Ie,startPosition:{x:Ae.clientX,y:Ae.clientY},currentPosition:{x:Ae.clientX,y:Ae.clientY},velocity:{x:0,y:0},touchHistory:[{time:Ie,position:{x:Ae.clientX,y:Ae.clientY}}],animation:null}},ke=H=>{const Ae=H.touches[0],Ie=Date.now();for(w.value.touchHistory.push({time:Ie,position:{x:Ae.clientX,y:Ae.clientY}});w.value.touchHistory.length>0&&Ie-w.value.touchHistory[0].time>sf;)w.value.touchHistory.shift();const ce=w.value.currentPosition.x-Ae.clientX,te=w.value.currentPosition.y-Ae.clientY;w.value.currentPosition={x:Ae.clientX,y:Ae.clientY},ve(y.value+te,b.value+ce)},Y=(H,Ae,Ie)=>{const ce=Ae-H,te=TC*ce,Le=$C*Ie,Ne=te-Le,lt=Ie+Ne*(Ru/1e3);return{position:H+lt*(Ru/1e3),velocity:lt}},we=(H,Ae)=>H+Ae*(Ru/1e3),oe=()=>{const H=w.value;if(!H.animation)return;const Ae=f.value.scrollHeight-c.value.clientHeight,Ie=f.value.scrollWidth-c.value.clientWidth;let ce=b.value,te=y.value,Le=H.velocity.x,Ne=H.velocity.y;if(ce<0||ce>Ie){const lt=ce<0?0:Ie,je=Y(ce,lt,Le);ce=je.position,Le=je.velocity}else ce=we(ce,Le),Le*=uf;if(te<0||te>Ae){const lt=te<0?0:Ae,je=Y(te,lt,Ne);te=je.position,Ne=je.velocity}else te=we(te,Ne),Ne*=uf;ve(te,ce),H.velocity={x:Le,y:Ne},Math.abs(Le)>df||Math.abs(Ne)>df||ce<0||ce>Ie||te<0||te>Ae?H.animation=requestAnimationFrame(oe):H.animation=null},ye=()=>{w.value.velocity=Ye(),w.value.animation=requestAnimationFrame(oe)},ie=({left:H,top:Ae})=>{if(H!==void 0){const Ie=f.value.scrollWidth-c.value.clientWidth;b.value=Math.max(0,Math.min(H,Ie))}if(Ae!==void 0){const Ie=f.value.scrollHeight-c.value.clientHeight;y.value=Math.max(0,Math.min(Ae,Ie))}I(),a("scroll",{left:b.value,top:y.value})};return ti(()=>{I(),xe.value=navigator.userAgent.toLowerCase().includes("windows")||navigator.userAgent.toLowerCase().includes("linux"),$.value=EC()}),Ku(()=>{w.value.animation&&cancelAnimationFrame(w.value.animation)}),Ga(()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",j)}),n({scrollTo:ie,getScrollPosition:()=>({left:b.value,top:y.value}),wrapperRef:c}),(H,Ae)=>(p(),B("div",{ref_key:"wrapperRef",ref:c,class:"relative overflow-hidden",style:Xn({width:`${e(d)}px`,height:`${e(r)}px`})},[z("div",MC,[z("div",{ref_key:"contentWrapper",ref:f,class:"custom-scrollbar-content",onWheel:ne,onTouchstart:Ge,onTouchmove:ke,onTouchend:ye},[qu(H.$slots,"default",{},void 0,!0)],544)]),Nt(z("div",{class:Dt([{"scrollbar-visible":e(S)},"custom-scrollbar-track vertical"]),onClick:Ae[1]||(Ae[1]=Ie=>Ee("vertical",Ie))},[z("div",{ref_key:"verticalScrollbar",ref:v,class:"custom-scrollbar-thumb vertical",style:Xn({height:`${e(M)}%`,transform:`translateY(${e(L)}px)`}),onMousedown:Ae[0]||(Ae[0]=Ie=>he("vertical",Ie))},null,36)],2),[[ba,e(F)]]),Nt(z("div",{class:Dt([{"scrollbar-visible":e(S)},"custom-scrollbar-track horizontal"]),onClick:Ae[3]||(Ae[3]=Ie=>Ee("horizontal",Ie))},[z("div",{ref_key:"horizontalScrollbar",ref:h,class:"custom-scrollbar-thumb horizontal",style:Xn({width:`${e(U)}%`,transform:`translateX(${e(G)}px)`}),onMousedown:Ae[2]||(Ae[2]=Ie=>he("horizontal",Ie))},null,36)],2),[[ba,e(E)]])],4))}}),DC=Object.assign(Ol(OC,[["__scopeId","data-v-bb0999a4"]]),{__name:"SmartsheetGridCanvasComponentsScroller"});function LC(t){var n,o,l,a;if((t==null?void 0:t.columnObj.uidt)===pe.LongText){if((o=jn((n=t==null?void 0:t.columnObj)==null?void 0:n.meta))!=null&&o.richMode)return cu.RichText;if((a=jn((l=t.columnObj)==null?void 0:l.meta))!=null&&a[Wh])return cu.AIPrompt}return t.columnObj.uidt?cu[t.columnObj.uidt]:""}const NC={class:"flex flex-row flex-1 items-center justify-start gap-x-3"},PC={class:"flex flex-row items-center flex-1 justify-start gap-x-3"},BC=ko({__name:"AddNewRowMenu",props:{path:{default:()=>[]},onNewRecordToGridClick:{},onNewRecordToFormClick:{},removeInlineAddRecord:{type:Boolean}},setup(t){const n=t,{removeInlineAddRecord:o}=_r(n),{isAddNewRecordGridMode:l}=nl();return(a,i)=>{const s=$l,r=Ya,d=qa,c=Yl("e");return p(),X(d,{variant:"small"},{default:J(()=>[Nt((p(),X(r,{class:"nc-new-record-with-grid group",disabled:e(o),onClick:i[0]||(i[0]=f=>a.onNewRecordToGridClick(a.path??[]))},{default:J(()=>{var f;return[z("div",NC,[(p(),X(po((f=("viewIcons"in a?a.viewIcons:e(_i))[e(Ul).GRID])==null?void 0:f.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(a.$t("activity.newRecord"))+" - "+se(a.$t("objects.viewType.grid")),1)]),e(l)?(p(),X(s,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):me("",!0)]}),_:1},8,["disabled"])),[[c,["c:row:add:grid"]]]),Nt((p(),X(r,{class:"nc-new-record-with-form group",onClick:i[1]||(i[1]=f=>a.onNewRecordToFormClick(a.path??[]))},{default:J(()=>{var f;return[z("div",PC,[(p(),X(po((f=("viewIcons"in a?a.viewIcons:e(_i))[e(Ul).FORM])==null?void 0:f.icon),{class:"nc-view-icon text-inherit"})),tt(" "+se(a.$t("activity.newRecord"))+" - "+se(a.$t("objects.viewType.form")),1)]),e(l)?me("",!0):(p(),X(s,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]}),_:1})),[[c,["c:row:add:form"]]])]),_:1})}}}),cf=Object.assign(Ol(BC,[["__scopeId","data-v-2b50c72e"]]),{__name:"SmartsheetGridCanvasComponentsAddNewRowMenu"}),WC=ko({__name:"GroupHeaderMenu",props:{group:{}},emits:["toggleExpand","toggleExpandAll"],setup(t,{emit:n}){const o=t,l=n,{group:a}=_r(o),i=d=>{l("toggleExpand",d)},s=()=>{const d=ga(a.value);l("toggleExpandAll",d,!0)},r=()=>{const d=ga(a.value);l("toggleExpandAll",d,!1)};return(d,c)=>{const f=$l,v=Ya,h=qa;return p(),X(h,{variant:"small"},{default:J(()=>{var y;return[(y=e(a))!=null&&y.isExpanded?(p(),X(v,{key:0,onClick:c[0]||(c[0]=b=>i(e(a)))},{default:J(()=>[ue(f,{icon:"minimize"}),c[2]||(c[2]=tt(" Collapse group "))]),_:1,__:[2]})):(p(),X(v,{key:1,onClick:c[1]||(c[1]=b=>i(e(a)))},{default:J(()=>[ue(f,{icon:"maximize"}),c[3]||(c[3]=tt(" Expand group "))]),_:1,__:[3]})),ue(v,{onClick:s},{default:J(()=>[ue(f,{icon:"maximizeAll"}),c[4]||(c[4]=tt(" Expand all "))]),_:1,__:[4]}),ue(v,{onClick:r},{default:J(()=>[ue(f,{icon:"minimizeAll"}),c[5]||(c[5]=tt(" Collapse all "))]),_:1,__:[5]})]}),_:1})}}}),zC=Object.assign(WC,{__name:"SmartsheetGridCanvasComponentsGroupHeaderMenu"}),VC={key:0,class:"absolute h-full flex items-center justify-center z-70 w-full inset-0 bg-white/30"},jC=["height","width"],UC={class:"absolute pointer-events-none inset-0"},GC={key:4,class:"nc-edit-or-add-provider-wrapper"},HC={class:"flex shadow-nc-sm rounded-lg"},YC={class:"flex items-center gap-2"},qC={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},XC=5,ff=96,KC=128,JC=ko({__name:"index",props:{totalRows:{},actualTotalRows:{},data:{},groupDataCache:{},rowHeightEnum:{},loadData:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},deleteSelectedRows:{type:Function},clearInvalidRows:{type:Function},deleteRangeOfRows:{type:Function},updateRecordOrder:{type:Function},bulkUpdateRows:{type:Function},bulkDeleteAll:{type:Function},bulkUpsertRows:{type:Function},expandForm:{type:Function},removeRowIfNew:{type:Function},rowSortRequiredRows:{},applySorting:{type:Function},clearCache:{type:Function},syncCount:{type:Function},selectedRows:{},chunkStates:{},isBulkOperationInProgress:{type:Boolean},selectedAllRecords:{type:Boolean},getRows:{type:Function},getDataCache:{type:Function},cachedGroups:{},totalGroups:{},groupByColumns:{},toggleExpand:{type:Function},toggleExpandAll:{type:Function},groupSyncCount:{type:Function},fetchMissingGroupChunks:{type:Function},clearGroupCache:{type:Function}},emits:["bulkUpdateDlg","update:selectedAllRecords"],setup(t,{expose:n,emit:o}){const l=t,a=o;yo(Hh,!0);const{loadData:i,callAddEmptyRow:s,updateOrSaveRow:r,deleteRow:d,expandForm:c,clearCache:f,syncCount:v,bulkUpdateRows:h,bulkUpsertRows:y,deleteRangeOfRows:b,clearInvalidRows:_,updateRecordOrder:m,applySorting:g,bulkDeleteAll:C,removeRowIfNew:w,getRows:S,getDataCache:x,toggleExpand:$,groupSyncCount:I,fetchMissingGroupChunks:F,clearGroupCache:E,toggleExpandAll:M}=l,U=Ra(l,"selectedAllRecords",a),{eventBus:L,isSqlView:G}=Il(),{withLoading:ae}=ps(),{showRecordPlanLimitExceededModal:ve,navigateToPricing:xe}=ql(),ne=Bn(l,"totalRows"),he=Bn(l,"actualTotalRows"),W=Bn(l,"totalGroups"),j=Bn(l,"chunkStates"),Ee=Bn(l,"data"),Ye=Bn(l,"cachedGroups"),Ge=Bn(l,"rowHeightEnum"),ke=Bn(l,"selectedRows"),Y=Bn(l,"rowSortRequiredRows"),we=Bn(l,"groupByColumns"),oe=Bn(l,"groupDataCache"),ye=V(),ie=V(0),H=V(0),Ae=V(),Ie=V(null),ce=V(null),te=V(null),Le=V(null),Ne=V(null),lt=V(!1),je=V(null),He=V(!1),Q=V(!1),Mt=V(),_e=V(null),wn=V(null),It=V(null),Tt=V(!1),Je=ki({x:0,y:0}),cn=ki(zh),Pn=new Set([pe.LongText,pe.DateTime,pe.SingleSelect,pe.MultiSelect,pe.Formula]),Et=V();yo(Yh,cn),yo(qh,wn);const Rn=Uo();yo(Rf,Rn);const mt=V(),ot=Uo(),gt=Uo();yo(Yu,ot),yo(If,gt),yo(Ff,mt);const{isExpandedFormCommentMode:zt}=Go(Sr()),Ht=V(!1),Yt=fn(Ea,Uo()),Xt=fn(Js,void 0),un=fn(Zu,Uo()),bt=fn(zl,V(!1)),xt=fn(Hi,V(!1)),{height:ct,width:ft}=Vh(ye),{height:Be,width:at}=Xu(),{aggregations:kt,loadViewAggregate:st}=nu(),{isDataReadOnly:qe,isUIAllowed:u,isMetaReadOnly:R}=gl(),{isMobileMode:P,isAddNewRecordGridMode:D,setAddNewRecordGridMode:fe,appInfo:K}=nl(),O=vs(),{$e:Z}=da(),{t:ge}=oa(),ee=sl(),{targetReference:Me,placement:We}=Go(ee),Xe=V(),{floatingStyles:nt}=dk(Me,Xe,{placement:We,middleware:[ak(8),rk(),ik({padding:5})]}),{tryShowTooltip:et,hideTooltip:ut}=ee;let Ke={index:null,isSelectionStarted:!1,path:[]};const{isGroupBy:Qe,rowSlice:ht,colSlice:Vt,editEnabled:Pe,activeCell:Se,totalWidth:$t,columnWidths:be,rowHeight:ze,updateVisibleRows:wt,columns:q,findColumnIndex:Fe,canvasRef:vt,triggerRefreshCanvas:Re,resizeableColumn:yt,resizeMouseMove:_t,isDragging:Ze,startDrag:on,startResize:Kt,hoverRow:nn,selection:pt,makeCellEditable:mn,findClickedColumn:ln,findColumnPosition:so,elementMap:Sn,onMouseMoveSelectionHandler:yn,onMouseDownSelectionHandler:kn,onMouseUpSelectionHandler:jt,onMouseDownFillHandlerStart:an,onMouseMoveFillHandlerMove:rn,onMouseUpFillHandlerEnd:En,isFillHandlerActive:Yn,onMouseDownRowReorderStart:ao,isRowReOrderEnabled:Zn,isRowReorderActive:So,isOrderColumnExists:To,isInsertBelowDisabled:Ue,isPrimaryKeyAvailable:Mo,meta:qn,view:eo,isAddingColumnAllowed:to,isAddingEmptyRowAllowed:Zo,isAddingEmptyRowPermitted:ul,isSelectedOnlyScript:ai,isSelectedOnlyAI:Ma,isSelectionReadOnly:Cn,copyValue:Ta,clearCell:Ka,clearSelectedRangeOfCells:Mi,handleCellClick:al,handleCellHover:fa,actionManager:$a,imageLoader:Ja,readOnly:Xl,baseRoleLoader:Oa,colResizeHoveredColIds:Qa,totalColumnsWidth:it,isFieldEditAllowed:Kl,isContextMenuAllowed:No,isDataEditAllowed:Io,removeInlineAddRecord:Po,upgradeModalInlineState:_o,isRowDraggingEnabled:Dl,rowMetaColumnWidth:Ko,rowColouringBorderWidth:Da}=CC({rowHeightEnum:Ge,cachedRows:Ee,mousePosition:Je,clearCache:f,chunkStates:j,totalRows:ne,actualTotalRows:he,loadData:i,scrollLeft:H,width:ft,height:ct,scrollToCell:Jl,scrollTop:ie,aggregations:kt,vSelectedAllRecords:U,selectedRows:ke,updateRecordOrder:m,expandRows:At,updateOrSaveRow:r,expandForm:c,bulkUpdateRows:h,bulkUpsertRows:y,addEmptyRow:Nn,onActiveCellChanged:mo,addNewColumn:Vn,setCursor:wl,getRows:S,cachedGroups:Ye,toggleExpand:$,totalGroups:W,groupSyncCount:I,groupByColumns:we,fetchMissingGroupChunks:F,getDataCache:x}),sn=V("auto");function wl(de,Ce){var Oe;Ce&&!Ce(sn.value)||(So.value&&(de="grabbing"),sn.value!==de&&(sn.value=de,vt.value&&((Oe=vt.value.style)==null?void 0:Oe.cursor)!==de&&(vt.value.style.cursor=de)))}const Mn=le({get(){return lt.value},set(de){var Ce;!de&&Q.value&&((Ce=Mt.value)!=null&&Ce.shouldKeepModalOpen())||(lt.value=de)}}),Ve=le({get(){return Q.value},set(de){var Ce;!de&&((Ce=Mt.value)!=null&&Ce.shouldKeepModalOpen())||(Q.value=de)}}),Ut=le(()=>{var de;return Pn.has((de=Pe.value)==null?void 0:de.column.uidt)}),St=le(()=>{var de;return(de=Et.value)==null?void 0:de.wrapperRef}),Ct=le(()=>q.value.filter(de=>de.fixed).reduce((de,Ce)=>de+hn(Ce.width),0)),dn=le(()=>{var rt,Rt;if(!Pe.value||!St.value)return{verticalStuck:!1,horizontalStuck:!1,isStuck:!1};if(((rt=Pe.value.column)==null?void 0:rt.uidt)===pe.LongText||((Rt=Pe.value.column)==null?void 0:Rt.uidt)===pe.Formula)return{verticalStuck:!0,horizontalStuck:!0,isStuck:!0};const de=Pe.value.y-ie.value-ze.value+1,Oe=Math.max(32,Math.min(St.value.clientHeight-ze.value-36,de))!==de;let Ft=!1;if(!Pe.value.fixed){const Qt=Pe.value.x-H.value;Ft=Math.max(Ct.value,Math.min(St.value.clientWidth-Pe.value.width,Qt))!==Qt}return{verticalStuck:Oe,horizontalStuck:Ft,isStuck:Oe||Ft}}),_n=le(()=>{var Oe,Ft,rt;if(!Pe.value)return{top:0,left:0};const de=Math.max(Ao-1,Math.min(((Oe=St.value)==null?void 0:Oe.clientHeight)-ze.value-Dn,Pe.value.y-ie.value-ze.value)),Ce=Pe.value.fixed?Pe.value.x:Math.max(Ct.value,Math.min(((Ft=St.value)==null?void 0:Ft.clientWidth)-Pe.value.width,Pe.value.x-H.value));return{top:`${de+(dn.value.horizontalStuck&&!Qe.value?1:0)}px`,left:`${Ce+(dn.value.isStuck&&((rt=Pe.value)!=null&&rt.fixed)?-1:0)}px`}}),In=le(()=>{const de=Po.value?412:256;if(!Qe.value)return x().totalRows.value*ze.value+32+de;const Ce=W.value*($o+ni);function Oe(Ft){let rt=0;for(const[,Rt]of Ft)Rt!=null&&Rt.isExpanded&&(Rt.path?(rt+=Rt.count*ze.value,Zo.value&&!Po.value&&(rt+=Ao),rt+=1):Rt!=null&&Rt.groups&&(rt+=((Rt==null?void 0:Rt.groupCount)??0)*($o+ni),rt+=Oe(Rt.groups)));return rt}return Ce+Oe(Ye.value)+32+de}),Ot=le({get:()=>ke.value.length&&qe.value||Mn.value||je.value===null&&!ke.value.length&&!U.value?!1:He.value,set:de=>{He.value=de}});function xn(){if(!ke.value.length&&!U.value)return;x().cachedRows.value.forEach(Ce=>{Ce.rowMeta.selected&&(Ce.rowMeta.selected=!1)}),U.value=!1}Hn(U,de=>{x().cachedRows.value.forEach(Oe=>{Oe.rowMeta.selected=!!de})});const Qn=()=>{var Oe,Ft;if(!((Oe=St.value)!=null&&Oe.clientWidth)||!((Ft=St.value)!=null&&Ft.clientHeight)){setTimeout(Qn,50);return}const de=Math.max(0,Fe(H.value)),Ce=Math.min(be.value.length,Fe(H.value+St.value.clientWidth+XC)+1);if((de!==Vt.value.start||Ce!==Vt.value.end)&&(Vt.value={start:de,end:Ce}),!Qe.value){const rt=x(),Rt=Math.max(0,Math.floor(ie.value/ze.value)),Qt=Math.ceil(St.value.clientHeight/ze.value),Zt=Math.min(Rt+Qt,rt.totalRows.value),Bt=Math.min(rt.totalRows.value,Zt);(Rt!==ht.value.start||Bt!==ht.value.end)&&(ht.value={start:Rt,end:Bt}),wt()}};function Jo(){Se.value.row=-1,Se.value.column=-1,pt.value.clear(),Pe.value=null}async function Un({row:de,level:Ce}){var Zt,Bt;const Oe=(Bt=(Zt=de.rowMeta)==null?void 0:Zt.path)==null?void 0:Bt.slice(0,Ce),Ft=Oe!=null&&Oe.length?xa(Ye.value,Oe):void 0,rt=(Ft==null?void 0:Ft.groups)??Ye.value,Rt=Math.max(...rt.keys());setTimeout(()=>{Jo()},150),await F(0,Rt,Ft??void 0,!0);const Qt=(Lt,vn,Wn=[])=>{for(let zn=0;zn<vn;zn++){const Tn=Lt.get(zn);Tn!=null&&Tn.groupCount?Qt(Tn.groups,Tn.groupCount,Tn.path??[...Wn,zn]):f(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,[...Wn,zn])}};Qt(rt,(Ft==null?void 0:Ft.groupCount)??W.value,Ft?ga(Ft):[]),await I(Ft),setTimeout(()=>{var Lt;(Lt=Et.value)==null||Lt.scrollTo({top:Math.max(0,Math.min(In.value,ie.value))})},150)}function mo(){if(Qe.value){let de=function(Ce){for(const[,Oe]of Ce)if(Oe!=null&&Oe.isExpanded)if(Oe!=null&&Oe.path){const{isRowSortRequiredRows:Ft}=x(Oe.path);_==null||_(Oe.path,{onGroupRowChange:Un}),Ft.value.length&&(g==null||g(Ft.value,Oe.path))}else Oe.groups&&de(Oe.groups)};de(Ye.value)}else _==null||_([]),Y.value.length&&(g==null||g(Y.value,[]));Qn(),requestAnimationFrame(Re)}const Vl=(de=[])=>{if(ve())return;fe(!0);let Ce={};if(Qe.value){const Oe=xa(Ye.value,de);Ce=es(Oe)}Nn(void 0,void 0,void 0,Ce,de),te.value=null,Mn.value=!1};function Eo(de=[]){if(ve())return;fe(!1);let Ce={};if(Qe.value){const Oe=xa(Ye.value,de);Ce=es(Oe)}un.trigger({overwrite:Ce,path:de}),te.value=null,Mn.value=!1}const yl=de=>{var Ce;if(de)Mn.value=!0;else if(Ve.value){const Oe=(Ce=Mt.value)==null?void 0:Ce.shouldKeepModalOpen();Mn.value=Oe,Ve.value=Oe,Oe||(_e.value=null,It.value=null)}};function il(de=!1,Ce){Ve.value=!1,Mn.value=!1,_e.value=null,Ce!=null&&Ce.id?setTimeout(()=>{var rt;let Oe=0,Ft=!1;for(const Rt of q.value){if(Rt.id===(Ce==null?void 0:Ce.id)){Ft=!0;break}Rt!=null&&Rt.fixed||(Oe+=hn(Rt.width))}Ft&&((rt=Et.value)==null||rt.scrollTo({left:Oe,top:0}))},200):de&&setTimeout(()=>{var Oe;(Oe=Et.value)==null||Oe.scrollTo({left:$t.value})},200)}function io(de,Ce){var zn,Tn,An,k,T,re;const Oe=ke.value.length>=Wu,Ft=!de.rowMeta.selected&&Oe||U.value||Xl.value,rt=((zn=de.rowMeta)==null?void 0:zn.selected)||U.value,Rt=Ce?ga(Ce):[],Qt=((Tn=nn.value)==null?void 0:Tn.rowIndex)===de.rowMeta.rowIndex&&(((An=nn.value)==null?void 0:An.path)??[]).join()===Rt.join(),Zt=Se.value.row===de.rowMeta.rowIndex&&((k=Se.value.path)==null?void 0:k.join())===Rt.join(),Bt=[];let Lt=4;we.value&&(Lt+=((T=we.value)==null?void 0:T.length)*13);const vn=Lt,Wn=Da.value?Da.value+8:0;if(Xl.value||!(Qt||rt||Zt)?(Bt.push({x:Lt,width:Ko.value/2-8,action:"none"}),Lt+=Ko.value/2-8+16):(Qt||rt||Zt)&&Dl.value?(Bt.push({x:Lt,width:26,action:ke.value.length?"none":"reorder"}),Lt+=26):Lt+=6,!Xl.value&&(rt||Qt||Zt)&&!bt.value&&(Bt.push({x:Lt,width:20,action:Ft?"none":"select"}),Lt+=24),(re=de.rowMeta)!=null&&re.commentCount){const De=de.rowMeta.commentCount>99,Wt=De?"99+":de.rowMeta.commentCount.toString(),Jt=Tl,{width:pn}=Jn(Jt,{x:vn+Ko.value/2-4-Wn,y:0,render:!1,text:Wt,maxWidth:Ko.value/2-Wn,fontFamily:`600 ${De?"10px":"12px"} Inter`,textAlign:"center",isTagLabel:!0,fillStyle:"#3366FF"});Bt.push({x:vn+Ko.value-4-Math.max(20,pn+8)-Wn,width:Math.max(20,pn+8),action:"comment"})}else Bt.push({x:vn+Ko.value-4-20-Wn,width:20,action:"comment"});return{isAtMaxSelection:Oe,isCheckboxDisabled:Ft,regions:Bt,currentX:Lt}}const Fl=({e:de,row:Ce,x:Oe,onlyDrag:Ft,group:rt})=>{var Lt,vn,Wn,zn;const{isAtMaxSelection:Rt,isCheckboxDisabled:Qt,regions:Zt}=io(Ce,rt),Bt=Zt.find(Tn=>Oe>=Tn.x&&Oe<Tn.x+Tn.width);if(Bt&&!(Ft&&Bt.action!=="reorder"&&Bt.action!=="select")){switch(Bt.action){case"select":if(!Qt&&((Lt=Ce.rowMeta)!=null&&Lt.selected||!Rt)&&(ol(),Ft)){Ce.rowMeta.selected=!((vn=Ce.rowMeta)!=null&&vn.selected);const Tn=ga(rt);(Wn=Ce.rowMeta)!=null&&Wn.selected&&hc(Ce.rowMeta.rowIndex)&&(Ke={index:Ce.rowMeta.rowIndex,path:Tn,isSelectionStarted:!1});const An=x(Tn);An==null||An.cachedRows.value.set(Ce==null?void 0:Ce.rowMeta.rowIndex,Ce)}break;case"reorder":de.detail===1&&Zn.value&&ao(de);break;case"comment":zt.value=!!((zn=Ce.rowMeta)!=null&&zn.commentCount),c(Ce,void 0,!1,rt==null?void 0:rt.path);break}requestAnimationFrame(Re)}},va=()=>{const de=V(!0),{close:Ce}=ss(Im,{modelValue:de,"onUpdate:modelValue":Oe});function Oe(){de.value=!1,Ce(1e3)}},La=({row:de,x:Ce,group:Oe})=>{const{regions:Ft}=io(de,Oe),rt=Ft.find(Rt=>Ce>=Rt.x&&Ce<Rt.x+Rt.width);if(rt)switch(rt.action){case"select":return"pointer";case"reorder":if(Zn.value)return So.value?"grabbing":"grab";break;case"comment":return"pointer"}};let el=null,no={},Ll=null;async function ii(de){var zn,Tn,An,k;const Ce=new Qv(Sn.elements);Ll=T=>ri(T,Ce),document.addEventListener("mouseup",Ll),no={isCreateOrEditColumnDropdownOpen:Ve.value,openColumnDropdownField:Ne.value,editEnabled:Pe.value,openAggregationFieldId:(zn=ce.value)==null?void 0:zn.id,openAddNewRowDropdown:te.value,openGroupContextMenuDropdown:Le.value,isDropdownVisible:Mn.value,editColumn:_e.value,columnOrder:It.value},Pe.value=null,ce.value=null,te.value=null,Le.value=null,Ne.value=null,Mn.value=!1,_e.value=null,It.value=null,Ve.value=!1,Ve.value||(Ie.value=null),je.value=null,el=null;const Oe=(Tn=vt.value)==null?void 0:Tn.getBoundingClientRect();if(!Oe)return;const Ft=de.clientY-Oe.top,rt=de.clientX-Oe.left,Rt=Bc(de);if(!Rt)return;if(Ft<=Ao){if(rt>Ko.value)Kt(de),await tl(()=>{yt.value||(on(de.clientX-Oe.left),requestAnimationFrame(Re))});else{No.value&&U.value&&(je.value={row:0,col:-1,path:[]},requestAnimationFrame(Re));return}return}if(Ft>ct.value-36)return;const Qt=Ce.findElementAt(Je.x,Je.y,[Lo.ADD_NEW_ROW,Lo.ROW,Lo.GROUP]),Zt=Qt==null?void 0:Qt.group,Bt=Qt==null?void 0:Qt.row,Lt=Qt==null?void 0:Qt.rowIndex,vn=Zt?ga(Zt):[];if(!Bt)return;if(rt<Ko.value+we.value.length*13){if(Rt!==cl.SINGLE_CLICK)return;Fl({e:de,row:Bt,x:rt,onlyDrag:!0,group:Zt});return}if(an(de),Yn.value)return;const{column:Wn}=ln(rt,H.value);if(Wn!=null&&Wn.columnObj||(pt.value.clear(),Se.value={row:-1,column:-1,path:[]},Pe.value=null),(Lt!==((An=Se.value)==null?void 0:An.row)||!Al(vn.map(T=>`${T}`),(k=Se.value)==null?void 0:k.path))&&(mo(),xn()),Rt===cl.RIGHT_CLICK&&(Wn!=null&&Wn.id)){pt.value.isEmpty()&&(Se.value.row=Lt,Se.value.column=q.value.findIndex(De=>De.id===Wn.id),Se.value.path=vn);const T=q.value.findIndex(De=>De.id===Wn.id);pt.value.isCellInRange({row:Lt,col:T})||(pt.value.clear(),pt.value.startRange({row:Lt,col:T}),pt.value.endRange({row:Lt,col:T})),No.value&&(je.value={row:Lt,col:T,path:vn},requestAnimationFrame(Re));return}Rt!==cl.DOUBLE_CLICK&&(el=Se.value,kn(de)),requestAnimationFrame(Re)}function Jl(de,Ce,Oe,Ft=!0){var De,Wt,Jt,pn,bn,$n,fo;const rt=de??Se.value.row??-1,Rt=Ce??Se.value.column??-1,Qt=Oe??Se.value.path??[];let Zt=0,Bt=0;Qe.value&&Ye.value?(Zt=pr(Ye.value,Qt,rt,ze.value,Zo.value),Bt=Zt+ze.value+ff):(Zt=rt*ze.value,Bt=Zt+ze.value+ff);const Lt=((De=Et.value)==null?void 0:De.getScrollPosition().top)??0,vn=ct.value;if(Zt<Lt?(Wt=Et.value)==null||Wt.scrollTo({top:Zt}):Bt>Lt+vn&&((Jt=Et.value)==null||Jt.scrollTo({top:Bt-vn})),!Ft)return;const Wn=q.value.filter(dt=>dt.fixed).reduce((dt,Gt)=>dt+hn(Gt.width),0)+KC;let zn=0;for(let dt=0;dt<Rt;dt++){const Gt=q.value[dt];Gt&&(Gt.fixed||(zn+=hn(Gt.width)))}const Tn=(pn=q.value[Rt])==null?void 0:pn.width,An=hn(Tn);let k=zn+An;zn+=Wn,k+=Wn;const T=((bn=Et.value)==null?void 0:bn.getScrollPosition().left)??0,re=ft.value;zn<T+Wn?($n=Et.value)==null||$n.scrollTo({left:zn-Wn}):k>T+re&&((fo=Et.value)==null||fo.scrollTo({left:k-re}))}async function ri(de,Ce){var Wt,Jt,pn,bn,$n,fo,dt,Gt,oo;de.preventDefault(),Ll&&(document.removeEventListener("mouseup",Ll),Ll=null,Ke={index:null,path:[],isSelectionStarted:!1}),await En();const Oe=(Wt=vt.value)==null?void 0:Wt.getBoundingClientRect();if(!Oe)return;const Ft=de.clientY-Oe.top,rt=de.clientX-Oe.left;if(Pe.value)return;if(jt(de)&&!(Ft<=Ao||Ft>ct.value-36||rt<=Ko.value)){requestAnimationFrame(Re);return}if(So.value)return;const Rt=Bc(de);if(!Rt)return;if(P.value){if(Ft>32&&Ft<ct.value-36){const gn=Ce.findElementAt(rt,Ft,[Lo.ROW,Lo.GROUP,Lo.ADD_NEW_ROW]),wo=gn==null?void 0:gn.group,On=gn==null?void 0:gn.row,Fo=((Jt=On==null?void 0:On.rowMeta)==null?void 0:Jt.rowIndex)??-1;if(gn!=null&&gn.isGroup)$(wo);else if(gn!=null&&gn.isRow&&On){if(Po.value&&Fo>=ll)return;c(On,void 0,!1,wo==null?void 0:wo.path)}requestAnimationFrame(Re);return}else if(Ft<32)return}if(Ft<=Ao)if(rt<Ko.value+we.value.length*13){if(Rt!==cl.SINGLE_CLICK||Xl.value||Qe.value)return;Pt({x:Dl.value?30:10,y:8,height:16,width:16},Je)&&(U.value=!U.value,ol()),requestAnimationFrame(Re);return}else{const gn=it.value-H.value+we.value.length*13,wo=or;if(rt>=gn&&rt<=gn+wo){if(!to.value||no.isCreateOrEditColumnDropdownOpen&&!no.editColumn)return;Ve.value=!0,Ie.value={top:`${Oe.top}px`,left:`${gn+Oe.left}px`,width:`${wo}px`,height:"32px",position:"fixed"},Mn.value=!0,requestAnimationFrame(Re);return}const{column:On,xOffset:Fo}=ln(rt,H.value),ea=!u("fieldEdit");if(On)if(Rt===cl.RIGHT_CLICK){if(ea)return;Ne.value=On.columnObj,wn.value=On.columnObj,Mn.value=!0,Ie.value={top:`${Oe.top}px`,left:`${Oe.left+Fo}px`,width:`${On.width}`,height:"32px",position:"fixed"},requestAnimationFrame(Re);return}else{const Vo=hn(On.width);let Pa=Fo+Vo-8;Pa-=16,((pn=we.value)==null?void 0:pn.length)===1&&On.fixed&&(Pa+=13);const Ti=Pa;if(Ti<=rt&&Ti+14>=rt){if(ea||no.isDropdownVisible&&no.openColumnDropdownField===On.columnObj)return;Ie.value={top:`${Oe.top}px`,left:`${Oe.left+Fo}px`,width:`${On.width}`,height:"32px",position:"fixed"},Ne.value=On.columnObj,wn.value=On.columnObj,Mn.value=!0,requestAnimationFrame(Re);return}else if(Rt===cl.DOUBLE_CLICK){if(sn.value==="col-resize")return;zo(de,!1,On.columnObj,Fo),pt.value.startRange({row:NaN,col:NaN}),pt.value.endRange({row:NaN,col:NaN}),Se.value={row:-1,column:-1,path:((bn=Se.value)==null?void 0:bn.path)??[]},requestAnimationFrame(Re);return}else if(!Qe.value&&rt<Fo+Vo-20-(($n=On.columnObj)!=null&&$n.description?24:0)){const Za=q.value.findIndex(Oi=>Oi.id===On.id),$i=x(),Xi=Math.min($i.totalRows.value-1,99);pt.value.startRange({row:0,col:Za}),pt.value.endRange({row:Xi,col:Za}),xn(),Se.value={row:0,column:Za,path:[]},mo(),requestAnimationFrame(Re)}}requestAnimationFrame(Re);return}if(Ft>ct.value-36){if(xt.value&&u("fieldAdd")){va();return}const{column:gn,xOffset:wo}=ln(rt,H.value);if(gn&&gn.id!=="row_number"){if(no.isDropdownVisible&&no.openAggregationFieldId&&no.openAggregationFieldId===gn.id)return;ce.value=gn,Mn.value=!0,Ie.value={top:`${Oe.top+ct.value-36}px`,left:`${Oe.left+wo}px`,width:gn.width,height:"36px",position:"fixed"}}requestAnimationFrame(Re);return}const Qt=Ce.findElementAt(rt,Ft,[Lo.ADD_NEW_ROW,Lo.ROW,Lo.GROUP]);let Zt=Qt==null?void 0:Qt.group;const Bt=Qt==null?void 0:Qt.row,Lt=((fo=Bt==null?void 0:Bt.rowMeta)==null?void 0:fo.rowIndex)??-1,vn=Zt?ga(Zt):[],Wn=(Qt==null?void 0:Qt.type)===Lo.ADD_NEW_ROW;!Zt&&(Qt!=null&&Qt.groupPath)&&(Zt=Ye.value.get(vn[0]));const zn=x(vn);if(Qt!=null&&Qt.isGroup){if(Rt===cl.SINGLE_CLICK){const{column:gn,xOffset:wo}=ln(rt,H.value);if(gn&&(gn!=null&&gn.fixed)||!K.value.ee){const On=hn(gn.width),Fo=rt-On,ea=Ft>Qt.y+8&&Ft<Qt.y+Qt.height-8;if(Fo>65&&Fo<On+65&&ea&&K.value.isOnPrem){if(no.isDropdownVisible&&no.openGroupContextMenuDropdown&&((dt=no.openGroupContextMenuDropdown.path)==null?void 0:dt.join(","))===((Gt=Zt==null?void 0:Zt.path)==null?void 0:Gt.join(","))){requestAnimationFrame(Re);return}Le.value=Zt,Mn.value=!0,Ie.value={top:`${Oe.top+Ft-36}px`,left:`${Oe.left+wo}px`,width:"300px",height:"36px",position:"fixed"},requestAnimationFrame(Re);return}$(Zt)}else if(gn){if(no.isDropdownVisible&&no.openAggregationFieldId&&no.openAggregationFieldId===gn.id)return;ce.value=gn,Mn.value=!0,Ie.value={top:`${Oe.top+Ft-36}px`,left:`${Oe.left+wo}px`,width:gn.width,height:"36px",position:"fixed"}}}requestAnimationFrame(Re);return}if(Po.value){if(Lt>=ll)return;if(_o.value.isHoveredLearnMore){window.open("https://nocodb.com/pricing","_blank","noopener,noreferrer");return}if(_o.value.isHoveredUpgrade)return xe({limitOrFeature:Hs.LIMIT_EXTERNAL_SOURCE_PER_WORKSPACE})}if(Wn&&Rt===cl.SINGLE_CLICK&&rt<it.value-H.value){if(Zo.value)if(Qe.value){const gn=Ce.findElementAtWithX(rt,Ft,Lo.EDIT_NEW_ROW_METHOD);if(gn){if(Al(no.openAddNewRowDropdown,vn)){Mn.value=!0,te.value=[],requestAnimationFrame(Re);return}te.value=vn,Mn.value=!0,Ie.value={top:`${Oe.top+gn.y-120}px`,left:`${Oe.left+rt+140}px`,width:gn.width,height:"36px",position:"fixed"},requestAnimationFrame(Re);return}const wo=es(Zt);D.value||!Qe.value?Nn(void 0,void 0,void 0,wo,vn):Oo({overwrite:wo,path:vn})}else{if(Po.value)return;await Nn()}pt.value.clear(),Se.value.row=Lt,Se.value.column=1,Se.value.path=vn,requestAnimationFrame(Re);return}else if(Lt>zn.totalRows.value&&!Qe.value){pt.value.clear(),Se.value={row:-1,column:-1,path:[]},mo(),requestAnimationFrame(Re);return}if(rt<Ko.value+we.value.length*13){if(!Bt||![cl.SINGLE_CLICK,cl.RIGHT_CLICK].includes(Rt))return;switch(Rt){case cl.SINGLE_CLICK:Fl({e:de,row:Bt,x:rt,group:Qt==null?void 0:Qt.group});break;case cl.RIGHT_CLICK:No.value&&(je.value={row:Lt,col:-1,path:vn},requestAnimationFrame(Re));break}return}const Tn={...Se.value};(Lt<ht.value.start||Lt>=ht.value.end)&&(Se.value.row=-1,Se.value.column=-1,Se.value.path=[],requestAnimationFrame(Re));const{column:An}=ln(rt,H.value);if(!An){Se.value.row=-1,Se.value.column=-1,Se.value.path=[],pt.value.clear(),requestAnimationFrame(Re);return}if(!Bt){Tn.row!==-1&&Tn.column!==-1&&Lt===-1&&mo();return}const k=qt(Bt==null?void 0:Bt.row,(oo=qn.value)==null?void 0:oo.columns),T=q.value.findIndex(gn=>gn.id===An.id);if(Rt===cl.RIGHT_CLICK){Se.value.row=Lt,Se.value.column=T,Se.value.path=vn,requestAnimationFrame(Re);return}const re=await al({event:de,row:Bt,column:An,value:Bt==null?void 0:Bt.row[An.title],mousePosition:{x:rt,y:Ft},pk:k,selected:(el==null?void 0:el.row)===Lt&&(el==null?void 0:el.column)===T&&Al(el==null?void 0:el.path,vn),imageLoader:Ja,path:vn,baseRoleLoader:Oa});if(Se.value.row=Lt,Se.value.column=T,Se.value.path=vn,re){pt.value.startRange({row:Lt,col:T}),pt.value.endRange({row:Lt,col:T}),requestAnimationFrame(Re);return}An!=null&&An.fixed||Jl(),requestAnimationFrame(Re);const De=An.columnObj.uidt;if(Rt===cl.DOUBLE_CLICK){if(Bv.includes(De)||![pe.Barcode,pe.QrCode,pe.Lookup].includes(De)&&(An!=null&&An.virtual))return;mn(Bt,An)}}const si=(de,Ce,Oe,Ft)=>{const rt=[];let Rt=Oe+1;const Qt=Tl;return Qt.save(),Qt.font="550 12px Inter",q.value.slice(de,Ce).forEach(Zt=>{var T,re,De,Wt,Jt,pn,bn,$n,fo,dt,Gt;const Bt=hn(Zt.width),Lt=Zt.id==="row_number";if(Lt&&Qe.value){Rt+=Bt;return}const vn=8;let Wn=vn+16;Zt.uidt&&(Wn+=26,rt.push({x:Rt+8-Ft,width:13,type:"columnIcon",text:LC(Zt)})),(T=Zt.isInvalidColumn)!=null&&T.isInvalid&&!((re=Zt.isInvalidColumn)!=null&&re.ignoreTooltip)&&(Wn+=18),(Wt=(De=Zt==null?void 0:Zt.columnObj)==null?void 0:De.description)!=null&&Wt.length&&(Wn+=18);const zn=Bt-Wn,Tn=Qt.measureText(Zt.title).width,An=Tn>zn;rt.push({x:Rt+(Zt.uidt?26:Dl.value?30:10)-Ft,width:Math.max(Zt.uidt?0:16,An?zn:Tn),type:"title",text:Zt.title,disableTooltip:!An});let k=Rt+Bt-vn-(Kl.value?16:0);if(Lt){Rt+=Bt;return}Kl.value&&!((Jt=Zt.columnObj)!=null&&Jt.readonly)?rt.push({x:k-Ft,width:14,type:"columnChevron",disableTooltip:!0,text:null}):(pn=qn.value)!=null&&pn.synced&&((bn=Zt.columnObj)!=null&&bn.readonly)&&rt.push({x:k-Ft,width:14,type:"synced",disableTooltip:!1,text:"This field is synced"}),($n=Zt.isInvalidColumn)!=null&&$n.isInvalid&&!((fo=Zt.isInvalidColumn)!=null&&fo.ignoreTooltip)&&(k-=18,rt.push({x:k-Ft,width:14,type:"error",text:Zt.isInvalidColumn.tooltip||"Invalid Column"})),(Gt=(dt=Zt==null?void 0:Zt.columnObj)==null?void 0:dt.description)!=null&&Gt.length&&(k-=18,rt.push({x:k-Ft,width:14,type:"info",text:Zt.columnObj.description})),Rt+=Bt}),Qt.restore(),rt.forEach(Zt=>{Zt.y=8,Zt.height=Zt.width}),rt},qi=de=>{var Ft,rt,Rt,Qt,Zt;const Ce=(Ft=vt.value)==null?void 0:Ft.getBoundingClientRect();if(!Ce)return;cn.clientX=de.clientX,cn.clientY=de.clientY,Je.x=de.clientX-Ce.left,Je.y=de.clientY-Ce.top;let Oe=Qa.value.size?"col-resize":"auto";if(ut(),Je.y<32){const Bt=q.value.filter(zn=>zn.fixed),Lt=it.value-H.value+((rt=we.value)==null?void 0:rt.length)*13,vn=or;if(Je.x>=Lt&&Je.x<=Lt+vn&&Kl.value&&(Oe="pointer"),Bt.length){const Tn=si(0,Bt.length,0,0).find(An=>Je.x>=An.x&&Je.x<=An.x+An.width);["title","columnChevron"].includes(Tn==null?void 0:Tn.type)&&Kl.value&&(Oe="pointer"),Tn&&!Tn.disableTooltip&&et({rect:Tn,text:Tn.text,mousePosition:Je})}if(!Bt.some(zn=>{const Tn=hn(zn.width);return Je.x>=0&&Je.x<=Tn})){let zn=0;for(let An=0;An<Vt.value.start;An++)zn+=hn(q.value[An].width);const Tn=Bt.reduce((An,k)=>An+hn(k.width),0);if(Je.x>=Tn){const k=si(Vt.value.start,Vt.value.end,zn,H.value).find(T=>Je.x>=T.x&&Je.x<=T.x+T.width);["title","columnChevron"].includes(k==null?void 0:k.type)&&Kl.value&&(Oe="pointer"),k&&!k.disableTooltip&&et({rect:k,text:k.text,mousePosition:Je})}}}if(Yn.value)rn(de);else if(Ze.value||yt.value)Je.x>=ft.value-200?(Rt=Et.value)==null||Rt.scrollTo({left:H.value+10}):Je.x<=200&&((Qt=Et.value)==null||Qt.scrollTo({left:H.value-10}));else{if(de.clientY-Ce.top<=32&&yt.value)_t(de);else if(Je.y>ct.value-36){Oe=Je.x<it.value-H.value?"pointer":"auto",wl(Oe),requestAnimationFrame(Re);return}else{const Lt=Sn.findElementAt(Je.x,Je.y,[Lo.ADD_NEW_ROW,Lo.ROW]);if(Lt){if(Po.value&&!(Lt!=null&&Lt.group)&&(Lt!=null&&Lt.rowIndex)&&(Lt==null?void 0:Lt.rowIndex)>=ll)return;nn.value={rowIndex:Lt==null?void 0:Lt.rowIndex,path:ga(Lt==null?void 0:Lt.group)}}yn(de)}requestAnimationFrame(Re)}if(Je.y>32){const Bt=Sn.findElementAt(Je.x,Je.y,[Lo.ADD_NEW_ROW,Lo.ROW]),Lt=Bt==null?void 0:Bt.row,vn=Bt==null?void 0:Bt.rowIndex,Wn=ga(Bt==null?void 0:Bt.group),{column:zn}=ln(Je.x,H.value);if(!Lt||!zn){(Bt==null?void 0:Bt.type)===Lo.ADD_NEW_ROW&&Je.x<it.value-H.value?wl("pointer"):wl("auto");return}const Tn=qt((Lt==null?void 0:Lt.row)??{},(Zt=qn.value)==null?void 0:Zt.columns),An=q.value.findIndex(k=>k.id===zn.id);fa({event:de,row:Lt,column:zn,value:Lt==null?void 0:Lt.row[zn.title],mousePosition:Je,pk:Tn,selected:Se.value.row===vn&&Se.value.column===An,imageLoader:Ja,path:Wn})}if(Oe&&wl(Oe),Je.x<Ko.value+we.value.length*13&&Je.y>Ao&&Je.y<=ct.value-36){const Bt=Sn.findElementAt(Je.x,Je.y,[Lo.ADD_NEW_ROW,Lo.ROW]),Lt=Bt==null?void 0:Bt.row;if(Oe=La({row:Lt,x:Je.x,group:Bt==null?void 0:Bt.group})||Oe,Oe&&wl(Oe),!Lt||Si(Lt.rowMeta.rowIndex)||!hc(Ke.index)||Qe.value&&!Al(Ke.path,Bt.groupPath))return;const{isAtMaxSelection:vn,isCheckboxDisabled:Wn,regions:zn}=io(Lt,Bt==null?void 0:Bt.group);if(vn||Wn)return;const Tn=zn.find(re=>Je.x>=re.x&&Je.x<re.x+re.width);if(!Tn||Tn.action!=="select")return;const An=Math.min(Ke.index,Lt.rowMeta.rowIndex),k=Math.min(An+Wu,Math.max(Ke.index,Lt.rowMeta.rowIndex));if(An===k&&An===Ke.index&&Ke.isSelectionStarted)return;x(Bt.groupPath).cachedRows.value.forEach(re=>{re.rowMeta.rowIndex>=An&&re.rowMeta.rowIndex<=k?re.rowMeta.selected=!0:Ke.isSelectionStarted&&(re.rowMeta.selected=!1)}),Ke.isSelectionStarted||(Ke.isSelectionStarted=!0),requestAnimationFrame(Re)}},ui=()=>{wl("auto"),ut(),nn.value={path:[],rowIndex:-2},requestAnimationFrame(Re)},di=ae(async de=>{var Ce;if(Qe.value){if((Ce=de==null?void 0:de.path)!=null&&Ce.length){f(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,de==null?void 0:de.path),v(de==null?void 0:de.path),Qn(),Pe.value=null,requestAnimationFrame(Re);return}await I(),oe.value.clear(),E(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),setTimeout(()=>{var Oe;(Oe=Et.value)==null||Oe.scrollTo({top:Math.max(0,Math.min(In.value,ie.value))})},150)}else f(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),await v(),wt();Qn(),requestAnimationFrame(Re)});let ci=null,A=null;const N=de=>{ci&&cancelAnimationFrame(ci),A&&clearTimeout(A),ci=requestAnimationFrame(()=>{ie.value=Math.max(0,de.top),$t.value<ft.value?H.value=0:H.value=Math.max(0,de.left),Qn(),Re()}),A=window.setTimeout(()=>{var Oe;(Oe=vt.value)!=null&&Oe.getBoundingClientRect()&&requestAnimationFrame(Re)},150)},Te=()=>{Qn(),wt()};async function At({newRows:de,newColumns:Ce,cellsOverwritten:Oe,rowsUpdated:Ft}){Ht.value=!0;const rt={continue:!1,expand:!0},{close:Rt}=ss(pv,{modelValue:Ht,newRows:de,newColumns:Ce,cellsOverwritten:Oe,rowsUpdated:Ft,isAddingEmptyRowPermitted:ul.value,meta:qn.value,"onUpdate:expand":Zt,"onUpdate:modelValue":Qt});function Qt(){Ht.value=!1,Rt(1e3)}async function Zt(Bt){rt.continue=!0,rt.expand=Bt,Rt(1e3)}return await ka(Ht).toBe(!1),rt}async function Fn(de,Ce,Oe=[]){await(r==null?void 0:r(de,null,null,{metaValue:qn.value,viewMetaValue:eo.value},Ce,Oe))}function Vn(de=null,Ce=!1){var Oe,Ft;if(It.value=de,_e.value=null,Ne.value=null,!!to.value)if(Z("c:shortcut",{key:"ALT + C"}),Ce)Mn.value=!0,Ve.value=!0,requestAnimationFrame(Re);else{const rt=(Oe=vt.value)==null?void 0:Oe.getBoundingClientRect();if(!rt)return;(Ft=Et.value)==null||Ft.scrollTo({left:it.value}),Ie.value={top:`${rt.top}px`,right:`${256-or}px`,width:`${or}px`,height:"32px",position:"fixed"},Mn.value=!0,Ve.value=!0,requestAnimationFrame(Re)}}function zo(de,Ce=!1,Oe,Ft){var rt;if(u("fieldEdit")&&!P.value&&(Ce||!R.value||Gh.includes(Oe.uidt))&&!G.value){const Rt=(rt=vt.value)==null?void 0:rt.getBoundingClientRect();if(Ce&&(Tt.value=!0),!(Oe!=null&&Oe.id))return;const{column:Qt,xOffset:Zt}=so(Oe.id,H.value);Ie.value={top:`${Rt.top}px`,left:`${Rt.left+(Ft??Zt)}px`,width:(Qt==null?void 0:Qt.width)??"180px",height:"32px",position:"fixed"},Ne.value=null,_e.value=Oe,Mn.value=!0,Ve.value=!0}}function Ln(de){var Oe,Ft;(Oe=Et.value)==null||Oe.scrollTo({left:$t.value});const Ce=(Ft=vt.value)==null?void 0:Ft.getBoundingClientRect();Ce&&setTimeout(()=>{if(no.isCreateOrEditColumnDropdownOpen&&!no.editColumn)return;const rt=it.value-H.value;Ie.value={top:`${Ce.top}px`,left:`${rt+Ce.left}px`,width:`${or}px`,height:"32px",position:"fixed"},Ne.value=null,Ae.value=de,Mn.value=!0,Ve.value=!0,requestAnimationFrame(Re)},500)}async function Nn(de,Ce=!1,Oe,Ft={},rt=[]){if(ve({focusBtn:null})||Po.value&&!Ce&&!Oe&&!de&&!rt.length)return;const Rt=x(rt);_==null||_(rt,{onGroupRowChange:Un}),Rt!=null&&Rt.isRowSortRequiredRows.value.length&&(g==null||g(Rt==null?void 0:Rt.isRowSortRequiredRows.value,rt));const Qt=s==null?void 0:s(de,void 0,Ft,rt);return!Ce&&Qt&&Fn(Qt,Oe,rt),Qn(),requestAnimationFrame(Re),tl().then(()=>{var Zt,Bt,Lt;Se.value={row:de??Rt.totalRows.value-1,column:((Zt=je.value)==null?void 0:Zt.col)??1,path:rt},pt.value.startRange({row:de??Rt.totalRows.value-1,col:((Bt=je.value)==null?void 0:Bt.col)??1}),pt.value.endRange({row:de??Rt.totalRows.value-1,col:((Lt=je.value)==null?void 0:Lt.col)??1}),Jl()}),Qt}async function Oo({overwrite:de,path:Ce}){const Oe=await Nn(void 0,!0,void 0,de,Ce);Oe&&(c==null||c(Oe,void 0,!0,Ce))}const co=(de,Ce)=>{var Rt;const Oe=x(de==null?void 0:de.path),{cachedRows:Ft}=Oe,rt=Ft.value.get(Ce==="above"?de.row:de.row+1);if(rt){const Qt=qt(rt.row,(Rt=qn.value)==null?void 0:Rt.columns);Nn(de.row+(Ce==="above"?0:1),!1,Qt,{},de==null?void 0:de.path)}else Nn(void 0,!1,void 0,{},de==null?void 0:de.path)},go=async de=>{var Rt,Qt,Zt;if(Ss((Rt=Se.value)==null?void 0:Rt.row)||Ss((Qt=Se.value)==null?void 0:Qt.column))return;const Ce=((Zt=Pe.value)==null?void 0:Zt.path)||Se.value.path,Oe=xa(Ye.value,Ce),Ft=es(Oe),rt=x(Ce);switch(Pe.value=null,pt.value.clear(),de){case Gl.NEXT:Se.value.row<rt.totalRows.value-1?Se.value.row++:Zo.value&&ul.value&&!Po.value&&(Nn(void 0,!1,void 0,Ft,Ce),Se.value.row++);break;case Gl.PREV:Se.value.row>0&&Se.value.row--;break}await tl(()=>{mo()}),pt.value.startRange({row:Se.value.row,col:Se.value.column}),pt.value.endRange({row:Se.value.row,col:Se.value.column}),requestAnimationFrame(Re),tl(()=>{Jl(void 0,void 0,void 0,!1)})},Ql=de=>{a("bulkUpdateDlg",de)};Hn([ct,ft,at,Be],()=>{tl(()=>{Qn(),requestAnimationFrame(Re)})}),Hn(In,de=>{var Ce;ie.value>de-ct.value&&((Ce=Et.value)==null||Ce.scrollTo({top:Math.max(de-ct.value-256,0)}))}),Hn(ze,()=>{Qn(),requestAnimationFrame(Re)}),Hn([()=>{var de;return(de=q.value)==null?void 0:de.length},()=>ne.value],()=>{tl(()=>{Qn(),requestAnimationFrame(Re)})}),Hn(Se,de=>{var Bt,Lt,vn,Wn;const Ce=de.path;if(Qe.value&&Ss(Ce))return;const Oe=x(Ce),Ft=de.row!==null?(Bt=Oe.cachedRows.value.get(de.row))==null?void 0:Bt.row:void 0,rt=Ft&&de.column!==null?(Lt=q.value[de.column])==null?void 0:Lt.columnObj:void 0,Rt=Ft&&rt?Ft[rt.title]:void 0,Qt=qt(Ft,(vn=qn.value)==null?void 0:vn.columns),Zt=(Wn=eo.value)==null?void 0:Wn.id;L.emit(Xo.CELL_SELECTED,{rowId:Qt,colId:rt==null?void 0:rt.id,val:Rt,viewId:Zt})},{deep:!0});function Nl(){Pe.value=null,pt.value.startRange({row:Se.value.row,col:Se.value.column}),pt.value.endRange({row:Se.value.row,col:Se.value.column}),requestAnimationFrame(Re)}Yt.on(di),Xt==null||Xt.on(Te),un==null||un.on(Oo),Rn.on(Nl);const{isViewColumnsLoading:Pl}=Ha();Hn(eo,async(de,Ce)=>{try{de&&de.id!==(Ce==null?void 0:Ce.id)&&(de.fk_model_id===O.params.viewId||bt.value)&&(Jf(),await ka(Pl).toMatch(Oe=>!Oe),Qe.value?(await I(),Qn()):(await v(),Qn(),wt()),await st())}catch(Oe){ed.isCancel(Oe)||(console.error(Oe),tn.error(ge("msg.errorLoadingData")))}},{immediate:!0}),Ga(()=>{Yt.off(di),Xt==null||Xt.off(Te),un==null||un.off(Oo),Rn.off(Nl)}),L.on(async(de,Ce)=>{de===Xo.CLEAR_NEW_ROW?(pt.value.clear(),Se.value.row=-1,Se.value.column=-1,w(Ce),requestAnimationFrame(Re)):de===Xo.FIELD_RELOAD&&(Qn(),requestAnimationFrame(Re))});function ol(de,Ce=!1){Se.value&&(Se.value.row>=0||Se.value.column>=0||Ce)&&(Se.value={row:-1,column:-1,path:de??[]},Pe.value=null,Yn.value=!1,pt.value.clear(),mo(),requestAnimationFrame(Re))}function bl(de){$(de),Mn.value=!1,Le.value=null,requestAnimationFrame(Re)}const pa=(de,Ce)=>{Mn.value=!1,Le.value=null,M(de,Ce),requestAnimationFrame(Re)};Xs(ye,de=>{const Ce=de.target;sa()||Wl()||Vi()||Kf()||Ce&&jh(Ce,["ant-select-dropdown","nc-dropdown"])||(mo(),!document.querySelector(".canvas-aggregation, .canvas-header-column-menu, .canvas-header-add-new-row-menu, .canvas-group-context-menu")&&nd())||(Ne.value=null,ce.value=null,te.value=null,Le.value=null,(Se.value.row>=0||Se.value.column>=0||Pe.value)&&ol(Se.value.path,!0))},{ignore:[".nc-edit-or-add-provider-wrapper",".canvas-aggregation",".canvas-header-column-menu",".canvas-header-add-new-row-menu",".canvas-group-context-menu"]}),Zr("Escape",()=>{Ne.value=null,ce.value=null,te.value=null,Le.value=null,Mn.value=!1});const Zl={[pe.LongText]:2,[pe.Formula]:2};function dl(de){var Oe,Ft,rt,Rt;const Ce=((Ft=(Oe=Pe.value)==null?void 0:Oe.column)==null?void 0:Ft.title)??"";Ce&&(Rt=(rt=Pe.value)==null?void 0:rt.row)!=null&&Rt.row&&(Pe.value.row.row[Ce]=de)}const Na=le(()=>{var de;return!!((de=Pe.value)!=null&&de.row)});rd(Na,de=>{gt.trigger(de)},{isGridCell:!0,immediate:!0}),Hn(Po,de=>{D.value&&de&&fe(!de)},{immediate:!0}),n({scrollToRow:Jl,openColumnCreate:Ln});const _l=le(()=>O.query);return Hn([()=>Ee.value.size,()=>_l.value.expand,()=>_l.value.rowId],([de,Ce,Oe])=>{var Ft,rt;if(Ce==="true"&&!Oe&&!Qe.value&&de>0){const Rt=Ee.value.keys().next().value,Qt=(Ft=Ee.value)==null?void 0:Ft.get(Rt);Qt&&c(Qt,void 0,void 0,Array.isArray((rt=Qt.rowMeta)==null?void 0:rt.path)?Qt.rowMeta.path:[])}},{immediate:!0}),(de,Ce)=>{var An;const Oe=Ys,Ft=Fx,rt=Gi,Rt=Fm,Qt=ad,Zt=wv,Bt=Am,Lt=Em,vn=$l,Wn=ca,zn=Rr,Tn=Yl("e");return p(),B("div",{ref_key:"wrapperRef",ref:ye,class:"w-full h-full"},[de.isBulkOperationInProgress?(p(),B("div",VC,[ue(Oe,{size:"regular"})])):me("",!0),ue(DC,{ref_key:"scroller",ref:Et,class:"relative sticky","scroll-height":e(In),"scroll-width":e($t),height:e(ct),width:e(ft),onScroll:N},{default:J(()=>{var k,T;return[z("div",{class:"sticky top-0 left-0",style:Xn({height:`${e(In)}px`,width:`${e($t)}px`})},[(p(),X(Uh,{to:"body"},[ue(kf,{name:"tooltip"},{default:J(()=>[e(ee).tooltipText?(p(),X(AC,{key:0,ref_key:"tooltipRef",ref:Xe,"tooltip-style":e(nt)},null,8,["tooltip-style"])):me("",!0)]),_:1})])),ue(rt,{visible:e(Ot),"onUpdate:visible":Ce[3]||(Ce[3]=re=>bo(Ot)?Ot.value=re:null),trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:J(()=>{var re,De;return[e(je)&&((re=e(je))==null?void 0:re.row)!==-1&&(((De=e(je))==null?void 0:De.col)!==-1||e(ke).length||e(U)||e(Qe))?(p(),X(Ft,{key:0,"context-menu-target":e(je),"onUpdate:contextMenuTarget":Ce[0]||(Ce[0]=Wt=>bo(je)?je.value=Wt:null),"selected-all-records":e(U),"onUpdate:selectedAllRecords":Ce[1]||(Ce[1]=Wt=>bo(U)?U.value=Wt:null),selection:e(pt),columns:e(q),"active-cell":e(Se),"action-manager":e($a),"is-group-by":e(Qe),"get-data-cache":e(x),"clear-cell":e(Ka),"is-primary-key-available":e(Mo),"is-selection-read-only":e(Cn),"is-selection-only-a-i":e(Ma),"is-selection-only-script":e(ai),"is-insert-below-disabled":e(Ue),"is-order-column-exists":e(To),"delete-row":e(d),"delete-range-of-rows":e(b),"delete-selected-rows":de.deleteSelectedRows,"bulk-delete-all":e(C),"call-add-new-row":co,"copy-value":e(Ta),"read-only":!de.hasEditPermission,"get-rows":e(S),"bulk-update-rows":e(h),"expand-form":e(c),"clear-selected-range-of-cells":e(Mi),onClick:Ce[2]||(Ce[2]=Wt=>Ot.value=!1),onBulkUpdateDlg:Ql},null,8,["context-menu-target","selected-all-records","selection","columns","active-cell","action-manager","is-group-by","get-data-cache","clear-cell","is-primary-key-available","is-selection-read-only","is-selection-only-a-i","is-selection-only-script","is-insert-below-disabled","is-order-column-exists","delete-row","delete-range-of-rows","delete-selected-rows","bulk-delete-all","copy-value","read-only","get-rows","bulk-update-rows","expand-form","clear-selected-range-of-cells"])):me("",!0)]}),default:J(()=>[z("canvas",{ref_key:"canvasRef",ref:vt,class:"sticky top-0 left-0",height:`${e(ct)}px`,width:`${e(ft)}px`,oncontextmenu:"return false",onMousedown:ii,onMousemove:qi,onMouseleave:ui},null,40,jC)]),_:1},8,["visible"]),z("div",UC,[(k=e(Pe))!=null&&k.row?(p(),B("div",{key:(T=e(Pe))==null?void 0:T.rowIndex,style:Xn({top:e(_n).top,left:e(_n).left,width:`${e(Pe).width}px`,minHeight:`${e(Pe).minHeight+(Zl[e(Pe).column.uidt]??0)}px`,height:`${e(Pe).height}px`,borderRadius:"2px",willChange:"top, left, width, height"}),class:Dt(["nc-canvas-table-editable-cell-wrapper pointer-events-auto",{[`row-height-${e(Ge)??1}`]:!0,"on-stick ":e(dn).isStuck,"border-[#3366ff]":e(dn).isStuck&&e(Pe).isCellEditable,"border-[#9AA2AF]":e(dn).isStuck&&!e(Pe).isCellEditable}])},[z("div",{ref_key:"activeCellElement",ref:mt,class:Dt(["relative w-[calc(100%-5px)] h-[calc(100%-5px)] rounded-br-[9px] bg-white",{"px-[0.550rem]":!e(Ut)&&!e(Pe).fixed,"px-[0.49rem]":e(Pe).fixed,"top-[0.5px]":e(Qe)&&e(dn).isStuck,"top-[2.5px]":e(Qe),"left-[2.5px] ":e(Qe)&&!e(Pe).fixed,"left-[2px] ":e(Qe)&&e(Pe).fixed,"left-[-1px] top-[2px]":!e(Qe)&&e(dn).isStuck,"left-[2px] top-[3.5px]":!e(Qe)&&!e(dn).isStuck}]),onClick:Ce[7]||(Ce[7]=re=>e(ot).trigger(re))},[ue(Zt,{row:e(Pe).row},{default:J(({state:re})=>[e(xo)(e(Pe).column)&&e(Pe).column.title?(p(),X(Rt,{key:0,modelValue:e(Pe).row.row[e(Pe).column.title],"onUpdate:modelValue":Ce[4]||(Ce[4]=De=>e(Pe).row.row[e(Pe).column.title]=De),column:e(Pe).column,row:e(Pe).row,path:e(Pe).path,active:"","read-only":!e(Io)||!e(Pe).isCellEditable,"is-allowed":e(Pe).isCellEditable,onSave:De=>{var Wt;return(Wt=e(r))==null?void 0:Wt(e(Pe).row,e(Pe).column.title,re,void 0,void 0,e(Pe).path)},onNavigate:go},null,8,["modelValue","column","row","path","read-only","is-allowed","onSave"])):(p(),X(Qt,{key:1,"model-value":e(Pe).row.row[e(Pe).column.title],column:e(Pe).column,"row-index":e(Pe).rowIndex,path:e(Pe).path,active:"","edit-enabled":"","read-only":!e(Io)||!e(Pe).isCellEditable,"is-allowed":e(Pe).isCellEditable,"onUpdate:modelValue":dl,onSave:Ce[5]||(Ce[5]=De=>{var Wt;return(Wt=e(r))==null?void 0:Wt(...De)}),onSaveWithState:Ce[6]||(Ce[6]=De=>{var Wt;return(Wt=e(r))==null?void 0:Wt(...De)}),onNavigate:go},null,8,["model-value","column","row-index","path","read-only","is-allowed"]))]),_:1},8,["row"])],2)],6)):me("",!0)])],4)]}),_:1},8,["scroll-height","scroll-width","height","width"]),e(Ie)?(p(),X(rt,{key:1,trigger:["click"],visible:e(Mn)&&!!(e(Ne)||e(Ve)||e(ce)||e(te)||e(Le)),"overlay-class-name":`!bg-transparent !min-w-[220px] ${!e(ce)&&!e(Ne)&&!e(Le)&&!e(te)?"!border-none !shadow-none":""}`,placement:"bottomRight",onVisibleChange:yl,"onUpdate:visible":yl},{overlay:J(()=>{var k;return[e(ce)?(p(),X(IC,{key:0,column:e(ce),"onUpdate:column":Ce[8]||(Ce[8]=T=>bo(ce)?ce.value=T:null),class:"canvas-aggregation"},null,8,["column"])):e(Ne)?(p(),X(Bt,{key:1,"is-open":e(Mn),"onUpdate:isOpen":Ce[9]||(Ce[9]=T=>bo(Mn)?Mn.value=T:null),column:e(Ne),class:"canvas-header-column-menu",onEdit:zo,onAddColumn:Ce[10]||(Ce[10]=T=>Vn(T,!0))},null,8,["is-open","column"])):e(te)?(p(),X(cf,{key:2,class:"canvas-header-add-new-row-menu",path:e(te),"on-new-record-to-grid-click":Vl,"on-new-record-to-form-click":Eo},null,8,["path"])):e(Le)?(p(),X(zC,{key:3,class:"canvas-group-context-menu",group:e(Le),onToggleExpand:bl,onToggleExpandAll:pa},null,8,["group"])):me("",!0),e(Ve)?(p(),B("div",GC,[(p(),X(Lt,{key:((k=e(_e))==null?void 0:k.id)||"new",ref_key:"columnEditOrAddProviderRef",ref:Mt,column:e(It)?null:e(_e),"column-position":e(It),"edit-description":e(Tt),preload:e(Ae),onSubmit:Ce[11]||(Ce[11]=T=>{var re;return il(!((re=e(_e))!=null&&re.id),T)}),onCancel:Ce[12]||(Ce[12]=T=>il()),onMounted:Ce[13]||(Ce[13]=T=>Ae.value=void 0),onClick:Ce[14]||(Ce[14]=ro(()=>{},["stop"])),onKeydown:Ce[15]||(Ce[15]=ro(()=>{},["stop"]))},null,8,["column","column-position","edit-description","preload"]))])):me("",!0)]}),default:J(()=>[e(Ne)||e(Ve)||e(ce)||e(te)||e(Le)?(p(),B("div",{key:0,style:Xn(e(Ie)),class:"hide pointer-events-none"},null,4)):me("",!0)]),_:1},8,["visible","overlay-class-name"])):me("",!0),z("div",{class:"absolute bottom-12 z-5 left-2",onClick:Ce[18]||(Ce[18]=ro(()=>{},["stop"]))},[e(Zo)&&!e(Po)?(p(),X(zn,{key:0,entity:e(vl).TABLE,"entity-id":(An=e(qn))==null?void 0:An.id,permission:e(fl).TABLE_RECORD_ADD,"show-overlay":""},{default:J(({isAllowed:k})=>[ue(rt,{disabled:!k},{overlay:J(()=>[ue(cf,{path:e(te),"on-new-record-to-grid-click":Vl,"on-new-record-to-form-click":Eo},null,8,["path"])]),default:J(()=>[z("div",HC,[e(P)?Nt((p(),X(Wn,{key:0,class:"nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:Ce[16]||(Ce[16]=ro(T=>Eo(),["stop"]))},{default:J(()=>[z("div",YC,[ue(vn,{icon:"plus"}),Ce[19]||(Ce[19]=tt(" New Record "))])]),_:1})),[[Tn,[e(D)?"c:row:add:grid":"c:row:add:form"]]]):Nt((p(),X(Wn,{key:1,class:Dt(["nc-grid-add-new-row",{"!rounded-r-none !border-r-0":!e(Qe)}]),size:"small",type:"secondary",shadow:!1,onClick:Ce[17]||(Ce[17]=ro(T=>e(D)&&!e(Qe)?Nn():Eo(),["stop"]))},{default:J(()=>[z("div",qC,[ue(vn,{icon:"plus"}),e(D)||e(Qe)?(p(),B(en,{key:0},[tt(se(de.$t("activity.newRecord")),1)],64)):(p(),B(en,{key:1},[tt(se(de.$t("activity.newRecord"))+" - "+se(de.$t("objects.viewType.form")),1)],64))])]),_:1},8,["class"])),[[Tn,[e(D)&&!e(Qe)?"c:row:add:grid":"c:row:add:form"]]]),!e(P)&&!e(Qe)?(p(),X(Wn,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary",shadow:!1},{default:J(()=>[ue(vn,{icon:"arrowUp"})]),_:1})):me("",!0)])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):me("",!0)])],512)}}}),QC=Object.assign(Ol(JC,[["__scopeId","data-v-09b5d084"]]),{__name:"SmartsheetGridCanvas"}),ZC=ko({__name:"Aggregation",props:{group:{},maxDepth:{},scrollLeft:{}},setup(t){return(n,o)=>(p(),B("div"))}}),e2=Object.assign(ZC,{__name:"SmartsheetGridAggregation"}),t2=Co(()=>Ro(()=>Promise.resolve().then(()=>fv),void 0,import.meta.url).then(t=>t.default||t)),n2=ko({__name:"GroupByTable",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},depth:{},maxDepth:{},rowHeight:{},paginationFixedSize:{},paginationHideSidebars:{type:Boolean},scrollLeft:{},viewWidth:{},scrollable:{}},emits:["update:paginationData"],setup(t,{emit:n}){const o=t,a=Ra(o,"group",n),{t:i}=oa(),s=fs(),r=fn(Ai,V()),d=fn(cs,V()),c=fn(zl,V(!1)),f=V(!1),{eventBus:v,allFilters:h,isExternalSource:y,validFiltersFromUrlParams:b}=Il(),{showUpgradeToSeeMoreRecordsModal:_}=ql(),{user:m}=nl(),{withLoading:g}=ps(),C=s.currentRoute,w=le(()=>C.value.query),S=V(),x=V(!1),$=V(),I=V(),F=le(()=>w.value.group),E=le({get(){return!!w.value.rowId},set(ce){ce||(s.push({query:{...w.value,rowId:void 0,group:void 0}}),$.value={},I.value={})}});function M(ce,te,Le=!1,Ne){var je;const lt=qt(ce.row,(je=r.value)==null?void 0:je.columns);if(I.value=te,lt&&!c.value)s.push({query:{...w.value,group:a.value.key,rowId:lt}});else{if(Ne&&Ne!==a.value.key)return;$.value=ce,x.value=!0,f.value=!Le}}const U=ce=>{v.emit(Xo.CLEAR_NEW_ROW,ce)};function L(ce,te,Le=r.value){if(ce.nested||!ce.rows)return;te=te??ce.rows.length;const Ne=ce.nestedIn.reduce((je,He)=>(He.key!=="__nc_null__"&&!hl(He.column_uidt)&&![pe.Rollup,pe.Lookup,pe.Formula,pe.Barcode,pe.QrCode].includes(He.column_uidt)&&(je[He.title]=He.key,He.column_uidt===pe.Checkbox&&(je[He.title]=je[He.title]===kl.TRUE?!0:je[He.title]===kl.FALSE?!1:!!je[He.title])),je),{});ce.count=ce.count+1;const lt=Bm([...h.value,...b.value],Le==null?void 0:Le.columns,{currentUser:m.value??void 0});return ce.rows.splice(te,0,{row:{...lt,...cm(Le==null?void 0:Le.columns),...Ne},oldRow:{},rowMeta:{new:!0}}),ce.rows[te]}const G=le(()=>!a.value.nested&&a.value.rows?a.value.rows:[]),{deleteRow:ae,deleteSelectedRows:ve,deleteRangeOfRows:xe,updateOrSaveRow:ne,bulkUpdateRows:he,selectedAllRecords:W,removeRowIfNew:j}=Wm({meta:r,viewMeta:d,formattedData:G,paginationData:V(a.value.paginationData),callbacks:{changePage:ce=>o.loadGroupPage(a.value,ce),loadData:()=>o.loadGroupData(a.value,!0),globalCallback:()=>{var ce;return(ce=o.redistributeRows)==null?void 0:ce.call(o)}}}),Ee=async ce=>{a.value.count=a.value.count-1,await ae(ce)},Ye=g(async ce=>{await o.loadGroupData(a.value,!0,{...(ce==null?void 0:ce.offset)!==void 0?{offset:ce.offset}:{}})});yo(zf,V(!0));const Ge=le(()=>({fixedSize:o.paginationFixedSize?o.paginationFixedSize-2:void 0,hideSidebars:o.paginationHideSidebars,extraStyle:"background: transparent !important; border-top: 0px;"}));function ke(){return G.value.findIndex(ce=>{var te;return w.value.rowId===qt(ce.row,(te=r.value)==null?void 0:te.columns)})}const Y=async ce=>{var je,He,Q,Mt,_e;let Le=ke()+(ce===Gl.NEXT?1:-1);for(;(He=(je=G.value[Le])==null?void 0:je.rowMeta)!=null&&He.new;)Le=Le+(ce===Gl.NEXT?1:-1);const Ne=((Q=a.value.paginationData)==null?void 0:Q.page)||1;if(Le<0){if(Ne===1)return tn.info(i("msg.info.noMoreRecords"));await o.loadGroupPage(a.value,Ne-1),Le=G.value.length-1}else if(Le>=G.value.length){if((Mt=a.value.paginationData)!=null&&Mt.isLastPage)return tn.info(i("msg.info.noMoreRecords"));await o.loadGroupPage(a.value,Ne+1),Le=0}const lt=qt(G.value[Le].row,(_e=r.value)==null?void 0:_e.columns);lt&&await s.push({query:{...w.value,rowId:lt}})},we=(ce,te)=>{var Le;if((((Le=a.value.paginationData)==null?void 0:Le.pageSize)??10)*ce>100&&_({isExternalSource:y.value}))return!0;te==null||te()},oe=async()=>{var te,Le,Ne,lt,je,He,Q,Mt,_e,wn;const ce=ke();if(!((te=a.value.paginationData)!=null&&te.isLastPage)&&ce===(((Le=a.value.paginationData)==null?void 0:Le.pageSize)??10)-1&&we((Ne=a.value.paginationData)!=null&&Ne.page?((lt=a.value.paginationData)==null?void 0:lt.page)+1:1)){(He=(je=S.value)==null?void 0:je.stopLoading)==null||He.call(je);return}if(!((Q=a.value.paginationData)!=null&&Q.isLastPage)&&ce===((Mt=a.value.paginationData)==null?void 0:Mt.pageSize)){const It=(_e=a.value.paginationData)!=null&&_e.page?((wn=a.value.paginationData)==null?void 0:wn.page)+1:1;await o.loadGroupPage(a.value,It)}Y(Gl.NEXT)},ye=async()=>{var te,Le,Ne;const ce=ke();if(!((te=a.value.paginationData)!=null&&te.isFirstPage)&&ce===1){const lt=(Le=a.value.paginationData)!=null&&Le.page?((Ne=a.value.paginationData)==null?void 0:Ne.page)-1:1;await o.loadGroupPage(a.value,lt)}Y(Gl.PREV)},ie=le(()=>{var te;const ce=ke();return((te=a.value.paginationData)==null?void 0:te.isLastPage)&&ce===G.value.length-1}),H=le(()=>{var te;const ce=ke();return((te=a.value.paginationData)==null?void 0:te.isFirstPage)&&ce===0});async function Ae(){ve&&(await ve(),await Ye({shouldShowLoading:!1}))}const Ie=fn(Ea,Uo());return Ga(async()=>{Ie==null||Ie.off(Ye)}),Ie==null||Ie.on(Ye),v.on(ce=>{(ce===Xo.GROUP_BY_RELOAD||ce===Xo.DATA_RELOAD)&&(Ie==null||Ie.trigger())}),(ce,te)=>{var lt;const Le=t2,Ne=ud;return p(),B(en,null,[e(a).rows?(p(),X(fd,{key:0,"selected-all-records":e(W),"onUpdate:selectedAllRecords":te[0]||(te[0]=je=>bo(W)?W.value=je:null),class:"nc-group-table",data:e(a).rows,"v-group":e(a),"pagination-data":e(a).paginationData,"load-data":async()=>{},"change-page":je=>we(je,()=>o.loadGroupPage(e(a),je)),"call-add-empty-row":je=>L(e(a),je),"expand-form":M,"row-height-enum":ce.rowHeight,"delete-row":Ee,"delete-selected-rows":Ae,"delete-range-of-rows":e(xe),"update-or-save-row":e(ne),"remove-row-if-new":e(j),"bulk-update-rows":e(he),"hide-header":!0,pagination:e(Ge),"disable-skeleton":!0,"disable-virtual-y":!0},null,8,["selected-all-records","data","v-group","pagination-data","change-page","call-add-empty-row","row-height-enum","delete-range-of-rows","update-or-save-row","remove-row-if-new","bulk-update-rows","pagination"])):me("",!0),(p(),X(Mu,null,{default:J(()=>[e($)&&e(x)?(p(),X(Le,{key:0,modelValue:e(x),"onUpdate:modelValue":[te[1]||(te[1]=je=>bo(x)?x.value=je:null),te[2]||(te[2]=je=>U(e($)))],"load-row":!e(c),row:e($),state:e(I),meta:e(r),view:e(d)},null,8,["modelValue","load-row","row","state","meta","view"])):me("",!0)]),_:1})),e(E)&&((lt=e(r))!=null&&lt.id)&&e(F)===e(a).key?(p(),X(Ne,{key:1,ref_key:"expandedFormRef",ref:S,modelValue:e(E),"onUpdate:modelValue":te[3]||(te[3]=je=>bo(E)?E.value=je:null),row:e($)??{row:{},oldRow:{},rowMeta:{}},meta:e(r),"load-row":!e(c),state:e(I),"row-id":e(w).rowId,view:e(d),"show-next-prev-icons":"","first-row":e(H),"last-row":e(ie),"expand-form":M,onNext:oe,onPrev:ye},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):me("",!0)],64)}}}),o2=Object.assign(n2,{__name:"SmartsheetGridGroupByTable"}),l2=Co(()=>Ro(()=>import("./CMyFGii6.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url).then(t=>t.default||t)),a2=Co(()=>Ro(()=>import("./CkXo2doe.js").then(t=>t.C),__vite__mapDeps([37,1,2,12,13,38,39,40,28,23,22,26,27,41]),import.meta.url).then(t=>t.default||t)),i2=Co(()=>Ro(()=>Promise.resolve().then(()=>vd),void 0,import.meta.url).then(t=>t.default||t)),r2={class:"pointer-events-none"},s2=ko({__name:"GroupByLabel",props:{column:{},modelValue:{}},setup(t){return yo(Ks,V(!0)),yo(Xh,V(!0)),(n,o)=>{const l=l2,a=a2,i=i2;return p(),B("div",r2,[ue(i,{row:{row:{[n.column.title]:n.modelValue},rowMeta:{}}},{default:J(()=>[e(xo)(n.column)?(p(),X(l,{key:0,"model-value":n.modelValue,class:"!text-gray-600",column:n.column,"read-only":!0},null,8,["model-value","column"])):(p(),X(a,{key:1,"model-value":n.modelValue,class:"!text-gray-600",column:n.column,"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"]))]),_:1},8,["row"])])}}}),u2=Object.assign(s2,{__name:"SmartsheetGridGroupByLabel"}),d2=Co(()=>Ro(()=>import("./yjlRPiAT.js"),__vite__mapDeps([79,1,2,66,67,68,69,44,45,46,47,48,49,24,23,3,22,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,70,71,40,72,32,31,33,30,34,73,74,28,26,27,75,76,77,80,81,82,19,83,84,85,86,87,88,89,90,91,92,37,12,13,38,39,41,93,94,95,29,96,97,98,99,100,7,8,9,10,11,14,15,16,17,18,20,21,25,35,36,101,102,103,104,105,106,107,108,109,110,111]),import.meta.url).then(t=>t.default||t)),c2=Co(()=>Ro(()=>import("./1_lWk-g2.js"),__vite__mapDeps([112,20,1,2,21,32,31,33,30,34,113]),import.meta.url).then(t=>t.default||t)),f2={key:0,class:"flex sticky top-0 z-5"},v2={class:"flex items-center"},p2={class:"flex"},h2={key:1,class:"flex min-w-[100px] flex-wrap"},m2={key:1,class:"text-gray-400"},g2={class:"text-xs group-hover:hidden text-gray-500 nc-group-row-count"},w2={class:"text-[#374151] ml-2"},y2={class:"flex items-center gap-2"},b2=ko({__name:"GroupBy",props:{group:{},callAddEmptyRow:{type:Function},expandForm:{type:Function},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},loadGroupAggregation:{type:Function},redistributeRows:{type:Function},viewWidth:{},scrollLeft:{},fullPage:{type:Boolean},depth:{},maxDepth:{},rowHeight:{}},emits:["update:paginationData"],setup(t,{emit:n}){const o=t,a=Ra(o,"group",n),i=fn(Ai,V()),s=fn(gr,V()),r=Bn(o,"scrollLeft"),{isViewDataLoading:d,isPaginationLoading:c}=Go(wr()),{gridViewCols:f}=Ha(),{withLoading:v}=ps(),h=fn(Ju,Uo()),y=le(()=>{var W,j;return(j=(W=i.value)==null?void 0:W.columns)==null?void 0:j.find(Ee=>Ee.pv)}),b=le(()=>!y.value||!y.value.id?{width:"100px"}:f.value[y.value.id]),_=fn(Ea,Uo());h==null||h.on(async W=>{var j,Ee;if((j=s.value)!=null&&j.length&&((!W||!((Ee=W==null?void 0:W.fields)!=null&&Ee.length))&&await o.loadGroupAggregation(a.value),W!=null&&W.fields)){const Ye=W.fields.reduce((Ge,ke)=>{const Y=s.value.find(we=>we.title===ke.title);return Y!=null&&Y.id&&(Ge[Y.id]=ke.aggregation??f.value[Y.id].aggregation??Wa.None),Ge},{});await o.loadGroupAggregation(a.value,Object.entries(Ye).map(([Ge,ke])=>({field:Ge,type:ke})))}});const m=async(W,j,Ee)=>{d.value=!0,c.value=!0,await o.loadGroupData(W,j,Ee),d.value=!1,c.value=!1},g=o.depth??0,C=V(),w=V(),S=V(),x=le(()=>{var W;return o.fullPage??(((W=S.value)==null?void 0:W.offsetWidth)??0)>(o.viewWidth??0)}),$=V(),I=le(()=>$.value?Array.isArray($.value)?$.value.map(W=>W.replace("group-panel-","")):[$.value.replace("group-panel-","")]:[]),F=V([]),E=async W=>{var j,Ee,Ye,Ge;if(W=Array.isArray(W)?W:[W],W.length>0&&a.value.children&&!F.value.includes(W[W.length-1])){await ka(()=>{var we;return((we=a.value.children)==null?void 0:we.length)>0}).toBeTruthy({timeout:1e4});const ke=W[W.length-1].replace("group-panel-",""),Y=a.value.children.find(we=>`${we.key}`===ke);Y&&(Y.nested?(Ye=(Ee=(j=Y.children)==null?void 0:j[0])==null?void 0:Ee.children)!=null&&Ye.length||o.loadGroups({},Y,{triggerChildOnly:!0}):(Ge=Y.rows)!=null&&Ge.length||m(Y))}F.value=W},M=v(W=>{a.value.nested?o.loadGroups({...(W==null?void 0:W.offset)!==void 0?{offset:W.offset}:{}},a.value):(m(a.value,!0,{...(W==null?void 0:W.offset)!==void 0?{offset:W.offset}:{}}),o.loadGroupAggregation(a.value))});ti(async()=>{_==null||_.on(M)}),Ga(async()=>{_==null||_.off(M)}),Hn([()=>a.value.key],async(W,j)=>{W!==j&&(a.value.nested?a.value.nested&&await o.loadGroups({},a.value):await m(a.value,!0))}),ti(async()=>{var W,j;a.value.root===!0&&!((j=(W=a.value)==null?void 0:W.children)!=null&&j.length)&&await o.loadGroups({},a.value)}),a.value.root===!0&&yo(Vf,C);const U=V(),L=le(()=>{if(a.value.root===!0)return U.value??0;if(o.scrollLeft&&o.viewWidth&&w.value){const W=w.value.scrollWidth+12+12;return o.scrollLeft+o.viewWidth+20>W?W-o.viewWidth-20:Math.max(Math.min(W-o.viewWidth,(o.scrollLeft??0)-12),0)}return 0}),G=W=>{a.value.root&&(U.value=W.target.scrollLeft)},ae=async W=>{Array.isArray($.value)?$.value.push(`group-panel-${W}`):$.value=[`group-panel-${W}`],await E(`group-panel-${W}`)},ve=W=>{Array.isArray($.value)?$.value=$.value.filter(j=>j!==`group-panel-${W}`):$.value=[]},xe=le(()=>{var Ge;const W=Number((((Ge=b.value)==null?void 0:Ge.width)??"").replace("px",""))+55+o.maxDepth*9,j=o.maxDepth??1,Ee=a.value.root?U.value??0:r.value??0,Ye=ke=>{switch(ke){case 3:return`${W-18}px`;case 2:return`${W-9}px`;case 1:default:return`${W}px`}};return g===0?Ee<29?`${W+Ee-(.02*(Ee*Ee)+1.07*Ee)}px`:Ye(j):g===1?Ee<30?`${W+Ee-9-23/20*Ee}px`:Ye(j):g===2?Ee<=14?`${W+Ee-18-Ee}px`:Ye(j):`${W}px`}),ne=le(()=>{if(o.maxDepth===3)switch(g){case 2:return"#F9F9FA";case 1:return"#F4F4F5";default:return"#F1F1F1"}if(o.maxDepth===2)switch(g){case 1:return"#F9F9FA";default:return"#F4F4F5"}return o.maxDepth===1,"#F9F9FA"});async function he(){var j;if(g!==0)return;const W=await o.callAddEmptyRow();W&&((j=o.expandForm)==null||j.call(o,W,void 0,!0))}return(W,j)=>{const Ee=$l,Ye=ca,Ge=Kh,ke=Ya,Y=qa,we=Gi,oe=e2,ye=jm,ie=Vm,H=d2,Ae=c2,Ie=Yl("e");return p(),B(en,null,[z("div",{ref_key:"wrapper",ref:C,class:Dt([{"overflow-y-auto":e(a).root===!0},"h-full"]),style:Xn(`${!e(a).root&&e(a).nested?"padding-left: 8px; padding-right: 8px;":""}`),onScroll:G},[z("div",{ref_key:"scrollable",ref:w,style:Xn(`${e(a).root===!0?"width: fit-content":"width: 100%"}`)},[e(a).root===!0?(p(),B("div",f2,[z("div",{class:"border-b-1 border-gray-200 mb-2",style:Xn([{"background-color":"#f4f4f5"},{"padding-left":`${(W.maxDepth||1)*9}px`}])},null,4),ue(fd,{ref_key:"tableHeader",ref:S,class:"mb-2",data:[],"hide-checkbox":!0,"header-only":!0},null,512)])):me("",!0),z("div",{class:Dt({"pl-2":e(a).root===!0})},[ue(ie,{"active-key":e($),"onUpdate:activeKey":j[1]||(j[1]=ce=>bo($)?$.value=ce:null),class:"nc-group-wrapper !rounded-lg",bordered:!1,onChange:E},{default:J(()=>{var ce;return[(p(!0),B(en,null,ho(((ce=e(a))==null?void 0:ce.children)??[],te=>(p(),X(ye,{key:`group-panel-${te.key}`,class:"!border-1 border-gray-300 nc-group rounded-[8px] mb-2",style:Xn(`background: ${e(ne)};`),"show-arrow":!1},{header:J(()=>[z("div",{class:Dt([{"!rounded-b-none":e(I).includes(te.key.toString()),"!border-b-1":e(g)===(W.maxDepth??1)-1&&e(I).includes(te.key.toString())},"flex !sticky w-full items-center rounded-b-lg select-none transition-all !rounded-t-[8px] !h-10"])},[z("div",{class:Dt([{"!rounded-bl-[8px]":!e(I).includes(te.key.toString())},"!sticky flex z-10 justify-between !h-9.8 border-r-1 !rounded-tl-[8px] group pr-2 border-gray-300 overflow-clip items-center !left-0"]),style:Xn(`width:${e(xe)};background: ${e(ne)};`)},[z("div",v2,[ue(Ye,{class:"!border-0 !shadow-none !bg-transparent !hover:bg-transparent",type:"secondary",size:"small"},{default:J(()=>[ue(Ee,{icon:"chevronDown",class:"transition-all",style:Xn(`${e(I).includes(te.key.toString())?"transform: rotate(360deg)":"transform: rotate(270deg)"}`)},null,8,["style"])]),_:2},1024),z("div",p2,[te.column.uidt==="MultiSelect"?(p(!0),B(en,{key:0},ho(Object.entries(te.key.split(",")),([Le,Ne])=>(p(),X(Ge,{key:`panel-tag-${te.column.id}-${Ne}`,class:"!py-0 !px-[12px] !rounded-[12px]",color:te.color.split(",")[+Le]},{default:J(()=>[z("span",{class:"nc-group-value",style:Xn({color:e(ar).isReadable(te.color.split(",")[+Le]||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(ar).mostReadable(te.color.split(",")[+Le]||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},se(Ne in("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(kl)).VAR_TITLES?("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(kl)).VAR_TITLES[Ne]:Ne),5)]),_:2},1032,["color"]))),128)):!(te.key in("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(kl)).VAR_TITLES)&&e(Om)(te.column)?(p(),B("div",h2,[(p(!0),B(en,null,ho(("parseKey"in W?W.parseKey:e(Bs))(te),(Le,Ne)=>(p(),B(en,{key:Ne},[Le?(p(),X(u2,{key:0,column:te.column,"model-value":Le},null,8,["column","model-value"])):(p(),B("span",m2,"No mapped value"))],64))),128))])):(p(),X(Ge,{key:`panel-tag-${te.column.id}-${te.key}`,class:Dt(["!py-0 !px-[12px]",`${te.column.uidt==="SingleSelect"?"!rounded-[12px]":"!rounded-[6px]"}`]),color:te.color},{default:J(()=>{var Le;return[z("span",{class:"nc-group-value font-semibold text-[13px]",style:Xn({color:e(ar).isReadable(te.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(ar).mostReadable(te.color||"#ccc",["#0b1d05","#fff"]).toHex8String()})},[te.key in("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(kl)).VAR_TITLES?(p(),B(en,{key:0},[tt(se(("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(kl)).VAR_TITLES[te.key]),1)],64)):(p(),B(en,{key:1},[tt(se((Le=("parseKey"in W?W.parseKey:e(Bs))(te))==null?void 0:Le.join(", ")),1)],64))],4)]}),_:2},1032,["class","color"]))])]),z("div",{style:Xn(`background: linear-gradient(to right, hsla(0, 0%, 97%, 0), ${e(ne)} 18%);`),class:"flex !h-10 absolute right-0 pl-8 pr-2 items-center"},[z("div",g2,[z("span",null,se(W.$t("datatype.Count")),1),z("span",w2,se(te.count),1)]),ue(we,{class:"!hidden !group-hover:block"},{overlay:J(()=>[ue(Y,{variant:"small"},{default:J(()=>[e(I).includes(te.key.toString())?(p(),X(ke,{key:0,onClick:Le=>ve(te.key)},{default:J(()=>[ue(Ee,{icon:"minimize"}),j[5]||(j[5]=tt(" Collapse group "))]),_:2,__:[5]},1032,["onClick"])):(p(),X(ke,{key:1,onClick:Le=>ae(te.key)},{default:J(()=>[ue(Ee,{icon:"maximize"}),j[6]||(j[6]=tt(" Expand group "))]),_:2,__:[6]},1032,["onClick"]))]),_:2},1024)]),default:J(()=>[ue(Ye,{size:"small",type:"text",onClick:j[0]||(j[0]=ro(()=>{},["stop"]))},{default:J(()=>[ue(Ee,{icon:"threeDotVertical"})]),_:1})]),_:2},1024)],4)],6),ue(oe,{"scroll-left":o.scrollLeft||e(U),"max-depth":W.maxDepth,group:te,depth:e(g)},null,8,["scroll-left","max-depth","group","depth"])],2)]),default:J(()=>[!te.nested&&te.rows?(p(),X(o2,{key:0,group:te,"max-depth":W.maxDepth,depth:W.depth,"load-groups":W.loadGroups,"load-group-data":m,"load-group-page":W.loadGroupPage,"group-wrapper-change-page":W.groupWrapperChangePage,"row-height":W.rowHeight,"redistribute-rows":W.redistributeRows,"pagination-fixed-size":e(x)?o.viewWidth:void 0,"pagination-hide-sidebars":!0,"scroll-left":o.scrollLeft||e(U),"view-width":W.viewWidth,scrollable:e(w)},null,8,["group","max-depth","depth","load-groups","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","pagination-fixed-size","scroll-left","view-width","scrollable"])):(p(),X(tp,{key:1,group:te,"load-groups":W.loadGroups,"load-group-data":m,"load-group-page":W.loadGroupPage,"group-wrapper-change-page":W.groupWrapperChangePage,"row-height":W.rowHeight,"load-group-aggregation":W.loadGroupAggregation,"redistribute-rows":W.redistributeRows,"view-width":W.viewWidth,depth:e(g)+1,"max-depth":W.maxDepth,"scroll-left":e(L),"full-page":e(x)},null,8,["group","load-groups","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","redistribute-rows","view-width","depth","max-depth","scroll-left","full-page"]))]),_:2},1032,["style"]))),128))]}),_:1},8,["active-key"])],2)],4)],38),e(a).root?(p(),X(H,{key:0,"pagination-data":e(a).paginationData,"onUpdate:paginationData":j[2]||(j[2]=ce=>e(a).paginationData=ce),"show-size-changer":!1,"scroll-left":e(U),"custom-label":"groups",depth:W.maxDepth,"change-page":ce=>W.groupWrapperChangePage(ce,e(a))},null,8,["pagination-data","scroll-left","depth","change-page"])):(p(),X(Ae,{key:1,"pagination-data":e(a).paginationData,"onUpdate:paginationData":j[3]||(j[3]=ce=>e(a).paginationData=ce),"align-count-on-right":"","custom-label":"groups","align-left":"","show-api-timing":"","change-page":ce=>W.groupWrapperChangePage(ce,e(a)),"hide-sidebars":!0,style:Xn(`${o.depth&&o.depth>0?"border-radius: 0 0 8px 8px !important; background: transparent; border-top: 0px; height: 24px; padding-bottom: 8px;":""}`),"fixed-size":void 0},null,8,["pagination-data","change-page","style"])),W.depth!==0?(p(),B("div",{key:2,class:"absolute bottom-12 z-5 left-2",onClick:j[4]||(j[4]=ro(()=>{},["stop"]))},[Nt((p(),X(Ye,{class:"nc-group-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:ro(he,["stop"])},{default:J(()=>[z("div",y2,[ue(Ee,{icon:"plus"}),j[7]||(j[7]=tt(" New Record "))])]),_:1})),[[Ie,["c:row:add:grid"]]])])):me("",!0)],64)}}}),tp=Object.assign(Ol(b2,[["__scopeId","data-v-1ee01c28"]]),{__name:"SmartsheetGridGroupBy"}),Jr=100,_2=100,vf=t=>t==="asc"?"+":t==="desc"?"-":t==="count-asc"?"~+":t==="count-desc"?"~-":"+",x2=(t,n,o,l)=>{const{gridViewCols:a}=Ha(),i=Ca(),{base:s}=Go(i),{$api:r}=da(),{getMeta:d,metas:c}=oi(),{appInfo:f}=nl(),{nestedFilters:v,sorts:h}=Il(),{fetchBulkAggregatedData:y,sharedView:b}=ju(),_=fs(),m=fn(zl,V(!1)),g=fn(Jh,V(null)),C=V([]),w=le(()=>_.currentRoute.value.query),S=le(()=>{var ke,Y,we;return(Y=(ke=n.value)==null?void 0:ke.columns)!=null&&Y.length?(we=n.value)==null?void 0:we.columns.reduce((oe,ye)=>(oe[ye.id]=ye,oe),{}):{}}),x=le(()=>Object.values(a.value).reduce((ke,Y)=>{const we=Y.title;return ke[we]=Y,ke},{})),$=le(()=>{const ke=[];return Object.values(a.value).forEach(Y=>{var we,oe;if(Y.group_by){const ye=(oe=(we=n==null?void 0:n.value)==null?void 0:we.columns)==null?void 0:oe.find(ie=>ie.id===Y.fk_column_id);ye&&ke.push({column:ye,sort:Y.group_by_sort||"asc",order:Y.group_by_order||1})}}),ke.sort((Y,we)=>(Y.order??1/0)-(we.order??1/0)),ke}),I=V(new Map),F=V(0),E=V([]),M=ke=>Math.floor(ke/Jr),U=V(Su.light),L=V(U.value[0]),G=()=>{const ke=L.value,Y=U.value.indexOf(L.value);return Y===U.value.length-1?L.value=U.value[0]:L.value=U.value[Y+1],ke},ae=async(ke,Y,we=!1)=>{var Ae,Ie,ce,te,Le,Ne,lt,je,He,Q,Mt,_e,wn,It;const oe=Y?Y.chunkStates:E.value;if(oe[ke]==="loading"||oe[ke]==="loaded"&&!we)return;oe[ke]="loading";const ye=ke*Jr,ie=Y?xe(Y):0,H=$.value[ie];if(!(!H||!((Ae=t.value)!=null&&Ae.id)||!((Ie=s.value)!=null&&Ie.id)))try{const Tt=Y?ve(Y,o==null?void 0:o.value):o.value,Je=m.value?await r.public.dataGroupBy(b.value.uuid,{offset:ye,limit:Jr,where:Tt,sort:`${vf(H.sort)}${H.column.title}`,column_name:H.column.title,subGroupColumnName:(ce=$.value[ie+1])==null?void 0:ce.column.title,sortArrJson:JSON.stringify(h.value),filterArrJson:JSON.stringify(v.value)},{headers:{"xc-password":g.value}}):await r.dbViewRow.groupBy("noco",s.value.id,t.value.fk_model_id,t.value.id,{offset:ye,limit:Jr,where:Tt,sort:`${vf(H.sort)}${H.column.title}`,column_name:H.column.title,sortArrJson:JSON.stringify(h.value),filterArrJson:JSON.stringify(v.value),subGroupColumnName:(te=$.value[ie+1])==null?void 0:te.column.title}),cn=[];for(const Pn of Je.list){let Et={};if(H.column.uidt===pe.LinkToAnotherRecord){const Xt=await d(H.column.colOptions.fk_related_model_id);if(!Xt)continue;Et.relatedTableMeta=Xt;const un=((Le=Xt.columns)==null?void 0:Le.find(bt=>bt.pv))||((Ne=Xt.columns)==null?void 0:Ne[0]);Et.relatedColumn=un,Et.displayValueProp=un==null?void 0:un.title}if(H.column.uidt===pe.Lookup){const Xt=(je=(lt=n.value)==null?void 0:lt.columns)==null?void 0:je.find(ft=>{var Be,at;return ft.id===((at=(Be=H.column)==null?void 0:Be.colOptions)==null?void 0:at.fk_relation_column_id)});if(!Xt)continue;const un=await d(Xt.colOptions.fk_related_model_id);if(!un)continue;const bt=(He=un.columns)==null?void 0:He.find(ft=>{var Be;return ft.id===((Be=H.column.colOptions)==null?void 0:Be.fk_lookup_column_id)});if(!bt)continue;let xt=un,ct=bt;if(bt.uidt===pe.LinkToAnotherRecord){const ft=await d(bt.colOptions.fk_related_model_id);ft&&(xt=ft,ct=((Q=ft.columns)==null?void 0:Q.find(Be=>Be.pv))||((Mt=ft.columns)==null?void 0:Mt[0]))}Et.relatedTableMeta=xt,Et.relatedColumn=ct,Et.displayValueProp=ct==null?void 0:ct.title}const Rn=Je.list.indexOf(Pn),mt=Dm(Pn[H.column.title]??Pn[H.column.column_name],H.column,Et==null?void 0:Et.displayValueProp),ot=ye+Rn;Et={...Et,groupIndex:ot,column:H.column,groups:new Map,chunkStates:[],count:+Pn.count,groupCount:+Pn.__sub_group_count__,isExpanded:!1,color:Lm(mt,H.column,G),expandedGroups:0,value:mt,nestedIn:Y?[...Y.nestedIn,{title:H.column.title,column_name:H.column.title,key:mt,column_uidt:H.column.uidt,groupIndex:ot}]:[{title:H.column.title,column_name:H.column.title,key:mt,column_uidt:H.column.uidt,groupIndex:ot}],aggregations:{}};const gt=ga(Et);let zt=(((wn=(_e=w.value)==null?void 0:_e.path)==null?void 0:wn.split("-"))??[]).map(Xt=>+Xt);zt=[...zt.slice(0,Et.nestedIn.length),...Array(Math.max(0,Et.nestedIn.length-zt.length)).fill("")];const Ht=gt.join("-")===zt.join("-"),Yt=Et.nestedIn.map(Xt=>`${Xt.key}-${Xt.column_name}`).join("_")||"default";Et.isExpanded=C.value.includes(Yt)||Ht,ie===$.value.length-1&&(Et.path=gt),Y?Y.groups.set(ot,Et):I.value.set(ot,Et),cn.push(Et)}if((It=f.value)!=null&&It.ee&&cn.length){const Pn=new wc,Et=Object.values(a.value).map(ot=>({field:ot.fk_column_id,type:ot.aggregation??Wa.None})).filter(ot=>ot.type!==Wa.None),Rn=cn.map(ot=>({where:ve(ot,o==null?void 0:o.value),alias:Pn.generateAlias(ot.value),filterArrJson:JSON.stringify(v.value)}));let mt={};Et.length&&(mt=m.value?await y({aggregation:Et,filterArrJson:JSON.stringify(v.value)},Rn):await r.dbDataTableBulkAggregate.dbDataTableBulkAggregate(n.value.id,{viewId:t.value.id,aggregation:Et,filterArrJson:JSON.stringify(v.value)},Rn),await Pn.process(mt,(ot,gt)=>{const zt=cn.find(Ht=>Ht.value.toString()===ot.toString());Object.keys(gt).forEach(Ht=>{const Yt=x.value[Ht],Xt=S.value[Yt.fk_column_id];gt[Ht]=Vu(Yt.aggregation,gt[Ht],Xt,[ot.toString()],{col:Xt,meta:n.value,metas:c.value,isMysql:i.isMysql,isPg:i.isPg})??""}),zt&&Object.assign(zt.aggregations,gt)}))}Y?oe[ke]="loaded":(F.value=Je.pageInfo.totalRows||F.value,E.value[ke]="loaded")}catch(Tt){console.error(`Error fetching group chunk at level ${ie}:`,Tt),oe[ke]=void 0}};function ve(ke,Y=""){var we;return(we=ke==null?void 0:ke.nestedIn)!=null&&we.length?ke.nestedIn.reduce((oe,ye)=>{if(ye.key===kl.NULL)oe+=`${oe.length?"~and":""}(${ye.title},gb_null)`;else if(ye.column_uidt===pe.Checkbox)oe+=`${oe.length?"~and":""}(${ye.title},${ye.key===kl.TRUE?"checked":"notchecked"})`;else if([pe.Date,pe.DateTime,pe.CreatedTime,pe.LastModifiedTime].includes(ye.column_uidt))oe+=`${oe.length?"~and":""}(${ye.title},gb_eq,exactDate,${ye.key})`;else if([pe.User,pe.CreatedBy,pe.LastModifiedBy].includes(ye.column_uidt))try{const ie=JSON.parse(ye.key);oe+=`${oe.length?"~and":""}(${ye.title},gb_eq,${(Array.isArray(ie)?ie:[ie]).map(H=>H.id).join(",")})`}catch(ie){console.error(ie)}else oe+=`${oe.length?"~and":""}(${ye.title},gb_eq,${ye.key})`;return oe},Y):Y}function xe(ke){var Y;return((Y=ke.nestedIn)==null?void 0:Y.length)||0}const ne=async(ke,Y,we,oe=!1)=>{const ye=M(ke),ie=M(Y),H=we?we.chunkStates:E.value,Ae=Array.from({length:ie-ye+1},(Ie,ce)=>ye+ce).filter(Ie=>!H[Ie]||oe);if(await Promise.all(Ae.map(Ie=>ae(Ie,we,oe))),l==null||l.syncVisibleData(),oe){let Ie=!1;for(let ce=ke;ce<=Y;ce++){const te=I.value.get(ce);(te==null?void 0:te.count)===0&&(Ie=!0),Ie&&I.value.delete(ce)}}await Promise.all(Ae.map(Ie=>ae(Ie,we,oe)))},he=(ke,Y,we)=>{if(ke===Number.NEGATIVE_INFINITY&&Y===Number.POSITIVE_INFINITY){I.value=new Map,E.value=[];return}const oe=we?we.groups:I.value;if(oe.size<=_2)return;const ye=Math.max(0,ke),ie=Math.min((we?we.count:F.value)-1,Y),H=new Map;for(let Ae=ye;Ae<=ie;Ae++){const Ie=oe.get(Ae);Ie&&H.set(Ae,Ie)}we?(we.groups=H,we.chunkStates=we.chunkStates.map((Ae,Ie)=>Ie>=M(ye)&&Ie<=M(ie)?Ae:void 0)):(I.value=H,E.value=E.value.map((Ae,Ie)=>Ie>=M(ye)&&Ie<=M(ie)?Ae:void 0))};async function W(ke){var Y,we,oe,ye;if(!(!t.value||!((we=(Y=n.value)==null?void 0:Y.columns)!=null&&we.length)))if(ke){const ie=(ye=$.value)==null?void 0:ye[ke.nestedIn.length];if(!ie)return;const H=ve(ke,o==null?void 0:o.value);ke.groupCount=m.value?await r.public.dataGroupByCount(b.value.uuid,{where:H,column_name:ie.column.title,filterArrJson:JSON.stringify(v.value)},{headers:{"xc-password":g.value}}):await r.dbViewRow.groupByCount("noco",s.value.id,t.value.fk_model_id,t.value.id,{where:H,column_name:ie.column.title})}else{const ie=(oe=$.value)==null?void 0:oe[0];if(!ie)return;F.value=m.value?await r.public.dataGroupByCount(b.value.uuid,{where:o==null?void 0:o.value,column_name:ie.column.title,filterArrJson:JSON.stringify(v.value)},{headers:{"xc-password":g.value}}):await r.dbViewRow.groupByCount("noco",s.value.id,t.value.fk_model_id,t.value.id,{where:o==null?void 0:o.value,column_name:ie.column.title})}}async function j(ke,Y){var H;if(!((H=f.value)!=null&&H.ee))return;const we=100,oe=new wc,ye=Y?Y.map(Ae=>{const Ie=x.value[Ae.title];return Ie?{field:Ie.fk_column_id,type:Ae.aggregation??Ie.aggregation??Wa.None}:null}).filter(Boolean):Object.values(a.value).map(Ae=>({field:Ae.fk_column_id,type:Ae.aggregation??Wa.None})).filter(Ae=>Ae.type!==Wa.None);if(!ye.length)return;const ie=new Map;Y&&Y.forEach(Ae=>{const Ie=x.value[Ae.title];Ie!=null&&Ie.fk_column_id&&ie.set(Ie.fk_column_id,Ae.aggregation??Ie.aggregation??Wa.None)});for(let Ae=0;Ae<ke.length;Ae+=we){const Ie=ke.slice(Ae,Ae+we),ce=Ie.map(te=>({where:ve(te,o==null?void 0:o.value),alias:oe.generateAlias(tf(te)),filterArrJson:JSON.stringify(v.value)}));try{const te=m.value?await y({aggregation:ye,filterArrJson:JSON.stringify(v.value)},ce):await r.dbDataTableBulkAggregate.dbDataTableBulkAggregate(n.value.id,{viewId:t.value.id,aggregation:ye,filterArrJson:JSON.stringify(v.value)},ce);await oe.process(te,(Le,Ne)=>{const lt=Ie.find(je=>tf(je)===Le.toString());lt&&(Object.keys(Ne).forEach(je=>{const He=x.value[je],Q=S.value[He.fk_column_id],Mt=ie.get(He.fk_column_id)??He.aggregation;Ne[je]=Vu(Mt,Ne[je],Q,[Le.toString()],{col:Q,meta:n.value,metas:c.value,isMysql:i.isMysql,isPg:i.isPg})??""}),Object.assign(lt.aggregations,Ne))})}catch(te){console.error("Error refreshing group aggregations batch:",te)}}l==null||l.syncVisibleData()}const Ee=async ke=>{ke.isExpanded=!ke.isExpanded;const Y=ke.nestedIn.map(we=>`${we.key}-${we.column_name}`).join("_")||"default";if(ke.isExpanded)C.value.includes(Y)||C.value.push(Y);else{const we=C.value.indexOf(Y);we!==-1&&C.value.splice(we,1)}},Ye=async(ke,Y)=>{let we;if(ke!=null&&ke.length||(ke=[0]),ke.length===1)we=I.value;else{let oe=I.value;for(let ye=0;ye<ke.length-1;ye++){const ie=oe.get(ke[ye]);if(!ie||!ie.groups)return;oe=ie.groups}we=oe}we.forEach(oe=>{const ye=oe.nestedIn.map(ie=>`${ie.key}-${ie.column_name}`).join("_")||"default";if(oe.isExpanded=Y,Y)C.value.includes(ye)||C.value.push(ye);else{const ie=C.value.indexOf(ye);ie!==-1&&C.value.splice(ie,1)}}),l==null||l.syncVisibleData()};return{isGroupBy:le(()=>!!$.value.length),cachedGroups:I,groupByColumns:$,totalGroups:F,chunkStates:E,syncCount:W,fetchMissingGroupChunks:ne,clearGroupCache:he,toggleExpand:Ee,GROUP_CHUNK_SIZE:Jr,buildNestedWhere:ve,CHUNK_SIZE:50,columnsById:S,gridViewColByTitle:x,updateGroupAggregations:j,toggleExpandAll:Ye}};function k2(t,n,o,l){const a=Qh(),{activeTable:i}=Go(a),s=fn(Ea,Uo()),r=le(()=>t.value||i.value),{t:d}=oa(),c=Zh("optimisedQuery",()=>!0),f=fn(zl,V(!1)),{getMeta:v}=oi(),h=fn(Ju),{addUndo:y,clone:b,defineViewScope:_}=Fi(),{base:m}=Go(Ca()),{$api:g}=da(),{appInfo:C}=nl(),w=V(!1),{cachedGroups:S,totalGroups:x,toggleExpand:$,groupByColumns:I,isGroupBy:F,buildNestedWhere:E,clearGroupCache:M,syncCount:U,fetchMissingGroupChunks:L,updateGroupAggregations:G,toggleExpandAll:ae}=x2(n,r,o,{syncVisibleData:mt}),{insertRow:ve,updateRowProperty:xe,addEmptyRow:ne,deleteRow:he,deleteRowById:W,updateOrSaveRow:j,cachedRows:Ee,clearCache:Ye,totalRows:Ge,actualTotalRows:ke,bulkUpdateView:Y,removeRowIfNew:we,syncCount:oe,fetchChunk:ye,recoverLTARRefs:ie,getChunkIndex:H,selectedRows:Ae,chunkStates:Ie,isRowSortRequiredRows:ce,clearInvalidRows:te,applySorting:Le,CHUNK_SIZE:Ne,isLastRow:lt,isFirstRow:je,getExpandedRowIndex:He,loadData:Q,updateRecordOrder:Mt,selectedAllRecords:_e,loadAggCommentsCount:wn,navigateToSiblingRow:It,getRows:Tt,getDataCache:Je,groupDataCache:cn}=Um({meta:r,viewMeta:n,callbacks:{syncVisibleData:mt,getCount:Et,getWhereFilter:Rn,reloadAggregate:Pn,findGroupByPath:xt=>xa(S.value,xt)},groupByColumns:I,where:o,isPublic:f});function Pn(xt){var st;const{fields:ct,path:ft}=xt;if(h==null||h.trigger(xt),!F.value||!((st=C.value)!=null&&st.ee))return;function Be(qe){const u=[qe];if(qe.groups&&qe.groups.size>0)for(const R of qe.groups.values())u.push(...Be(R));return u}const at=xa(S.value,ft);if(!at)return;const kt=Be(at);if(G(kt,ct),ft.length>1)for(let qe=ft.length-1;qe>0;qe--){const u=ft.slice(0,qe),R=xa(S.value,u);if(R){const P=Be(R);G(P,ct)}}}h==null||h.on((xt={})=>{const{path:ct,fields:ft}=xt;if(!(ct!=null&&ct.length)&&F.value){let Be=function(kt){const st=Array.from(kt.values());at.push(...st);for(const qe of st)qe.groups&&qe.groups.size>0&&Be(qe.groups)};const at=[];Be(S.value),at.length&&G(at,ft)}});function Et(xt){if(!(xt!=null&&xt.length))return;let ct=S.value;const ft=[...xt];for(let kt=0;kt<xt.length-1;kt++){const st=ft[kt],qe=ct.get(st);if(!qe||!qe.groups){console.warn(`Invalid path: Group at index ${st} not found or has no subgroups`);return}ct=qe.groups}const Be=ft[xt.length-1],at=ct.get(Be);if(!at){console.warn(`Target group at path [${xt}] not found`);return}return at.count}async function Rn(xt=[],ct=!1){let ft=xa(S.value,xt);if(!ft)try{let Be=S.value,at,kt;for(let st=0;st<xt.length;st++){const qe=xt[st],u=Be.get(qe);if(!u){kt=qe;break}if(st===xt.length-1){kt=qe;break}if(!u.isExpanded||!u.groups)return"";at=u,Be=u.groups}kt!==void 0&&await L(kt,kt,at),ft=xa(S.value,xt)}catch(Be){return console.error(`Failed to load group for path ${xt}:`,Be),""}return E(ft,ct?"":o==null?void 0:o.value)}function mt(){l==null||l.trigger()}async function ot(xt=[]){var at,kt,st,qe;let ct=[],ft="";w.value=!0;const Be=Je(xt);for(const u of Be.selectedRows.value){const{row:R,rowMeta:P}=u;if(!P.selected||P.new)continue;const D=mc((at=r==null?void 0:r.value)==null?void 0:at.columns),fe=qt(R,(kt=r==null?void 0:r.value)==null?void 0:kt.columns),K=Pi(R,(st=r==null?void 0:r.value)==null?void 0:st.columns);D&&fe&&(ft||(ft=D),ct.push({[ft]:fe,pkData:K,row:b(R),rowMeta:P}))}if(ct.length){try{const{list:u}=await g.dbTableRow.list(ya,m==null?void 0:m.value.id,(qe=r.value)==null?void 0:qe.id,{pks:ct.map(R=>R[ft]).join(","),getHiddenColumns:!0,limit:ct.length});ct=ct.map(R=>{var K;const P=R.row,D=Pi(P,(K=r.value)==null?void 0:K.columns),fe=u.find(O=>Object.keys(D).every(Z=>O[Z]===D[Z]));return fe?{...R,row:{...fe}}:{...R}}),await un(ct.map(R=>R.pkData))}catch(u){const R=await pl(u);return w.value=!1,tn.error(`${d("msg.error.deleteRowFailed")}: ${R}`)}await Yt(ct,!1,xt),y({undo:{fn:async(u,R)=>{const P=u.reverse(),D=await gt(P,void 0,!0,R);Array.isArray(D)&&await Promise.all(P.map((fe,K)=>ie(fe.row)))},args:[ct,b(xt)]},redo:{fn:async(u,R)=>{try{w.value=!0,await un(u.map(P=>P.pkData)),await Yt(u,!1,R),await oe(R)}finally{w.value=!1}},args:[ct,b(xt)]},scope:_({view:n.value})}),w.value=!1,await oe(xt)}}async function gt(xt,{metaValue:ct=r.value,viewMetaValue:ft=n.value}={},Be=!1,at=[]){var qe;if(!ct||!ft)throw new Error("Meta value or view meta value is undefined");const kt=Je(at);w.value=!0;const st=new Set((qe=ct.columns)==null?void 0:qe.filter(u=>!u.pk&&(Os(u)||rs(u))).map(u=>u.title));try{const R=(await Promise.all(xt.map(async K=>{const{missingRequiredColumns:O,insertObj:Z}=await tv({meta:ct,ltarState:{},getMeta:v,row:K.row,undo:Be});if(O.size===0){const ge={...Z};for(const ee of st)delete ge[ee];return{insertObj:ge,rowIndex:K.rowMeta.rowIndex}}return null}))).filter(Boolean),P=await g.dbDataTableRow.create(ct.id,R.map(K=>K.insertObj),{viewId:ft.id,undo:Be});R.sort((K,O)=>(K.rowIndex??0)-(O.rowIndex??0));const D=new Map;for(const[K,O]of kt.cachedRows.value)D.set(K,{...O,rowMeta:{...O.rowMeta,rowIndex:K}});for(const{insertObj:K,rowIndex:O}of R){if(D.has(O)){const ge=Array.from(D.entries()).filter(([ee])=>ee>=O).sort((ee,Me)=>Me[0]-ee[0]);for(const[ee,Me]of ge){const We=ee+1;D.set(We,{...Me,rowMeta:{...Me.rowMeta,rowIndex:We}})}}const Z={row:{...K,id:P[R.indexOf({insertObj:K,rowIndex:O})]},oldRow:{},rowMeta:{rowIndex:O,new:!1,path:at}};D.set(O,Z)}const fe=new Set;for(const[K,O]of D){if(fe.has(O.rowMeta.rowIndex)){console.error(`Op: bulkInsertRows ${Be}:  Duplicate index detected:`,O.rowMeta.rowIndex);break}fe.add(O.rowMeta.rowIndex)}return kt.cachedRows.value=D,kt.totalRows.value+=R.length,await oe(at),mt(),P}catch(u){const R=await pl(u);throw tn.error(`Failed to bulk insert rows: ${R}`),u}finally{w.value=!1}}async function zt(xt,ct,{metaValue:ft=r.value}={},Be=!1,at=[]){w.value=!0;const kt=Je(at);await Promise.all(xt.map(async u=>{u.rowMeta&&(u.rowMeta.changed=!1,await ka(()=>{var R,P;return!((R=u.rowMeta)!=null&&R.new&&((P=u.rowMeta)!=null&&P.saving))}).toMatch(R=>R),u.rowMeta.saving=!0)}));const st=[],qe=xt.map(u=>{const R=Pi(u.row,ft==null?void 0:ft.columns),P=ct.reduce((D,fe)=>({...D,[fe]:u.row[fe]}),{});return st.push({pk:qt(u.row,ft==null?void 0:ft.columns),rowIndex:u.rowMeta.rowIndex}),{...P,...R}});try{const u=await g.dbTableRow.bulkUpdate(ya,ft==null?void 0:ft.base_id,ft==null?void 0:ft.id,qe);Pn({fields:ct.map(R=>({title:R})),path:at}),u.forEach(R=>{var fe;const P=qt(R,ft==null?void 0:ft.columns),D=(fe=st.find(K=>K.pk===P))==null?void 0:fe.rowIndex;if(D!=null){const K=kt.cachedRows.value.get(D);K&&(K.rowMeta.saving=!1,K.row={...K.row,...R},kt.cachedRows.value.set(D,K))}})}catch(u){console.error(u),tn.error(await pl(u)),w.value=!1;return}finally{xt.forEach(u=>{u.rowMeta&&(u.rowMeta.saving=!1)})}Be||y({undo:{fn:async(u,R,P)=>{await zt(u.map(D=>({...D,row:D.oldRow,oldRow:D.row})),R,void 0,!0,P)},args:[b(xt),ct,b(at)]},redo:{fn:async(u,R,P)=>{await zt(u,R,void 0,!0,P)},args:[b(xt),ct,b(at)]},scope:_({view:n.value})}),Le(xt),mt(),s==null||s.trigger(),w.value=!1}async function Ht(xt,ct,ft,{metaValue:Be=r.value,viewMetaValue:at=n.value}={},kt,st=!1,qe=[]){var R;const u=Je(qe);try{w.value=!0;const P=(r.value.columns??[]).filter(Xe=>kt.some(nt=>nt.title===Xe.title)),D=ct.filter(Xe=>!u.cachedRows.value.has(Xe.rowMeta.rowIndex)),fe=new Set(D.map(Xe=>Math.floor(Xe.rowMeta.rowIndex/Ne)));await Promise.all(Array.from(fe).map(Xe=>ye(Xe,qe)));const K=Xe=>qt(Xe.row,Be==null?void 0:Be.columns),O=ct.map(Xe=>{const nt=Xe??u.cachedRows.value.get(Xe.rowMeta.rowIndex);return P.forEach(et=>{nt.oldRow[et.title]=void 0}),b(nt)}),Z=Xe=>{var et;const nt={...Xe};return(et=Be==null?void 0:Be.columns)==null||et.forEach(ut=>{(ut.system||xo(ut))&&delete nt[ut.title]}),nt};ct=ct.map(Xe=>{const nt=u.cachedRows.value.get(Xe.rowMeta.rowIndex);return nt?{...nt,row:{...nt.row,...Xe.row},oldRow:nt.row}:Xe});const ge=await g.dbTableRow.bulkUpsert(ya,(Be==null?void 0:Be.base_id)??((R=m.value)==null?void 0:R.id),Be==null?void 0:Be.id,[...xt.map(Xe=>Z(Xe.row)),...ct.map(Xe=>Z(Xe.row))],{}),ee=new Set(Array.from(u.cachedRows.value.values()).map(Xe=>K(Xe))),[Me,We]=ge.reduce(([Xe,nt],et)=>ee.has(qt(et,Be==null?void 0:Be.columns))?[Xe,[...nt,{row:et,rowMeta:{},oldRow:et}]]:[[...Xe,{row:et,rowMeta:{},oldRow:{}}],nt],[[],[]]);Me.forEach((Xe,nt)=>{const et=u.totalRows.value+nt;Xe.rowMeta.rowIndex=et,u.cachedRows.value.set(et,{...Xe,rowMeta:{...Xe.rowMeta,rowIndex:et}})}),We.forEach(Xe=>{const nt=Array.from(u.cachedRows.value.entries()).find(([et,ut])=>K(ut)===K(Xe));nt&&u.cachedRows.value.set(nt[0],{...Xe,rowMeta:{...Xe.rowMeta,rowIndex:nt[0]}})}),u.totalRows.value+=Me.length,st||y({undo:{fn:async(Xe,nt,et)=>{var ut,Ke,Qe;try{w.value=!0,await un(Xe.map(Vt=>Pi(Vt.row,Be==null?void 0:Be.columns))),await zt(nt.map(Vt=>({...Vt,row:Vt.oldRow,oldRow:Vt.row})),ft,{metaValue:Be},!0,et),w.value=!0;const ht=(await g.dbTableColumn.hash((ut=r.value)==null?void 0:ut.id)).hash;await g.dbTableColumn.bulk((Ke=r.value)==null?void 0:Ke.id,{hash:ht,ops:P.map(Vt=>({op:"delete",column:Vt}))}),Xe.forEach(Vt=>{u.cachedRows.value.delete(Vt.rowMeta.rowIndex)}),u.totalRows.value=u.totalRows.value-Xe.length,mt(),await v((Qe=r.value)==null?void 0:Qe.id,!0)}catch{}finally{w.value=!1}},args:[b(Me),b(O),b(qe)]},redo:{fn:async(Xe,nt,et)=>{var ut,Ke,Qe;try{w.value=!0;const ht=(await g.dbTableColumn.hash((ut=r.value)==null?void 0:ut.id)).hash;await g.dbTableColumn.bulk((Ke=r.value)==null?void 0:Ke.id,{hash:ht,ops:P.map(Vt=>({op:"add",column:Vt}))}),await Ht(Xe,nt,ft,{metaValue:Be,viewMetaValue:at},kt,!0,et),w.value=!0,await v((Qe=r.value)==null?void 0:Qe.id,!0),mt()}finally{w.value=!1}},args:[b(Me),b(We),b(qe)]},scope:_({view:n.value})}),s==null||s.trigger(),mt(),await oe(qe)}catch(P){tn.error(await pl(P))}finally{w.value=!1}}async function Yt(xt,ct=!0,ft=[]){const Be=Je(ft),at=Math.max(...Be.cachedRows.value.keys()),kt=new Map,st=new Set(xt.map(D=>(ct?D.row:D).rowMeta.rowIndex)),qe=new Set;let u=0;for(let D=0;D<=at+1;D++){if(st.has(D)){u++,qe.add(H(D));continue}if(Be.cachedRows.value.has(D)){const fe=Be.cachedRows.value.get(D);if(fe){const K=D-u;fe.rowMeta.rowIndex=K,kt.set(K,fe),qe.add(H(D)),qe.add(H(K))}}}const R=new Map;for(const[D,fe]of kt){const K=H(fe.rowMeta.rowIndex);R.set(K,(R.get(K)||0)+1)}for(const D of qe)(!R.has(D)||R.get(D)<Ne)&&(Be.chunkStates.value[D]=void 0);const P=new Set;for(const[D,fe]of kt){if(P.has(fe.rowMeta.rowIndex)){console.error("Op: updateCacheAfterDelete: Duplicate index detected:",fe.rowMeta.rowIndex);break}P.add(fe.rowMeta.rowIndex)}Be.cachedRows.value=kt,Be.totalRows.value=Math.max(0,Be.totalRows.value-xt.length),await oe(ft),mt()}async function Xt(xt,ct=[]){var u,R,P,D;if(!xt._start||!xt._end)return;w.value=!0;const ft=Je(ct),Be=Math.min(xt._start.row,xt._end.row),at=Math.max(xt._start.row,xt._end.row);let kt=[],st="";await Tt(Be,at,ct);for(let fe=Be;fe<=at;fe++){const K=ft.cachedRows.value.get(fe);if(!K){console.warn(`Record at index ${fe} not found in local cache`);continue}const{row:O,rowMeta:Z}=K;if(!Z.new){const ge=mc((u=r==null?void 0:r.value)==null?void 0:u.columns),ee=qt(O,(R=r==null?void 0:r.value)==null?void 0:R.columns),Me=Pi(O,(P=r==null?void 0:r.value)==null?void 0:P.columns);ge&&ee&&(st||(st=ge),kt.push({[st]:ee,pkData:Me,...K,rowIndex:fe}))}}if(!kt.length)return;const{list:qe}=await g.dbTableRow.list(ya,m==null?void 0:m.value.id,(D=r.value)==null?void 0:D.id,{pks:kt.map(fe=>fe[st]).join(","),getHiddenColumns:"true",limit:kt.length});try{kt=kt.map(fe=>{var ge;const K=fe.row,O=Pi(K,(ge=r.value)==null?void 0:ge.columns),Z=qe.find(ee=>Object.keys(O).every(Me=>ee[Me]===O[Me]));return Z?(fe.row=Z,fe):(console.warn(`Full record not found for row with index ${fe.rowMeta.rowIndex}`),fe)}),await un(kt.map(fe=>fe.pkData))}catch(fe){const K=await pl(fe);throw tn.error(`${d("msg.error.deleteRowFailed")}: ${K}`),w.value=!1,fe}y({undo:{fn:async(fe,K)=>{const O=fe.reverse(),Z=await gt(O,void 0,!0,K);Array.isArray(Z)&&await Promise.all(O.map((ge,ee)=>ie(ge.row)))},args:[kt,b(ct)]},redo:{fn:async(fe,K)=>{await un(fe.map(O=>O.pkData)),await Yt(fe,!1,K)},args:[kt,b(ct)]},scope:_({view:n.value})}),await Yt(kt,!1,ct),w.value=!1}async function un(xt,{metaValue:ct=r.value,viewMetaValue:ft=n.value}={}){try{const Be=await g.dbDataTableRow.delete(ct==null?void 0:ct.id,xt.length===1?xt[0]:xt,{viewId:ft==null?void 0:ft.id});return Pn({path:[]}),xt.length===1&&Be?[Be]:Be}catch(Be){const at=await pl(Be);tn.error(`Bulk delete failed: ${at}`)}}async function bt(xt=[]){var ct;try{w.value=!0,await g.dbTableRow.bulkDeleteAll("noco",m.value.id,r.value.id,{where:o==null?void 0:o.value,viewId:(ct=n.value)==null?void 0:ct.id})}catch{}finally{Ye(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,xt),await oe(xt),mt==null||mt(),w.value=!1}}return{cachedRows:Ee,loadData:Q,insertRow:ve,updateRowProperty:xe,addEmptyRow:ne,deleteRow:he,deleteRowById:W,deleteSelectedRows:ot,deleteRangeOfRows:Xt,updateOrSaveRow:j,bulkUpdateRows:zt,bulkUpsertRows:Ht,bulkUpdateView:Y,bulkDeleteAll:bt,loadAggCommentsCount:wn,syncCount:oe,removeRowIfNew:we,navigateToSiblingRow:It,getExpandedRowIndex:He,optimisedQuery:c,isLastRow:lt,isFirstRow:je,clearCache:Ye,totalRows:Ge,actualTotalRows:ke,selectedRows:Ae,syncVisibleData:mt,chunkStates:Ie,clearInvalidRows:te,applySorting:Le,isRowSortRequiredRows:ce,isBulkOperationInProgress:w,updateRecordOrder:Mt,selectedAllRecords:_e,getRows:Tt,getDataCache:Je,groupDataCache:cn,cachedGroups:S,totalGroups:x,toggleExpand:$,groupByColumns:I,isGroupBy:F,groupSyncCount:U,fetchMissingGroupChunks:L,clearGroupCache:M,toggleExpandAll:ae}}const C2=Co(()=>Ro(()=>Promise.resolve().then(()=>fv),void 0,import.meta.url).then(t=>t.default||t)),R2=Co(()=>Ro(()=>import("./DPZQP7x8.js"),__vite__mapDeps([114,1,2]),import.meta.url).then(t=>t.default||t)),S2=ko({__name:"index",setup(t,{expose:n}){const o=fn(Ai,V()),l=fn(cs,V()),a=fn(Ea,Uo()),i=fs(),s=i.currentRoute,{xWhere:r,eventBus:d,isExternalSource:c}=Il(),{t:f}=oa(),{isFeatureEnabled:v}=em(),{blockExternalSourceRecordVisibility:h,showUpgradeToSeeMoreRecordsModal:y}=ql(),b=V(!1),_=le(()=>s.value.query),m=V(),g=V(!1),C=V(),w=V(),S=Uo();yo(Js,S);const x=V();p1(l,o,r,S);const{loadData:$,updateOrSaveRow:I,addEmptyRow:F,deleteRow:E,deleteSelectedRows:M,cachedRows:U,clearCache:L,removeRowIfNew:G,navigateToSiblingRow:ae,deleteRangeOfRows:ve,bulkUpdateRows:xe,bulkUpsertRows:ne,syncCount:he,totalRows:W,actualTotalRows:j,syncVisibleData:Ee,optimisedQuery:Ye,isLastRow:Ge,isFirstRow:ke,chunkStates:Y,updateRecordOrder:we,clearInvalidRows:oe,isRowSortRequiredRows:ye,applySorting:ie,isBulkOperationInProgress:H,selectedAllRecords:Ae,bulkDeleteAll:Ie,getRows:ce,getDataCache:te,cachedGroups:Le,groupByColumns:Ne,groupSyncCount:lt,fetchMissingGroupChunks:je,toggleExpand:He,totalGroups:Q,clearGroupCache:Mt,toggleExpandAll:_e,groupDataCache:wn}=k2(o,l,r,S),It=le(()=>{var yt;const Re=(yt=l.value)==null?void 0:yt.view;if((Re==null?void 0:Re.row_height)!==void 0)switch(Re==null?void 0:Re.row_height){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 6;default:return 1}});yo(tm,V(!1)),yo(nm,V(!1)),yo(om,V(!0)),yo(lm,V(!1)),yo(am,It);const Tt=fn(zl,V(!1));yo(ir,a);const Je=V(!1);function cn(Re,yt,_t=!1,Ze=[]){var Kt;const on=qt(Re.row,(Kt=o.value)==null?void 0:Kt.columns);if(w.value=yt,on&&!Tt.value){C.value=void 0;const nn={query:{..._.value,rowId:on,path:Ze.join("-"),expand:void 0}};_.value.expand?i.replace(nn):i.push(nn)}else C.value=Re,g.value=!0,Je.value=!_t}n({loadData:$,openColumnCreate:Re=>{var yt;(yt=x.value)==null||yt.openColumnCreate(Re)}});const Et=le({get(){return!!_.value.rowId},set(Re){Re||i.push({query:{..._.value,path:void 0,rowId:void 0}})}}),Rn=Re=>{Je.value||d.emit(Xo.CLEAR_NEW_ROW,Re)},mt=()=>{Ye.value?(Ye.value=!1,tn.info(f("msg.optimizedQueryDisabled"))):(Ye.value=!0,tn.info(f("msg.optimizedQueryEnabled")))},ot=rv(),{windowSize:gt,leftSidebarWidth:zt}=_r(ot),Ht=V(0);d.on(Re=>{(Re===Xo.GROUP_BY_RELOAD||Re===Xo.DATA_RELOAD)&&(a==null||a.trigger())});const Yt=()=>{ae(Gl.NEXT)},Xt=()=>{ae(Gl.PREV)},un=()=>{if(Tt.value){Ht.value=gt.value;return}Ht.value=gt.value-zt.value},bt=le(()=>v(fu.INFINITE_SCROLLING)),xt=le(()=>v(fu.CANVAS_GRID_VIEW)),ct=le(()=>v(fu.CANVAS_GROUP_GRID_VIEW)&&!h(c.value));Hn([gt,zt],un),ti(()=>{un()});const{selectedAllRecords:ft,formattedData:Be,paginationData:at,loadData:kt,changePage:st,aggCommentCount:qe,addEmptyRow:u,deleteRow:R,updateOrSaveRow:P,deleteSelectedRows:D,deleteRangeOfRows:fe,bulkUpdateRows:K,removeRowIfNew:O,isFirstRow:Z,islastRow:ge,getExpandedRowIndex:ee,navigateToSiblingRow:Me}=zm(o,l,r),{isGroupBy:We,rootGroup:Xe,loadGroupData:nt,loadGroups:et,loadGroupPage:ut,groupWrapperChangePage:Ke,loadGroupAggregation:Qe,groupBy:ht,redistributeRows:Vt,loadDisallowedLookups:Pe}=Nm(),Se=le(()=>{switch(ht.value.length){case 1:return"#F9F9FA";case 2:return"#F4F4F5";case 3:return"#E7E7E9";default:return"#F9F9FA"}}),$t=Re=>{var yt;if(_.value.rowId)if(bt.value){const _t=(yt=Array.from(U.value.values()).find(on=>qt(on.row,o.value.columns)===_.value.rowId))==null?void 0:yt.rowMeta.rowIndex;if(_t===void 0)return;const Ze=U.value.get(_t);if(!Ze)return;Ze.rowMeta.commentCount=Re,Ee==null||Ee()}else{const _t=qe.value.findIndex(on=>on.row_id===_.value.rowId),Ze=Be.value.findIndex(on=>{var Kt;return qt(on.row,(Kt=o.value)==null?void 0:Kt.columns)===_.value.rowId});if(Ze===-1)return;if(_t===-1){qe.value.push({row_id:_.value.rowId,count:Re}),Be.value[Ze].rowMeta.commentCount=Re;return}if(Number(qe.value[_t].count)===Re)return;qe.value[_t].count=Re,Be.value[Ze].rowMeta.commentCount=Re}},be=(Re,yt)=>{var _t;if((((_t=at.value)==null?void 0:_t.pageSize)??25)*Re>100&&y({isExternalSource:c.value}))return!0;yt==null||yt()},ze=()=>{var yt,_t,Ze,on;const Re=ee();if(!at.value.isLastPage&&Re===(at.value.pageSize??25)-1&&be((yt=at.value)!=null&&yt.page?((_t=at.value)==null?void 0:_t.page)+1:1)){(on=(Ze=m.value)==null?void 0:Ze.stopLoading)==null||on.call(Ze);return}Me(Gl.NEXT)},wt=()=>{Me(Gl.PREV)},q=V([]),Fe=le(()=>{const Re=te(q.value);return Re==null?void 0:Re.selectedRows.value}),vt=Re=>{q.value=Re,b.value=!0};return Hn([()=>{var Re;return(Re=l.value)==null?void 0:Re.id},()=>{var Re;return(Re=o.value)==null?void 0:Re.columns}],async()=>{await Pe()}),(Re,yt)=>{var Kt;const _t=C2,Ze=ud,on=R2;return p(),B("div",{class:"relative flex flex-col h-full min-h-0 w-full nc-grid-wrapper","data-testid":"nc-grid-wrapper",style:Xn(`background-color: ${e(We)&&!e(ct)?`${e(Se)}`:"var(--nc-grid-bg)"};`)},[!e(We)&&!e(bt)?(p(),X(fd,{key:0,ref_key:"tableRef",ref:x,"selected-all-records":e(ft),"onUpdate:selectedAllRecords":yt[0]||(yt[0]=nn=>bo(ft)?ft.value=nn:null),data:e(Be),"pagination-data":e(at),"load-data":e(kt),"change-page":nn=>be(nn,()=>e(st)(nn)),"call-add-empty-row":e(u),"delete-row":e(R),"update-or-save-row":e(P),"delete-selected-rows":e(D),"delete-range-of-rows":e(fe),"bulk-update-rows":e(K),"expand-form":cn,"remove-row-if-new":e(O),"row-height-enum":e(It),onToggleOptimisedQuery:mt,onBulkUpdateDlg:yt[1]||(yt[1]=nn=>b.value=!0)},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","bulk-update-rows","remove-row-if-new","row-height-enum"])):e(bt)&&(e(xt)&&!e(We)||e(ct)&&e(We))?(p(),X(QC,{key:1,ref_key:"tableRef",ref:x,"selected-all-records":e(Ae),"onUpdate:selectedAllRecords":yt[2]||(yt[2]=nn=>bo(Ae)?Ae.value=nn:null),"load-data":e($),"call-add-empty-row":e(F),"delete-row":e(E),"update-or-save-row":e(I),"delete-selected-rows":e(M),"delete-range-of-rows":e(ve),"apply-sorting":e(ie),"bulk-update-rows":e(xe),"bulk-upsert-rows":e(ne),"update-record-order":e(we),"bulk-delete-all":e(Ie),"clear-cache":e(L),"clear-invalid-rows":e(oe),data:e(U),"total-rows":e(W),"actual-total-rows":e(j),"sync-count":e(he),"get-rows":e(ce),"chunk-states":e(Y),"expand-form":cn,"remove-row-if-new":e(G),"row-height-enum":e(It),"selected-rows":e(Fe),"row-sort-required-rows":e(ye),"total-groups":e(Q),"get-data-cache":e(te),"cached-groups":e(Le),"group-by-columns":e(Ne),"group-data-cache":e(wn),"clear-group-cache":e(Mt),"toggle-expand":e(He),"group-sync-count":e(lt),"fetch-missing-group-chunks":e(je),"is-bulk-operation-in-progress":e(H),"toggle-expand-all":e(_e),onToggleOptimisedQuery:mt,onBulkUpdateDlg:vt},null,8,["selected-all-records","load-data","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","apply-sorting","bulk-update-rows","bulk-upsert-rows","update-record-order","bulk-delete-all","clear-cache","clear-invalid-rows","data","total-rows","actual-total-rows","sync-count","get-rows","chunk-states","remove-row-if-new","row-height-enum","selected-rows","row-sort-required-rows","total-groups","get-data-cache","cached-groups","group-by-columns","group-data-cache","clear-group-cache","toggle-expand","group-sync-count","fetch-missing-group-chunks","is-bulk-operation-in-progress","toggle-expand-all"])):e(We)?(p(),X(tp,{key:3,group:e(Xe),"load-groups":e(et),"load-group-data":e(nt),"call-add-empty-row":e(u),"expand-form":cn,"load-group-page":e(ut),"group-wrapper-change-page":e(Ke),"row-height":e(It),"load-group-aggregation":e(Qe),"max-depth":e(ht).length,"redistribute-rows":e(Vt),"view-width":e(Ht)},null,8,["group","load-groups","load-group-data","call-add-empty-row","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","max-depth","redistribute-rows","view-width"])):(p(),X(Eb,{key:2,ref_key:"tableRef",ref:x,"selected-all-records":e(Ae),"onUpdate:selectedAllRecords":yt[3]||(yt[3]=nn=>bo(Ae)?Ae.value=nn:null),"load-data":e($),"call-add-empty-row":e(F),"delete-row":e(E),"update-or-save-row":e(I),"delete-selected-rows":e(M),"delete-range-of-rows":e(ve),"apply-sorting":e(ie),"bulk-update-rows":e(xe),"bulk-upsert-rows":e(ne),"get-rows":e(ce),"update-record-order":e(we),"bulk-delete-all":e(Ie),"clear-cache":e(L),"clear-invalid-rows":e(oe),data:e(U),"total-rows":e(W),"actual-total-rows":e(j),"sync-count":e(he),"chunk-states":e(Y),"expand-form":cn,"remove-row-if-new":e(G),"row-height-enum":e(It),"selected-rows":e(Fe),"row-sort-required-rows":e(ye),"is-bulk-operation-in-progress":e(H),onToggleOptimisedQuery:mt,onBulkUpdateDlg:yt[4]||(yt[4]=nn=>b.value=!0)},null,8,["selected-all-records","load-data","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","apply-sorting","bulk-update-rows","bulk-upsert-rows","get-rows","update-record-order","bulk-delete-all","clear-cache","clear-invalid-rows","data","total-rows","actual-total-rows","sync-count","chunk-states","remove-row-if-new","row-height-enum","selected-rows","row-sort-required-rows","is-bulk-operation-in-progress"])),(p(),X(Mu,null,{default:J(()=>[e(C)&&e(g)?(p(),X(_t,{key:0,modelValue:e(g),"onUpdate:modelValue":[yt[5]||(yt[5]=nn=>bo(g)?g.value=nn:null),yt[6]||(yt[6]=nn=>Rn(e(C)))],"load-row":!e(Tt),row:e(C),state:e(w),meta:e(o),view:e(l)},null,8,["modelValue","load-row","row","state","meta","view"])):me("",!0)]),_:1})),e(Et)&&((Kt=e(o))!=null&&Kt.id)?(p(),X(Ze,{key:4,ref_key:"expandedFormRef",ref:m,modelValue:e(Et),"onUpdate:modelValue":yt[7]||(yt[7]=nn=>bo(Et)?Et.value=nn:null),row:e(C)??{row:{},oldRow:{},rowMeta:{}},meta:e(o),"load-row":!e(Tt),state:e(w),"row-id":e(_).rowId,view:e(l),"show-next-prev-icons":"","first-row":e(bt)?e(ke):e(Z),"last-row":e(bt)?e(Ge):e(ge),"expand-form":cn,onNext:yt[8]||(yt[8]=nn=>e(bt)?Yt():ze()),onPrev:yt[9]||(yt[9]=nn=>e(bt)?Xt():wt()),onUpdateRowCommentCount:$t},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):me("",!0),(p(),X(Mu,null,{default:J(()=>[e(b)?(p(),X(on,{key:0,modelValue:e(b),"onUpdate:modelValue":yt[10]||(yt[10]=nn=>bo(b)?b.value=nn:null),meta:e(o),view:e(l),path:e(q),"bulk-update-rows":e(xe),rows:e(Fe)},null,8,["modelValue","meta","view","path","bulk-update-rows","rows"])):me("",!0)]),_:1}))],4)}}}),I2=Object.assign(S2,{__name:"SmartsheetGrid"}),CR=Object.freeze(Object.defineProperty({__proto__:null,default:I2},Symbol.toStringTag,{value:"Module"}));export{vd as R,I2 as _,Bb as a,nu as b,CR as c,fv as i,tu as u};
