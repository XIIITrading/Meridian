import{e as Kt,r as T,T as _l,n as q,ak as gl,aQ as Be,bw as at,o8 as hl,I as w,o as r,w as s,a as u,ag as S,L as l,ao as Oe,c as O,K as B,b as n,M as Ht,d as y,t as c,O as Wt,a1 as lt,P as je,Q as yl,_ as Gt,a9 as bl,f as kl,S as wl,G as Mt,aM as xl,em as Cl,al as $l,am as Fl,a8 as Il,aE as Tl,fZ as Al,aC as Ce,dD as Ol,as as Sl,aj as k,ik as he,h2 as Dl,bv as Ml,aU as Bl,dw as Se,aL as Ll,o9 as Bt,g as Rl,bW as Pl,gR as Lt,jA as Nl,$ as De,fr as El,oa as Ul,ob as zl,an as Ve,ar as Vl,aG as jl,ap as Kl,N as te,ad as Rt,aT as ye,jM as Me,af as Pt,cn as Hl,a2 as Wl,a3 as ot,aJ as Gl,aq as Nt,bX as ql,kw as Yl,aw as Ql,b9 as Et,bY as Jl,g0 as Xl,f_ as Zl,f$ as eo,aA as to,by as lo,j6 as oo,ld as ao,a4 as ue,fR as io,aD as so,gY as Ut,bu as no,fS as ro,gJ as zt,fw as uo,ax as co}from"./DOFFjK0_.js";import{u as po}from"./CV-2bRRD.js";import{_ as fo}from"./D_wq2ltS.js";import{_ as mo}from"./9aYOtC5C.js";import{_ as vo}from"./0vrXc9P0.js";import{_ as _o}from"./CQugZrqw.js";import{_ as go}from"./BRTCxTHu.js";import{_ as ho}from"./CiBV2ZED.js";import{r as Vt,a as yo}from"./CJtI8BMq.js";import{a as bo}from"./0c4tmWST.js";import{d as jt}from"./G4Pt-Lbf.js";import{D as ko}from"./BhfICdUA.js";import{u as wo}from"./DG2ZEhLK.js";import{u as xo}from"./B3Wp9c04.js";import{d as Co}from"./ZNRZafJ9.js";import{S as $o}from"./ps5He39s.js";import"./MNXVOE4I.js";import"./DDEVLD8O.js";import"./BNo10Mdm.js";import"./hehmy6V1.js";import"./BvG7Iv4q.js";import"./CyXz1Zkk.js";import"./CPChVVVr.js";import"./D4c215jk.js";import"./CFXGfO_A.js";import"./VKUQM8lk.js";import"./SJHyi9T4.js";import"./YaKnxhzO.js";import"./BqWeTF94.js";import"./D2QgEzTv.js";import"./-rIuSlCu.js";import"./BrfakvRE.js";import"./sgaWLnOz.js";import"./C6nWwNvX.js";import"./BpgQOThx.js";import"./CYkscC4Z.js";import"./CHgOe2F-.js";import"./DEAKw9Pl.js";import"./Cl-qOJW6.js";import"./DmoodaOn.js";import"./Bo7kLdUR.js";import"./4PLl4EP6.js";import"./DcFNOSET.js";import"./boyBAVNN.js";import"./B3tDgntu.js";import"./Db9kSA7A.js";import"./D1gZ4Fpg.js";import"./BYGCxle3.js";import"./C1uRXLg7.js";import"./DGuB8RA-.js";import"./DunK-51v.js";import"./MSgi_m6o.js";import"./JKos0pQW.js";import"./BdLxRlCP.js";import"./CNJqPN7Y.js";import"./AxsiR11P.js";import"./C9H3ht2d.js";import"./CkXo2doe.js";import"./Czlq_f4Y.js";import"./Cgx2iu1G.js";import"./DiUleKVo.js";import"./JUJEmhCv.js";import"./Bgc5K1P7.js";import"./lL-0_K96.js";import"./BClTqpVB.js";import"./CtJu2gHc.js";import"./CMyFGii6.js";import"./qgYlKlk5.js";import"./Cb5B9eG-.js";import"./C_qz9woQ.js";import"./DA4KItu_.js";import"./D8wgK-Ih.js";import"./HdsRe6lq.js";import"./DzBSAsxR.js";import"./4fFkR2QG.js";import"./CAfhvBOi.js";import"./BcKPINb2.js";import"./D0vnHTOx.js";import"./SpSJ8E4d.js";import"./Dh5zKH8k.js";import"./B4YnCsMc.js";import"./6zXueAcs.js";import"./Byuk3M83.js";import"./D-8_fbld.js";import"./DminWhpq.js";import"./NRjd0XWG.js";import"./RfUK_fd6.js";const Fo={class:"flex gap-4"},Io={key:0,class:"nc-modal-confirm-icon-wrapper"},To={class:"flex-1 flex flex-col gap-2"},Ao={class:"flex items-start gap-3"},Oo={class:"flex flex-row w-full justify-end gap-2"},So=Kt({__name:"ModalConfirm",props:{type:{default:"warning"},showIcon:{type:Boolean,default:!0},title:{default:""},titleClass:{default:""},content:{default:""},contentClass:{default:""},okText:{default:""},okClass:{default:""},okProps:{},cancelText:{default:""},cancelClass:{default:""},cancelProps:{},focusBtn:{default:"ok"},visible:{type:Boolean},width:{},height:{default:"auto"},size:{default:"xs"},destroyOnClose:{type:Boolean},maskClosable:{type:Boolean,default:!1},keyboard:{type:Boolean},showSeparator:{type:Boolean,default:!1},wrapClassName:{},closable:{type:Boolean},ncModalClassName:{},stopEventPropogation:{type:Boolean},class:{}},emits:["update:visible","cancel","clickCancel","ok"],setup(it,{emit:V}){const Y=it,ie=V,{visible:P,...se}=Y,ne=T(!1),re=_l(Y,"visible",ie,{defaultValue:!1}),le=q({get:()=>re.value,set:g=>{re.value=g,ie("update:visible",g),g||ie("cancel")}}),{type:ce}=gl(Y),Le=q(()=>ce.value==="success"?"circleCheckSolid":ce.value==="error"?"ncAlertCircleFilled":ce.value==="warning"?"alertTriangleSolid":ce.value==="info"?"ncInfoSolid":"alertTriangleSolid"),Z=T(),pe=T(),Ke=()=>{le.value=!1,ie("clickCancel")};return Be(Z,()=>{var g,N,E;!((g=Z.value)!=null&&g.$el)||Y.focusBtn!=="cancel"||((E=(N=Z.value)==null?void 0:N.$el)==null||E.focus(),ne.value=!0)}),Be(pe,()=>{var g,N,E;!((g=pe.value)!=null&&g.$el)||Y.focusBtn!=="ok"||((E=(N=pe.value)==null?void 0:N.$el)==null||E.focus(),ne.value=!0)}),po(le,g=>{var N,E,j,be,L;switch(g.key){case"Enter":if(at()||hl()||!((N=document.activeElement)!=null&&N.closest(".nc-modal-confirm-wrapper")))return;ie("ok");break;case"Tab":ne.value&&(g.preventDefault(),ne.value=!1,Y.focusBtn==="cancel"?(j=(E=Z.value)==null?void 0:E.$el)==null||j.focus():(L=(be=pe.value)==null?void 0:be.$el)==null||L.focus());break}},{immediate:!0,isGridCell:!1}),(g,N)=>{const E=Ht,j=Wt,be=yl;return r(),w(be,lt(se,{visible:l(le),"onUpdate:visible":N[1]||(N[1]=L=>je(le)?le.value=L:null),title:"","wrap-class-name":"nc-modal-confirm-wrapper"}),{default:s(()=>{var L,K;return[u("div",{class:S(["nc-modal-confirm flex flex-col gap-5",[`nc-modal-confirm-type-${l(ce)}`]])},[u("div",Fo,[g.showIcon?(r(),O("div",Io,[Oe(g.$slots,"icon",{},()=>[n(E,{icon:l(Le),class:"nc-confirm-modal-icon"},null,8,["icon"])],!0)])):B("",!0),u("div",To,[u("div",Ao,[u("div",{class:S(["nc-modal-confirm-title",g.titleClass])},[Oe(g.$slots,"title",{},()=>[y(c(g.title),1)],!0)],2),Oe(g.$slots,"headerAction",{},void 0,!0)]),g.content||g.$slots.content?(r(),O("div",{key:0,class:S(["nc-modal-confirm-content",g.contentClass])},[Oe(g.$slots,"content",{},()=>[y(c(g.content),1)],!0)],2)):B("",!0)])]),Oe(g.$slots,"extraContent",{},void 0,!0),u("div",Oo,[n(j,lt({ref_key:"cancelBtnRef",ref:Z,type:((L=g.cancelProps)==null?void 0:L.type)??"secondary",size:"small",class:g.cancelClass},g.cancelProps,{"hide-focus":l(ne),onClick:Ke}),{default:s(()=>[y(c(g.cancelText||g.$t("general.cancel")),1)]),_:1},16,["type","class","hide-focus"]),n(j,lt({ref_key:"okBtnRef",ref:pe,type:((K=g.okProps)==null?void 0:K.type)??"primary",size:"small",class:g.okClass},g.okProps,{"hide-focus":l(ne),onClick:N[0]||(N[0]=de=>ie("ok"))}),{default:s(()=>[y(c(g.okText||g.$t("general.ok")),1)]),_:1},16,["type","class","hide-focus"])])],2)]}),_:3},16,["visible"])}}}),Do=Object.assign(Gt(So,[["__scopeId","data-v-3c71f71f"]]),{__name:"NcModalConfirm"}),Mo=""+new URL("multi-field-editor.DjOPELNE.png",import.meta.url).href,Bo={class:"nc-fields-wrapper w-full p-4"},Lo={class:"max-w-250 h-full w-full mx-auto flex flex-col gap-6"},Ro={key:0,class:"flex flex-row justify-between mt-2"},Po={class:"flex flex-row gap-x-4"},No={class:"flex w-full justify-between pt-2"},Eo={class:"flex gap-2"},Uo={class:"flex gap-2"},zo={key:0,class:"nc-fields-add-new-field-btn-wrapper rounded-lg shadow-nc-sm"},Vo={class:"flex items-center gap-2"},jo={key:1,class:"nc-fields-add-new-field-btn-wrapper shadow-sm"},Ko={class:"flex items-center gap-2"},Ho={class:"flex flex-row rounded-lg border-1 overflow-clip border-gray-200",style:{height:"calc(100vh - (var(--topbar-height) * 3.6) - 24px)"}},Wo={key:0,class:"pt-3 bg-nc-bg-gray-extralight border-b-1 border-b-nc-border-gray-medium"},Go={class:"px-5 pt-4 pb-5"},qo={key:0,class:"flex items-center"},Yo={class:"flex-1 flex items-center gap-3"},Qo={class:"text-sm text-nc-content-gray-subtle flex-1"},Jo={key:1,class:"w-full flex items-center gap-3"},Xo={key:2},Zo={class:"text-nc-content-purple-light text-sm h-7 flex items-center gap-2"},ea={class:"nc-animate-dots"},ta={key:3},la={class:"flex gap-3 items-start"},oa={class:"flex-1 flex gap-2 flex-wrap"},aa={class:"w-[150px]"},ia={class:"flex flex-row items-center gap-1.5 py-[3px] text-small leading-[18px]"},sa={key:1,class:"text-nc-content-purple-light"},na={key:2,class:"text-nc-content-gray-subtle2"},ra={class:"flex items-center gap-1"},da={key:0,class:"-mx-5 -mb-5 pt-5"},ua={class:"px-5 pt-4 pb-5 flex flex-col gap-4"},ca={key:0,class:"flex items-center"},pa={class:"flex-1 flex items-center gap-3"},fa={class:"text-sm text-nc-content-gray-subtle flex-1"},ma={class:"relative"},va={key:0,class:"w-full flex items-center gap-3"},_a={key:1,class:"flex flex-col gap-3"},ga={class:"flex gap-2 flex-wrap"},ha={class:"w-[150px]"},ya={class:"flex flex-row items-center gap-1.5 py-[3px] text-small leading-[18px]"},ba={key:1,class:"text-nc-content-purple-light"},ka={key:2,class:"text-nc-content-gray-subtle2"},wa=["data-testid","onClick"],xa={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},Ca={"data-testid":"nc-field-title"},$a={class:"flex items-center justify-end gap-1"},Fa={class:"nc-field-status-wrapper flex items-center"},Ia={class:"flex items-center text-xs gap-1"},Ta=["data-testid"],Aa={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},Oa={"data-testid":"nc-field-title"},Sa={class:"flex items-center justify-end gap-1"},Da={class:"flex items-center"},Ma={class:"flex items-center text-xs gap-1"},Ba={key:1,class:"w-[25rem] flex flex-col justify-center p-4 items-center"},La={class:"text-2xl text-gray-600 font-bold text-center pt-6"},Ra={class:"text-center text-sm px-2 text-gray-500 pt-6"},Pa=Kt({__name:"Fields",setup(it){const{t:V}=bl(),{$api:Y}=kl(),{getMeta:ie}=wl(),{meta:P,view:se,eventBus:ne}=wo(),re=Mt(xl,T(!1)),le=Mt(Cl,T(!1)),ce=$l(),Le=Fl(),{openedViewsTab:Z}=Il(Le),{isAiFeaturesEnabled:pe,isAiBetaFeaturesEnabled:Ke,aiIntegrationAvailable:g,aiLoading:N,aiError:E}=Tl(),j=T([]),be=T([]),L=T([]),K=T([]),de=T(),{fields:He,toggleFieldVisibility:qt,loadViewColumns:Yt,isViewColumnsLoading:Qt,showSystemFields:Re}=xo(),R=T(!1),Pe=T(),H=T([]),_=(e,t)=>e!=null&&e.id&&(t!=null&&t.id)?e.id===t.id:e!=null&&e.temp_id&&(t!=null&&t.temp_id)?e.temp_id===t.temp_id:!1,fe=q(()=>{const e={};if(He.value)for(const t of He.value)t.fk_column_id&&(e[t.fk_column_id]=t);return e}),$e=e=>{if(!e)return-1;const t=L.value.find(o=>_(o.column,e));if(t)return t.order;if(e.id){const o=fe.value[e.id];if(o)return o.order}return-1},me=T(Re.value),b=q({get:()=>(j.value??[]).filter(t=>{const o=le.value?!Al.includes(V.name):!0;return!t.fk_column_id&&(me.value?!!fe.value[t.id]:!Ce(t))&&o}).concat(H.value).map(t=>mt(t)).sort((t,o)=>$e(t)-$e(o)),set:e=>{var t;j.value=(t=j.value)==null?void 0:t.map(o=>{const i=e.find(f=>_(f,o));return i||o})}}),st=q(()=>b.value.every(e=>{var t,o;return!!(((t=K.value.find(i=>i.column.fk_column_id===e.id))==null?void 0:t.visible)??((o=fe.value[e.id])==null?void 0:o.show))})),p=T(),ve=T(""),{aiMode:_e,aiModeStep:nt,predicted:Jt,activeTabPredictedFields:Xt,activeTabSelectedFields:W,activeTabPredictHistory:We,calledFunction:Ge,prompt:ke,oldPrompt:Zt,isPromtAlreadyGenerated:el,maxSelectionCount:ee,activeAiTab:Ne,isPredictFromPromptLoading:rt,isFormulaPredictionMode:we,fieldPredictionMode:qe,onInit:Ye,toggleAiMode:tl,disableAiMode:ll,predictMore:ol,predictRefresh:al,predictFromPrompt:il,handleRefreshOnError:dt,onToggleTag:ut}=Co(T(!0),b),Fe=q(()=>Xt.value.filter(e=>!e.selected));Ol(()=>{Ye()});const Qe=(e,t=!1)=>{if(!He.value)return-1;if(e<=0){const C=b.value.find(D=>D.pv);return C?C.order||0:-1}if(e>=b.value.length-1){const C=b.value.map(D=>$e(D));return Math.max(...C)+1}let o=-1,i=-1;const f=b.value[e+(t?-1:0)],d=b.value[e+(t?0:1)];return f&&(o=$e(f)),d&&(i=$e(d),i===-1&&(i=o+1)),(o+i)/2},v=T([]),sl=T(0),oe=T(!1),Ie=T(),Ee=T(),Te=q(()=>v.value.length>0||L.value.length>0||K.value.length>0||me.value!==Re.value),nl=(e,t=!1)=>{const o=b.value.findIndex(i=>_(i,e));o!==-1&&(Ie.value=t?o:o+1)},{isMetaReadOnly:rl}=Sl(),ct=e=>!(rl.value&&!oo.includes(e==null?void 0:e.uidt)&&!ao.includes(e==null?void 0:e.uidt)&&!Ce(e)),U=(e,t)=>{if(e!=null&&e.id&&(e!=null&&e.uidt)&&!ct(e))return ue.info(V("msg.info.schemaReadOnly"));if(e&&(e!=null&&e.pk)){ue.info(V("msg.info.editingPKnotSupported"));return}t&&t.target instanceof HTMLElement&&t.target.closest(".no-action")||_(e,p.value)||e===void 0&&p.value===void 0||(oe.value=!0,De(()=>{p.value=e,oe.value=!1}))},xe=(e,t=!1)=>{e&&nl(e,t),U({}),setTimeout(()=>{!e&&!t&&de.value&&(de.value.scrollTop=de.value.scrollHeight)},100)},A=q(()=>{if(j.value)return j.value.find(e=>e.pv)}),dl=async e=>{var i,f;if(!j.value)return;const t=io(`${e.title} copy`,[...j.value,...H.value]);let o={};switch(e.uidt){case k.LinkToAnotherRecord:case k.Links:case k.Lookup:case k.Rollup:case k.Formula:case k.Button:return ue.info(V("msg.info.notAvailableAtTheMoment"));case k.SingleSelect:case k.MultiSelect:o={...e,title:t,column_name:t,id:void 0,order:void 0,pv:!1,colOptions:{options:((f=(i=e.colOptions)==null?void 0:i.options)==null?void 0:f.map(d=>({...d,id:void 0})))??[]}};break;default:o={...e,title:t,column_name:t,id:void 0,colOptions:void 0,order:void 0,pv:!1};break}xe(e),Ee.value=o},pt=e=>{for(const t of e)if(t.status||t.is_group&&pt(t.children||[]))return!0},Je=(e,t=!1)=>{var d,F,C,D,x,m;const o=b.value.find(M=>_(M,e));if(!o)return;e.colOptions&&[k.SingleSelect,k.MultiSelect].includes(o.uidt)&&(e={...e,colOptions:{...e.colOptions||{},options:(((d=e.colOptions)==null?void 0:d.options)||[]).map(M=>((M==null?void 0:M.index)!==void 0&&delete M.index,M))}});const i=jt(o,e),f=Object.fromEntries(Object.entries(i).filter(([M,J])=>J!==void 0));if(Object.keys(f).length===0||Object.keys(f).length===1&&"custom"in f&&Object.keys(f.custom).length===0||Object.keys(f).length===1&&"altered"in f)v.value=v.value.filter(M=>M.op==="add"||!_(M.column,e));else{const M=v.value.find(h=>_(h.column,e)),J=L.value.find(h=>_(h.column,e));if(H.value.find(h=>_(h,e))){H.value=H.value.map(h=>_(h,e)?(v.value=v.value.filter($=>$.op==="add"&&!_($.column,e)),v.value=[...v.value,{op:"add",column:e}],e):h);return}M||M&&J?M.column=e:so(e)&&!t?(["title","column_name","meta"].some(h=>h in f)||"childViewId"in f&&f.childViewId!==((F=o.colOptions)==null?void 0:F.fk_target_view_id)||pt(f.filters||[]))&&(v.value=[...v.value,{op:"update",column:e}]):v.value=[...v.value,{op:"update",column:e}],p.value&&Object.keys(p.value).length&&(e!=null&&e.id&&((C=p.value)!=null&&C.id)&&(e==null?void 0:e.id)===((D=p.value)==null?void 0:D.id)||e!=null&&e.temp_id&&((x=p.value)!=null&&x.temp_id)&&(e==null?void 0:e.temp_id)===((m=p.value)==null?void 0:m.temp_id))&&(p.value=e)}},Xe=e=>{const t=v.value.find(o=>_(o.column,e));if(t)if(t.op==="delete")v.value=v.value.filter(o=>o.column.id!==e.id);else if(t.op==="add"){if(p.value&&_(p.value,e)&&U(),v.value=v.value.filter(o=>o.column.temp_id!==e.temp_id),H.value=H.value.filter(o=>o.temp_id!==e.temp_id),e.is_ai_field){const o=Jt.value.find(i=>i.ai_temp_id===e.ai_temp_id);if(!o)return;ut(o)}}else t.op="delete",t.column=e;else v.value=[...v.value,{op:"delete",column:e}]},ft=e=>{var t;Ee.value&&(e=Ee.value,Ee.value=void 0),e.temp_id=`temp_${++sl.value}`,e.view_id=(t=se.value)==null?void 0:t.id,v.value=[...v.value,{op:"add",column:e}],H.value=[...H.value,e],Ie.value?(L.value.push({op:"move",column:e,index:Ie.value,order:Qe(Ie.value)}),Ie.value=void 0):L.value.push({op:"move",column:e,index:b.value.length,order:Qe(b.value.length)}),U(e)},ul=e=>{var d,F;const t=b.value[e.moved.oldIndex],o=Qe(e.moved.newIndex,e.moved.newIndex<e.moved.oldIndex),i=v.value.find(C=>_(C.column,t));if((i==null?void 0:i.op)==="update"){const C=jt(i.column,t);if(!(Object.keys(C).length===1&&"column_order"in C)){ue.warning(V("msg.warning.multiField.moveEditedField"));return}}if((i==null?void 0:i.op)==="delete"){ue.warning(V("msg.warning.multiField.moveDeletedField"));return}const f=L.value.find(C=>_(C.column,b.value[e.moved.oldIndex]));f?(f.index=e.moved.newIndex,f.order=o):L.value.push({op:"move",column:b.value[e.moved.oldIndex],index:e.moved.newIndex,order:o}),Je(i?{...i.column,column_order:{order:o,view_id:(d=se.value)==null?void 0:d.id}}:{...t,column_order:{order:o,view_id:(F=se.value)==null?void 0:F.id}},!0)},Ae=e=>{var i,f,d,F,C,D;const t=v.value.find(x=>_(e,x.column)&&x.op==="delete"),o=v.value.find(x=>_(e,x.column)&&x.op==="add");if(t)return!0;if(!e.title&&!o||(e.uidt===k.Links||e.uidt===k.LinkToAnotherRecord)&&o&&(!e.childColumn||!e.childTable||!e.childId)&&(!((i=e.custom)!=null&&i.ref_model_id)||!((f=e.custom)!=null&&f.ref_column_id))||e.uidt===k.Lookup&&o&&(!e.fk_relation_column_id||!e.fk_lookup_column_id)||e.uidt===k.Rollup&&o&&(!e.fk_relation_column_id||!e.fk_rollup_column_id||!e.rollup_function)||e.uidt===k.Formula&&o&&!e.formula_raw)return!1;if(e.uidt===k.Button){if(o&&(e.type===he.Url&&!e.formula_raw||e.type===he.Webhook&&!e.fk_webhook_id))return!1;if(e.type===he.Ai)return!(!e.fk_integration_id||!((d=e.formula_raw)!=null&&d.trim())||!((F=e.output_column_ids)!=null&&F.length)||!((D=(C=e.output_column_ids)==null?void 0:C.split(","))!=null&&D.length))}return!0};function mt(e){var t,o,i,f,d,F,C,D,x;if(e.uidt===k.QrCode&&((t=e.colOptions)!=null&&t.fk_qr_value_column_id)&&(e!=null&&e.fk_qr_value_column_id||(e.fk_qr_value_column_id=e.colOptions.fk_qr_value_column_id)),e.uidt===k.Barcode&&((o=e.colOptions)!=null&&o.fk_barcode_value_column_id)&&(e!=null&&e.fk_barcode_value_column_id||(e.fk_barcode_value_column_id=e.colOptions.fk_barcode_value_column_id)),e.uidt===k.Lookup&&((i=e==null?void 0:e.colOptions)!=null&&i.fk_lookup_column_id)&&((f=e==null?void 0:e.colOptions)!=null&&f.fk_relation_column_id)&&(e!=null&&e.fk_lookup_column_id||(e.fk_lookup_column_id=e.colOptions.fk_lookup_column_id),e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id)),e.uidt===k.Rollup&&((d=e==null?void 0:e.colOptions)!=null&&d.fk_relation_column_id)&&((F=e==null?void 0:e.colOptions)!=null&&F.fk_rollup_column_id)&&((C=e==null?void 0:e.colOptions)!=null&&C.rollup_function)&&(e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id),e!=null&&e.fk_rollup_column_id||(e.fk_rollup_column_id=e.colOptions.fk_rollup_column_id),e!=null&&e.rollup_function||(e.rollup_function=e.colOptions.rollup_function)),e.uidt===k.Formula&&((D=e.colOptions)!=null&&D.formula_raw)&&!(e!=null&&e.formula_raw)&&(e.formula_raw=(x=e.colOptions)==null?void 0:x.formula_raw),e.uidt===k.Button)if(e!=null&&e.id){const m=e.colOptions;e.type=m==null?void 0:m.type,e.theme=m==null?void 0:m.theme,e.label=m==null?void 0:m.label,e.color=m==null?void 0:m.color,e.fk_webhook_id=m==null?void 0:m.fk_webhook_id,e.fk_script_id=m==null?void 0:m.fk_script_id,e.icon=m==null?void 0:m.icon,e.formula_raw=(m==null?void 0:m.formula_raw)||"",e.type===he.Ai&&(e.output_column_ids=(m==null?void 0:m.output_column_ids)||"",e.fk_integration_id=m==null?void 0:m.fk_integration_id)}else e.type=(e==null?void 0:e.type)||he.Url,e.type===he.Ai?(e.theme=e.theme||"text",e.label=e.label||"Generate data",e.color=e.color||"purple",e.icon=e.icon||"ncAutoAwesome",e.output_column_ids=(e==null?void 0:e.output_column_ids)||""):(e.theme=e.theme||"solid",e.label=e.label||"Button",e.color=e.color||"brand",e.fk_webhook_id=(e==null?void 0:e.fk_webhook_id)||""),e.formula_raw=e.formula_raw||"";if(e.uidt===k.LongText&&Dl(e))if(e!=null&&e.id){const m=e.colOptions;e.prompt_raw=m==null?void 0:m.prompt_raw}else e.prompt_raw=e.prompt_raw||"";return e}const vt=e=>{const t=v.value.find(o=>_(o.column,e));t&&(t.op==="delete"?v.value=v.value.filter(o=>!_(o.column,e)):t.op==="update"&&(v.value=v.value.filter(o=>!_(o.column,e)),L.value=L.value.filter(o=>!_(o.column,e))),p.value=null,U(b.value.filter(o=>o.id===e.id)[0]))},Q=e=>{const t=b.value.find(o=>_(o,e));if(t){const o=v.value.find(i=>_(i.column,t));if(o)return o.column}return null},_t=q(()=>{const e={};for(const t of v.value)t.op==="add"?t.column.temp_id&&(e[t.column.temp_id]="add"):t.op==="update"?t.column.id&&(e[t.column.id]="update"):t.op==="delete"&&t.column.id&&(e[t.column.id]="delete");return e}),G=e=>{const t=(e==null?void 0:e.id)||(e==null?void 0:e.temp_id);return t?_t.value[t]:""},cl=q(()=>{const e={};for(const t of v.value)if(t!=null&&t.error){const o=t.column.id||t.column.temp_id;o&&(e[o]=t.error)}return e}),gt=e=>{const t=(e==null?void 0:e.id)||(e==null?void 0:e.temp_id);return t?cl.value[t]:""},ht=()=>{v.value=[],L.value=[],H.value=[],K.value=[],be.value=[],me.value=Re.value,U(),Ye()},yt=q(()=>b.value.every(e=>Ae(e))),bt=()=>{var e,t,o;if(j.value=(t=(e=P.value)==null?void 0:e.columns)==null?void 0:t.map(i=>{const f=i.uidt?Ut.getColumnDefaultMeta(i.uidt):{};return no(f)||(i.meta||(i.meta={}),i.meta={...f,...i.meta||{}}),{...i}}),(o=p.value)!=null&&o.id){const i=b.value.find(f=>{var d;return f.id===((d=p.value)==null?void 0:d.id)});i&&(U(i),oe.value=!0,De(()=>{p.value=i,oe.value=!1}))}},Ue=async()=>{var e,t,o,i,f,d,F,C,D,x,m;if(yt.value){if(!R.value&&!Te.value)return}else{ue.error(V("msg.error.multiFieldSaveValidation"));return}try{if(!((e=P.value)!=null&&e.id))return;R.value=!0;const M=[];for(const h of L.value){const $=v.value.find(X=>_(X.column,h.column));if($&&$.op==="add"){if(!((t=$.column)!=null&&t.userHasChangedTitle)&&!$.column.title){const X=Lt({formState:$.column,tableExplorerColumns:b.value||[],metaColumns:((o=P.value)==null?void 0:o.columns)||[],newFieldTitles:M});M.push(X),$.column.title=X,$.column.column_name=X}$.column.column_order={order:h.order,view_id:(i=se.value)==null?void 0:i.id}}$&&$.op==="update"&&($.column.column_order={order:h.order,view_id:(f=se.value)==null?void 0:f.id}),$&&($.column.view_id=(d=se.value)==null?void 0:d.id)}const J=new Set;for(const h of v.value)if(h.op==="add")p.value&&_(p.value,h.column)&&U();else if(h.op==="delete")J.add(h.column.id),p.value&&_(p.value,h.column)&&U();else if(h.op==="update"){const $=(C=(F=P.value)==null?void 0:F.columns)==null?void 0:C.find(X=>X.id===h.column.id);($==null?void 0:$.uidt)===k.Attachment&&($==null?void 0:$.uidt)!==h.column.uidt&&J.add(h.column.id)}for(const h of K.value)await qt(h.visible,{...h.column,show:h.visible});v.value=v.value.map(({error:h,...$})=>$);const ae=await Y.dbTableColumn.bulk((D=P.value)==null?void 0:D.id,{hash:Pe.value,ops:v.value});await Yt(),ae&&(v.value=ae.failedOps&&((x=ae.failedOps)!=null&&x.length)?ae.failedOps:[],H.value=H.value.filter(h=>!!(ae.failedOps&&ae.failedOps.find(X=>X.column.temp_id===h.temp_id))),L.value=[]);for(const h of v.value)J.has(h.column.id)&&(h.op==="delete"||h.op==="update")&&J.delete(h.column.id);return await ie(P.value.id,!0),bt(),Ye(),Le.updateViewCoverImageColumnId({metaId:P.value.id,columnIds:J}),Pe.value=(await Y.dbTableColumn.hash((m=P.value)==null?void 0:m.id)).hash,Re.value=me.value,K.value=[],ne.emit(ro.ROW_COLOR_UPDATE),!Te.value}catch{ue.error(V("msg.error.somethingWentWrong"))}finally{R.value=!1}},kt=async(e,t)=>{if(t.fk_column_id&&_t.value[t.fk_column_id]){ue.warning(V("msg.warning.multiField.fieldVisibility"));return}const o=K.value.findIndex(i=>i.column.fk_column_id===t.fk_column_id);if(o!==-1){t.show===e?K.value=K.value.filter(i=>i.column.fk_column_id!==t.fk_column_id):K.value[o].visible=e;return}K.value.push({visible:e,column:t})},pl=(e=!1)=>{b.value.forEach(t=>kt(!e,fe.value[t.id]))};Ml(document,"keydown",async e=>{if((Bl()?e.metaKey:e.ctrlKey)&&e.key.toLowerCase()==="s"){if(Z.value!=="field")return;e.preventDefault();return}if(e.altKey&&e.key.toLowerCase()==="c"||e.altKey&&e.code==="KeyC"){if(Z.value!=="field")return;e.preventDefault(),xe()}}),Se("ArrowDown",()=>{const e=b.value.findIndex(t=>_(t,p.value));e===-1||e===b.value.length-1?U(b.value[0]):U(b.value[e+1])}),Se("ArrowUp",()=>{const e=b.value.findIndex(t=>_(t,p.value));U(e===-1?b.value[0]:e===0?b.value[b.value.length-1]:b.value[e-1])}),Se("Delete",()=>{var t;if((t=p.value)!=null&&t.pv||at())return;!(G(p.value)==="delete")&&p.value&&Xe(p.value)}),Se("Backspace",()=>{var t;if((t=p.value)!=null&&t.pv||at())return;!(G(p.value)==="delete")&&p.value&&Xe(p.value)}),Se("ArrowRight",()=>{var e;if(((e=document.activeElement)==null?void 0:e.tagName)!=="TEXTAREA"&&p.value){const t=document.querySelector(".nc-fields-input");t&&t.focus()}});const wt=Ll();Bt(wt.meta_s,()=>{var e;(e=P.value)!=null&&e.id&&Z.value==="field"&&Ue()}),Bt(wt.ctrl_s,()=>{var e;(e=P.value)!=null&&e.id&&Z.value==="field"&&Ue()}),Be(P,async e=>{e!=null&&e.id&&(Pe.value=(await Y.dbTableColumn.hash(e.id)).hash)},{deep:!0}),Rl(async()=>{await Pl(()=>{var e,t;return!!((e=P.value)!=null&&e.id&&((t=P.value)!=null&&t.columns))}).toBeTruthy(),P.value&&P.value.id&&(Pe.value=(await Y.dbTableColumn.hash(P.value.id)).hash),bt()}),Be(()=>{var e;return(e=p.value)==null?void 0:e.temp_id},(e,t)=>{if(!t)return;const o=b.value.find(d=>d.temp_id===t);if(!o||o&&(o.title||!v.value.find(d=>d.op==="add"&&d.column.temp_id===o.temp_id)||o!=null&&o.userHasChangedTitle||!Ae(o)))return;const i=v.value.filter(d=>d.op==="add"&&d.column.title).map(d=>d.column.title).filter(d=>d),f=Lt({formState:o,tableExplorerColumns:b.value||[],metaColumns:j.value||[],newFieldTitles:i});o.title=f,o.column_name=f});const fl=e=>{if([k.SingleSelect,k.MultiSelect].includes(e.type)&&e.options){const o=[];for(const i of e.options)o.find(f=>f.title===i)||o.push({title:i,index:o.length,color:zt.light[o.length%zt.light.length]});e.colOptions={options:o}}const t=qe.value==="formula"?k.Formula:qe.value==="button"?k.Button:e.type;ft(mt({title:e.title,uidt:t,column_name:e.title.toLowerCase().replace(/\\W/g,"_"),...e.formula?{formula_raw:e.formula}:{},...e.colOptions?{colOptions:e.colOptions}:{},meta:Ut.getColumnDefaultMeta(t),...qe.value==="button"?{type:he.Ai,output_column_ids:e.output_column_ids,formula_raw:e.formula_raw}:{},is_ai_field:!0,ai_temp_id:e.ai_temp_id}))},xt=e=>{if(R.value)return;ut(e)&&(fl(e),setTimeout(()=>{de.value&&(de.value.scrollTop=de.value.scrollHeight)},100))},Ct=()=>{ce.navigateToIntegrations(void 0,void 0,{categories:"ai"})},ze=(...e)=>{tl(...e),oe.value=!0,De(()=>{oe.value=!1})},$t=()=>{ll(),oe.value=!0,De(()=>{oe.value=!1})},Ft=T();Be(Ne,e=>{e===Nl.PROMPT&&De(()=>{var t;(t=Ft.value)==null||t.focus()})});const It=T(),Ze=T(),{width:et}=El(It),Tt=q(()=>(et.value&&et.value!==Ze.value&&(Ze.value=et.value),Ze.value)),At=(e,t)=>{var F,C,D;if(!Te.value||!(uo((F=e.params)==null?void 0:F.slugs)&&((D=(C=e.params)==null?void 0:C.slugs)!=null&&D.includes("field")))){t();return}const o=T(!0),i=T({loading:!1}),{close:f}=co(Do,{visible:o,title:V("msg.info.unsavedChanges"),content:V("activity.doYouWantToSaveTheChanges"),okText:V("tooltip.saveChanges"),cancelText:V("labels.discard"),onCancel:d,onOk:async()=>{i.value.loading=!0;const x=await Ue();i.value.loading=!1,x?t():t(!1),d(!1)},okProps:i,"update:visible":d,showIcon:!1,keyboard:!1,loading:R.value,maskClosable:!1});function d(x=!0){x&&(ht(),t()),o.value=!1,f(1e3)}};return Ul((e,t,o)=>{At(t,o)}),zl((e,t,o)=>{At(t,o)}),(e,t)=>{const o=$o,i=Ht,f=Vl,d=Wt,F=fo,C=mo,D=jl,x=Kl,m=Gl,M=ql,J=vo,ae=Wl,h=Yl,$=Jl,X=eo,Ot=Xl,ge=_o,St=go,ml=to,Dt=bo,vl=ho;return r(),O("div",Bo,[u("div",Lo,[l(Qt)?(r(),O("div",Ro,[n(o,{class:"!h-8 !w-68 !rounded !overflow-hidden",active:"",size:"small"}),u("div",Po,[n(o,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),n(o,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),n(o,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"})])])):(r(),O(Ve,{key:1},[u("div",No,[u("div",Eo,[n(f,{value:l(ve),"onUpdate:value":t[1]||(t[1]=a=>je(ve)?ve.value=a:null),"data-testid":"nc-field-search-input",class:"!h-8 !px-1 !rounded-lg !w-72",placeholder:e.$t("placeholder.searchFields")},{prefix:s(()=>[n(i,{icon:"search",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black"})]),suffix:s(()=>[l(ve).length>0?(r(),w(i,{key:0,icon:"close",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black","data-testid":"nc-field-clear-search",onClick:t[0]||(t[0]=a=>ve.value="")})):B("",!0)]),_:1},8,["value","placeholder"]),l(re)?B("",!0):(r(),w(D,{key:0,trigger:["hover"],placement:"bottomRight"},{overlay:s(()=>[n(C,{variant:"small"},{default:s(()=>[n(F,{class:"!children:w-full",onClick:t[2]||(t[2]=a=>pl(l(st)))},{default:s(()=>[y(c(l(st)?e.$t("general.hideAll"):e.$t("general.showAll"))+" "+c(e.$t("objects.fields").toLowerCase()),1)]),_:1}),n(F,{class:"!children:w-full",onClick:t[3]||(t[3]=a=>me.value=!l(me))},{default:s(()=>[y(c(l(me)?e.$t("title.hideSystemFields"):e.$t("activity.showSystemFields")),1)]),_:1})]),_:1})]),default:s(()=>[n(d,{size:"small",type:"secondary","icon-only":"",shadow:!1},{icon:s(()=>[n(i,{icon:"threeDotVertical",class:"text-xs !text-current w-4 h-4"})]),_:1})]),_:1}))]),u("div",Uo,[l(pe)?(r(),O("div",zo,[n(x,null,{title:s(()=>[y(c(`${("renderAltOrOptlKey"in e?e.renderAltOrOptlKey:l(Vt))()} + C`),1)]),default:s(()=>[n(d,{"data-testid":"nc-field-add-new",type:"secondary",size:"small",class:"nc-field-add-new !rounded-r-none !border-r-transparent",disabled:l(R),shadow:!1,onClick:t[4]||(t[4]=a=>xe())},{default:s(()=>[u("div",Vo,[n(i,{icon:"plus",class:"w-3"}),y(" "+c(e.$t("labels.multiField.newField")),1)])]),_:1},8,["disabled"])]),_:1}),n(x,{title:l(_e)?e.$t("labels.disableNocoAI"):"",disabled:!l(_e)},{default:s(()=>[n(D,{trigger:["hover"],placement:"bottomRight","overlay-class-name":"!border-purple-200"},{overlay:s(()=>[n(C,{variant:"medium"},{default:s(()=>[n(F,{class:"!children:w-full !text-nc-content-purple-dark",onClick:t[6]||(t[6]=a=>ze())},{default:s(()=>[(r(),w(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Me))(l(k).SingleLineText)),{class:"flex-none w-3.5 h-3.5"})),y(" "+c(e.$t("labels.autoSuggestFields")),1)]),_:1}),Rt(n(F,{class:"!children:w-full !text-nc-content-purple-dark",onClick:t[7]||(t[7]=a=>ze("formula"))},{default:s(()=>[(r(),w(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Me))(l(k).Formula)),{class:"flex-none w-3.5 h-3.5"})),y(" "+c(e.$t("labels.autoSuggestFormulas")),1)]),_:1},512),[[Pt,!l(le)]]),Rt(n(F,{class:"!children:w-full !text-nc-content-purple-dark",onClick:t[8]||(t[8]=a=>ze("button"))},{default:s(()=>[(r(),w(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Me))(l(k).Button)),{class:"flex-none w-3.5 h-3.5"})),t[23]||(t[23]=y(" Auto suggest actions "))]),_:1,__:[23]},512),[[Pt,!l(le)&&l(Ke)]])]),_:1})]),default:s(()=>[n(d,{size:"small",type:l(_e)?"primary":"secondary",theme:"ai",class:S(["nc-field-ai-toggle-btn",{"!pointer-events-none !cursor-not-allowed":l(N),"nc-ai-mode":l(_e)}]),"icon-only":"",shadow:!1,onClick:t[5]||(t[5]=te(a=>l(_e)?$t():ze(),["stop"]))},{icon:s(()=>[n(i,{icon:"ncAutoAwesome",class:"text-xs !text-current w-4 h-4"})]),_:1},8,["type","class"])]),_:1})]),_:1},8,["title","disabled"])])):(r(),O("div",jo,[n(x,null,{title:s(()=>[y(c(`${("renderAltOrOptlKey"in e?e.renderAltOrOptlKey:l(Vt))()} + C`),1)]),default:s(()=>[n(d,{"data-testid":"nc-field-add-new",type:"secondary",size:"small",class:"nc-field-add-new",disabled:l(R),shadow:!1,onClick:t[9]||(t[9]=a=>xe())},{default:s(()=>[u("div",Ko,[n(i,{icon:"plus",class:"w-3"}),y(" "+c(e.$t("labels.multiField.newField")),1)])]),_:1},8,["disabled"])]),_:1})])),n(d,{"data-testid":"nc-field-reset",type:"secondary",size:"small",disabled:!l(R)&&!l(Te),onClick:t[10]||(t[10]=a=>ht())},{default:s(()=>[y(c(e.$t("general.reset")),1)]),_:1},8,["disabled"]),n(x,null,{title:s(()=>[y(c(`${("renderCmdOrCtrlKey"in e?e.renderCmdOrCtrlKey:l(yo))()} + S`),1)]),default:s(()=>[n(d,{"data-testid":"nc-field-save-changes",type:"primary",size:"small",loading:l(R),disabled:l(yt)?!l(R)&&!l(Te):!0,onClick:t[11]||(t[11]=a=>Ue())},{default:s(()=>[y(c(e.$t("labels.multiField.saveChanges")),1)]),_:1},8,["loading","disabled"])]),_:1})])]),u("div",Ho,[u("div",{class:"flex-1 h-full flex flex-col",style:Hl({width:l(Tt)?`calc(100% - ${l(Tt)}px)`:void 0})},[l(_e)?(r(),O("div",Wo,[n(h,{"active-tab":l(Ne),"onUpdate:activeTab":t[14]||(t[14]=a=>je(Ne)?Ne.value=a:null),"show-close-btn":"",onClose:t[15]||(t[15]=a=>$t())},{AutoSuggestedContent:s(()=>{var a;return[u("div",Go,[l(g)?l(E)?(r(),O("div",Jo,[n(i,{icon:"ncInfoSolid",class:"flex-none !text-nc-content-red-dark w-4 h-4"}),n(x,{class:"truncate flex-1 text-sm text-nc-content-gray-subtle","show-on-truncate-only":""},{title:s(()=>[y(c(l(E)),1)]),default:s(()=>[y(" "+c(l(E)),1)]),_:1}),n(d,{size:"small",type:"text",class:"!text-nc-content-brand",onClick:te(l(dt),["stop"])},{default:s(()=>[y(c(e.$t("general.refresh")),1)]),_:1},8,["onClick"])])):l(nt)==="init"?(r(),O("div",Xo,[u("div",Zo,[n(m,{size:"regular",class:"!text-nc-content-purple-dark"}),u("div",ea," Auto suggesting "+c(l(we)?"formula":"")+" fields for "+c((a=l(P))==null?void 0:a.title),1)])])):l(nt)==="pick"?(r(),O("div",ta,[u("div",la,[u("div",oa,[l(Fe).length?(r(!0),O(Ve,{key:0},Nt(l(Fe),I=>(r(),w(x,{key:I.title,disabled:l(W).length<l(ee)||I.selected},{title:s(()=>[u("div",aa," You can only select "+c(l(ee))+" fields to create at a time. ",1)]),default:s(()=>[n(M,{class:S(["nc-ai-suggested-tag",{"nc-disabled":l(R)||!I.selected&&l(W).length>=l(ee),"nc-selected":I.selected}]),disabled:l(W).length>=l(ee),onClick:tt=>xt(I)},{default:s(()=>[u("div",ia,[l(we)||I!=null&&I.type?(r(),w(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Me))(l(we)?l(k).Formula:I.type)),{key:0,class:S(["flex-none w-3.5 h-3.5",{"opacity-60":l(R)||!I.selected&&l(W).length>=l(ee)}])},null,8,["class"])):B("",!0),u("div",null,c(I.title),1)])]),_:2},1032,["class","disabled","onClick"])]),_:2},1032,["disabled"]))),128)):l(W).length?(r(),O("div",sa," To generate more "+c(l(we)?"formula":"")+" field suggestions, click the + or ⟳ icon on the right ",1)):(r(),O("div",na,c(e.$t("labels.noData")),1))]),u("div",ra,[(l(We).length<l(W).length?l(We).length+l(W).length<10:l(We).length<10)?(r(),w(x,{key:0,title:"Suggest more",placement:"top"},{default:s(()=>[n(d,{size:"xs",class:"!px-1",type:"text",theme:"ai",loading:l(N)&&l(Ge)==="predictMore",disabled:l(R),"icon-only":"",onClick:l(ol)},{icon:s(()=>[n(i,{icon:"ncPlusAi",class:"!text-current"})]),_:1},8,["loading","disabled","onClick"])]),_:1})):B("",!0),n(x,{title:"Re-suggest",placement:"top"},{default:s(()=>[n(d,{size:"xs",class:"!px-1",type:"text",theme:"ai",disabled:l(R),loading:l(N)&&l(Ge)==="predictRefresh",onClick:l(al)},{loadingIcon:s(()=>t[25]||(t[25]=[u("template",null,null,-1)])),default:s(()=>[n(i,{icon:"refresh",class:S(["!text-current",{"animate-infinite animate-spin":l(N)&&l(Ge)==="predictRefresh"}])},null,8,["class"])]),_:1},8,["disabled","loading","onClick"])]),_:1})])]),l(Fe).length?(r(),O("div",da,[n(J,{"show-unlock-button":!1,class:"!px-5"},{icon:s(()=>[n(i,{icon:"ncInfo",class:"text-nc-content-gray-muted w-3.5 h-3.5"})]),title:s(()=>t[26]||(t[26]=[u("span",{class:"truncate"}," Click on suggested fields to add ",-1)])),_:1})])):B("",!0)])):B("",!0):(r(),O("div",qo,[u("div",Yo,[n(i,{icon:"alertTriangleSolid",class:"!text-nc-content-orange-medium w-4 h-4"}),u("div",Qo,c(e.$t("title.noAiIntegrationAvailable")),1)]),n(d,{type:"text",size:"small",onClick:te(Ct,["stop"])},{icon:s(()=>[n(i,{icon:"plus",class:"h-4 w-4"})]),default:s(()=>[t[24]||(t[24]=y(" Add Integration "))]),_:1,__:[24]})]))])]}),PromptContent:s(()=>[u("div",ua,[l(g)?(r(),O(Ve,{key:1},[u("div",ma,[n(ae,{ref_key:"aiPromptInputRef",ref:Ft,value:l(ke),"onUpdate:value":t[12]||(t[12]=a=>je(ke)?ke.value=a:null),disabled:l(R),placeholder:"Enter your prompt to get field suggestions..",class:"nc-ai-input nc-input-shadow !px-3 !pt-2 !pb-3 !text-sm !min-h-[68px] !rounded-lg",onKeydown:t[13]||(t[13]=ot(te(()=>{},["stop"]),["enter"]))},null,8,["value","disabled"]),n(d,{size:"xs",type:"primary",theme:"ai",class:"!px-1 !absolute bottom-2 right-2",disabled:!l(ke).trim()||l(rt)||!!l(ke).trim()&&l(ke).trim()===l(Zt).trim()||l(R),loading:l(rt),"icon-only":"",onClick:l(il)},{loadingIcon:s(()=>[n(m,{class:"!text-purple-700",size:"medium"})]),icon:s(()=>[n(i,{icon:"send",class:"flex-none h-4 w-4"})]),_:1},8,["disabled","loading","onClick"])]),l(E)?(r(),O("div",va,[n(i,{icon:"ncInfoSolid",class:"flex-none !text-nc-content-red-dark w-4 h-4"}),n(x,{class:"truncate flex-1 text-sm text-nc-content-gray-subtle","show-on-truncate-only":""},{title:s(()=>[y(c(l(E)),1)]),default:s(()=>[y(" "+c(l(E)),1)]),_:1}),n(d,{size:"small",type:"text",class:"!text-nc-content-brand",onClick:te(l(dt),["stop"])},{default:s(()=>[y(c(e.$t("general.refresh")),1)]),_:1},8,["onClick"])])):l(el)?(r(),O("div",_a,[t[28]||(t[28]=u("div",{class:"text-nc-content-purple-dark font-semibold text-xs"},"Generated Field(s)",-1)),u("div",ga,[l(Fe).length?(r(!0),O(Ve,{key:0},Nt(l(Fe),a=>(r(),w(x,{key:a.title,disabled:l(W).length<l(ee)||a.selected},{title:s(()=>[u("div",ha," You can only select "+c(l(ee))+" fields to create at a time. ",1)]),default:s(()=>[n(M,{class:S(["nc-ai-suggested-tag",{"nc-disabled":l(R)||!a.selected&&l(W).length>=l(ee),"nc-selected":a.selected}]),disabled:l(W).length>=l(ee),onClick:I=>xt(a)},{default:s(()=>[u("div",ya,[l(we)||a!=null&&a.type?(r(),w(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Me))(l(we)?l(k).Formula:a.type)),{key:0,class:S(["flex-none w-3.5 h-3.5",{"opacity-60":l(R)||!a.selected&&l(W).length>=l(ee)}])},null,8,["class"])):B("",!0),u("div",null,c(a.title),1)])]),_:2},1032,["class","disabled","onClick"])]),_:2},1032,["disabled"]))),128)):l(W).length?(r(),O("div",ba," No suggestions remaining. To generate more fields, prompt again... ")):(r(),O("div",ka,c(e.$t("labels.noData")),1))])])):B("",!0)],64)):(r(),O("div",ca,[u("div",pa,[n(i,{icon:"alertTriangleSolid",class:"!text-nc-content-orange-medium w-4 h-4"}),u("div",fa,c(e.$t("title.noAiIntegrationAvailable")),1)]),n(d,{type:"text",size:"small",onClick:te(Ct,["stop"])},{icon:s(()=>[n(i,{icon:"plus",class:"h-4 w-4"})]),default:s(()=>[t[27]||(t[27]=y(" Add Integration "))]),_:1,__:[27]})]))])]),_:1},8,["active-tab"])])):B("",!0),u("div",{ref_key:"fieldsListWrapperDomRef",ref:de,class:"flex-1 flex-grow-1 nc-scrollbar-md !overflow-auto"},[n(l(ko),{"model-value":l(b),disabled:l(re),"item-key":"id","data-testid":"nc-field-list-wrapper",onChange:t[20]||(t[20]=a=>ul(a))},Ql({item:s(({element:a})=>{var I,tt;return[a.title.toLowerCase().includes(l(ve).toLowerCase())&&!a.pv?(r(),O("div",{key:0,class:S(["flex px-2 border-b-1 border-gray-200 pl-5 group",{selected:_(a,l(p)),"cursor-not-allowed":!ct(a),"hover:bg-gray-100":!l(Ce)(a)}]),"data-testid":`nc-field-item-${((I=Q(a))==null?void 0:I.title)||a.title}`,onClick:z=>U(a,z)},[u("div",xa,[(r(),w(ye(("iconMap"in e?e.iconMap:l(Et)).drag),{class:S(["cursor-move !h-3.75 text-gray-600 mr-1",{"opacity-0 !cursor-default":l(re)}])},null,8,["class"])),a.id&&l(fe)[a.id]?(r(),w($,{key:0,disabled:l(re),checked:!!(((tt=l(K).find(z=>z.column.fk_column_id===a.id))==null?void 0:tt.visible)??l(fe)[a.id].show),"data-testid":"nc-field-visibility-checkbox",onChange:z=>{kt(z.target.checked,l(fe)[a.id])}},null,8,["disabled","checked","onChange"])):(r(),w($,{key:1,disabled:!0,class:"opacity-0",checked:!0})),a&&l(Zl)(Q(a)||a)?(r(),w(X,{key:2,"column-meta":Q(a)||a,class:S({"text-brand-500":_(a,l(p))})},null,8,["column-meta","class"])):(r(),w(Ot,{key:3,"column-meta":Q(a)||a,class:S({"text-brand-500":_(a,l(p))})},null,8,["column-meta","class"])),n(x,{class:S([{"text-brand-500":_(a,l(p))},"truncate flex-1"]),"show-on-truncate-only":""},{title:s(()=>{var z;return[y(c(((z=Q(a))==null?void 0:z.title)||a.title),1)]}),default:s(()=>{var z;return[u("span",Ca,c(((z=Q(a))==null?void 0:z.title)||a.title),1)]}),_:2},1032,["class"])]),u("div",$a,[u("div",Fa,[G(a)==="delete"?(r(),w(ge,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700 text-small leading-[18px]","data-testid":"nc-field-status-deleted-field"},{default:s(()=>[y(c(e.$t("labels.multiField.deletedField")),1)]),_:1})):Ae(a)&&G(a)==="add"?(r(),w(ge,{key:1,color:a!=null&&a.is_ai_field?"purple":"green",border:!!(a!=null&&a.is_ai_field),class:S(["text-small leading-[18px]",{"!bg-purple-50 text-purple-700 !border-purple-100":a==null?void 0:a.is_ai_field,"bg-green-50 text-green-700":!(a!=null&&a.is_ai_field)}]),"data-testid":"nc-field-status-new-field"},{default:s(()=>[a!=null&&a.is_ai_field?(r(),w(i,{key:0,icon:"ncAutoAwesome",class:"mr-1 h-4 w-4"})):B("",!0),y(" "+c(e.$t("labels.multiField.newField")),1)]),_:2},1032,["color","border","class"])):G(a)==="update"?(r(),w(ge,{key:2,color:"orange",border:!1,class:"bg-orange-50 text-orange-700 text-small leading-[18px]","data-testid":"nc-field-status-updated-field"},{default:s(()=>[y(c(e.$t("labels.multiField.updatedField")),1)]),_:1})):B("",!0),Ae(a)?B("",!0):(r(),w(ge,{key:3,color:"yellow",border:!1,class:"ml-1 bg-yellow-50 text-yellow-700 text-small leading-[18px]","data-testid":"nc-field-status-incomplete-configuration"},{default:s(()=>[y(c(e.$t("labels.multiField.incompleteConfiguration")),1)]),_:1})),gt(a)?(r(),w(x,{key:4,class:"cursor-pointer"},{title:s(()=>[y(c(gt(a)),1)]),default:s(()=>[n(ge,{color:"red",border:!1,class:"ml-1 bg-red-50 text-red-700 text-small leading-[18px]","data-testid":"nc-field-status-error-configuration"},{default:s(()=>[n(i,{icon:"info",class:"!text-current"})]),_:1})]),_:2},1024)):B("",!0)]),G(a)==="delete"||G(a)==="update"?(r(),w(d,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:l(R),"data-testid":"nc-field-restore-changes",onClick:z=>vt(a)},{default:s(()=>[u("div",Ia,[n(i,{icon:"reload"}),y(" "+c(e.$t("general.restore")),1)])]),_:2},1032,["disabled","onClick"])):(r(),w(D,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown nc-dropdown-table-explorer",onClick:t[16]||(t[16]=te(()=>{},["stop"]))},{overlay:s(()=>[n(C,{variant:"small",class:"!mt-1 !min-w-55"},{default:s(()=>[G(a)!=="add"?(r(),w(St,{key:0,id:a.id,"data-testid":"nc-field-item-action-copy-id",tooltip:e.$t("msg.clickToCopyFieldId"),label:e.$t("labels.idColon",{id:a.id})},null,8,["id","tooltip","label"])):B("",!0),n(F,{key:"table-explorer-duplicate","data-testid":"nc-field-item-action-duplicate",disabled:l(Ce)(a),onClick:z=>dl(a)},{default:s(()=>[n(i,{icon:"duplicate"}),u("span",null,c(e.$t("general.duplicate"))+" "+c(e.$t("objects.field").toLowerCase()),1)]),_:2},1032,["disabled","onClick"]),a.pv?B("",!0):(r(),w(F,{key:"table-explorer-insert-above","data-testid":"nc-field-item-action-insert-above",onClick:z=>xe(a,!0)},{default:s(()=>[n(i,{icon:"ncArrowUp"}),u("span",null,c(e.$t("general.insertAbove")),1)]),_:2},1032,["onClick"])),n(F,{key:"table-explorer-insert-below","data-testid":"nc-field-item-action-insert-below",onClick:z=>xe(a)},{default:s(()=>[n(i,{icon:"ncArrowDown"}),u("span",null,c(e.$t("general.insertBelow")),1)]),_:2},1032,["onClick"]),n(ml),n(F,{key:"table-explorer-delete","data-testid":"nc-field-item-action-delete",disabled:l(Ce)(a),onClick:z=>Xe(a)},{default:s(()=>[u("div",{class:S(["text-red-500",{"!text-gray-400":l(Ce)(a)}])},[n(i,{icon:"delete",class:"group-hover:text-accent -ml-0.25 -mt-0.75 mr-0.5"}),y(" "+c(e.$t("general.delete"))+" "+c(e.$t("objects.field").toLowerCase()),1)],2)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:s(()=>[n(d,{size:"xsmall",type:"text",class:S(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":_(a,l(p)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!_(a,l(p))}]),"data-testid":"nc-field-item-action-button"},{default:s(()=>[n(i,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:2},1032,["class"])]),_:2},1024)),n(Dt,{class:S(["text-brand-500 opacity-0",{"opacity-100":_(a,l(p))}])},null,8,["class"])])],10,wa)):B("",!0)]}),_:2},[l(A)&&l(A).title&&l(A).title.toLowerCase().includes(l(ve).toLowerCase())?{name:"header",fn:s(()=>{var a;return[u("div",{class:S(["flex px-2 bg-white hover:bg-gray-100 border-b-1 border-gray-200 last:border-b-1 pl-5 group",{selected:_(l(A),l(p)),"first:rounded-tl-lg":!l(_e)}]),"data-testid":`nc-field-item-${((a=Q(l(A)))==null?void 0:a.title)||l(A).title}`,onClick:t[19]||(t[19]=I=>U(l(A),I))},[u("div",Aa,[(r(),w(ye(("iconMap"in e?e.iconMap:l(Et)).drag),{class:S(["cursor-move !h-3.75 text-gray-200 mr-1",{"opacity-0 !cursor-default":l(re)}])},null,8,["class"])),n($,{disabled:!0,checked:!0,"data-testid":"nc-field-visibility-checkbox"}),l(A)?(r(),w(Ot,{key:0,"column-meta":Q(l(A))||l(A),class:S({"text-brand-500":_(l(A),l(p))})},null,8,["column-meta","class"])):B("",!0),n(x,{class:S(["truncate flex-1",{"text-brand-500":_(l(A),l(p))}]),"show-on-truncate-only":""},{title:s(()=>{var I;return[y(c(((I=Q(l(A)))==null?void 0:I.title)||l(A).title),1)]}),default:s(()=>{var I;return[u("span",Oa,c(((I=Q(l(A)))==null?void 0:I.title)||l(A).title),1)]}),_:1},8,["class"])]),u("div",Sa,[u("div",Da,[G(l(A))==="delete"?(r(),w(ge,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700 text-small leading-[18px]","data-testid":"nc-field-status-deleted-field"},{default:s(()=>[y(c(e.$t("labels.multiField.deletedField")),1)]),_:1})):G(l(A))==="update"?(r(),w(ge,{key:1,color:"orange",border:!1,class:"bg-orange-50 text-orange-700 text-small leading-[18px]","data-testid":"nc-field-status-updated-field"},{default:s(()=>[y(c(e.$t("labels.multiField.updatedField")),1)]),_:1})):B("",!0)]),G(l(A))==="delete"||G(l(A))==="update"?(r(),w(d,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:l(R),"data-testid":"nc-field-restore-changes",onClick:t[17]||(t[17]=I=>vt(l(A)))},{default:s(()=>[u("div",Ma,[n(i,{icon:"reload"}),y(" "+c(e.$t("general.restore")),1)])]),_:1},8,["disabled"])):(r(),w(D,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown-display-column nc-dropdown-table-explorer-display-column",onClick:t[18]||(t[18]=te(()=>{},["stop"]))},{overlay:s(()=>[n(C,{variant:"small",class:"!min-w-55"},{default:s(()=>[n(St,{id:l(A).id,"data-testid":"nc-field-item-action-copy-id",tooltip:e.$t("msg.clickToCopyFieldId"),label:e.$t("labels.idColon",{id:l(A).id})},null,8,["id","tooltip","label"])]),_:1})]),default:s(()=>[n(d,{size:"xsmall",type:"text",class:S(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":_(l(A),l(p)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!_(l(A),l(p))}]),"data-testid":"nc-field-item-action-button"},{default:s(()=>[n(i,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:1},8,["class"])]),_:1})),n(Dt,{class:S(["text-brand-500 opacity-0",{"opacity-100":_(l(A),l(p))}])},null,8,["class"])])],10,Ta)]}),key:"0"}:void 0]),1032,["model-value","disabled"])],512)],4),n(lo,{name:"slide-fade"},{default:s(()=>{var a,I;return[l(oe)?B("",!0):(r(),O("div",{key:0,ref_key:"rightPanelRef",ref:It,class:"flex-none border-gray-200 border-l-1 nc-scrollbar-md h-full !overflow-y-auto",onKeydown:[t[21]||(t[21]=ot(te(()=>{},["stop"]),["up"])),t[22]||(t[22]=ot(te(()=>{},["stop"]),["down"]))]},[l(p)?(r(),w(vl,{key:0,class:"p-4 w-[25rem] flex-none",column:l(p),preload:Q(l(p)),"table-explorer-columns":l(b),"is-column-valid":Ae,"embed-mode":"","from-table-explorer":"","disable-title-focus":!!((a=l(p))!=null&&a.id)||!!((I=l(p))!=null&&I.title),onUpdate:Je,onAdd:ft},null,8,["column","preload","table-explorer-columns","disable-title-focus"])):(r(),O("div",Ba,[t[29]||(t[29]=u("img",{src:Mo,class:"!w-[18rem]"},null,-1)),u("div",La,c(e.$t("labels.multiField.selectField")),1),u("div",Ra,c(e.$t("labels.multiField.selectFieldLabel")),1)]))],544))]}),_:1})])],64))])])}}}),gs=Object.assign(Gt(Pa,[["__scopeId","data-v-873514b7"]]),{__name:"SmartsheetDetailsFields"});export{gs as default};
