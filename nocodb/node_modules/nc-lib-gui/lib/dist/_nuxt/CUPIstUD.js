import{e as H,f as P,S as Q,G as h,r as m,aZ as Y,T as Z,n as C,ak as q,fT as J,j9 as K,aC as j,le as B,g as W,I as V,o as k,w as _,a as d,t as c,d as v,aT as F,L as t,b9 as X,b as w,bf as ee,P as D,j as ae,O as se,Q as te,kt as $,fS as le,f$ as oe,g0 as ne,f_ as ie,_ as ue}from"./DOFFjK0_.js";import{u as de}from"./DG2ZEhLK.js";import{u as re}from"./B3Wp9c04.js";import"./SJHyi9T4.js";const ce={class:"flex flex-col gap-3"},pe={class:"text-base text-gray-800 font-semibold"},me={class:"text-gray-600 flex items-center gap-1"},_e={class:"bg-gray-100 inline-flex items-center gap-1 px-1 rounded-md"},ve={class:"border-1 rounded-lg border-nc-border-gray-medium h-[250px]"},fe={class:"flex w-full gap-2 justify-end"},ye=H({__name:"UpdateDisplayValue",props:{value:{type:Boolean},useMetaFields:{type:Boolean}},setup(L){const I=L,{$api:U}=P(),{getMeta:O}=Q(),{eventBus:E}=de(),{fields:M}=re(),l=h(Y,m()),o=Z(I,"value"),z=m(o.value),f=C({get:()=>o.value,set:e=>{o.value=e,z.value=e}}),{useMetaFields:S}=q(I),y=h(J),b=h(K),g=C(()=>(y==null?void 0:y.value)||(b==null?void 0:b.value)),n=m(),x=m(!1),T=e=>({title:e.title,id:e.id,ncItemDisabled:!$(e)&&!e.pv,ncItemTooltip:!$(e)&&B(e)&&!e.pv?`${B(e)} field cannot be used as display value field`:"",column:e}),R=C(()=>{var s,u;const e=((s=l.value)==null?void 0:s.columnsById)??{};return S.value?(((u=l.value)==null?void 0:u.columns)??[]).filter(a=>(a==null?void 0:a.id)&&!j(a)).map(a=>T(a)):(M.value??[]).filter(a=>e[a==null?void 0:a.fk_column_id]&&!j(e[a.fk_column_id])).map(a=>T(e[a.fk_column_id]))}),A=async()=>{var e;if(n.value){x.value=!0;try{await U.dbTableColumn.primaryColumnSet(n.value),await O((e=l==null?void 0:l.value)==null?void 0:e.id,!0),E.emit(le.FIELD_RELOAD),o.value=!1}catch(s){console.error(s)}finally{x.value=!1}}},G=e=>ae(ie(e)?oe:ne,{columnMeta:e});return W(()=>{var e,s,u,a,p;n.value=S.value?(u=(s=(e=l.value)==null?void 0:e.columns)==null?void 0:s.find(i=>i.id===g.value.id))==null?void 0:u.id:(p=(a=M.value)==null?void 0:a.find(i=>i.fk_column_id===g.value.id))==null?void 0:p.fk_column_id}),(e,s)=>{const u=ee,a=se,p=te;return k(),V(p,{visible:t(f),"onUpdate:visible":s[3]||(s[3]=i=>D(f)?f.value=i:null),size:"small"},{default:_(()=>{var i,N;return[d("div",ce,[d("div",null,[d("h1",pe,c(e.$t("labels.searchDisplayValue")),1),d("div",me,[v(c(e.$t("labels.selectYourNewTitleFor"))+" ",1),d("span",_e,[(k(),V(F(("iconMap"in e?e.iconMap:t(X)).table))),v(" "+c(((i=t(l))==null?void 0:i.title)??((N=t(l))==null?void 0:N.table_name)),1)])])]),d("div",ve,[w(u,{value:t(n),"onUpdate:value":s[0]||(s[0]=r=>D(n)?n.value=r:null),open:t(o),"onUpdate:open":s[1]||(s[1]=r=>D(o)?o.value=r:null),list:t(R),"option-label-key":"title","option-value-key":"id","close-on-select":!1,class:"!w-auto","show-search-always":"","container-class-name":"!max-h-[200px]"},{listItemExtraLeft:_(({option:r})=>[(k(),V(F(G(r.column)),{class:"!mx-0 opacity-70"}))]),_:1},8,["value","open","list"])]),d("div",fe,[w(a,{type:"secondary",size:"small",onClick:s[2]||(s[2]=r=>o.value=!1)},{default:_(()=>[v(c(e.$t("general.cancel")),1)]),_:1}),w(a,{disabled:!t(n)||t(n)===t(g).id,loading:t(x),size:"small",onClick:A},{default:_(()=>[v(c(e.$t("labels.changeDisplayValueField")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),Ce=Object.assign(ue(ye,[["__scopeId","data-v-829d5e14"]]),{__name:"SmartsheetHeaderUpdateDisplayValue"});export{Ce as default};
