const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CpTfZi32.js","./DOFFjK0_.js","./entry.DDfSYhWa.css"])))=>i.map(i=>d[i]);
import{e as oe,G as D,fQ as se,gh as re,r as m,aY as ne,a8 as le,am as ie,u as ce,J as ue,n as p,kK as de,aQ as R,fO as pe,eN as me,g as fe,fS as he,bv as ve,c as I,o as u,I as _,L as a,w as f,b as d,M as _e,at as ye,a as i,ag as V,K as y,aG as be,P as ge,o2 as we,t as b,N as Se,ar as xe,ap as ke,aS as De,$ as G,aW as Re,_ as Ie}from"./DOFFjK0_.js";import{_ as Ve}from"./7yLujnbV.js";import{u as qe,b as Ce}from"./DG2ZEhLK.js";import{a as Ee}from"./Dh5zKH8k.js";import"./B3Wp9c04.js";import"./SJHyi9T4.js";import"./D2QgEzTv.js";const Oe=De(()=>Re(()=>import("./CpTfZi32.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(g=>g.default||g)),Be={class:"flex flex-row h-8 relative"},Te={class:"h-5 flex items-center gap-1 px-1 rounded-md text-nc-content-brand bg-nc-bg-brand select-none"},Qe={key:0,class:"w-16 text-bodyDefaultSm font-medium truncate"},$e={class:"flex items-center justify-center px-1"},Ge={key:0,class:"border-t-1 border-nc-border-gray-medium py-1 px-3 flex gap-3"},Le={class:"text-nc-content-gray text-bodySmBold"},We={class:"text-nc-content-gray-muted text-bodySm"},Ne=oe({__name:"SearchData",setup(g){const L=D(se),w=D(re),q=D(ne,m()),{meta:W,eventBus:N,isGrid:j,isGallery:A,totalRowsWithSearchQuery:C,totalRowsWithoutSearchQuery:F,gridEditEnabled:K}=qe(),{lastOpenedViewId:E}=le(ie()),{isGroupBy:M}=Ee(),z=ce().currentRoute,{search:o,loadFieldQuery:P}=Ce(),{isMobileMode:n}=ue(),r=m(!1),c=m(!!n.value),h=m(),O=m(),S=p(()=>!o.value.query&&!c.value),B=p(()=>{var e;return!((e=o.value.query)!=null&&e.trim())||o.value.isValidFieldQuery}),H=p(()=>{var e;return!r.value&&((e=o.value.query)==null?void 0:e.trim())&&!n.value&&(j.value&&!M.value||A.value)}),x=p(()=>{var e,t;return((t=(e=W.value)==null?void 0:e.columns)==null?void 0:t.filter(s=>de(s)))??[]});R(()=>{var e;return(e=q.value)==null?void 0:e.id},(e,t)=>{var s;if(e!==t){let l=!1;e!==E.value&&(E.value=e,l=!0),P((s=q.value)==null?void 0:s.id,l)}},{immediate:!0});function k(){L.trigger({shouldShowLoading:!1,offset:0}),w==null||w.trigger()}const T=p(()=>{var t,s;if(o.value.field)return(t=x.value)==null?void 0:t.find(l=>l.id===o.value.field);const e=(s=x.value)==null?void 0:s.find(l=>l.pv);return o.value.field=e==null?void 0:e.id,e}),Q=p(()=>{var e;return(e=T.value)==null?void 0:e.title});pe(()=>o.value.query,()=>{k()},{debounce:500,maxWait:600});const U=e=>{var t;o.value.field=e.id,r.value=!1,(t=o.value.query)!=null&&t.length&&k(),G(()=>{var s;(s=h.value)==null||s.focus()})},$=()=>{c.value=!0,setTimeout(()=>{G(()=>{var e,t;S.value||((e=h.value)==null||e.focus(),(t=h.value)==null||t.select())})},300)},J=()=>{r.value||K.value||(o.value.query="",n.value||(c.value=!1))};return me(O,e=>{const t=e.target;o.value.query||t.closest(".nc-dropdown-toolbar-search, .nc-dropdown-toolbar-search-field-option")||n.value||(c.value=!1)}),fe(()=>{(o.value.query||n.value)&&!c.value&&(c.value=!0)}),R(()=>{var e,t;return(t=(e=z.value)==null?void 0:e.query)==null?void 0:t.where},()=>{N.emit(he.DATA_RELOAD)}),ve("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="f"?(e.preventDefault(),$()):e.key==="Escape"&&J()}),R(S,e=>{e||(r.value=!1)},{immediate:!0}),(e,t)=>{const s=_e,l=ye,Y=we,X=Ve,Z=be,ee=xe,te=ke,ae=Oe;return u(),I("div",{ref_key:"globalSearchWrapperRef",ref:O,class:"nc-global-search-wrapper relative"},[a(S)?(u(),_(l,{key:0,class:"nc-toolbar-btn !rounded-lg !h-7 !px-1.5","data-testid":"nc-global-search-show-input",onClick:$},{default:f(()=>[d(s,{icon:"search",class:"h-4 w-4 text-gray-700 group-hover:text-black"})]),_:1})):(u(),_(ae,{key:1,visible:!0},{default:f(()=>[i("div",{class:V({"border-1 rounded-lg border-gray-200 overflow-hidden focus-within:border-primary focus-within:shadow-selected":a(n),"border-primary shadow-selected":a(n)&&a(o).query.length!==0})},[i("div",Be,[d(Z,{visible:a(r),"onUpdate:visible":t[1]||(t[1]=v=>ge(r)?r.value=v:null),trigger:["click"],"overlay-class-name":"nc-dropdown-toolbar-search-field-option"},{overlay:f(()=>[d(X,{"is-parent-open":a(r),"selected-option-id":a(o).field,"show-selected-option":"",options:a(x),"input-bordered":!1,"search-input-placeholder":e.$t("placeholder.searchFields"),"toolbar-menu":"globalSearch",onSelected:U},null,8,["is-parent-open","selected-option-id","options","search-input-placeholder"])]),default:f(()=>[i("div",{class:"flex items-center gap-2 group px-2 cursor-pointer",onClick:t[0]||(t[0]=v=>r.value=!a(r))},[d(s,{icon:"search",class:"h-3.5 w-3.5 text-nc-content-gray-muted"}),i("div",Te,[d(Y,{column:a(T),class:"!w-3.5 !h-3.5 !mx-0"},null,8,["column"]),a(n)?y("",!0):(u(),I("div",Qe,b(a(Q)??""),1)),i("div",$e,[d(s,{icon:"chevronDown",class:V(["!text-current flex-none transform transition-transform duration-25 w-3.5 h-3.5",{"!rotate-180":a(r)}])},null,8,["class"])])])])]),_:1},8,["visible"]),i("form",{class:"p-0",onSubmit:t[3]||(t[3]=Se(()=>{},["prevent"]))},[a(o).query||a(c)?(u(),_(ee,{key:0,ref_key:"globalSearchRef",ref:h,value:a(o).query,"onUpdate:value":t[2]||(t[2]=v=>a(o).query=v),name:"globalSearchQuery",size:"small",class:V(["!text-bodyDefaultSm !w-40 h-full nc-view-search-data !pl-0",{"!pr-7":!a(B)}]),placeholder:`${e.$t("general.searchIn")} ${a(Q)??""}`,bordered:!1,autocomplete:"off","data-testid":"search-data-input",onPressEnter:k},null,8,["value","class","placeholder"])):y("",!0)],32),a(B)?y("",!0):(u(),_(te,{key:0,title:e.$t("msg.error.invalidSearchQuery"),class:"absolute right-1 top-[50%] transform -translate-y-[50%] flex items-center pr-1",placement:"topRight"},{default:f(()=>[d(s,{icon:"ncInfo",class:"flex-none h-3.5 w-3.5 text-nc-content-red-medium"})]),_:1},8,["title"]))]),a(H)?(u(),I("div",Ge,[i("div",Le,b(a(C))+" of "+b(a(F)),1),i("div",We,b(e.$t("title.matchingResultsInRecords",{count:a(C)})),1)])):y("",!0)],2)]),_:1}))],512)}}}),Je=Object.assign(Ie(Ne,[["__scopeId","data-v-a790531c"]]),{__name:"SmartsheetToolbarSearchData"});export{Je as default};
