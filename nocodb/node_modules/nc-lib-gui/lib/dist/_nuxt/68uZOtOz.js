import{e as oe,ak as he,du as se,G as _,r as v,aY as ie,aZ as ne,n as B,aj as d,aC as ae,jn as ye,aD as re,fU as V,j1 as le,c as f,o as s,b as I,L as e,aM as ke,fQ as we,cd as Ce,J as Oe,al as Ie,je as Te,gi as De,fS as Me,aQ as xe,g as Le,ac as $e,I as p,w as c,ap as Be,ag as w,ad as M,O as Ee,a as g,K as x,aT as L,b9 as $,t as C,d as A,N as O,an as Q,aq as ee,bB as Ne,eO as Ue,aG as Ve,P as te,ah as je,f8 as Re,_ as Fe}from"./DOFFjK0_.js";import{_ as Pe}from"./7yLujnbV.js";import{u as pe}from"./B3Wp9c04.js";import{u as de}from"./D0vnHTOx.js";import ze from"./D4XRfH0I.js";import{_ as Ge}from"./0vrXc9P0.js";import{g as Ae,a as Qe}from"./DminWhpq.js";import{u as We}from"./DG2ZEhLK.js";import{u as qe}from"./0c4tmWST.js";import{u as He}from"./BfzMHcOa.js";import"./SJHyi9T4.js";import"./BRTCxTHu.js";import"./D_wq2ltS.js";import"./DDEVLD8O.js";import"./-rIuSlCu.js";import"./DiUleKVo.js";import"./JUJEmhCv.js";import"./BrfakvRE.js";import"./SpSJ8E4d.js";import"./9aYOtC5C.js";import"./Dh5zKH8k.js";import"./D2QgEzTv.js";import"./BYGCxle3.js";import"./MNXVOE4I.js";import"./C1uRXLg7.js";import"./boyBAVNN.js";import"./D-8_fbld.js";import"./4PLl4EP6.js";import"./DcFNOSET.js";import"./D1gZ4Fpg.js";import"./Bo7kLdUR.js";import"./DGuB8RA-.js";import"./DunK-51v.js";import"./ps5He39s.js";import"./CHgOe2F-.js";import"./MSgi_m6o.js";import"./JKos0pQW.js";import"./CQugZrqw.js";import"./BdLxRlCP.js";import"./YaKnxhzO.js";import"./CNJqPN7Y.js";import"./AxsiR11P.js";import"./C9H3ht2d.js";import"./CkXo2doe.js";import"./CV-2bRRD.js";import"./Czlq_f4Y.js";import"./Cgx2iu1G.js";import"./C6nWwNvX.js";import"./CJtI8BMq.js";import"./Bgc5K1P7.js";import"./D4c215jk.js";import"./lL-0_K96.js";import"./BClTqpVB.js";import"./CYkscC4Z.js";import"./DEAKw9Pl.js";import"./Cl-qOJW6.js";import"./BNo10Mdm.js";import"./CtJu2gHc.js";import"./CMyFGii6.js";import"./qgYlKlk5.js";import"./Cb5B9eG-.js";import"./C_qz9woQ.js";import"./DA4KItu_.js";import"./D8wgK-Ih.js";import"./HdsRe6lq.js";import"./DzBSAsxR.js";import"./4fFkR2QG.js";import"./CAfhvBOi.js";import"./BcKPINb2.js";import"./CiBV2ZED.js";import"./ZNRZafJ9.js";import"./BhfICdUA.js";import"./NRjd0XWG.js";import"./RfUK_fd6.js";import"./hehmy6V1.js";import"./BvG7Iv4q.js";import"./CyXz1Zkk.js";import"./CPChVVVr.js";import"./CFXGfO_A.js";import"./VKUQM8lk.js";import"./BqWeTF94.js";import"./sgaWLnOz.js";import"./BpgQOThx.js";import"./DmoodaOn.js";import"./B3tDgntu.js";import"./Db9kSA7A.js";import"./B4YnCsMc.js";import"./6zXueAcs.js";import"./Byuk3M83.js";const Je={class:"nc-sort-create-modal"},Ke=oe({__name:"CreateSort",props:{isParentOpen:{type:Boolean}},emits:["created"],setup(W,{emit:E}){const j=W,a=E,{isParentOpen:T}=he(j),R=se(),F=_(ie,v()),N=_(ne,v()),{showSystemFields:r,metaColumnById:h}=pe(),{sorts:U}=de(F),P=B(()=>{var b,y;return(((y=R((b=N.value)==null?void 0:b.columns))==null?void 0:y.filter(i=>{var l;return i.uidt===d.Links?!0:ae((l=h==null?void 0:h.value)==null?void 0:l[i.id])?ye(i,N.value)?!1:r.value:!(re(i)&&![V.BELONGS_TO,V.ONE_TO_ONE].includes(i.colOptions.type))}).filter(i=>!U.value.find(l=>l.fk_column_id===i.id)))??[]).map(i=>([d.QrCode,d.Barcode,d.ID,d.Button].includes(i.uidt)&&(i.ncItemDisabled=!0,i.ncItemTooltip=`Sorting is not supported for ${le[i.uidt]} field`),i))}),z=b=>{a("created",b)};return(b,y)=>{const i=Pe;return s(),f("div",Je,[I(i,{"is-parent-open":e(T),"search-input-placeholder":b.$t("msg.selectFieldToSort"),options:e(P),"toolbar-menu":"sort",onSelected:z},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Ye=Object.assign(Ke,{__name:"SmartsheetToolbarCreateSort"}),Ze={class:"flex items-center gap-1 min-h-5"},Xe={class:"flex items-center gap-2"},et={key:0,class:"text-capitalize !text-[13px] font-medium"},tt={key:1,class:"pt-2 pb-2 pl-4 nc-filter-list max-h-[max(80vh,30rem)] min-w-102","data-testid":"nc-sorts-menu"},ot={class:"w-full flex items-center justify-between gap-2"},st={class:"truncate flex-1"},it={class:"flex gap-1 items-center"},nt={key:1},at={class:"flex gap-1 items-center"},rt=oe({__name:"SortListMenu",setup(W){const E=_(ne,v()),j=_(ie,v()),a=_(ke,v(!1)),T=_(we),R=_(Ce,v(!1)),F=se(),{eventBus:N}=We(),{sorts:r,saveOrUpdate:h,loadSorts:U,addSort:P,deleteSort:z}=de(j,()=>T==null?void 0:T.trigger()),{showSystemFields:b,metaColumnById:y}=pe(),{appearanceConfig:i}=qe(),l=v(!1),{isMobileMode:q}=Oe(),{getPlanLimit:me}=Ie(),H=_(Te,v(!1)),J=_(De,B(()=>!1));N.on(o=>{o===Me.SORT_RELOAD&&U()});const G=B(()=>{var o;return F(((o=E.value)==null?void 0:o.columns)||[]).map(t=>([d.QrCode,d.Barcode,d.ID,d.Button].includes(t.uidt)&&(t.ncItemDisabled=!0,t.ncItemTooltip=`Sorting is not supported for ${le[t.uidt]} field`),t))}),ce=B(()=>G.value.reduce((o,t)=>(o[t.id]=t,o),{})),ue=B(()=>{var o;return(o=G.value)==null?void 0:o.filter(t=>{var u;return t.uidt===d.Links?!0:ae((u=y==null?void 0:y.value)==null?void 0:u[t.id])?b.value:t.uidt===d.QrCode||t.uidt===d.Barcode||t.uidt===d.ID||t.uidt===d.Button?!1:!(re(t)&&![V.BELONGS_TO,V.ONE_TO_ONE].includes(t.colOptions.type))}).filter(t=>!r.value.find(u=>u.fk_column_id===t.id))}),fe=o=>Qe(o,ce.value),S=v(!1);He(S);const K=o=>{P(!0,o);const t=r.value[r.value.length-1];h(t,r.value.length-1),l.value=!1};return xe(S,()=>{S.value||(l.value=!1)}),Le(()=>{U()}),(o,t)=>{const u=Ee,Y=Be,Z=Ye,_e=ze,ve=Ue,be=Ne,X=Ve,Se=Ge,D=$e("e");return s(),p(X,{visible:e(S),"onUpdate:visible":t[7]||(t[7]=n=>te(S)?S.value=n:null),trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-sort-menu nc-toolbar-dropdown overflow-hidden"},{overlay:c(()=>[g("div",{class:w({"nc-locked-view":e(a)})},[e(r).length?(s(),f("div",tt,[g("div",{class:"sort-grid max-h-120 nc-scrollbar-thin pr-4 my-2 py-1",onClick:t[2]||(t[2]=O(()=>{},["stop"]))},[(s(!0),f(Q,null,ee(e(r),(n,k)=>(s(),f("div",{key:k,class:"flex first:mb-0 !mb-1.5 !last:mb-0 items-center"},[I(_e,{modelValue:n.fk_column_id,"onUpdate:modelValue":[m=>n.fk_column_id=m,m=>e(h)(n,k)],class:"flex caption nc-sort-field-select !w-44 flex-grow",columns:e(G),"is-sort":"",meta:e(E),disabled:e(a),onClick:t[0]||(t[0]=O(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta","disabled"]),I(be,{value:n.direction,"onUpdate:value":m=>n.direction=m,class:"flex flex-grow-1 w-full nc-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir !rounded-lg",disabled:e(a),onClick:t[1]||(t[1]=O(()=>{},["stop"])),onSelect:m=>e(h)(n,k)},{default:c(()=>[(s(!0),f(Q,null,ee(("getSortDirectionOptions"in o?o.getSortDirectionOptions:e(Ae))(fe(n.fk_column_id)),(m,ge)=>M((s(),p(ve,{key:ge,value:m.value},{default:c(()=>[g("div",ot,[g("div",st,C(m.text),1),n.direction===m.value?(s(),p(L(("iconMap"in o?o.iconMap:e($)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):x("",!0)])]),_:2},1032,["value"])),[[D,["c:sort:operation:select"]]])),128))]),_:2},1032,["value","onUpdate:value","label","disabled","onSelect"]),I(Y,{placement:"top",title:"Remove",class:"flex-none"},{default:c(()=>[M((s(),p(u,{size:"small",type:"secondary",shadow:!1,disabled:e(a),class:"nc-sort-item-remove-btn !max-w-8 !border-l-transparent !rounded-l-none",onClick:O(m=>e(z)(n,k),["stop"])},{default:c(()=>[(s(),p(L(("iconMap"in o?o.iconMap:e($)).deleteListItem)))]),_:2},1032,["disabled","onClick"])),[[D,["c:sort:delete"]]])]),_:2},1024)]))),128))]),e(ue).length?(s(),p(X,{key:0,visible:e(l),"onUpdate:visible":t[5]||(t[5]=n=>te(l)?l.value=n:null),trigger:["click"],disabled:e(a),"overlay-class-name":"nc-toolbar-dropdown"},{overlay:c(()=>[I(Z,{"is-parent-open":e(l),onCreated:K},null,8,["is-parent-open"])]),default:c(()=>[("isEeUI"in o?o.isEeUI:e(je))&&!e(R)?(s(),f(Q,{key:0},[e(r).length<e(me)(e(Re).LIMIT_SORT_PER_VIEW)?M((s(),p(u,{key:0,class:w(["mt-1 mb-2",{"!text-brand-500":!e(a)}]),type:"text",size:"small",disabled:e(a),onClick:t[3]||(t[3]=O(n=>l.value=!0,["stop"]))},{default:c(()=>[g("div",it,[(s(),p(L(("iconMap"in o?o.iconMap:e($)).plus))),A(" "+C(o.$t("activity.addSort")),1)])]),_:1},8,["class","disabled"])),[[D,["c:sort:add"]]]):(s(),f("span",nt))],64)):M((s(),p(u,{key:1,class:w(["mt-1 mb-2",{"!text-brand-500":!e(a)}]),type:"text",size:"small",disabled:e(a),onClick:t[4]||(t[4]=O(n=>l.value=!0,["stop"]))},{default:c(()=>[g("div",at,[(s(),p(L(("iconMap"in o?o.iconMap:e($)).plus))),A(" "+C(o.$t("activity.addSort")),1)])]),_:1},8,["class","disabled"])),[[D,["c:sort:add"]]])]),_:1},8,["visible","disabled"])):x("",!0)])):(s(),p(Z,{key:0,"is-parent-open":e(S),disabled:e(a),onCreated:K},null,8,["is-parent-open","disabled"])),e(a)?(s(),p(Se,{key:2,class:w({"-mt-2":e(r).length}),onOnOpen:t[6]||(t[6]=n=>S.value=!1)},null,8,["class"])):x("",!0)],2)]),default:c(()=>{var n;return[I(Y,{disabled:!e(q)&&!e(J),class:w({"nc-active-btn":(n=e(r))==null?void 0:n.length})},{title:c(()=>[A(C(o.$t("activity.sort")),1)]),default:c(()=>{var k;return[M((s(),p(u,{class:w([{"!border-1 !rounded-md":e(H),"!border-0":!e(H),[e(i).SORTED.toolbarBgClass]:(k=e(r))==null?void 0:k.length},"nc-sort-menu-btn nc-toolbar-btn !h-7 group"]),size:"small",type:"secondary","show-as-disabled":e(a)},{default:c(()=>{var m;return[g("div",Ze,[g("div",Xe,[(s(),p(L(("iconMap"in o?o.iconMap:e($)).sort),{class:"h-4 w-4 text-inherit"})),!e(q)&&!e(J)?(s(),f("span",et,C(o.$t("activity.sort")),1)):x("",!0)]),(m=e(r))!=null&&m.length?(s(),f("span",{key:0,class:w(["nc-toolbar-btn-chip",{[e(i).SORTED.toolbarChipBgClass]:!0,[e(i).SORTED.toolbarTextClass]:!0}])},C(e(r).length),3)):x("",!0)])]}),_:1},8,["class","show-as-disabled"])),[[D,["c:sort"]]])]}),_:1},8,["disabled","class"])]}),_:1},8,["visible"])}}}),Ao=Object.assign(Fe(rt,[["__scopeId","data-v-d802fe1f"]]),{__name:"SmartsheetToolbarSortListMenu"});export{Ao as default};
