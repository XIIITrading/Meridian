import{u as Re,_ as $e}from"./DdC0rwNw.js";import{r as u,a8 as ve,e as We,a7 as je,J as Be,al as De,as as Ue,b7 as Te,T as Le,n as E,bk as Pe,bA as Ve,Y as Q,a9 as Ae,aQ as F,a4 as Y,a5 as me,ah as Ke,hP as W,ab as Ge,g as Qe,I as R,o as v,w as g,a as m,b as h,c as I,K as q,ag as J,L as t,ad as Fe,an as pe,aq as de,d as C,t as y,aT as X,b9 as H,N as Ye,a3 as ue,cc as qe,aG as Je,P as Z,O as Xe,ap as He,ar as Ze,be as es,bY as ss,d3 as ts,Q as as,l0 as os,eV as is,eW as fe,_ as ls}from"./DOFFjK0_.js";import"./C44sDnaa.js";import"./KFthsW2H.js";import"./Db9kSA7A.js";import"./Bo7kLdUR.js";import"./lL-0_K96.js";import"./JVTgKN82.js";import"./HdsRe6lq.js";import"./Bx9ACB-J.js";import"./C9H3ht2d.js";import"./CQugZrqw.js";import"./Co1c6GHq.js";import"./Cl-qOJW6.js";import"./CHgOe2F-.js";import"./CYkscC4Z.js";import"./ps5He39s.js";import"./DEAKw9Pl.js";import"./SpSJ8E4d.js";import"./BrfakvRE.js";import"./D_wq2ltS.js";import"./9aYOtC5C.js";import"./JUJEmhCv.js";import"./C6nWwNvX.js";import"./EgJz-9W8.js";import"./JKos0pQW.js";import"./BRY4OykS.js";import"./4fFkR2QG.js";import"./CTGo9zv-.js";import"./AxsiR11P.js";import"./CFXGfO_A.js";import"./VKUQM8lk.js";import"./SJHyi9T4.js";import"./BJ_KO_Ot.js";import"./BjlRxDgN.js";import"./boyBAVNN.js";import"./CFDwQBzt.js";import"./Ck0WYZ6p.js";import"./G4Pt-Lbf.js";import"./DeaWGTJr.js";import"./D1f5NZz7.js";import"./CyXz1Zkk.js";import"./DiUleKVo.js";import"./BhfICdUA.js";import"./NRjd0XWG.js";import"./CPChVVVr.js";import"./D4c215jk.js";import"./BYGCxle3.js";const ns=()=>{const j=u([]),B=u([]),i=u([]),{orgId:D}=ve(Re());return{orgId:D,workspaces:j,listWorkspaces:async(...w)=>{},fetchOrganizationMembers:async(...w)=>{},fetchOrganizationBases:async(...w)=>{},bases:i,members:B}},rs={class:"flex flex-row text-2xl font-bold items-center gap-x-2"},cs={class:"flex items-center justify-between gap-3 mt-2"},ms={class:"flex w-full gap-4 flex-col"},ps={class:"flex justify-between gap-3 w-full"},ds=["disabled","placeholder"],us={class:"flex items-center"},fs={key:0,class:"ml-2 text-red-500 -mt-2"},vs={key:1,class:"ml-2 text-red-500 -mt-2"},gs={class:""},bs={class:"py-2"},hs={class:"mx-2"},ys={class:"flex flex-col max-h-64 overflow-y-auto nc-scrollbar-md mt-2 px-2"},_s=["onClick"],ws={class:"flex gap-2 capitalize items-center"},ks={class:"flex mt-8 justify-end"},xs={class:"flex gap-2"},Es=We({__name:"InviteDlg",props:{modelValue:{type:Boolean},type:{},baseId:{},emails:{},workspaceId:{},users:{}},emits:["update:modelValue"],setup(j,{emit:B}){const i=j,D=B,ee=je(),{appInfo:ge}=Be(),se=De(),{baseRoles:w,workspaceRoles:U}=Ue(),{createProjectUser:be}=ee,{inviteCollaborator:te}=se,{isPaymentEnabled:he,showUserPlanLimitExceededModal:ye,isPaidPlan:Is,showUserMayChargeAlert:Cs}=Te(),b=Le(i,"modelValue",D),ae=E(()=>i.type==="base"?Pe:Ve),oe=E(()=>i.type==="base"?w==null?void 0:w.value:U==null?void 0:U.value),l=Q({email:"",roles:ae.value.NO_ACCESS}),k=u(),_e=u(),ie=u(),z=u(!1),c=Q({isError:!0,message:""}),_=u(""),n=u([]),T=u([]),L=u([]),M=u(!1),le=ns(),{listWorkspaces:we}=le,{workspaces:ke}=ve(le),S=u(""),ne=E(()=>ke.value.filter(e=>e.title.toLowerCase().includes(S.value.toLowerCase()))),N=Q({}),x=E(()=>ne.value.filter(e=>N[e.id])),P=()=>{var e;(e=ie.value)==null||e.focus(),z.value=!0},{t:V}=Ae();F(b,async e=>{if(e){try{const s=Object.values(ae.value),r=s.findIndex(p=>oe.value&&Object.keys(oe.value).includes(p));r!==-1?(T.value=s.slice(r),L.value=s.slice(0,r)):(T.value=s,L.value=[])}catch(s){Y.error(await me(s))}i.emails&&(n.value=i.emails),setTimeout(()=>{P()},100)}else n.value=[],l.email="",_.value=""});const re=e=>{const s=n.value.indexOf(e);s!==-1&&n.value.splice(s,1),n.value.push(e)},ce=(e,s=!1)=>e.length?W(e.trim())?!0:(s||(c.isError=!0,c.message="Invalid Email"),!1):(s||(c.isError=!0,c.message="Email should not be empty"),!1),xe=E(()=>{if(!n.value.length&&!_.value.length||n.value.length&&l.email)return!0}),Ee=E(()=>Ke);F(l,e=>{if(W(e.email)&&!n.value.length){_.value=e.email,c.isError=!1;return}if(_.value="",(e.email.charAt(e.email.length-1)===","||e.email.charAt(e.email.length-1)===" ")&&e.email.trim().length){const p=e.email.split(",")[0].trim()||e.email.split(" ")[0].trim();if(!W(p)){c.isError=!0,c.message="Invalid Email";return}if(n.value.includes(p)){re(p),l.email="";return}n.value.push(p),l.email="",_.value=""}!e.email.length&&c.isError&&(c.isError=!1)});const Ie=()=>{ce(l.email)&&(l.email+=" ",c.isError=!1,c.message="")};Ge("Backspace",()=>{z.value&&l.email.length<1&&n.value.pop()}),F(b,e=>{e&&setTimeout(()=>{P()},100)});const Ce=e=>{var p;c.isError=!1;const s=(p=e.clipboardData)==null?void 0:p.getData("text"),r=(s==null?void 0:s.split(","))||(s==null?void 0:s.split(" "));(r==null?void 0:r.length)===1&&l.email.length&&(r[0]=l.email+=r[0]),r==null||r.forEach(a=>{if(a=os(a)||a,!!ce(a,r.length>1)){if(n.value.includes(a)){re(a);return}n.value.push(a),l.email=""}}),l.email=""},ze=async()=>{var e,s,r,p;try{M.value=!0;const a=_.value||n.value.join(",");a.includes(",")||W(a)||(c.isError=!0,c.message="invalid email");for(const d of a==null?void 0:a.split(","))if((e=i.users)!=null&&e.some(f=>f.email===d.trim())){let f="objects.project";i.type==="workspace"?f="objects.workspace":i.type==="organization"&&(f="general.organization"),k.value=V("msg.userAlreadyExists",{email:d.trim(),scope:V(f).toLowerCase()});return}if(i.type==="base"&&i.baseId)await be(i.baseId,{email:a,roles:l.roles});else if(i.type==="workspace"&&i.workspaceId)await te(a,l.roles,i.workspaceId);else if(i.type==="organization")for(const d of x.value)await te(a,l.roles,d.id);Y.success(V("msg.info.inviteSent")),l.email="",n.value=[],b.value=!1}catch(a){const d=await is(a);if(he.value&&d.error===fe.PLAN_LIMIT_EXCEEDED){let f;i.type==="workspace"&&i.workspaceId?f=i.workspaceId:i.type==="organization"&&(f=(p=(r=(s=a==null?void 0:a.config)==null?void 0:s.url)==null?void 0:r.split("/"))==null?void 0:p[4]);const K=d.details;ye({details:K,role:l.roles,callback(G){G==="ok"&&(b.value=!1)},workspaceId:f,isAdminPanel:i.type==="organization"})}else d.error===fe.UNKNOWN_ERROR&&(d.message=await me(a)),Y.error(d.message)}finally{_.value="",M.value=!1}},A=u(!1);Qe(async()=>{i.type==="organization"&&await we()});const Me=e=>l.roles=e,Se=e=>{k.value=null,n.value.splice(e,1),n.value.length===0&&(l.email="")};return(e,s)=>{const r=$e,p=He,a=Xe,d=Ze,f=es,K=ss,G=Je,Ne=ts,Oe=as;return v(),R(Oe,{visible:t(b),"onUpdate:visible":s[7]||(s[7]=O=>Z(b)?b.value=O:null),header:e.$t("activity.createTable"),"show-separator":!1,size:"medium",class:"nc-invite-dlg",onKeydown:s[8]||(s[8]=ue(O=>b.value=!1,["esc"]))},{header:g(()=>[m("div",rs,y(e.type==="organization"?e.$t("labels.addMembersToOrganization"):e.type==="base"?e.$t("activity.addMember"):e.$t("activity.inviteToWorkspace")),1)]),default:g(()=>{var O;return[m("div",cs,[m("div",ms,[m("div",ps,[m("div",{ref_key:"divRef",ref:_e,class:J([{"border-primary/100":t(z),"p-1":((O=t(n))==null?void 0:O.length)>0},"flex items-center flex-wrap border-1 gap-1 w-full overflow-x-scroll nc-scrollbar-x-md min-h-10 rounded-lg !min-w-96"]),tabindex:"0",onBlur:s[3]||(s[3]=o=>z.value=!1),onClick:P},[(v(!0),I(pe,null,de(t(n),(o,$)=>(v(),I("span",{key:o,class:"border-1 text-nc-content-gray bg-nc-bg-gray-light rounded-md flex items-center px-1 whitespace-nowrap"},[C(y(o)+" ",1),(v(),R(X(("iconMap"in e?e.iconMap:t(H)).close),{class:"ml-0.5 hover:cursor-pointer hover:text-nc-content-gray-subtle mt-0.5 w-4 h-4 text-nc-content-gray-subtle2",onClick:zs=>Se($)},null,8,["onClick"]))]))),128)),Fe(m("input",{id:"email",ref_key:"focusRef",ref:ie,"onUpdate:modelValue":s[0]||(s[0]=o=>t(l).email=o),disabled:t(M),placeholder:e.$t("activity.enterEmail"),class:"flex-1 min-w-36 outline-none px-2","data-testid":"email-input",onBlur:s[1]||(s[1]=o=>z.value=!1),onKeyup:ue(Ie,["enter"]),onPaste:Ye(Ce,["prevent"]),onInput:s[2]||(s[2]=o=>k.value=null)},null,40,ds),[[qe,t(l).email]])],34),m("div",us,[h(r,{description:!1,"on-role-change":Me,role:t(l).roles,"disabled-roles":t(L),roles:t(T),class:"!min-w-[152px] nc-invite-role-selector",size:"lg"},null,8,["role","disabled-roles","roles"])])]),t(k)?(v(),I("span",fs,y(t(k)),1)):q("",!0),t(c).isError&&t(c).message?(v(),I("span",vs,y(t(c).message),1)):q("",!0),e.type==="organization"?(v(),R(G,{key:2,visible:t(A),"onUpdate:visible":s[5]||(s[5]=o=>Z(A)?A.value=o:null)},{overlay:g(()=>[m("div",bs,[m("div",hs,[h(d,{value:t(S),"onUpdate:value":s[4]||(s[4]=o=>Z(S)?S.value=o:null),class:J([{"!border-brand-500":t(S).length>0},"!rounded-lg !h-8 !ring-0 !placeholder:text-gray-500 !border-gray-200 !px-4"]),"data-testid":"nc-ws-search",placeholder:"Search workspace"},{prefix:g(()=>[(v(),R(X(("iconMap"in e?e.iconMap:t(H)).search),{class:"h-4 w-4 mr-1 text-gray-500"}))]),_:1},8,["value","class"])]),m("div",ys,[(v(!0),I(pe,null,de(t(ne),o=>(v(),I("div",{key:o.id,class:"px-2 cursor-pointer hover:bg-gray-100 rounded-lg h-9.5 py-2 w-full flex gap-2",onClick:$=>t(N)[o.id]=!t(N)[o.id]},[m("div",ws,[h(f,{workspace:o,size:"medium"},null,8,["workspace"]),C(" "+y(o.title),1)]),s[9]||(s[9]=m("div",{class:"flex-1"},null,-1)),h(K,{checked:t(N)[o.id],"onUpdate:checked":$=>t(N)[o.id]=$,size:"large"},null,8,["checked","onUpdate:checked"])],8,_s))),128))])])]),default:g(()=>[h(a,{class:"!justify-between","full-width":"",size:"medium",type:"secondary"},{default:g(()=>[m("div",{class:J([{"!text-gray-600":t(x).length>0},"flex text-gray-500 justify-between items-center w-full"])},[h(p,{class:"!max-w-130 truncate","show-on-truncate-only":""},{title:g(()=>[C(y(t(x).length>0?t(x).map(o=>o.title).join(", "):"-select workspaces to invite to-"),1)]),default:g(()=>[m("span",gs,y(t(x).length>0?t(x).map(o=>o.title).join(", "):"-select workspaces to invite to-"),1)]),_:1}),(v(),R(X(("iconMap"in e?e.iconMap:t(H)).chevronDown)))],2)]),_:1}),s[10]||(s[10]=C(" /> "))]),_:1,__:[10]},8,["visible"])):q("",!0)])]),h(Ne,{visible:t(Ee),type:"warning",message:e.$t("upgrade.newEditorWillBeChanged"),description:e.$t("upgrade.newEditorWillBeChangedSubtitle"),class:"mt-5"},null,8,["visible","message","description"]),m("div",ks,[m("div",xs,[h(a,{type:"secondary",onClick:s[6]||(s[6]=o=>b.value=!1)},{default:g(()=>[C(y(e.$t("labels.cancel")),1)]),_:1}),h(a,{disabled:t(xe)||t(c).isError||t(M)||!!t(k),loading:t(M),size:"medium",type:"primary",class:"nc-invite-btn",onClick:ze},{default:g(()=>[C(y(e.type==="base"?e.$t("activity.inviteToBase"):e.$t("activity.inviteToWorkspace")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible","header"])}}}),kt=Object.assign(ls(Es,[["__scopeId","data-v-a786b919"]]),{__name:"DlgInviteDlg"});export{kt as default};
