import{kf as ne,r as _,aQ as ae,kj as le,e as ie,a9 as re,G as d,j7 as ce,ko as de,kO as ue,fT as me,n as m,gD as pe,kp as fe,jf as _e,aZ as ve,g$ as A,g as ge,c as u,o as a,b as i,K as y,I as j,w as s,L as e,a as l,t as r,ap as ye,O as he,d as $,by as we,M as Ce,aT as xe,j as ke,ag as R,P as be,cb as Ie,cn as je,bQ as $e,an as Re,f$ as Qe,g0 as Ee,f_ as Oe}from"./DOFFjK0_.js";import{Q as Fe}from"./B4YnCsMc.js";import{u as Ne,b as Te,c as Be}from"./cND0wAUd.js";import{u as Le}from"./YRJcuhQv.js";import"./CV-2bRRD.js";function W(N,Q){const h=ne(N),w=_("");return ae(h,async v=>{h.value&&le&&(w.value=await Fe.toDataURL(v,Q))},{immediate:!0}),w}const Me={class:"flex gap-2 items-center w-full"},qe={class:"font-weight-700 m-0"},De={class:"h-5 px-1 bg-nc-bg-gray-medium text-nc-content-gray-subtle2 rounded-md justify-center items-center flex"},Pe={class:"text-sm font-medium"},ze={class:"flex flex-row items-center justify-end"},Se={class:"flex flex-row flex-grow mr-2 !overflow-y-auto py-2 hidden","data-testid":"nc-qr-code-large-value-label"},Ue={key:0,class:"flex gap-2"},Ge={class:"flex children:flex-none relative h-4 w-4"},He=["href","download"],Ve=["src","alt"],Ae=["src","alt"],We=["src","alt"],Ke={key:1,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},Ze={key:2,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},F=2e3,Je=ie({__name:"QrCode",setup(N){const{t:Q}=re(),h=d(ce,!1),w=d(de,_(!1)),v=d(ue),C=d(me),o=m(()=>String((v==null?void 0:v.value)??"")),K=d(pe,_(!1)),x=d(fe,_(!1)),p=m(()=>K.value&&!x.value),T=m(()=>(o==null?void 0:o.value.length)>F),f=m(()=>{var t;return((t=o==null?void 0:o.value)==null?void 0:t.length)>0&&!T.value&&(o==null?void 0:o.value)!=="ERR!"}),B=m(()=>{var t;return o.value.length>F?(t=o==null?void 0:o.value)==null?void 0:t.slice(0,F):o.value}),L={errorCorrectionLevel:"M",margin:1,rendererOpts:{quality:1}},k=d(_e,_(void 0)),M=W(B,{...L,width:150}),b=W(B,{...L,width:600}),c=_(!1),E=t=>{f.value&&(t==null||t.stopPropagation(),c.value=!0)},Z=()=>c.value=!1,q=d(ve),D=m(()=>{var t;return(t=C==null?void 0:C.value.colOptions)==null?void 0:t.fk_qr_value_column_id}),{showClearNonEditableFieldWarning:J}=Le({onEnter:E}),X=t=>ke(Oe(t)?Qe:Ee,{columnMeta:t}),{isCopied:P,performCopy:Y}=Ne(),ee=async()=>{if(!b.value)return;const t=await Te(b.value);if(!await Be(t))throw new Error(Q("msg.error.notSupported"))},te=m(()=>{if(!p.value)return k.value?`${k.value===1?A[1]-4:A[`${k.value}`]-20}px`:"1.8rem"});return ge(()=>{h&&!w.value&&!p.value&&!x.value&&f.value&&(c.value=!0)}),(t,n)=>{const I=Ce,O=he,z=ye,oe=Ie,se=$e;return a(),u(Re,null,[i(oe,{visible:e(c),"onUpdate:visible":n[2]||(n[2]=g=>be(c)?c.value=g:null),class:R({active:e(c)}),"wrap-class-name":"nc-qr-code-large qrcode-modal","body-style":{padding:"0px",display:"flex",justifyContent:"center"},closable:!1,onOk:Z},{title:s(()=>{var g,S,U,G,H,V;return[l("div",Me,[l("h1",qe,r((g=e(C))==null?void 0:g.title),1),l("div",De,[(a(),j(xe(X((U=(S=e(q))==null?void 0:S.columnsById)==null?void 0:U[e(D)])),{class:"h-4"})),l("div",Pe,r((V=(H=(G=e(q))==null?void 0:G.columnsById)==null?void 0:H[e(D)])==null?void 0:V.title),1)]),n[3]||(n[3]=l("div",{class:"flex-1"},null,-1)),i(O,{class:"nc-qrcode-close !px-1",type:"text",size:"xs",onClick:n[0]||(n[0]=Xe=>c.value=!1)},{default:s(()=>[i(I,{class:"text-md text-gray-700 h-4 w-4",icon:"close"})]),_:1})])]}),footer:s(()=>[l("div",ze,[l("div",Se,r(e(o)),1),e(f)?(a(),u("div",Ue,[i(z,null,{title:s(()=>[$(r(t.$t("labels.clickToCopy")),1)]),default:s(()=>[i(O,{size:"small",type:"secondary",onClick:n[1]||(n[1]=g=>e(Y)(ee))},{icon:s(()=>[l("div",Ge,[i(we,{name:"icon-fade",duration:200},{default:s(()=>[e(P)?(a(),j(I,{key:0,icon:"check",class:"h-4 w-4 opacity-80"})):(a(),j(I,{key:1,icon:"copy",class:"h-4 w-4 opacity-80"}))]),_:1})])]),default:s(()=>[$(" "+r(e(P)?t.$t("general.copied"):t.$t("general.copy")),1)]),_:1})]),_:1}),l("a",{href:e(b),download:`${e(o)}.png`},[i(z,null,{title:s(()=>[$(r(t.$t("labels.clickToDownload")),1)]),default:s(()=>[i(O,{size:"small",type:"secondary"},{icon:s(()=>[i(I,{icon:"download",class:"w-4 h-4"})]),default:s(()=>[$(" "+r(t.$t("general.download")),1)]),_:1})]),_:1})],8,He)])):y("",!0)])]),default:s(()=>[e(f)?(a(),u("img",{key:0,src:e(b),alt:t.$t("title.qrCode"),class:"h-[156px] mt-8 mb-4"},null,8,Ve)):y("",!0)]),_:1},8,["visible","class"]),e(f)?(a(),u("div",{key:0,class:R(["nc-qrcode-container w-full flex",{"flex-start h-20":e(p),"justify-center":!e(p)&&!e(x)}])},[e(k)?(a(),u("img",{key:0,style:je({height:e(te)}),class:R([{"border-1":e(p)},"min-w-[1.4em]"]),src:e(M),alt:t.$t("title.qrCode"),onClick:E},null,14,Ae)):(a(),u("img",{key:1,class:R(["flex-none min-w-[1.4em]",!e(p)&&!e(x)?"mx-auto":""]),src:e(M),alt:t.$t("title.qrCode"),onClick:E},null,10,We))],2)):y("",!0),e(T)?(a(),u("div",Ke,r(t.$t("labels.qrCodeValueTooLong")),1)):y("",!0),e(J)?(a(),u("div",Ze,r(t.$t("msg.warning.nonEditableFields.qrFieldsCannotBeDirectlyChanged")),1)):!e(f)&&e(o)==="ERR!"?(a(),j(se,{key:3,placement:"bottom",class:"text-orange-700"},{title:s(()=>n[4]||(n[4]=[l("span",{class:"font-bold"},"Please select a target field!",-1)])),default:s(()=>[n[5]||(n[5]=l("span",null,"ERR!",-1))]),_:1,__:[5]})):y("",!0)],64)}}}),nt=Object.assign(Je,{__name:"VirtualCellQrCode"});export{nt as default};
