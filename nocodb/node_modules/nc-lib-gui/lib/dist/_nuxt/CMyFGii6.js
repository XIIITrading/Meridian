const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Cd4hVR2a.js","./DOFFjK0_.js","./entry.DDfSYhWa.css","./Header.CU2xE2ZP.css","./C06hMDCB.js","./DGuB8RA-.js","./Bo7kLdUR.js","./D2QgEzTv.js","./B3tDgntu.js","./qgYlKlk5.js","./Cb5B9eG-.js","./C_qz9woQ.js","./DA4KItu_.js","./CV-2bRRD.js","./TimeSelector.DAR2lbHN.css","./D8wgK-Ih.js","./HdsRe6lq.js","./index.N-A1gxk9.css","./DzBSAsxR.js","./FilterInput.7KjqjE1F.css","./4fFkR2QG.js","./Pagination.XVPzwtel.css","./SJHyi9T4.js","./DG2ZEhLK.js","./CAfhvBOi.js","./BYGCxle3.js","./DcFNOSET.js","./boyBAVNN.js","./4PLl4EP6.js","./Bgc5K1P7.js","./DEAKw9Pl.js","./CHgOe2F-.js","./CYkscC4Z.js","./ps5He39s.js","./Cl-qOJW6.js","./BcKPINb2.js","./ListItem.DqIR0qoS.css","./0c4tmWST.js","./D1gZ4Fpg.js","./B3Wp9c04.js","./C1uRXLg7.js","./D_wq2ltS.js","./Item.C85DUSg3.css","./9aYOtC5C.js","./index.CotXCNy2.css","./DunK-51v.js","./DivDataCell.D_9SDUsb.css","./MSgi_m6o.js","./JKos0pQW.js","./CQugZrqw.js","./index._6B72PDH.css","./BdLxRlCP.js","./YaKnxhzO.js","./Markdown.CUPXKfeQ.css","./CNJqPN7Y.js","./AxsiR11P.js","./C9H3ht2d.js","./Comments.BKDN6dt-.css","./CkXo2doe.js","./Czlq_f4Y.js","./Cgx2iu1G.js","./C6nWwNvX.js","./Cell.Dgtcn0F2.css","./DiUleKVo.js","./JUJEmhCv.js","./Modal.CB1oWLel.css","./BrfakvRE.js","./CJtI8BMq.js","./D4c215jk.js","./lL-0_K96.js","./BClTqpVB.js","./BNo10Mdm.js","./index.C8L8AhJa.css","./CtJu2gHc.js","./MNXVOE4I.js","./LockView.BWC8JyQk.css","./D0vnHTOx.js","./BRTCxTHu.js","./DDEVLD8O.js","./-rIuSlCu.js","./SpSJ8E4d.js","./Dh5zKH8k.js","./ColumnMenu.DQG9Y5_N.css","./CiBV2ZED.js","./ZNRZafJ9.js","./BhfICdUA.js","./NRjd0XWG.js","./RfUK_fd6.js","./SelectOptions.DqNkMQ-A.css","./hehmy6V1.js","./BvG7Iv4q.js","./CyXz1Zkk.js","./CPChVVVr.js","./CFXGfO_A.js","./VKUQM8lk.js","./BqWeTF94.js","./sgaWLnOz.js","./BpgQOThx.js","./DmoodaOn.js","./Db9kSA7A.js","./EditOrAddProvider.C2farLzy.css","./B4YnCsMc.js","./6zXueAcs.js","./Byuk3M83.js","./D-8_fbld.js","./DminWhpq.js","./index.Bp-YHGEB.css","./osS8F1ZT.js","./31oN5MbZ.js","./ItemChip.DLdmQCyF.css","./HasMany.Bt8cxc73.css","./C34BbtOJ.js","./ManyToMany.BL4O0IuN.css","./BWLmO9rU.js","./BelongsTo.BiGhDz14.css","./DumdhwR7.js","./OneToOne.Czf6-FKt.css","./DAQX8Nf_.js","./YRJcuhQv.js","./BS6ayr8r.js","./CbSkBAiy.js","./cND0wAUd.js","./QrCode.B8NlH_0C.css","./3Q4XGDlM.js","./Barcode.DFjssX3i.css","./B5eD6FFY.js","./BAkUHzkR.js","./Lookup.EBPuXRup.css","./csoBc1Ng.js","./Button.1b2c9vvw.css","./BQnbr8ef.js","./Cxaoa39b.js","./Readonly.CfYRp9Iz.css"])))=>i.map(i=>d[i]);
import{b3 as Sa,c as Y,o as d,a as I,r as f,S as Da,a8 as $t,V as St,a7 as za,f as na,J as Dt,G as g,aY as Aa,em as xt,j7 as sa,kG as oa,dJ as _t,fQ as zt,W as Pa,jb as Na,n as N,Y as wt,a9 as Tt,cd as At,gj as Fa,b0 as Rt,kH as Ua,aj as it,jo as ja,hH as Qt,kI as Ma,kJ as Yt,g2 as Ht,gl as Jt,aC as Ba,jg as ia,aD as Pt,eo as qa,aQ as Te,aV as Wt,cb as Ka,gn as ct,a4 as st,a5 as Et,fU as ze,u as Ga,eV as Qa,eW as Ya,gU as ra,gV as ua,gX as Xt,fG as Zt,fF as ea,fw as It,kK as Ha,kL as ft,g1 as Ja,ji as Wa,im as Xa,jj as Za,kM as el,e as Ct,T as Nt,as as bt,fT as Vt,gb as Ft,gk as Ut,b7 as da,g as jt,bz as Mt,ac as Bt,a3 as Qe,ag as dt,N as Ce,L as e,I as w,b as fe,ar as ca,w as Ae,M as va,aS as pe,an as ut,aq as pt,ad as gt,K as Pe,t as Je,O as fa,d as Lt,cf as pa,cg as ma,fl as _a,P as ya,j as mt,aW as me,_ as qt,kN as ha,eN as tl,aG as al,ao as ta,j3 as ll,j8 as nl,kO as ka,kP as wa,ko as sl,gD as ga,iC as ol,gE as il,c1 as vt,kr as La,i_ as rl,kQ as aa,aT as ul,bw as dl,hU as cl,av as rt,aX as nt,jd as vl,jy as fl,il as pl,gW as ml,hb as _l,gs as yl,kR as hl,kS as kl,kT as wl,ha as gl,hc as Ll,hd as bl,he as xl,hf as la,kU as Cl}from"./DOFFjK0_.js";import{_ as ba}from"./qgYlKlk5.js";import{_ as xa}from"./DGuB8RA-.js";import{_ as Ca}from"./4fFkR2QG.js";import{e as Ot}from"./D2QgEzTv.js";import{u as Rl}from"./SJHyi9T4.js";import{u as El,b as Il}from"./DG2ZEhLK.js";import{u as Ol}from"./CAfhvBOi.js";import{u as Tl}from"./Bgc5K1P7.js";import{a as Kt}from"./4PLl4EP6.js";import{S as Ra}from"./DEAKw9Pl.js";import"./CYkscC4Z.js";import{S as Ea}from"./ps5He39s.js";import{I as Vl}from"./BcKPINb2.js";import{u as $l}from"./CV-2bRRD.js";const Sl={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Dl(t,K){return d(),Y("svg",Sl,K[0]||(K[0]=[I("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"},null,-1)]))}const Gt=Sa({name:"mdi-plus",render:Dl}),zl=""+new URL("link-records.BXQG6er6.png",import.meta.url).href,[Al,Pl]=Rl((t,K,T,V=p=>{})=>{var je,xe,lt;const p=f(K.value),Re=()=>{p.value=K.value},{metas:ae,getMeta:k}=Da(),{base:$,sqlUis:C}=$t(St()),{getBaseRoles:z}=za(),{$api:F,$e:R}=na(),{isMobileMode:U}=Dt(),S=g(Aa,f()),y=g(xt,f(!1)),Z=g(sa,!1),G=g(oa,f([])),Ee=g(zt,_t()),{addUndo:ee,clone:j,defineViewScope:_e}=Pa(),m=g(Na,f(null)),se=f(),ye=f(),Ve=f([]),Ne=N(()=>Ve.value.reduce((n,l)=>(n[l.fk_column_id]=l,n),{})),O=wt({page:1,query:"",size:10}),we=f(0),de=wt({page:1,query:"",size:10}),M=f(0),A=f(!1),$e=f([]),le=f([]),oe=f([]),L=f(!1),h=f([]),Ie=wt({state:null}),ge=f(0),{t:Le}=Tt(),Fe=g(At,f(!1)),D=N(()=>{var n;return(n=t.value)==null?void 0:n.colOptions}),{sharedView:ie}=Fa(),{getViewColumns:Ye}=El(),{getValidSearchQueryForColumn:be}=Il(),he=((je=$.value)==null?void 0:je.id)||((lt=(xe=ie.value)==null?void 0:xe.view)==null?void 0:lt.base_id),re=N(()=>{var n,l;return(l=ae==null?void 0:ae.value)==null?void 0:l[(n=t==null?void 0:t.value)==null?void 0:n.fk_model_id]}),x=N(()=>{var n,l;return(l=ae.value)==null?void 0:l[(n=D.value)==null?void 0:n.fk_related_model_id]}),We=N(()=>{var n;return(n=x.value)!=null&&n.source_id?C.value[x.value.source_id]:Object.values(C.value)[0]}),Ue=N(()=>Ot(p.value.row,re.value.columns)),Be=N(()=>{var n,l;return!y.value||!((l=Rt((n=t.value)==null?void 0:n.meta))!=null&&l[Ua])}),Oe=n=>{var l;return Ot(n,(l=x.value)==null?void 0:l.columns)},Ke=async()=>{var l,r;if(await k(D.value.fk_related_model_id),Fe.value)return;const n=D.value.fk_target_view_id??((r=(l=x.value.views)==null?void 0:l[0])==null?void 0:r.id)??"";n&&(Ve.value=await Ye(n)??[])},ce=N(()=>{var n,l,r,o;return((l=(n=x.value)==null?void 0:n.columns)==null?void 0:l.find(v=>v.pv))||((o=(r=x==null?void 0:x.value)==null?void 0:r.columns)==null?void 0:o[0])}),Se=N(()=>{var n;return((n=ce.value)==null?void 0:n.title)||""}),yt=N(()=>{var n;return((n=ce.value)==null?void 0:n.id)||""}),ht=N(()=>{var n,l,r;return((r=(l=(n=x.value)==null?void 0:n.columns)==null?void 0:l.filter(o=>o.pk))==null?void 0:r.map(o=>o.title))??[]}),qe=N(()=>{var n,l,r,o,v;return(v=((l=(n=re.value)==null?void 0:n.columns)==null?void 0:l.find(_=>_.pv))||((o=(r=re==null?void 0:re.value)==null?void 0:r.columns)==null?void 0:o[0]))==null?void 0:v.title}),He=N(()=>{var r,o,v,_,te,Q;let n={type:"",format:""};const l=((o=(r=x.value)==null?void 0:r.columns)==null?void 0:o.find(ne=>ne.pv))||((_=(v=x==null?void 0:x.value)==null?void 0:v.columns)==null?void 0:_[0]);return l&&((l==null?void 0:l.uidt)===it.DateTime&&(n={type:l==null?void 0:l.uidt,format:`${((te=Rt(l==null?void 0:l.meta))==null?void 0:te.date_format)??ja[0]} ${((Q=Rt(l==null?void 0:l.meta))==null?void 0:Q.time_format)??Qt[0]}`}),(l==null?void 0:l.uidt)===it.Time&&(n={type:l==null?void 0:l.uidt,format:`${Qt[0]}`})),n}),kt=N(()=>K.value.row[qe.value]&&He.value.type&&He.value.format?Ma(K.value.row[qe.value],He.value.format,He.value.format!==it.Time):K.value.row[qe.value]),ot=Yt(Jt,n=>(x.value.columns??[]).filter(l=>Ht(l))[0],f([])),Xe=Yt(Jt,n=>(x.value.columns??[]).filter(l=>!Ba(l)&&!ia(l)&&!Pt(l)&&!Ht(l)).sort((l,r)=>{var o,v,_,te;return Fe.value?(((o=l.meta)==null?void 0:o.defaultViewColOrder)??1/0)-(((v=r.meta)==null?void 0:v.defaultViewColOrder)??1/0):(((_=Ne.value[l.id])==null?void 0:_.order)??1/0)-(((te=Ne.value[r.id])==null?void 0:te.order)??1/0)}).slice(0,U.value?1:3),f([])),Ze=N(()=>{var n,l;return Array.from(new Set([Se.value,...ht.value,...ot.value?[(n=ot.value)==null?void 0:n.title]:[],...(l=Xe.value||[])==null?void 0:l.map(r=>{var o;return(o=r.title)==null?void 0:o.trim()})]))}),et=qa(async()=>{var n,l,r,o;if(!((n=$.value)!=null&&n.id&&((l=$.value)==null?void 0:l.id)===((r=x.value)==null?void 0:r.base_id)))return await z((o=x.value)==null?void 0:o.base_id,{skipUpdatingUser:!0})}),tt=async(n,l)=>{var te;const r=l.colOptions||{};await k(r.fk_related_model_id);const o=(te=ae.value)==null?void 0:te[r==null?void 0:r.fk_related_model_id];if(!o)return;const v=((o==null?void 0:o.columns)||[]).filter(Q=>Q.pv||Q.pk),_=(Q,ne)=>{if(It(Q))return Q.map(ve=>_(ve,ne)).filter(Boolean);if(!Xt(Q))return null;const ke={};for(const ve of ne){const ue=Q[ve.title];Zt(ue)||ea(ue)||(ke[ve.title]=ue)}return ke};return _(n,v)},at=async(n={})=>{var r;const l={};if(!Xt(n)||!Rt((r=t.value)==null?void 0:r.meta).enableConditions)return{};for(const o of re.value.columns){const v=n[o.title];if(!(Zt(v)||ea(v)))switch(o.uidt){case it.Attachment:{It(v)&&(l[o.title]=v.map(_=>_!=null&&_.title?{title:_==null?void 0:_.title}:null).filter(Boolean));break}case it.Links:case it.LinkToAnotherRecord:{const _=await tt(v,o);_&&(l[o.title]=_);break}default:l[o.title]=v}}return l},u=n=>n?[...ce.value?[ce.value]:[],...Xe.value||[]].filter(r=>Ha(r)).map(r=>{let o="like",v=n.trim();if(ft(ce.value)&&ft(r)||(v=be(r,v,x.value)),!Ja(v))return"";if(ft(ce.value)&&ft(r))o="eq,exactDate";else if((r.uidt!==it.Formula||Wa(r)!==Xa.NUMERIC)&&!Za(r)&&We.value&&["text","string"].includes(We.value.getAbstractType(r))&&r.dt!=="bigint"){if(o="like",!v)return"";v=`%${v}%`}else o="eq",v=el(v)?"":v;return v?`(${r.title},${o},${v})`:""}).filter(Boolean).join("~or"):void 0,i=async(n,l=!1)=>{var r,o,v,_,te,Q,ne,ke,ve;n&&(Ie.state=n);try{let ue=O.size*(O.page-1)-we.value;(ue<0||l)&&(ue=0,we.value=0,O.page=1),L.value=!0;const De=u(O.query);if(Fe.value){const W=Ga().currentRoute;let X;if(y.value){const{formState:c,additionalState:b}=Ol();X=await at({...(c==null?void 0:c.value)||{},...(b==null?void 0:b.value)||{}})}se.value=await F.public.dataRelationList(W.value.params.viewId,t.value.id,{},{headers:{"xc-password":m.value},query:{limit:O.size,offset:ue,where:De,fields:Ze.value,rowData:JSON.stringify(X)}})}else if(T!=null&&T.value){const q=await at(K.value.row);se.value=await F.dbTableRow.list(ct,((r=x==null?void 0:x.value)==null?void 0:r.base_id)??he,(o=x==null?void 0:x.value)==null?void 0:o.id,{limit:O.size,offset:ue,where:De,linkColumnId:t.value.fk_column_id||t.value.id,linkRowData:JSON.stringify(q)});const W=new Set(((_=(v=ye.value)==null?void 0:v.list)==null?void 0:_.map(X=>X.Id))??[]);se.value.list&&W.size&&(se.value.list=se.value.list.filter(X=>!W.has(X.Id)))}else{let q;try{(te=K.value)!=null&&te.row&&(q=Object.keys((Q=K.value)==null?void 0:Q.row).reduce((W,X)=>(K.value.row[X]!==K.value.oldRow[X]&&(W[X]=K.value.row[X]),W),{}),q=await at(q))}catch{}se.value=await F.dbTableRow.nestedChildrenExcludedList(ct,re.value.base_id??he,re.value.id,encodeURIComponent(Ue.value),D.value.type,(ne=t==null?void 0:t.value)==null?void 0:ne.id,{limit:String(O.size),offset:String(ue),where:De,linkRowData:q?JSON.stringify(q):void 0})}(ke=se.value)==null||ke.list.forEach((q,W)=>{h.value[W]=!1,oe.value[W]=!1}),(ve=se.value)!=null&&ve.list&&n&&n[t.value.title]&&se.value.list.forEach((q,W)=>{([ze.BELONGS_TO,ze.ONE_TO_ONE].includes(D.value.type)?[n[t.value.title]]:n[t.value.title]).find(c=>{let b=!0;for(const Me in c)c[Me]!==q[Me]&&(b=!1);return b})&&(h.value[W]=!0)})}catch(ue){const De=await Qa(ue);if(De.error===Ya.INVALID_OFFSET_VALUE)return O.page=0,i(n,!0);st.error(`${Le("msg.error.failedToLoadList")}: ${De.message}`)}finally{L.value=!1}},B=async(n=!1,l=void 0,r=void 0)=>{var o,v,_,te,Q,ne,ke,ve,ue,De;l&&(Ie.state=l);try{if(A.value=!0,[ze.BELONGS_TO,ze.ONE_TO_ONE].includes(D.value.type)||!t.value)return;let q=de.size*(de.page-1)+M.value;if(q<0||n?(q=0,M.value=0,de.page=1):q>=ge.value&&(q=0),T!=null&&T.value||!Ue.value){const W=((o=t.value)==null?void 0:o.title)||"",X=((v=Ie.state)==null?void 0:v[W])??[],c=de.query.toLocaleLowerCase(),b=c?X.filter(Me=>`${Me[Se.value]??""}`.toLocaleLowerCase().includes(c)):X;ye.value={list:b,pageInfo:{isFirstPage:!0,isLastPage:b.length<=10,page:1,pageSize:10,totalRows:b.length}}}else{const W=u(de.query);Fe.value?ye.value=await F.public.dataNestedList((_=ie.value)==null?void 0:_.uuid,encodeURIComponent(Ue.value),D.value.type,t.value.id,{limit:String(de.size),offset:String(q),where:W},{headers:{"xc-password":m.value}}):ye.value=await F.dbTableRow.nestedList(ct,((te=re.value)==null?void 0:te.base_id)??(((Q=$==null?void 0:$.value)==null?void 0:Q.id)||((ke=(ne=ie.value)==null?void 0:ne.view)==null?void 0:ke.base_id)),re.value.id,encodeURIComponent(Ue.value),D.value.type,(ve=t==null?void 0:t.value)==null?void 0:ve.id,{limit:String(r??de.size),offset:String(q),where:W})}(ue=ye.value)==null||ue.list.forEach((W,X)=>{le.value[X]=!0,$e.value[X]=!1}),de.query||(ge.value=((De=ye.value)==null?void 0:De.pageInfo.totalRows)??0)}catch(q){st.error(`${Le("msg.error.failedToLoadChildrenList")}: ${await Et(q)}`)}finally{A.value=!1}return ye.value},a=async(n,l)=>{Ka.confirm({title:"Do you want to delete the record?",type:"warning",onOk:async()=>{var o;const r=Oe(n);try{const v=await F.dbTableRow.delete(ct,((o=x.value)==null?void 0:o.base_id)??he,x.value.id,encodeURIComponent(r));if(v.message)return st.info(`Record delete failed: ${`Unable to delete record with ID ${r} because of the following:
              
${v.message.join(`
`)}.

              Clear the data first & try again`})}`),!1;V==null||V({shouldShowLoading:!1,path:G.value}),T!=null&&T.value||await B(),l==null||l(n),R("a:links:delete-related-row")}catch(v){st.error(`${Le("msg.error.deleteFailed")}: ${await Et(v)}`)}}})},s=async(n,{metaValue:l=re.value}={},r=!1,o)=>{var v;try{M.value=M.value-1,we.value=we.value-1,oe.value[o]=!0,$e.value[o]=!0,await F.dbTableRow.nestedRemove(ct,(l==null?void 0:l.base_id)??$.value.id,l.id,encodeURIComponent(Ue.value),D.value.type,(v=t==null?void 0:t.value)==null?void 0:v.id,encodeURIComponent(Oe(n))),r||ee({redo:{fn:_=>s(_,{},!0,o),args:[j(n)]},undo:{fn:_=>E(_,{},!0,o),args:[j(n)]},scope:_e({view:S.value})}),h.value[o]=!1,le.value[o]=!1,D.value.type!==ze.BELONGS_TO&&D.value.type!==ze.ONE_TO_ONE&&(ge.value=ge.value-1)}catch(_){st.error(`${Le("msg.error.unlinkFailed")}: ${await Et(_)}`)}finally{oe.value[o]=!1,$e.value[o]=!1}V==null||V({shouldShowLoading:!1,path:G.value}),r&&Z&&Ee.trigger({shouldShowLoading:!1}),R("a:links:unlink")},E=async(n,{metaValue:l=re.value}={},r=!1,o)=>{var v,_,te,Q;try{if(oe.value[o]=!0,$e.value[o]=!0,M.value=M.value+1,we.value=we.value+1,await F.dbTableRow.nestedAdd(ct,(l==null?void 0:l.base_id)??$.value.id,l.id,encodeURIComponent(Ue.value),D.value.type,(v=t==null?void 0:t.value)==null?void 0:v.id,encodeURIComponent(Oe(n))),!r){let ne=null;(ra(t.value)||ua(t.value))&&(ne=(te=p.value.row)==null?void 0:te[(_=t.value)==null?void 0:_.title]),ee({redo:{fn:ke=>{E(ke,{},!0,o)},args:[j(n)]},undo:{fn:(ke,ve)=>{ve?E(ve,{},!0,o):s(ke,{},!0,o)},args:[j(n),j(ne)]},scope:_e({view:S.value})})}h.value[o]=!0,le.value[o]=!0,D.value.type!==ze.BELONGS_TO&&D.value.type!==ze.ONE_TO_ONE?ge.value=ge.value+1:(h.value=Array((Q=se.value)==null?void 0:Q.list.length).fill(!1),h.value[o]=!0)}catch(ne){st.error(`Linking failed: ${await Et(ne)}`)}finally{oe.value[o]=!1,$e.value[o]=!1}V==null||V({shouldShowLoading:!1,path:G.value}),r&&Z&&Ee.trigger({shouldShowLoading:!1}),R("a:links:link")},P=Wt(i,500),H=Wt(B,500);return Te(O,async()=>{await P(Ie.state)}),Te(de,async()=>{await H(!1,Ie.state)}),Te(ye,async()=>{var n;(n=ye.value)==null||n.list.forEach((l,r)=>{le.value[r]=!0,$e.value[r]=!1})}),{relatedTableMeta:x,loadRelatedTableMeta:Ke,targetViewColumns:Ve,targetViewColumnsById:Ne,relatedTableDisplayValueProp:Se,displayValueTypeAndFormatProp:He,childrenExcludedList:se,childrenList:ye,childrenListCount:ge,childrenListOffsetCount:M,childrenExcludedOffsetCount:we,rowId:Ue,childrenExcludedListPagination:O,childrenListPagination:de,displayValueProp:qe,meta:re,unlink:s,link:E,loadChildrenExcludedList:i,loadChildrenList:B,isChildrenExcludedListLinked:h,isChildrenListLinked:le,isChildrenListLoading:$e,isChildrenExcludedListLoading:oe,row:K,isChildrenLoading:A,isChildrenExcludedLoading:L,deleteRelatedRow:a,getRelatedTableRowId:Oe,headerDisplayValue:kt,relatedTableDisplayValueColumn:ce,relatedTableDisplayValuePropId:yt,resetChildrenExcludedOffsetCount:()=>{we.value=0},resetChildrenListOffsetCount:()=>{M.value=0},attachmentCol:ot,fields:Xe,refreshCurrentRow:Re,externalBaseUserRoles:et,showExtraFields:Be}},"ltar-store");function Ia(){const t=Pl();if(t==null)throw new Error("Please call `useLTARStore` on the appropriate parent component");return t}const Nl=pe(()=>me(()=>import("./Cd4hVR2a.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(t=>t.default||t)),Fl=pe(()=>me(()=>import("./C06hMDCB.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url).then(t=>t.default||t)),Ul=pe(()=>me(()=>import("./0c4tmWST.js").then(t=>t.i),__vite__mapDeps([37,1,2,23,22,28,7,26,27,38,6,25,39,40,5,41,42,43,44,45,46,33,31,47,48,49,50,51,52,53,54,55,56,57,58,13,14,59,60,61,62,63,64,65,66,67,29,68,69,70,32,30,34,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,8,99,100,101,102,18,103,104,105,106]),import.meta.url).then(t=>t.default||t)),jl={class:"flex flex-col h-full"},Ml={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},Bl={class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center rounded-md"},ql={key:0},Kl={class:"cursor-pointer"},Gl={class:"flex items-center"},Ql={class:"flex flex-col gap-2 flex-grow justify-center"},Yl={class:"flex flex-row gap-6 w-10/12"},Hl={key:1,class:"h-full flex flex-col gap-2 my-auto items-center justify-center text-gray-500 text-center"},Jl=["alt"],Wl={class:"text-base text-gray-700 font-bold"},Xl={class:"text-gray-700"},Zl={class:"flex items-center gap-1"},en={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between gap-3 min-h-11"},tn={class:"flex items-center gap-2"},an={class:"flex items-center gap-1"},ln={class:"flex items-center gap-1"},nn={key:0,class:"flex justify-center items-center"},sn=Ct({__name:"LinkedItems",props:{modelValue:{type:Boolean},cellValue:{},column:{},items:{}},emits:["update:modelValue","attachRecord","escape"],setup(t,{emit:K}){const T=t,V=K,p=Nt(T,"modelValue",V),{isMobileMode:Re}=Dt(),{isUIAllowed:ae}=bt(),{t:k}=Tt(),$=g(xt,f(!1)),C=g(At,f(!1)),z=f(!1),F=f(!1),R=g(Vt,f()),U=g(Ft,f(!1)),S=g(Ut,_t()),y=g(zt,_t()),Z=f(),{isDataReadOnly:G}=bt(),{isSharedBase:Ee}=$t(St()),{childrenList:ee,childrenListCount:j,loadChildrenList:_e,childrenListPagination:m,childrenExcludedOffsetCount:se,childrenListOffsetCount:ye,relatedTableDisplayValueProp:Ve,displayValueTypeAndFormatProp:Ne,unlink:O,isChildrenListLoading:we,isChildrenListLinked:de,isChildrenLoading:M,relatedTableMeta:A,link:$e,meta:le,row:oe,loadRelatedTableMeta:L,resetChildrenListOffsetCount:h,attachmentCol:Ie,fields:ge,refreshCurrentRow:Le,rowId:Fe,relatedTableDisplayValueColumn:D,externalBaseUserRoles:ie}=Ia(),{withLoading:Ye}=Tl(),{isNew:be,state:he,removeLTARRef:re,addLTARRef:x}=Kt(),{showRecordPlanLimitExceededModal:We}=da();Te([p,$],a=>{(a[0]||a[1])&&!be.value&&(Le(),_e(!0)),a[0]||h()},{immediate:!0});const Ue=async(a,s)=>{be.value?await re(a,R==null?void 0:R.value):await O(a,{},!1,s)},Be=async(a,s)=>{be.value?await x(a,R==null?void 0:R.value):await $e(a,{},!1,s)},Oe=f(!1),Ke=f({}),ce=N(()=>{var P,H,J,Ge;if(be.value)return{};const a=(P=R==null?void 0:R.value)==null?void 0:P.colOptions,s=(J=(H=A==null?void 0:A.value)==null?void 0:H.columns)==null?void 0:J.find(je=>{if(!Pt(je))return!1;const xe=je==null?void 0:je.colOptions;return(xe==null?void 0:xe.fk_related_model_id)!==le.value.id?!1:a.type===ze.MANY_TO_MANY&&(xe==null?void 0:xe.type)===ze.MANY_TO_MANY?a.fk_parent_column_id===xe.fk_child_column_id&&a.fk_child_column_id===xe.fk_parent_column_id:a.fk_parent_column_id===xe.fk_parent_column_id&&a.fk_child_column_id===xe.fk_child_column_id});if(!s)return{};const E=s==null?void 0:s.colOptions;return E?E.type===ze.BELONGS_TO?{[s.title]:(Ge=oe==null?void 0:oe.value)==null?void 0:Ge.row}:{[s.title]:(oe==null?void 0:oe.value)&&[oe.value.row]}:{}}),Se=N(()=>{var a;return((a=R.value)==null?void 0:a.title)||""}),yt=a=>{C.value||$.value||(Ke.value=a,Oe.value=!0)},ht=()=>{We()||(Ke.value={},Oe.value=!0,z.value=!0,F.value=!0)};y.on(Ye(a=>{a!=null&&a.isFromLinkRecord&&(Le(),_e())}));const qe=async a=>{var E;if(S==null||S.trigger({shouldShowLoading:!1}),y==null||y.trigger({shouldShowLoading:!1,isFromLinkRecord:!0,relatedTableMetaId:A.value.id,rowId:Fe.value}),!F.value)return;be.value?(await x(a,R==null?void 0:R.value),_e(!1,he.value)):p.value=!1;const s=mt("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[mt("span",{class:"font-semibold"},k("activity.recordCreatedLinked")),mt("span",{class:"text-gray-500"},k("activity.gotSavedLinkedSuccessfully",{tableName:(E=A.value)==null?void 0:E.title,recordTitle:a[Ve.value]}))]);st.success(s),F.value=!1},He=()=>{_e(!0)},kt=N(()=>{var a,s;return(s=(a=R.value)==null?void 0:a.colOptions)==null?void 0:s.type});Te(()=>T.cellValue,()=>{be.value&&_e(!1,he.value)},{immediate:!0}),Te(Oe,()=>{Oe.value||(z.value=!1),se.value=0,ye.value=0});const ot=N(()=>T.items<10&&m.page===1?T.items:j.value<10&&m.page===1?j.value||10:Math.ceil(j.value/10)===m.page?j.value%10:10),Xe=N(()=>{var a,s;return $.value||be.value?(s=(a=he.value)==null?void 0:a[Se.value])==null?void 0:s.length:M.value?T.items:j.value}),Ze=N(()=>{var a,s,E,P;return((s=(a=ee.value)==null?void 0:a.pageInfo)==null?void 0:s.totalRows)||be.value&&((P=(E=he.value)==null?void 0:E[Se.value])==null?void 0:P.length)}),et=(a,s)=>{Ee.value||U.value||C.value&&!$.value||(be.value||de.value[parseInt(s)]?Ue(a,parseInt(s)):Be(a,parseInt(s)))};Te([Z,Ze],()=>{var a;(!(U.value||C.value)||Ze.value)&&((a=Z.value)==null||a.focus())});const tt=a=>{var s,E,P,H,J;if(a.key==="Escape")p.value=!1;else if(a.key==="ArrowDown"){a.preventDefault();try{(E=(s=a.target)==null?void 0:s.nextElementSibling)==null||E.focus()}catch{}}else if(a.key==="ArrowUp"){a.preventDefault();try{(H=(P=a.target)==null?void 0:P.previousElementSibling)==null||H.focus()}catch{}}else if(!Oe.value&&a.key!=="Tab"&&a.key!=="Shift"&&a.key!=="Enter"&&a.key!==" ")try{(J=Z.value)==null||J.focus()}catch{}};jt(()=>{L(),window.addEventListener("keydown",tt),setTimeout(()=>{var a;(a=Z.value)==null||a.focus()},100)});const at=f();Te(m,()=>{var a;(a=at.value)==null||a.scrollTo({top:0,behavior:"smooth"})}),Mt(()=>{h(),m.query="",window.removeEventListener("keydown",tt)});const u=()=>{m.page=1,h()},i=f(!1),B=a=>{var s,E,P;if(a.key==="Escape")m.query||V("escape"),(s=Z.value)==null||s.blur();else if(a.key==="Enter"){const H=((E=ee.value)==null?void 0:E.list)??((P=he.value)==null?void 0:P[Se.value]);m.query&&It(H)&&H.length&&et(H[0],"0")}};return(a,s)=>{var _,te,Q,ne,ke,ve,ue,De,q,W,X;const E=ba,P=va,H=ca,J=Nl,Ge=Ra,je=Ea,xe=Fl,lt=Gt,n=fa,l=xa,r=Ca,o=Ul,v=Bt("e");return d(),Y("div",{class:dt(["nc-modal-child-list h-full w-full",{active:e(p)}]),onKeydown:s[10]||(s[10]=Qe(Ce(()=>{},["stop"]),["enter"]))},[I("div",jl,[I("div",Ml,[I("div",Bl,[e(D)&&e(ft)(e(D))?(d(),w(E,{key:0,class:"nc-filter-value-select rounded-md min-w-34",column:e(D),filter:{comparison_op:"eq",comparison_sub_op:"exactDate",value:e(m).query},onUpdateFilterValue:s[0]||(s[0]=c=>e(m).query=c),onClick:s[1]||(s[1]=Ce(()=>{},["stop"]))},null,8,["column","filter"])):(d(),w(H,{key:1,ref_key:"filterQueryRef",ref:Z,value:e(m).query,"onUpdate:value":s[2]||(s[2]=c=>e(m).query=c),bordered:!1,placeholder:"Search linked records...",class:"w-full min-h-4 !pl-0",size:"small",autocomplete:"off",onFocus:s[3]||(s[3]=c=>i.value=!0),onBlur:s[4]||(s[4]=c=>i.value=!1),onChange:u,onKeydownCapture:Ce(B,["stop"])},{prefix:Ae(()=>[fe(P,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"]))]),fe(J,{"data-testid":"nc-link-count-info","linked-records":e(Xe),"related-table-title":(_=e(A))==null?void 0:_.title,relation:e(kt),"table-title":(te=e(le))==null?void 0:te.title},null,8,["linked-records","related-table-title","relation","table-title"])]),I("div",{ref_key:"childrenListRef",ref:at,class:"flex-1 overflow-auto nc-scrollbar-thin"},[e(Ze)||e(M)?(d(),Y("div",ql,[I("div",Kl,[e(M)?(d(!0),Y(ut,{key:0},pt(Array.from({length:e(ot)}),(c,b)=>(d(),Y("div",{key:b,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[I("div",Gl,[fe(Ge,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),I("div",Ql,[fe(je,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),I("div",Yl,[(d(),Y(ut,null,pt([1,2,3],Me=>fe(je,{key:Me,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(d(!0),Y(ut,{key:1},pt(((Q=e(ee))==null?void 0:Q.list)??((ne=e(he))==null?void 0:ne[e(Se)])??[],(c,b)=>{var Me;return d(),w(xe,{key:b,attachment:e(Ie),"display-value-type-and-format-prop":e(Ne),fields:e(ge),"is-linked":(Me=e(ee))!=null&&Me.list?e(de)[Number.parseInt(b)]:!0,"is-loading":e(we)[Number.parseInt(b)],"is-selected":!!(e(i)&&e(m).query&&Number.parseInt(b)===0),"related-table-display-value-prop":e(Ve),row:c,"data-testid":"nc-child-list-item",onLinkOrUnlink:$a=>et(c,b),onExpand:$a=>yt(c),onKeydown:[Qe(Ce(()=>et(c,b),["prevent","stop"]),["space"]),Qe(Ce(()=>et(c,b),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","is-selected","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"])}),128))])])):(d(),Y("div",Hl,[I("img",{alt:a.$t("msg.clickLinkRecordsToAddLinkFromTable"),class:"!w-[158px] flex-none",src:zl},null,8,Jl),I("div",Wl,Je(a.$t("msg.noLinkedRecords")),1),I("div",Xl,Je(a.$t("msg.clickLinkRecordsToAddLinkFromTable")),1),!e(U)&&(e(j)<1||(((ke=e(ee))==null?void 0:ke.list)??((ve=e(he))==null?void 0:ve[e(Se)])??[]).length>0)?gt((d(),w(n,{key:0,"data-testid":"nc-child-list-button-link-to",size:"small",onClick:s[5]||(s[5]=c=>V("attachRecord"))},{default:Ae(()=>[I("div",Zl,[fe(lt),Lt(" "+Je(a.$t("title.linkRecords")),1)])]),_:1})),[[v,["c:links:link"]]]):Pe("",!0)]))],512),I("div",en,[I("div",tn,[!e(C)&&!e(G)&&e(ae)("dataEdit",e(ie))&&e(ae)("dataEdit")&&!e($)&&!((ue=e(A))!=null&&ue.synced)?(d(),w(l,{key:0,entity:e(ma).TABLE,"entity-id":(De=e(A))==null?void 0:De.id,permission:e(pa).TABLE_RECORD_ADD},{default:Ae(({isAllowed:c})=>[gt((d(),w(n,{size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",disabled:!c,onClick:ht},{default:Ae(()=>[I("div",an,[e(Re)?Pe("",!0):(d(),w(lt,{key:0,class:"h-4 w-4"})),Lt(" "+Je(a.$t("activity.newRecord")),1)])]),_:2},1032,["disabled"])),[[v,["c:row-expand:open"]]])]),_:1},8,["entity","entity-id","permission"])):Pe("",!0),!e(U)&&(e(j)>0||(((q=e(ee))==null?void 0:q.list)??((W=e(he))==null?void 0:W[e(Se)])??[]).length>0)?gt((d(),w(n,{key:1,"data-testid":"nc-child-list-button-link-to",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",size:"small",type:"secondary",onClick:s[6]||(s[6]=c=>V("attachRecord"))},{default:Ae(()=>[I("div",ln,[fe(P,{icon:"link2",class:"!xs:hidden h-4 w-4"}),Lt(" "+Je(e(Re)?a.$t("title.linkMore"):a.$t("title.linkMoreRecords")),1)])]),_:1})),[[v,["c:links:link"]]]):Pe("",!0)]),!e(be)&&((X=e(ee))!=null&&X.pageInfo)&&+e(ee).pageInfo.totalRows>e(m).size?(d(),Y("div",nn,[fe(r,{current:e(m).page,"onUpdate:current":s[7]||(s[7]=c=>e(m).page=c),"page-size":e(m).size,"onUpdate:pageSize":s[8]||(s[8]=c=>e(m).size=c),total:+e(ee).pageInfo.totalRows,mode:"simple"},null,8,["current","page-size","total"])])):Pe("",!0)])]),(d(),w(_a,null,{default:Ae(()=>{var c;return[e(Ke)&&e(Oe)?(d(),w(o,{key:0,modelValue:e(Oe),"onUpdate:modelValue":s[9]||(s[9]=b=>ya(Oe)?Oe.value=b:null),"load-row":!e(C),"close-after-save":e(z),meta:e(A),"new-record-header":e(z)?a.$t("activity.tableNameCreateNewRecord",{tableName:(c=e(A))==null?void 0:c.title}):void 0,row:{row:e(Ke),oldRow:e(Ke),rowMeta:e(F)?{new:!0}:{}},state:e(ce),"row-id":("extractPkFromRow"in a?a.extractPkFromRow:e(Ot))(e(Ke),e(A).columns),"use-meta-fields":"","skip-reload":"","maintain-default-view-order":"","new-record-submit-btn-text":e(F)?"Create & Link":void 0,onCreatedRecord:qe,onDeletedRecord:He},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","state","row-id","new-record-submit-btn-text"])):Pe("",!0)]}),_:1}))],34)}}}),Oa=Object.assign(qt(sn,[["__scopeId","data-v-08be0283"]]),{__name:"VirtualCellComponentsLinkedItems"}),us=Object.freeze(Object.defineProperty({__proto__:null,default:Oa},Symbol.toStringTag,{value:"Module"})),on=pe(()=>me(()=>import("./Cd4hVR2a.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(t=>t.default||t)),rn=pe(()=>me(()=>import("./C06hMDCB.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url).then(t=>t.default||t)),un=pe(()=>me(()=>import("./0c4tmWST.js").then(t=>t.i),__vite__mapDeps([37,1,2,23,22,28,7,26,27,38,6,25,39,40,5,41,42,43,44,45,46,33,31,47,48,49,50,51,52,53,54,55,56,57,58,13,14,59,60,61,62,63,64,65,66,67,29,68,69,70,32,30,34,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,8,99,100,101,102,18,103,104,105,106]),import.meta.url).then(t=>t.default||t)),dn={class:"flex flex-col h-full"},cn={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},vn={class:"flex-1 gap-2 flex items-center"},fn={class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center rounded-md"},pn={class:"flex-1 overflow-auto nc-scrollbar-thin"},mn={class:"flex items-center"},_n={class:"flex flex-col gap-2 flex-grow justify-center"},yn={class:"flex flex-row gap-6 w-10/12"},hn={key:1,class:"h-full my-auto py-2 flex flex-col gap-3 items-center justify-center text-gray-500"},kn={key:0},wn={key:1},gn={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between min-h-11"},Ln={class:"flex"},bn={class:"flex items-center gap-1"},xn={key:0,class:"flex items-center"},Cn={key:1,class:"flex items-center"},Rn=Ct({__name:"UnLinkedItems",props:{modelValue:{type:Boolean},column:{},hideBackBtn:{type:Boolean}},emits:["update:modelValue","addNewRecord","attachLinkedRecord","escape"],setup(t,{emit:K}){const T=t,V=K,p=Nt(T,"modelValue",V),{isMobileMode:Re}=Dt(),{isUIAllowed:ae}=bt(),k=g(Vt),{isSharedBase:$}=$t(St()),C=f(),{t:z}=Tt(),{$e:F}=na(),{isDataReadOnly:R}=bt(),{childrenExcludedList:U,isChildrenExcludedListLinked:S,childrenExcludedOffsetCount:y,childrenListOffsetCount:Z,isChildrenExcludedListLoading:G,isChildrenExcludedLoading:Ee,childrenListCount:ee,loadChildrenExcludedList:j,loadChildrenList:_e,childrenExcludedListPagination:m,relatedTableDisplayValueProp:se,displayValueTypeAndFormatProp:ye,relatedTableDisplayValueColumn:Ve,link:Ne,relatedTableMeta:O,meta:we,unlink:de,row:M,resetChildrenExcludedOffsetCount:A,loadRelatedTableMeta:$e,attachmentCol:le,fields:oe,refreshCurrentRow:L,rowId:h,externalBaseUserRoles:Ie}=Ia(),{addLTARRef:ge,isNew:Le,removeLTARRef:Fe,state:D}=Kt(),{showRecordPlanLimitExceededModal:ie}=da(),Ye=g(At,f(!1)),be=f(!1),he=f(!1);Ee.value=!0;const re=g(xt,f(!1)),x=g(ha,()=>{}),We=g(Ut,_t()),Ue=g(zt,_t()),Be=N(()=>{var u,i;return(i=(u=k.value)==null?void 0:u.colOptions)==null?void 0:i.type}),Oe=async(u,i)=>{Le.value?(await ge(u,k==null?void 0:k.value),Be.value==="oo"||Be.value==="bt"?S.value.forEach((B,a)=>{B&&(S.value[a]=!1),i===a&&(S.value[a]=!0)}):S.value[i]=!0,x(),F("a:links:link")):await Ne(u,{},!1,i)},Ke=async(u,i)=>{Le.value?(Fe(u,k==null?void 0:k.value),S.value[i]=!1,x(),F("a:links:unlink")):await de(u,{},!1,i)};Te(p,(u,i)=>{u&&!i&&(L(),m.query="",m.page=1,re.value||_e(),j(D.value,!0)),u||A()},{immediate:!0});const ce=f(!1),Se=f({}),yt=N(()=>{var a,s,E,P;if(Le.value)return{};const u=(a=k==null?void 0:k.value)==null?void 0:a.colOptions,i=(E=(s=O==null?void 0:O.value)==null?void 0:s.columns)==null?void 0:E.find(H=>{if(!Pt(H))return!1;const J=H==null?void 0:H.colOptions;return(J==null?void 0:J.fk_related_model_id)!==we.value.id?!1:u.type===ze.MANY_TO_MANY&&(J==null?void 0:J.type)===ze.MANY_TO_MANY?u.fk_parent_column_id===J.fk_child_column_id&&u.fk_child_column_id===J.fk_parent_column_id:u.fk_parent_column_id===J.fk_parent_column_id&&u.fk_child_column_id===J.fk_child_column_id});if(!i)return{};const B=i==null?void 0:i.colOptions;return B?B.type===ze.BELONGS_TO||B.type===ze.ONE_TO_ONE?{[i.title]:(P=M==null?void 0:M.value)==null?void 0:P.row}:{[i.title]:(M==null?void 0:M.value)&&[M.value.row]}:{}}),ht=N(()=>{var u,i,B,a,s,E,P,H,J;return re.value||Le.value?Be.value==="bt"||Be.value==="oo"?(i=D.value)!=null&&i[(u=k.value)==null?void 0:u.title]?1:0:((s=(a=D.value)==null?void 0:a[(B=k.value)==null?void 0:B.title])==null?void 0:s.length)??0:Be.value==="bt"?(P=M.value)!=null&&P.row[(E=O.value)==null?void 0:E.title]?1:0:Be.value==="oo"?(J=M.value)!=null&&J.row[(H=k.value)==null?void 0:H.title]?1:0:ee.value??0});Te(ce,()=>{ce.value||(be.value=!1,re.value||_e(),j(D.value)),y.value=0,Z.value=0}),Te(C,()=>{var u;(u=C.value)==null||u.focus()});const qe=(u,i)=>{$.value||(S.value[Number.parseInt(i)]?Ke(u,Number.parseInt(i)):Oe(u,Number.parseInt(i)))},He=()=>{ie()||(Se.value={},ce.value=!0,be.value=!0,he.value=!0)},kt=u=>{var B;if(ge(u,k==null?void 0:k.value),We==null||We.trigger({shouldShowLoading:!1}),Ue==null||Ue.trigger({shouldShowLoading:!1,isFromLinkRecord:!0,relatedTableMetaId:O.value.id,rowId:h.value}),!he.value){p.value=!1;return}const i=mt("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[mt("span",{class:"font-semibold"},z("activity.recordCreatedLinked")),mt("span",{class:"text-gray-500"},z("activity.gotSavedLinkedSuccessfully",{tableName:(B=O.value)==null?void 0:B.title,recordTitle:u[se.value]}))]);st.success(i),p.value=!1,he.value=!1},ot=async()=>{await _e(),j(D.value,!0)},Xe=u=>{var i,B,a,s,E;if(u.key==="Escape")p.value=!1;else if(u.key==="ArrowDown"){u.preventDefault();try{(B=(i=u.target)==null?void 0:i.nextElementSibling)==null||B.focus()}catch{}}else if(u.key==="ArrowUp"){u.preventDefault();try{(s=(a=u.target)==null?void 0:a.previousElementSibling)==null||s.focus()}catch{}}else if(!ce.value&&u.key!=="Tab"&&u.key!=="Shift"&&u.key!=="Enter"&&u.key!==" ")try{(E=C.value)==null||E.focus()}catch{}},Ze=f();Te(m,()=>{var u;(u=Ze.value)==null||u.scrollTo({top:0,behavior:"smooth"})}),jt(()=>{window.addEventListener("keydown",Xe),$e(),setTimeout(()=>{var u;(u=C.value)==null||u.focus()},100)}),Mt(()=>{A(),m.query="",window.removeEventListener("keydown",Xe)});const et=()=>{m.page=1,A()},tt=f(!1),at=u=>{var i,B,a,s;u.key==="Escape"?(m.query||V("escape"),(i=C.value)==null||i.blur()):u.key==="Enter"&&m.query&&It((B=U.value)==null?void 0:B.list)&&(a=U.value)!=null&&a.list.length&&qe((s=U.value)==null?void 0:s.list[0],"0")};return(u,i)=>{var r,o,v,_,te,Q,ne,ke,ve,ue,De,q,W,X;const B=va,a=ba,s=ca,E=on,P=Ra,H=Ea,J=rn,Ge=Gt,je=fa,xe=xa,lt=Ca,n=un,l=Bt("e");return d(),Y("div",{class:dt(["nc-modal-link-record h-full w-full overflow-hidden",{active:e(p)}]),onKeydown:i[11]||(i[11]=Qe(Ce(()=>{},["stop"]),["enter"]))},[I("div",dn,[I("div",cn,[I("div",vn,[u.hideBackBtn?Pe("",!0):(d(),Y("button",{key:0,class:"!text-brand-500 hover:!text-brand-700 p-1.5 flex",onClick:i[0]||(i[0]=c=>V("attachLinkedRecord"))},[fe(B,{icon:"ncArrowLeft",class:"flex-none h-4 w-4"})])),I("div",fn,[e(Ve)&&e(ft)(e(Ve))?(d(),w(a,{key:0,class:"nc-filter-value-select rounded-md min-w-34",column:e(Ve),filter:{comparison_op:"eq",comparison_sub_op:"exactDate",value:e(m).query},onUpdateFilterValue:i[1]||(i[1]=c=>e(m).query=c),onClick:i[2]||(i[2]=Ce(()=>{},["stop"]))},null,8,["column","filter"])):(d(),w(s,{key:1,ref_key:"filterQueryRef",ref:C,value:e(m).query,"onUpdate:value":i[3]||(i[3]=c=>e(m).query=c),bordered:!1,placeholder:"Search records to link...",class:"w-full nc-excluded-search min-h-4 !pl-0",size:"small",autocomplete:"off",onFocus:i[4]||(i[4]=c=>tt.value=!0),onBlur:i[5]||(i[5]=c=>tt.value=!1),onChange:et,onKeydownCapture:Ce(at,["stop"])},{prefix:Ae(()=>[fe(B,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"]))])]),fe(E,{"data-testid":"nc-link-count-info","linked-records":e(ht),"related-table-title":(r=e(O))==null?void 0:r.title,relation:e(Be),"table-title":(o=e(we))==null?void 0:o.title},null,8,["linked-records","related-table-title","relation","table-title"])]),I("div",pn,[(_=(v=e(U))==null?void 0:v.pageInfo)!=null&&_.totalRows?(d(),Y("div",{key:0,ref_key:"childrenExcludedListRef",ref:Ze},[e(Ee)?(d(!0),Y(ut,{key:0},pt(Array.from({length:10}),(c,b)=>(d(),Y("div",{key:b,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:c"},[I("div",mn,[fe(P,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),I("div",_n,[fe(H,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),I("div",yn,[(d(),Y(ut,null,pt([1,2,3],Me=>fe(H,{key:Me,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(d(!0),Y(ut,{key:1},pt(((te=e(U))==null?void 0:te.list)??[],(c,b)=>(d(),w(J,{key:b,attachment:e(le),"display-value-type-and-format-prop":e(ye),fields:e(oe),"is-linked":e(S)[Number.parseInt(b)],"is-loading":e(G)[Number.parseInt(b)],"is-selected":!!(e(tt)&&e(m).query&&Number.parseInt(b)===0),"related-table-display-value-prop":e(se),row:c,"data-testid":"nc-excluded-list-item",onLinkOrUnlink:Me=>qe(c,b),onExpand:()=>{Se.value=c,ce.value=!0},onKeydown:[Qe(Ce(()=>qe(c,b),["prevent","stop"]),["space"]),Qe(Ce(()=>qe(c,b),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","is-selected","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"]))),128))],512)):(d(),Y("div",hn,[fe(e(Vl),{class:"w-16 h-16 mx-auto"}),e(m).query?(d(),Y("p",kn,Je(u.$t("msg.noRecordsMatchYourSearchQuery")),1)):(d(),Y("p",wn,Je(u.$t("msg.noRecordsAvailForLinking")),1))]))]),I("div",gn,[I("div",Ln,[!e(Ye)&&!e(R)&&e(ae)("dataEdit",e(Ie))&&!e(re)&&!((Q=e(O))!=null&&Q.synced)?(d(),w(xe,{key:0,entity:e(ma).TABLE,"entity-id":(ne=e(O))==null?void 0:ne.id,permission:e(pa).TABLE_RECORD_ADD},{default:Ae(({isAllowed:c})=>[gt((d(),w(je,{size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",disabled:!c,onClick:He},{default:Ae(()=>[I("div",bn,[e(Re)?Pe("",!0):(d(),w(Ge,{key:0})),Lt(" "+Je(u.$t("activity.newRecord")),1)])]),_:2},1032,["disabled"])),[[l,["c:row-expand:open"]]])]),_:1},8,["entity","entity-id","permission"])):Pe("",!0)]),(ke=e(U))!=null&&ke.pageInfo&&+((ue=(ve=e(U))==null?void 0:ve.pageInfo)==null?void 0:ue.totalRows)>e(m).size?(d(),Y(ut,{key:0},[e(Re)?(d(),Y("div",xn,[fe(lt,{current:e(m).page,"onUpdate:current":i[6]||(i[6]=c=>e(m).page=c),"page-size":e(m).size,"onUpdate:pageSize":i[7]||(i[7]=c=>e(m).size=c),total:+((q=(De=e(U))==null?void 0:De.pageInfo)==null?void 0:q.totalRows),"entity-name":"links-excluded-list"},null,8,["current","page-size","total"])])):(d(),Y("div",Cn,[fe(lt,{current:e(m).page,"onUpdate:current":i[8]||(i[8]=c=>e(m).page=c),"page-size":e(m).size,"onUpdate:pageSize":i[9]||(i[9]=c=>e(m).size=c),total:+((X=(W=e(U))==null?void 0:W.pageInfo)==null?void 0:X.totalRows),"entity-name":"links-excluded-list",mode:"simple"},null,8,["current","page-size","total"])]))],64)):Pe("",!0)])]),(d(),w(_a,null,{default:Ae(()=>{var c;return[e(ce)?(d(),w(n,{key:0,modelValue:e(ce),"onUpdate:modelValue":i[10]||(i[10]=b=>ya(ce)?ce.value=b:null),"load-row":!e(Ye),"close-after-save":e(be),meta:e(O),"new-record-header":e(be)?u.$t("activity.tableNameCreateNewRecord",{tableName:(c=e(O))==null?void 0:c.title}):void 0,row:{row:e(Se),oldRow:{},rowMeta:e(he)?{new:!0}:{}},"row-id":("extractPkFromRow"in u?u.extractPkFromRow:e(Ot))(e(Se),e(O).columns),state:e(yt),"use-meta-fields":"","maintain-default-view-order":"","skip-reload":"","new-record-submit-btn-text":e(he)?"Create & Link":void 0,onDeletedRecord:ot,onCreatedRecord:kt},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","row-id","state","new-record-submit-btn-text"])):Pe("",!0)]}),_:1}))],34)}}}),Ta=Object.assign(qt(Rn,[["__scopeId","data-v-5d71f564"]]),{__name:"VirtualCellComponentsUnLinkedItems"}),ds=Object.freeze(Object.defineProperty({__proto__:null,default:Ta},Symbol.toStringTag,{value:"Module"})),En=Ct({__name:"LinkRecordDropdown",props:{isOpen:{type:Boolean,default:!1}},emits:["update:isOpen"],setup(t,{emit:K}){const p=Nt(t,"isOpen",K),Re=f(),ae=`link-records_${Math.floor(Math.random()*99999)}`,k=($=!1)=>{var z,F,R,U;const C=(U=(R=(F=(z=Re.value)==null?void 0:z.parentElement)==null?void 0:F.parentElement)==null?void 0:R.parentElement)==null?void 0:U.parentElement;C&&($?C.classList.add("inset-0","nc-link-dropdown-root",`nc-root-${ae}`):C.classList.remove("inset-0","nc-link-dropdown-root",`nc-root-${ae}`))};return Te(p,$=>{$?tl(document.querySelector(`.${ae}`),C=>{const z=C==null?void 0:C.target;!(z!=null&&z.classList.contains(`nc-root-${ae}`))||z!=null&&z.closest(`.nc-${ae}`)||(p.value=!1,k(!1))}):k(!1)},{flush:"post"}),Te([Re,p],()=>{Re.value&&(p.value?k(!0):k(!1))}),($,C)=>{const z=al;return d(),w(z,{visible:e(p),placement:"bottom","overlay-class-name":`nc-links-dropdown !min-w-[540px] !xs:min-w-[90vw] ${e(p)?"active":""}`,class:dt(`.nc-${ae}`)},{overlay:Ae(()=>[I("div",{ref_key:"ncLinksDropdownRef",ref:Re,class:dt(["nc-links-dropdown-wrapper",`${ae}`])},[ta($.$slots,"overlay")],2)]),default:Ae(()=>[ta($.$slots,"default")]),_:3},8,["visible","overlay-class-name","class"])}}}),Va=Object.assign(En,{__name:"VirtualCellComponentsLinkRecordDropdown"}),cs=Object.freeze(Object.defineProperty({__proto__:null,default:Va},Symbol.toStringTag,{value:"Module"})),In={class:"flex w-full group items-center min-h-4"},On={class:"block flex-shrink truncate"},Tn=["tabindex","onKeydown"],Vn=Ct({__name:"Links",setup(t){const K=g(sa,!1),T=g(nl,wt(ll)),V=g(ka,f(0)),p=g(Vt),Re=g(wa),ae=g(Ut,_t()),k=g(xt,f(!1)),$=g(Ft,f(!1)),C=g(sl,f(!1)),z=g(ga,f(!1)),F=g(ol,wt({})),R=g(il,null),U=vt(()=>{var L;return((L=p.value)==null?void 0:L.title)||""}),S=f(!1),y=f(!1),Z=f(!1),G=f(!1),{isUIAllowed:Ee}=bt(),{t:ee}=Tt(),{state:j,isNew:_e}=Kt(),{relatedTableMeta:m,loadRelatedTableMeta:se,relatedTableDisplayValueProp:ye}=Al(p,Re,_e,ae.trigger),Ve=vt(()=>{var L,h;return(h=(L=m.value)==null?void 0:L.columns)==null?void 0:h.find(Ie=>Ie.title===ye.value)});se();const Ne=vt(()=>!$.value&&Ee("dataEdit")&&!C.value||k.value),O=vt(()=>{var h,Ie,ge,Le,Fe,D,ie,Ye;if(k.value||_e.value)return(Ie=(h=j.value)==null?void 0:h[U.value])!=null&&Ie.length?`${+((Le=(ge=j.value)==null?void 0:ge[U.value])==null?void 0:Le.length)} ${ee("msg.recordsLinked")}`:k.value&&!z.value?ee("title.linkRecords"):ee("msg.noRecordsLinked");const L=+(V==null?void 0:V.value)||0;return L?L===1?`1 ${((D=(Fe=p.value)==null?void 0:Fe.meta)==null?void 0:D.singular)||ee("general.link")}`:`${L} ${((Ye=(ie=p.value)==null?void 0:ie.meta)==null?void 0:Ye.plural)||ee("general.links")}`:ee("msg.noRecordsLinked")}),we=vt(()=>{var L,h;return k!=null&&k.value?(h=(L=j.value)==null?void 0:L[U.value])==null?void 0:h.length:+(V==null?void 0:V.value)||0}),de=()=>{y.value=!1,S.value=!0,G.value=!1},M=()=>{S.value=!1,y.value=!0},A=()=>{C.value||(y.value=!0,S.value=!1,Z.value=!0,G.value=!1)};$l(g(La,f(!1)),L=>{switch(L.key){case"Enter":if(S.value)return;y.value=!0,Z.value=!0,L.stopPropagation();break}});const $e=vt(()=>{var L;return _e.value?((L=j==null?void 0:j.value)==null?void 0:L[p==null?void 0:p.value.title])??[]:[]}),le=()=>{Ne.value&&(S.value=!0,y.value=!1,Z.value=!0,G.value=!0)};Te([y,S],()=>{Z.value=y.value||S.value}),Te(Z,L=>{L||(S.value=!1,y.value=!1)},{flush:"post"});const oe=L=>{if(!(!(L instanceof KeyboardEvent)||!L.target||dl(L))&&cl(L))return y.value?(S.value=!1,y.value=!1):A(),!0};return jt(()=>{R==null||R.on(oe),!C.value&&K&&!z.value&&T&&rl(()=>{oe(F.event)||(aa(".nc-canvas-table-editable-cell-wrapper .nc-canvas-links-icon-plus",T)?le():aa(".nc-canvas-table-editable-cell-wrapper .nc-canvas-links-text",T)?A():Ne.value?le():A())})}),Mt(()=>{R==null||R.off(oe)}),(L,h)=>{const Ie=Gt,ge=Oa,Le=Ta,Fe=Va,D=Bt("e");return d(),Y("div",{class:"nc-cell-field flex w-full group items-center nc-links-wrapper py-1",onDblclick:Ce(A,["stop"])},[fe(Fe,{"is-open":Z.value,"onUpdate:isOpen":h[6]||(h[6]=ie=>Z.value=ie)},{overlay:Ae(()=>[y.value?(d(),w(ge,{key:0,modelValue:y.value,"onUpdate:modelValue":h[2]||(h[2]=ie=>y.value=ie),items:e(we),column:e(Ve),"cell-value":e($e),onAttachRecord:de,onEscape:h[3]||(h[3]=ie=>Z.value=!1)},null,8,["modelValue","items","column","cell-value"])):Pe("",!0),S.value?(d(),w(Le,{key:1,modelValue:S.value,"onUpdate:modelValue":h[4]||(h[4]=ie=>S.value=ie),column:e(Ve),"hide-back-btn":G.value,onAttachLinkedRecord:M,onEscape:h[5]||(h[5]=ie=>Z.value=!1)},null,8,["modelValue","column","hide-back-btn"])):Pe("",!0)]),default:Ae(()=>[I("div",In,[I("div",On,[gt((d(),w(ul(e(C)?"span":"a"),{title:e(O),class:dt(["text-center nc-datatype-link underline-transparent nc-canvas-links-text font-weight-500",{"!text-gray-300":!e(O)}]),tabindex:e($)?-1:0,onClick:h[0]||(h[0]=Ce(ie=>e(k)&&!e(z)?le():A(),["stop","prevent"])),onKeydown:h[1]||(h[1]=Qe(Ce(ie=>e(k)&&!e(z)?le():A,["stop","prevent"]),["enter"]))},{default:Ae(()=>[Lt(Je(e(O)),1)]),_:1},40,["title","class","tabindex"])),[[D,["c:cell:links:modal:open"]]])]),h[7]||(h[7]=I("div",{class:"flex-grow"},null,-1)),e(Ne)?(d(),Y("div",{key:0,class:dt([{hidden:e(C)},"!xs:hidden flex group justify-end group-hover:flex items-center nc-canvas-links-icon-plus"]),tabindex:e($)?-1:0,onKeydown:Qe(Ce(le,["stop"]),["enter"])},[fe(Ie,{class:"select-none !text-md text-gray-700 nc-action-icon nc-plus invisible group-hover:visible group-focus:visible",onClick:Ce(le,["stop"])})],42,Tn)):Pe("",!0)])]),_:1},8,["is-open"])],32)}}}),$n=Object.assign(Vn,{__name:"VirtualCellLinks"}),Sn=pe(()=>me(()=>import("./osS8F1ZT.js"),__vite__mapDeps([107,1,2,108,103,22,7,109,28,26,27,13,14,9,10,11,12,15,16,17,18,19,5,20,21,23,24,25,29,30,31,32,33,34,35,110]),import.meta.url).then(t=>t.default||t)),Dn=pe(()=>me(()=>import("./C34BbtOJ.js"),__vite__mapDeps([111,1,2,108,103,22,7,109,28,26,27,13,14,9,10,11,12,15,16,17,18,19,5,20,21,23,24,25,29,30,31,32,33,34,35,112]),import.meta.url).then(t=>t.default||t)),zn=pe(()=>me(()=>import("./BWLmO9rU.js"),__vite__mapDeps([113,1,2,108,103,22,7,109,28,26,27,13,14,9,10,11,12,15,16,17,18,19,5,20,21,23,24,25,29,30,31,32,33,34,35,114]),import.meta.url).then(t=>t.default||t)),An=pe(()=>me(()=>import("./DumdhwR7.js"),__vite__mapDeps([115,1,2,108,103,22,7,109,28,26,27,13,14,9,10,11,12,15,16,17,18,19,5,20,21,23,24,25,29,30,31,32,33,34,35,116]),import.meta.url).then(t=>t.default||t)),Pn=pe(()=>me(()=>import("./DAQX8Nf_.js"),__vite__mapDeps([117,1,2,118,13,14]),import.meta.url).then(t=>t.default||t)),Nn=pe(()=>me(()=>import("./BS6ayr8r.js"),__vite__mapDeps([119,1,2,102,22,118,13,14]),import.meta.url).then(t=>t.default||t)),Fn=pe(()=>me(()=>import("./CbSkBAiy.js"),__vite__mapDeps([120,1,2,101,121,118,13,14,122]),import.meta.url).then(t=>t.default||t)),Un=pe(()=>me(()=>import("./3Q4XGDlM.js"),__vite__mapDeps([123,1,2,121,118,13,14,124]),import.meta.url).then(t=>t.default||t)),jn=pe(()=>me(()=>import("./B5eD6FFY.js"),__vite__mapDeps([125,1,2]),import.meta.url).then(t=>t.default||t)),Mn=pe(()=>me(()=>import("./BAkUHzkR.js"),__vite__mapDeps([126,1,2,7,118,13,14,127]),import.meta.url).then(t=>t.default||t)),Bn=pe(()=>me(()=>import("./csoBc1Ng.js"),__vite__mapDeps([128,1,2,28,22,7,26,27,70,98,129]),import.meta.url).then(t=>t.default||t)),qn=pe(()=>me(()=>import("./BQnbr8ef.js"),__vite__mapDeps([130,1,2,60]),import.meta.url).then(t=>t.default||t)),Kn=pe(()=>me(()=>import("./Cxaoa39b.js"),__vite__mapDeps([131,1,2,18,68,132]),import.meta.url).then(t=>t.default||t)),Gn=Ct({__name:"VirtualCell",props:{column:{},modelValue:{},row:{},active:{type:Boolean},path:{},readOnly:{type:Boolean},isAllowed:{type:Boolean}},emits:["update:modelValue","navigate","save"],setup(t,{emit:K}){const T=t,V=K,p=rt(T,"column"),Re=rt(T,"active",!1),ae=rt(T,"row"),k=rt(T,"path"),$=rt(T,"readOnly",!1),C=rt(T,"isAllowed",!0);nt(Vt,p),nt(La,Re),nt(wa,ae),nt(oa,k),nt(ka,rt(T,"modelValue")),nt(ha,()=>V("save")),nt(Ft,$),nt(Cl,C);const z=g(vl,f(!1)),F=g(xt,f(!1)),R=g(ga,f(!1));function U(G,Ee){V("navigate",G),F.value||Ee.stopImmediatePropagation()}const S=N(()=>ia(p.value)),y=N(()=>{if(fl(p.value))return"link";if(pl(p.value))return"hm";if(ml(p.value))return"mm";if(ra(p.value))return"bt";if(ua(p.value))return"oo";if(_l(p.value))return"rollup";if(yl(p.value))return"formula";if(hl(p.value))return"qrCode";if(kl(p.value))return"barcode";if(wl(p.value))return"count";if(gl(p.value))return"lookup";if(Ll(p.value))return"button";if(bl(p.value))return"createdOrLastModifiedTimeCol";if(xl(p.value))return"createdOrLastModifiedByCol"}),Z=N(()=>{let G=`nc-virtual-cell-${(p.value.uidt||"default").toLowerCase()}`;return z.value&&!F.value&&y.value==="rollup"&&!R.value&&(G+=" text-right justify-end"),S.value&&!F.value&&(G+=" nc-display-value-cell"),G});return(G,Ee)=>{const ee=$n,j=Sn,_e=Dn,m=zn,se=An,ye=Pn,Ve=Nn,Ne=Fn,O=Un,we=jn,de=Mn,M=Bn,A=qn,$e=Kn;return d(),Y("div",{class:dt(["nc-virtual-cell w-full flex items-center",e(Z)]),onKeydown:[Ee[0]||(Ee[0]=Qe(Ce(le=>U(("NavigateDir"in G?G.NavigateDir:e(la)).NEXT,le),["exact"]),["enter"])),Ee[1]||(Ee[1]=Qe(Ce(le=>U(("NavigateDir"in G?G.NavigateDir:e(la)).PREV,le),["shift","exact"]),["enter"]))]},[e(y)==="link"?(d(),w(ee,{key:0})):e(y)==="hm"?(d(),w(j,{key:1})):e(y)==="mm"?(d(),w(_e,{key:2})):e(y)==="bt"?(d(),w(m,{key:3})):e(y)==="oo"?(d(),w(se,{key:4})):e(y)==="rollup"?(d(),w(ye,{key:5})):e(y)==="formula"?(d(),w(Ve,{key:6})):e(y)==="qrCode"?(d(),w(Ne,{key:7})):e(y)==="barcode"?(d(),w(O,{key:8})):e(y)==="count"?(d(),w(we,{key:9})):e(y)==="lookup"?(d(),w(de,{key:10})):e(y)==="button"?(d(),w(M,{key:11})):e(y)==="createdOrLastModifiedTimeCol"?(d(),w(A,{key:12,"model-value":G.modelValue},null,8,["model-value"])):e(y)==="createdOrLastModifiedByCol"?(d(),w($e,{key:13,"model-value":G.modelValue},null,8,["model-value"])):Pe("",!0)],34)}}}),Qn=Object.assign(qt(Gn,[["__scopeId","data-v-e393912b"]]),{__name:"SmartsheetVirtualCell"}),vs=Object.freeze(Object.defineProperty({__proto__:null,default:Qn},Symbol.toStringTag,{value:"Module"}));export{us as L,ds as U,vs as V,Qn as _,Ia as a,cs as b,Al as u};
