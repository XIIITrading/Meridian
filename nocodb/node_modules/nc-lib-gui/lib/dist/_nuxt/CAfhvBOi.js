var Ge=Object.defineProperty;var We=(f,a,o)=>a in f?Ge(f,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[a]=o;var Y=(f,a,o)=>We(f,typeof a!="symbol"?a+"":a,o);import{gX as Je,aj as d,cm as g,kA as Ke,gV as Qe,gU as Xe,gW as Ze,il as ze,b0 as C,kB as de,L as et,hK as ee,fq as Ne,i6 as tt,hP as rt,r as O,a8 as Q,am as it,b7 as at,J as st,a6 as lt,S as ot,al as nt,V as dt,a7 as ut,a9 as ct,b5 as ft,n as B,cg as Ve,cf as Me,cr as Oe,aD as H,aC as X,jq as mt,f_ as x,X as pt,aQ as Z,b_ as ht,dJ as bt,fU as ue,fm as vt,kC as kt,a4 as ce,a5 as wt,cG as yt,g2 as z,g1 as gt,$ as Ft,eV as St,eW as Ce,kD as Ae,iA as _t,jg as Vt,aX as Mt,jb as Ot}from"./DOFFjK0_.js";import{u as Ct}from"./SJHyi9T4.js";import{u as At}from"./BYGCxle3.js";import{u as Dt}from"./DcFNOSET.js";import{u as Nt}from"./4PLl4EP6.js";import{e as Rt}from"./D2QgEzTv.js";class De{constructor({data:a=[],nestedGroupedFilters:o={},formViewColumns:s=[],formViewColumnsMapByFkColumnId:m={},formState:k={},isMysql:V=void 0,isSharedForm:R=!1,getMeta:P=void 0}={}){Y(this,"allViewFilters");Y(this,"groupedFilters");Y(this,"nestedGroupedFilters");Y(this,"formViewColumns");Y(this,"formViewColumnsMapByFkColumnId");Y(this,"formState");Y(this,"value");Y(this,"isSharedForm");Y(this,"isMysql");Y(this,"getMeta");this.allViewFilters=a,this.groupedFilters={},this.nestedGroupedFilters=o,this.formViewColumns=s,this.formViewColumnsMapByFkColumnId=m,this.formState=k,this.isSharedForm=R,this.isMysql=V,this.getMeta=P}setFilters(a){this.allViewFilters=a}getRootFilters(a){return(this.groupedFilters[a]||[]).filter(o=>!o.fk_parent_id).sort((o,s)=>(o.order??1/0)-(s.order??1/0))}getParentFilters(a,o){return(this.groupedFilters[a]||[]).filter(s=>s.fk_parent_id===o).sort((s,m)=>(s.order??1/0)-(m.order??1/0))}getAllChildFilters(a,o){return a.map(s=>{if(s.id&&s.is_group){const m=this.getParentFilters(o,s.id);s.children=this.getAllChildFilters(m,o)}return s})}loadFilters(){for(const a in this.groupedFilters){const o=this.getRootFilters(a);this.nestedGroupedFilters[a]=this.getAllChildFilters(o,a)}return this.nestedGroupedFilters}getNestedGroupedFilters(){const a=this.allViewFilters.reduce((s,m)=>{const k=m.fk_parent_column_id||"ungrouped";return s[k]||(s[k]=[]),s[k].push(m),s},{});return this.groupedFilters=a,this.loadFilters()}toString(a){return`${a||""}`}isFieldAboveParentColumn(a,o){return a.order<o.order}async getOoOrBtColVal(a){var k,V,R;const o=(k=a==null?void 0:a.colOptions)==null?void 0:k.fk_related_model_id;if(!o||typeof this.getMeta!="function")return null;const s=await this.getMeta(o);if(!s||!Array.isArray(s==null?void 0:s.columns))return null;const m=((R=s.columns.find(P=>P.pv)||((V=s.columns)==null?void 0:V[0]))==null?void 0:R.title)||"";return!m||!this.formState[a.title]||!Je(this.formState[a.title])||this.formState[a.title][m]===void 0?null:this.formState[a.title][m]}async validateCondition(a=[],o,s){var k,V,R,P,$,G,E;if(!a.length)return!0;let m;for(const p of a){let n;if(p.is_group)n=await this.validateCondition(p.children,o,s);else{(!p.fk_column_id||!this.formViewColumnsMapByFkColumnId[p.fk_column_id])&&(n=!1);const h=this.formViewColumnsMapByFkColumnId[p.fk_column_id];this.isFieldAboveParentColumn(h,o)||(s[h.fk_column_id]=`Condition references a field (${h.title}) that comes later in the form.`,n=!0),h.show||(s[h.fk_column_id]=`Condition references a field (${h.title}) that was removed from the form.`,n=!0),(k=h.permissions)!=null&&k.isAllowedToEdit||(s[h.fk_column_id]=`Condition references a field (${h.title}) that is not editable and will be hidden in shared form.`,n=!0),h!=null&&h.visible||(n=!1);const I=h.title;let b=this.formState[I];if(n===void 0)if([d.Date,d.DateTime,d.CreatedTime,d.LastModifiedTime].includes(h.uidt)&&!["empty","blank","notempty","notblank"].includes(p.comparison_op)){const F=(V=this.isMysql)!=null&&V.call(this,h.source_id)?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";let S=g(new Date);const W=(R=h==null?void 0:h.meta)==null?void 0:R.date_format,_=b;let u=p.value;switch(W&&Ke(W)&&(S=g(S).date(1),b&&(b=g(b).date(1))),u&&(n=g(u).isSame(_,"day")),p.comparison_sub_op){case"today":u=S;break;case"tomorrow":u=S.add(1,"day");break;case"yesterday":u=S.add(-1,"day");break;case"oneWeekAgo":u=S.add(-1,"week");break;case"oneWeekFromNow":u=S.add(1,"week");break;case"oneMonthAgo":u=S.add(-1,"month");break;case"oneMonthFromNow":u=S.add(1,"month");break;case"daysAgo":if(!u)return;u=S.add(-u,"day");break;case"daysFromNow":if(!u)return;u=S.add(u,"day");break;case"exactDate":if(!u)return;break;case"pastWeek":u=S.add(-1,"week");break;case"pastMonth":u=S.add(-1,"month");break;case"pastYear":u=S.add(-1,"year");break;case"nextWeek":u=S.add(1,"week");break;case"nextMonth":u=S.add(1,"month");break;case"nextYear":u=S.add(1,"year");break;case"pastNumberOfDays":if(!u)return;u=S.add(-u,"day");break;case"nextNumberOfDays":if(!u)return;u=S.add(u,"day");break}if(_)switch(p.comparison_op){case"eq":n=g(_).isSame(u,"day");break;case"neq":n=!g(_).isSame(u,"day");break;case"gt":n=g(_).isAfter(u,"day");break;case"lt":n=g(_).isBefore(u,"day");break;case"lte":case"le":n=g(_).isSameOrBefore(u,"day");break;case"gte":case"ge":n=g(_).isSameOrAfter(u,"day");break;case"empty":case"blank":n=_===""||_===null||_===void 0;break;case"notempty":case"notblank":n=!(_===""||_===null||_===void 0);break;case"isWithin":{let j=g(new Date).format(F).toString();switch(j=h.uidt===d.Date?j.substring(0,10):j,p.comparison_sub_op){case"pastWeek":case"pastMonth":case"pastYear":case"pastNumberOfDays":n=g(_).isBetween(u,j,"day");break;case"nextWeek":case"nextMonth":case"nextYear":case"nextNumberOfDays":n=g(_).isBetween(j,u,"day");break}}}}else{switch(typeof p.value){case"boolean":b=!!this.formState[I];break;case"number":b=Number.isNaN(parseFloat(this.formState[I]))?this.formState[I]:+this.formState[I];break}switch(h.uidt){case d.Links:(Ze(h)||ze(h))&&(b=(this.formState[I]??[]).length);break;case d.LinkToAnotherRecord:(Qe(h)||Xe(h))&&(b=await this.getOoOrBtColVal(h));break}switch(p.comparison_op){case"eq":n=b==p.value;break;case"neq":n=b!=p.value;break;case"like":n=($=this.toString(b).toLowerCase())==null?void 0:$.includes((P=p.value)==null?void 0:P.toLowerCase());break;case"nlike":n=!((E=this.toString(b).toLowerCase())!=null&&E.includes((G=p.value)==null?void 0:G.toLowerCase()));break;case"empty":case"blank":n=b===""||b===null||b===void 0;break;case"notempty":case"notblank":n=!(b===""||b===null||b===void 0);break;case"checked":n=!!b;break;case"notchecked":n=!b;break;case"null":n=b===null;break;case"notnull":n=b!==null;break;case"allof":n=(this.toString(p.value).split(",").map(F=>F.trim())??[]).every(F=>(this.toString(b).split(",")??[]).includes(F));break;case"anyof":n=(this.toString(p.value).split(",").map(F=>F.trim())??[]).some(F=>(this.toString(b).split(",")??[]).includes(F));break;case"nallof":n=!(this.toString(p.value).split(",").map(F=>F.trim())??[]).every(F=>(this.toString(b).split(",")??[]).includes(F));break;case"nanyof":n=!(this.toString(p.value).split(",").map(F=>F.trim())??[]).some(F=>(this.toString(b).split(",")??[]).includes(F));break;case"lt":n=parseFloat(b)<+p.value;break;case"lte":case"le":n=parseFloat(b)<=+p.value;break;case"gt":n=parseFloat(b)>+p.value;break;case"gte":case"ge":n=parseFloat(b)>=+p.value;break}}}switch(p.logical_op){case"or":m=m||!!n;break;case"not":m=m&&!n;break;case"and":default:m=(m??!0)&&n;break}}return m}async validateVisibility(){var o;const a={};for(const s of this.formViewColumns){const m=this.nestedGroupedFilters[s.fk_column_id]??[],k={},V=await this.validateCondition(m,s,k);this.isSharedForm?(o=s.meta)!=null&&o.preFilledHiddenField||(s.show=!!V,s.visible=!!V):(s.visible=!!V,s.meta={...C(s.meta),visibility:{errors:k}})}return a}validateErrors(){}}const Et=f=>({validator:(a,o)=>new Promise((s,m)=>{const{t:k}=ee().global;return o&&!rt(o)?m(f.message||k("msg.error.invalidEmail")):s(!0)})}),Tt=f=>({validator:(a,o)=>new Promise((s,m)=>{const{t:k}=ee().global;return o&&!tt(o)?m(f.message||k("msg.invalidPhoneNumber")):s(!0)})}),Pt=f=>({validator:(a,o)=>new Promise((s,m)=>{const{t:k}=ee().global;return o&&!Ne(o)?m(f.message||k("msg.error.invalidURL")):s(!0)})}),Lt=f=>({validator:(a,o)=>new Promise((s,m)=>{const{t:k}=ee().global;return o&&o!=="-"&&!(f.uidt===d.Number?/^-?\d+$/.test(o):/^-?\d*\.?\d+$/.test(o))?m(k("msg.plsEnterANumber")):s(!0)})}),Yt=f=>(f=et(f),Array.isArray(f)?!!f.length:f==null?!1:f===!1?!0:typeof f=="object"?Object.keys(f).length>0:!!String(f).length),It=(f,a)=>{const o=[];switch([d.Number,d.Currency,d.Percent].includes(a.uidt)&&o.push(Lt(a)),a.uidt){case d.Email:{C(a.meta).validate&&o.push(Et({type:de.Email}));break}case d.PhoneNumber:{C(a.meta).validate&&o.push(Tt({type:de.PhoneNumber}));break}case d.URL:{C(a.meta).validate&&o.push(Pt({type:de.Url}));break}}return o},qt=(f,a)=>{f=f.replace(/\./g,"_").replace(/\[|\]/g,"_");let o=1,s=f;for(;a.has(s);)s=`${f}_${o}`,o++;return a.add(s),s},Bt=pt.useForm,[Kt,jt]=Ct(f=>{const a=O(!1),o=O(!1),s=O(!1),m=O(!1),k=O(null),V=O(null),R=O(0),{sharedView:P}=Q(it()),{blockAddNewRecord:$,showRecordPlanLimitExceededModal:G}=at();Mt(Ot,k);const E=O(),p=O(),n=O(),h=O({}),I=bt(),{isMobileMode:b}=st(),{api:F,isLoading:S}=lt(),{metas:W,setMeta:_,getMeta:u}=ot(),j=nt(),{workspaces:Re}=Q(j),te=dt(),{base:Ee,sqlUis:fe}=Q(te),Te=ut(),{basesUser:me}=Q(Te),{isAllowed:pe}=At(),{t:re}=ct(),ie=ft(),M=O({}),he=O({}),be=O({}),U=O({}),ve=O({}),ae=B(()=>{var e;return(e=p.value)!=null&&e.id?pe(Ve.TABLE,p.value.id,Me.TABLE_RECORD_ADD,{isFormView:!0}):!0}),ke=B(()=>{var e,t,r;return typeof((e=E.value)==null?void 0:e.redirect_url)=="string"&&!!((r=(t=E.value)==null?void 0:t.redirect_url)!=null&&r.trim())});Dt(p);const{state:A}=Nt(O({row:M,rowMeta:{new:!0},oldRow:{}})),se=B(()=>{var e;return(e=n.value||[])==null?void 0:e.filter(t=>we(t))}),Pe=B(()=>se.value.reduce((e,t)=>(e[t.fk_column_id]=t,e),{})),Le=B(()=>new De({nestedGroupedFilters:ve.value,formViewColumns:se.value,formViewColumnsMapByFkColumnId:Pe.value,formState:{...M.value||{},...A.value||{}},isSharedForm:!0,isMysql:e=>{var t;return["mysql",Oe.MYSQL].includes(((t=P.value)==null?void 0:t.client)||Oe.MYSQL)},getMeta:u})),J=B(()=>{var e;return((e=n.value)==null?void 0:e.filter(t=>{var l;const r=t.show,v=((l=t==null?void 0:t.permissions)==null?void 0:l.isAllowedToEdit)??!0;return r&&we(t)&&v}))||[]});function we(e){return!X(e)&&e.uidt!==d.SpecificDBType&&!mt(e)&&(!x(e)||H(e.uidt))}const Ye=async()=>{var e,t,r,v;V.value=null;try{const l=await F.public.sharedViewMetaGet(f,{headers:{"xc-password":k.value}});l!=null&&l.workspace&&Re.value.set(l.workspace.id,l.workspace),m.value=!1,P.value=l,E.value=l.view,p.value=l.model,_e(Array.isArray((e=l==null?void 0:l.filter)==null?void 0:e.children)?(t=l==null?void 0:l.filter)==null?void 0:t.children:[]);const w=l.meta;h.value=yt(w)?JSON.parse(w):w,await _(l.model),(r=Ee.value)!=null&&r.sources||te.setProject({sources:[{id:l.source_id,type:l.client}]});const D={...l.relatedMetas};Object.keys(D).forEach(i=>_(D[i])),l.users&&me.value.set(l.base_id,l.users);const N=(l.columns||[]).reduce((i,c)=>({...i,[c.fk_column_id]:c}),{});n.value=(((v=l.model)==null?void 0:v.columns)||[]).filter(i=>N[i.id]).map(i=>{if(!X(i)&&!x(i)&&!z(i)&&i.uidt!==d.SpecificDBType&&(i!=null&&i.title)&&gt(i==null?void 0:i.cdf)&&!/^\w+\(\)|CURRENT_TIMESTAMP$/.test(i.cdf)){const c=typeof i.cdf=="string"?i.cdf.replace(/^['"]|['"]$/g,""):i.cdf;[d.Number,d.Duration,d.Percent,d.Currency,d.Decimal].includes(i.uidt)?(M.value[i.title]=Number(c)||null,U.value[i.title]=Number(c)||null):i.uidt===d.Checkbox?["true","1"].includes(String(c).toLowerCase())?(M.value[i.title]=!0,U.value[i.title]=!0):["false","0"].includes(String(c).toLowerCase())&&(M.value[i.title]=!1,U.value[i.title]=!1):(M.value[i.title]=c,U.value[i.title]=c)}return{...i,readonly:ae.value?(i==null?void 0:i.readonly)??!1:!0,read_only:ae.value?(i==null?void 0:i.read_only)??!1:!0,order:N[i.id].order||i.order,visible:!0,meta:{...C(N[i.id].meta),...C(i.meta)},description:N[i.id].description,permissions:{isAllowedToEdit:pe(Ve.FIELD,i.id,Me.RECORD_FIELD_EDIT,{isFormView:!0})}}}).sort((i,c)=>(i.order??1/0)-(c.order??1/0)),await xe(),K(),Ft(()=>{G({isSharedFormView:!0,focusBtn:null})})}catch(l){const w=await St(l);l.response&&l.response.status===404?o.value=!0:w.error===Ce.INVALID_SHARED_VIEW_PASSWORD?(m.value=!0,k.value&&k.value!==""&&(V.value=w.message)):w.error===Ce.UNKNOWN_ERROR&&(console.error("Error occurred while loading shared form view",l),ce.error("Error occurred while loading shared form view"))}},q=B(()=>{const e=new Set;return J.value.reduce((t,r)=>(t[r.title]=qt(r.title,e),t),{})}),ye=B(()=>{const e={};if(!J.value||!Object.keys(q.value).length)return e;for(const t of J.value){let r=[{validator:(l,w)=>new Promise((D,N)=>ne(t)&&t.show&&(typeof w=="string"&&(w=w.trim()),t.uidt===d.Rating&&(!w||Number(w)<1)||t.uidt===d.Checkbox&&!w||t.uidt!==d.Checkbox&&!Yt(w))?N(re("msg.error.fieldRequired")):D())},{validator:l=>new Promise(w=>(K(),w()))}];const v=It(C(t.meta).validators??[],t);r=[...r,...v],r.length&&(e[q.value[t.title]]=r)}return e}),Ie=B(()=>{if(!Object.keys(q.value).length)return{};const e=Object.keys(M.value).reduce((r,v)=>(r[q.value[v]]=M.value[v],r),{}),t=Object.keys(A.value).reduce((r,v)=>(r[q.value[v]]=A.value[v],r),{});return{...e,...t}}),{validate:le,validateInfos:qe,clearValidate:ge}=Bt(Ie,ye),Fe=async()=>{var e,t;for(const r of se.value)r.title&&r.show&&r.visible&&((e=r.permissions)!=null&&e.isAllowedToEdit)&&ne(r)&&M.value[r.title]===void 0&&A.value[r.title]===void 0&&(x(r)?A.value={...A.value||{},[r.title]:null}:M.value[r.title]=null),(!r.visible||!((t=r.permissions)!=null&&t.isAllowedToEdit))&&r.title&&(delete M.value[r.title],delete A.value[r.title])},Be=async()=>{var e;await Fe();try{return await le([...Object.keys(M.value).map(t=>q.value[t]),...Object.keys(A.value).map(t=>q.value[t])].filter(t=>t!==void 0)),!0}catch(t){if(console.error("Error occurred while validating all fields:",t),(e=t==null?void 0:t.errorFields)!=null&&e.length)return ce.error(re("msg.error.someOfTheRequiredFieldsAreEmpty")),!1}},je=async()=>{var e,t,r,v;if(!$.value){try{if(!await Be())return;a.value=!0;const l={...M.value,...A.value},w={};for(const c of(r=(t=W.value)==null?void 0:t[(e=P.value)==null?void 0:e.fk_model_id])==null?void 0:r.columns)c.uidt===d.Attachment&&l[c.title]&&(w[`_${c.title}`]=l[c.title].map(T=>T.file));const D=kt({data:l,...w}),N=await F.public.dataCreate(P.value.uuid,D,{headers:{"xc-password":k.value}}),i=Rt(N,(v=p.value)==null?void 0:v.columns);if(i&&ke.value){const c=E.value.redirect_url.replace("{record_id}",i),T=document.createElement("a");T.href=c,T.host===window.location.host?(window.history.pushState({},"Redirect",c),window.location.reload()):window.location.href=c}else s.value=!0,a.value=!1}catch(l){console.error(l),await ce.error(await wt(l))}a.value=!1}},Se=async()=>{I.trigger(),A.value={...be.value},M.value={...U.value,...h.value.preFillEnabled?he.value:{}},ge(),K()};async function xe(){if(Object.keys(ie.query||{}).length){n.value=await Promise.all((n.value||[]).map(async e=>{const t=ie.query[e.title];if(!e.title||!t||X(e)||x(e)&&!H(e)||!h.value.preFillEnabled&&!x(e)&&!H(e)||z(e)||e.uidt===d.SpecificDBType)return e;const r=Array.isArray(t)?t.map(l=>decodeURIComponent(l).trim()):decodeURIComponent(t).trim(),v=await Ue(e,r);if(v!==void 0&&(H(e)?A.value={...A.value||{},[e.title]:v}:M.value[e.title]=v,h.value.preFillEnabled))switch(h.value.preFilledMode){case Ae.Hidden:{e.show=!1,e.meta={...C(e.meta),preFilledHiddenField:!0};break}case Ae.Locked:{e.read_only=!0;break}}return e}));try{be.value=JSON.parse(JSON.stringify(A.value||{})),he.value=JSON.parse(JSON.stringify(M.value||{}))}catch{}}}function He(e){var t;return(t=e!=null&&e.source_id?fe.value[e==null?void 0:e.source_id]:Object.values(fe.value)[0])==null?void 0:t.getAbstractType(e)}async function Ue(e,t){var v,l,w,D,N;let r;switch(e.uidt){case d.SingleSelect:case d.MultiSelect:case d.User:{const i=(C(e.meta).isLimitOption?C(e.meta).limitOptions||[]:[]).reduce((y,L)=>(L!=null&&L.id&&(y[L.id]=L),y),{}),c=t.split(",");let T=[];[d.SingleSelect,d.MultiSelect].includes(e.uidt)?(T=(((v=e.colOptions)==null?void 0:v.options)||[]).filter(y=>{var L;return!!(y!=null&&y.id&&(y!=null&&y.title)&&c.includes(y.title)&&(i[y.id]?(L=i[y.id])!=null&&L.show:!C(e.meta).isLimitOption||!(C(e.meta).limitOptions||[]).length))}).map(y=>y.title),T.length&&(r=e.uidt===d.SingleSelect?T[0]:T.join(","))):(T=((l=p.value)!=null&&l.base_id?me.value.get(p.value.base_id)||[]:[]).filter(y=>{var L;return!!(y!=null&&y.id&&(y!=null&&y.email)&&(c.includes(y.email)||c.includes(y.id))&&(i[y.id]?(L=i[y.id])!=null&&L.show:!C(e.meta).isLimitOption||!(C(e.meta).limitOptions||[]).length))}).map(y=>y.email),T.length&&(r=(w=C(e.meta))!=null&&w.is_multi?T.join(","):T[0]));break}case d.Checkbox:{["true",!0,"1",1].includes(t.toLowerCase())?r=!0:["false",!1,"0",0].includes(t.toLowerCase())&&(r=!1);break}case d.Rating:{isNaN(Number(t))||(r=Math.min(Math.max(Number(t),0),C(e.meta).max??5));break}case d.URL:{C(e.meta).validate?Ne(t)&&(r=t):r=t;break}case d.Year:{/^\d+$/.test(t)&&(r=Number(t));break}case d.Date:{const i=g(t);(i.isValid()&&i.toISOString()===t||g(t,"YYYY-MM-DD").isValid())&&(r=g(t).format("YYYY-MM-DD"));break}case d.DateTime:{const i=g(t);(i.isValid()&&i.toISOString()===t||g(t,"YYYY-MM-DD HH:mm:ss").isValid())&&(r=g(t).utc().format("YYYY-MM-DD HH:mm:ssZ"));break}case d.Time:{let i=g(t);i.isValid()||(i=g(t,"HH:mm:ss")),i.isValid()||(i=g(`1999-01-01 ${t}`)),i.isValid()&&(r=i.format(te.isMysql(e.source_id)?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ"));break}case d.LinkToAnotherRecord:case d.Links:{const i=Array.isArray(t)?t:t.split(",");r=await $e(e,i),(((D=e.colOptions)==null?void 0:D.type)===ue.BELONGS_TO||((N=e.colOptions)==null?void 0:N.type)===ue.ONE_TO_ONE)&&(r=r[0]);break}default:_t(e,He(e))?isNaN(Number(t))||(r=Number(t)):r=t}return r}async function $e(e,t){var N,i;const r=await u((N=e.colOptions)==null?void 0:N.fk_related_model_id);if(!r)return[];let v,l,w;const D=new Set;for(const c of r.columns||[])!l&&c.pk&&(l=c),!w&&c.pv&&(w=c),!v&&z(c)&&(v=c),!(X(c)||Vt(c)||H(c)||z(c))&&D.size<(b.value?1:3)&&D.add(c.title);return v&&D.add(v.title),l&&D.add(l.title),w&&D.add(w.title),!l||t.length===0?[]:((i=await F.public.dataRelationList(ie.params.viewId,e.id,{},{headers:{"xc-password":k.value},query:{limit:Math.max(25,t.length),where:`(${l.title},in,${t.join(",")})`,fields:Array.from(D)}}))==null?void 0:i.list)||[]}let oe;Z(s,e=>{var t,r,v;if(e&&((t=E.value)!=null&&t.show_blank_form)){if(typeof((r=E.value)==null?void 0:r.redirect_url)=="string")return;R.value=5,oe=ht(()=>{R.value=R.value-1,R.value<0&&(s.value=!1,I.trigger(),clearInterval(oe))},1e3)}e||((v=E.value)!=null&&v.show_blank_form&&clearInterval(oe),Se())});function ne(e){var t;if(!x(e)&&(e.rqd&&!e.cdf||e.pk&&!(e.ai||e.cdf)||e.required))return!0;if(H(e)&&e.colOptions&&e.colOptions.type===ue.BELONGS_TO){const r=(t=n.value)==null?void 0:t.find(v=>{var l;return v.id===((l=e==null?void 0:e.colOptions)==null?void 0:l.fk_child_column_id)});if((r&&r.rqd&&!r.cdf||e.required)&&r)return!0}else if(x(e)&&e.required)return!0;return!1}function _e(e){if(!e.length)return;const r=new De({data:e}).getNestedGroupedFilters();ve.value={...r}}async function K(){await Le.value.validateVisibility()}return Z(k,(e,t)=>{e!==t&&V.value&&(V.value=null)}),Z(()=>{var e;return(e=E.value)==null?void 0:e.heading},()=>{var e;vt(`${((e=E.value)==null?void 0:e.heading)??"NocoDB"}`)},{flush:"post"}),Z(A,async()=>{try{await le(Object.keys(A.value).map(e=>q.value[e]).filter(e=>e!==void 0))}catch{}},{deep:!0}),{sharedView:P,sharedFormView:E,loadSharedView:Ye,columns:n,submitForm:je,clearForm:Se,progress:a,meta:p,validators:ye,formColumns:J,formState:M,notFound:o,password:k,passwordError:V,submitted:s,secondsRemain:R,passwordDlg:m,isLoading:S,sharedViewMeta:h,onReset:I.on,validate:le,validateInfos:qe,clearValidate:ge,additionalState:A,isRequired:ne,handleAddMissingRequiredFieldDefaultState:Fe,fieldMappings:q,isValidRedirectUrl:ke,loadAllviewFilters:_e,checkFieldVisibility:K,isAddingEmptyRowPermitted:ae}},"shared-form-view-store");function Qt(){const f=jt();if(f==null)throw new Error("Please call `useProvideSharedFormStore` on the appropriate parent component");return f}export{De as F,Kt as a,It as e,qt as g,Yt as r,Qt as u};
